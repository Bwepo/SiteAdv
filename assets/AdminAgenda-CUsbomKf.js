import{a3 as Ee,at as Ae,r as o,h as Y,j as e,m as Me,e as m}from"./index-DecnLHKo.js";import{C as H,c as U,a as Le,b as $e}from"./card-CiqP3Dhs.js";import{B as w}from"./badge-D5OiQakQ.js";import{B as i}from"./button-blv5p1JR.js";import{I as Be}from"./input-b1PXoCdy.js";import{S as Oe}from"./scroll-area-DNU-2HGY.js";import{S as Q,f as W,g as q,h as G,i as g}from"./form-CMkr7sE5.js";import{A as Pe,a as ze,b as Fe,c as Re,d as Ve,e as Ie,f as _e,g as Ye}from"./alert-dialog-BUy4Fiut.js";import{E as J,a as K,c as k,P as He}from"./crmTypes-3TDjSWGp.js";import{A as Ue,C as Qe,S as We}from"./CrmSkeletons-CFJ1v4et.js";import{A as qe}from"./AgendaEventSheet-2lbmSOqp.js";import{P as X}from"./plus-DvZzPKn5.js";import{C as le}from"./clock-BAF3oms6.js";import{U as Ge}from"./users-7BIpTiLP.js";import{M as Je}from"./map-pin-CNx5aw8c.js";import{T as Ke}from"./trash-2-DIp5utsS.js";import{C as ie}from"./chevron-left-enJtcxrg.js";import{C as ce}from"./chevron-right-Didn2Abd.js";import{C as Xe}from"./calendar-CKfyerD0.js";import{S as Ze}from"./search-BhDD_Kfz.js";import"./index-BA9iO99N.js";import"./index-X8yNqmBR.js";import"./index-DihTyu0G.js";import"./chevron-up-Bvm8CVkA.js";import"./check-C_sBm2Xx.js";import"./label-B-BRMFKQ.js";import"./index-qxHTWXA6.js";import"./refresh-cw-2Ry1Cmgh.js";import"./skeleton-eE-V90Uh.js";import"./sheet-5BOo_W2m.js";import"./textarea-DDCHxpxP.js";import"./loader-circle-DBTixJ4M.js";import"./types-C9wiu8_K.js";function et(h){const T=h.split("T")[0],[p,E,A]=T.split("-");return`${A}/${E}/${p}`}function Bt({projectId:h,hideHeader:T}={}){const{events:p,loading:E,syncing:A,error:de,lastSync:me,sync:xe,deleteEvent:he,createEvent:pe,updateEvent:M}=Ee(),{projects:ue}=Ae(),[f,Z]=o.useState("calendar"),[u,ee]=o.useState(""),[j,te]=o.useState("all"),[N,se]=o.useState("all"),[b,ae]=o.useState(h||"all"),[D,re]=o.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[ge,S]=o.useState(!1),[L,$]=o.useState(null),[B,O]=o.useState(null);o.useState(null);const[fe,P]=o.useState(null),[d,ne]=o.useState(null),je=o.useCallback(async(t,s)=>{t.preventDefault(),P(null);const a=t.dataTransfer.getData("eventId");if(!a)return;const r=p.find(n=>n.id===a);if(!(!r||r.date===s))try{await M(a,{title:r.title,date:s,time:r.time,endTime:r.endTime,type:r.type,status:r.status,clientName:r.client,location:r.location,description:r.description,projectAirtableId:r.projectId}),Y.success(`"${r.title}" reagendado para ${new Date(s+"T12:00:00").toLocaleDateString("pt-BR")}`)}catch{Y.error("Erro ao reagendar")}},[p,M]),x=o.useMemo(()=>{const t=h||b;return p.filter(s=>{var a;return!(u&&!s.title.toLowerCase().includes(u.toLowerCase())&&!((a=s.client)!=null&&a.toLowerCase().includes(u.toLowerCase()))||j!=="all"&&s.type!==j||N!=="all"&&s.status!==N||t!=="all"&&s.projectId!==t)}).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||""))},[p,u,j,N,b,h]),z=()=>{$(null),S(!0)},F=t=>{$(t),S(!0)},Ne=async(t,s)=>{s?await pe(t):L&&await M(L.id,t)},ve=async()=>{if(B)try{await he(B)}catch{Y.error("Erro ao remover compromisso.")}finally{O(null)}},ye=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),we=o.useMemo(()=>{const{year:t,month:s}=D,a=new Date(t,s,1),r=new Date(t,s+1,0),n=a.getDay(),c=[],_=l=>`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;for(let l=n-1;l>=0;l--){const C=new Date(t,s,-l);c.push({date:_(C),day:C.getDate(),isCurrentMonth:!1})}for(let l=1;l<=r.getDate();l++){const C=new Date(t,s,l);c.push({date:_(C),day:l,isCurrentMonth:!0})}for(;c.length<42;){const l=new Date(t,s+1,c.length-n-r.getDate()+1);c.push({date:_(l),day:l.getDate(),isCurrentMonth:!1})}return c},[D]),R=o.useMemo(()=>{const t=new Map;return x.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[x]),v=(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),be=o.useMemo(()=>x.filter(t=>t.date>=v).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[x,v]),De=new Date(D.year,D.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),Se=()=>re(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),Ce=()=>re(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),[V,I]=o.useState(0),y=o.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()+V*7);const a=[];for(let r=0;r<7;r++){const n=new Date(s);n.setDate(s.getDate()+r),a.push(`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`)}return a},[V]),ke=o.useMemo(()=>{if(y.length===0)return"";const t=new Date(y[0]+"T12:00:00"),s=new Date(y[6]+"T12:00:00");return`${t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})} — ${s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}`},[y]),oe=o.useMemo(()=>{const t=new Map;return x.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[x]),Te=()=>T?e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(w,{variant:"secondary",className:"text-xs",children:[x.length," eventos"]}),e.jsxs(i,{onClick:z,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(X,{className:"mr-1.5 h-4 w-4"})," Novo Compromisso"]})]}):e.jsxs("div",{className:"flex flex-col gap-3 glass p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(Be,{placeholder:"Buscar compromisso ou cliente...",value:u,onChange:t=>ee(t.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs(i,{onClick:z,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(X,{className:"mr-1.5 h-4 w-4"})," Novo Compromisso"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsx("button",{onClick:()=>Z("calendar"),className:m("px-4 py-1.5 text-sm font-medium transition-colors",f==="calendar"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Mês"}),e.jsx("button",{onClick:()=>Z("week"),className:m("px-4 py-1.5 text-sm font-medium transition-colors",f==="week"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Semana"})]}),e.jsx(We,{syncing:A,lastSync:me,onSync:xe,error:de})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center text-xs text-muted-foreground",children:[e.jsxs(Q,{value:j,onValueChange:te,children:[e.jsx(W,{className:"w-[130px] h-8 text-xs",children:e.jsx(q,{placeholder:"Tipo"})}),e.jsxs(G,{children:[e.jsx(g,{value:"all",children:"Todos Tipos"}),Object.keys(K).map(t=>e.jsx(g,{value:t,children:K[t]},t))]})]}),e.jsxs(Q,{value:N,onValueChange:se,children:[e.jsx(W,{className:"w-[140px] h-8 text-xs",children:e.jsx(q,{placeholder:"Status"})}),e.jsxs(G,{children:[e.jsx(g,{value:"all",children:"Todos Status"}),Object.keys(k).map(t=>e.jsx(g,{value:t,children:k[t]},t))]})]}),!h&&e.jsxs(Q,{value:b,onValueChange:ae,children:[e.jsx(W,{className:"w-[150px] h-8 text-xs",children:e.jsx(q,{placeholder:"Projeto"})}),e.jsxs(G,{children:[e.jsx(g,{value:"all",children:"Todos Projetos"}),ue.map(t=>e.jsx(g,{value:t.id,children:t.name},t.id))]})]}),(j!=="all"||N!=="all"||b!=="all"||u)&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{te("all"),se("all"),ae("all"),ee("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]});return e.jsxs(Me.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[Te(),E?f==="list"?e.jsx(Ue,{}):e.jsx(Qe,{}):f==="list"?e.jsx("div",{className:"space-y-6",children:oe.length===0?e.jsx(H,{children:e.jsxs(U,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(i,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:z,children:[e.jsx(X,{className:"w-4 h-4"})," Criar compromisso"]})]})}):oe.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[ye(t),t===v&&e.jsx(w,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(H,{className:"hover:border-primary/30 transition-colors",children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{variant:"secondary",className:`text-[10px] ${J[a.type]}`,children:K[a.type]}),e.jsx(w,{variant:"outline",className:"text-[10px]",children:k[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>F(a),children:e.jsx(He,{className:"w-3.5 h-3.5"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>O(a.id),children:e.jsx(Ke,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):f==="week"?e.jsxs(H,{children:[e.jsx(Le,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>I(t=>t-1),children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx($e,{className:"text-base",children:ke}),e.jsxs("div",{className:"flex items-center gap-1",children:[V!==0&&e.jsx(i,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:()=>I(0),children:"Hoje"}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>I(t=>t+1),children:e.jsx(ce,{className:"w-4 h-4"})})]})]})}),e.jsx(U,{children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:y.map(t=>{const s=new Date(t+"T12:00:00"),a=t===v,r=R.get(t)||[];return e.jsxs("div",{className:m("min-h-[140px] p-2 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",a?"bg-primary/5 border-primary/30":"border-border/50"),onClick:()=>{r.length===0&&($(null),S(!0))},children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground capitalize",children:s.toLocaleDateString("pt-BR",{weekday:"short"})}),e.jsx("p",{className:m("text-lg font-bold",a&&"text-primary"),children:s.getDate()})]}),e.jsx("div",{className:"space-y-1",children:r.map(n=>e.jsxs("div",{className:m("text-[10px] px-1.5 py-1 rounded cursor-pointer hover:opacity-80",J[n.type]),onClick:c=>{c.stopPropagation(),F(n)},children:[n.time&&e.jsxs("span",{className:"font-semibold",children:[n.time," "]}),e.jsx("span",{className:"truncate",children:n.title})]},n.id))})]},t)})})})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 rounded-xl border border-border bg-card p-4",children:[e.jsx("div",{className:"mb-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full sm:w-auto gap-4",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:Se,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg font-semibold text-foreground capitalize font-sans text-center min-w-[140px]",children:De}),e.jsx(i,{variant:"ghost",size:"icon",onClick:Ce,children:e.jsx(ce,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"py-1 text-center text-xs font-medium text-muted-foreground",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:we.map((t,s)=>{const a=R.get(t.date)||[],r=t.date===v;return e.jsxs("button",{onClick:()=>{d===t.date?ne(null):ne(t.date)},onDragOver:n=>{n.preventDefault(),P(t.date)},onDragLeave:()=>P(null),onDrop:n=>je(n,t.date),className:m("relative flex flex-col items-center rounded-lg p-1.5 text-sm transition-colors min-h-[48px]",!t.isCurrentMonth&&"opacity-30",r&&"ring-1 ring-accent",d===t.date&&"bg-accent/10 ring-1 ring-accent",fe===t.date&&"bg-primary/10 ring-1 ring-primary/30","hover:bg-secondary/50"),children:[e.jsx("span",{className:m("text-xs font-sans",r?"font-bold text-accent":"text-foreground"),children:t.day}),a.length>0&&e.jsx("div",{className:"mt-0.5 flex gap-0.5",children:a.slice(0,3).map((n,c)=>e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-accent"},c))})]},s)})})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4 flex flex-col max-h-[500px] lg:max-h-[calc(100vh-220px)]",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-foreground font-sans shrink-0",children:d?`${new Date(d+"T12:00:00").toLocaleDateString("pt-BR",{day:"numeric",month:"long"})}`:"Próximos compromissos"}),e.jsx(Oe,{className:"flex-1 -mr-2 pr-2",children:e.jsx("div",{className:"space-y-3",children:(()=>{const t=d?R.get(d)||[]:be;return t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:d?"Nenhum compromisso neste dia.":"Nenhum compromisso futuro."}):t.map(s=>e.jsxs("div",{onClick:()=>F(s),className:"rounded-lg border border-border bg-card/80 p-3 space-y-1.5 cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsx("p",{className:"text-sm font-medium text-foreground font-sans",children:s.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(w,{variant:"outline",className:m("text-[10px] px-1.5 py-0 capitalize",J[s.type]),children:k[s.status]||s.status}),!d&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(Xe,{className:"h-3 w-3"}),et(s.date)]}),s.time&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(le,{className:"h-3 w-3"}),s.time]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:s.description})]},s.id))})()})})]})]}),e.jsx(qe,{open:ge,onOpenChange:S,event:L,onSave:Ne}),e.jsx(Pe,{open:!!B,onOpenChange:t=>!t&&O(null),children:e.jsxs(ze,{children:[e.jsxs(Fe,{children:[e.jsx(Re,{children:"Remover compromisso?"}),e.jsxs(Ve,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Ie,{children:[e.jsx(_e,{children:"Cancelar"}),e.jsx(Ye,{onClick:ve,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Bt as default};
