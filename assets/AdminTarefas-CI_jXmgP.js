const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminCrmDashboard-Dos0oDzl.js","assets/index-Ohf2YKo4.js","assets/index-CerVpy-o.css","assets/card-CAkvq4zZ.js","assets/badge-CzPtlc2e.js","assets/button-CbyiNCQE.js","assets/skeleton-BlsWxq22.js","assets/select-VQ5SyJ6c.js","assets/index-ClrKZCBj.js","assets/index-CGvwGerI.js","assets/index-C5oQL5ZR.js","assets/chevron-up-BI35rG8q.js","assets/check-BphomgM7.js","assets/crmTypes-DoNY0SBQ.js","assets/useQuery-CBRJvJIe.js","assets/filter-CnjluwhZ.js","assets/folder-kanban-B5zOYu_Y.js","assets/calendar-CIVUDgyE.js","assets/list-todo-jUnN54gm.js","assets/clock-DU-Ta7v3.js","assets/triangle-alert-BJhHF0RX.js","assets/circle-check-B--SbOvi.js","assets/arrow-right-BVbXurIE.js","assets/users-B5V8Eox9.js"])))=>i.map(i=>d[i]);
import{c as Ve,r as a,j as e,e as j,h as ht,m as js,a5 as pt}from"./index-Ohf2YKo4.js";import{E as ft,A as jt,m as Ns}from"./formatters-XX2JuEKb.js";import{P as gt,T as bt}from"./TarefaSheet-cK37m8yS.js";import{u as us}from"./useCrmFieldOptions-EDPTiDlW.js";import{u as vt,F as Nt,a as xe,b as me,c as he,d as Te,e as pe,t as St}from"./form-DHZKbqHN.js";import{D as Ct,C as Ss}from"./DatePickerInput-Dpt7Qq0O.js";import{S as wt,b as yt,c as Dt,d as Tt,e as kt,f as _t}from"./sheet-JDe2enXS.js";import{I as xs}from"./input-Bm6QtOcn.js";import{B as Y}from"./button-CbyiNCQE.js";import{S as T,a as k,b as _,c as A,d as u}from"./select-VQ5SyJ6c.js";import{P as Ye,a as We,b as Ge}from"./popover-efVtiJWF.js";import{S as ms,g as os,h as Cs,a as At,b as Mt,i as ws,j as ys,T as Ds,c as Fe}from"./crmTypes-DoNY0SBQ.js";import{S as hs}from"./search-Rnf2BhZ4.js";import{C as Ot}from"./check-BphomgM7.js";import{U as Lt}from"./user-CSwi78NC.js";import{T as ps}from"./trash-2-B9QNx74-.js";import{L as Et}from"./loader-circle-D9S7QrlI.js";import{o as Pt,s as fe}from"./types-Ba-nZvwf.js";import{T as Ts,b as ks,c as Ft,K as It}from"./CrmSkeletons-DJ2Fzc4t.js";import{C as Be,c as Re}from"./card-CAkvq4zZ.js";import{A as _s,a as As,b as Ms,c as Os,d as Ls,e as Es,f as Ps,g as Fs}from"./alert-dialog-BFo6J-nF.js";import{B,P as Is}from"./badge-CzPtlc2e.js";import{S as Ie}from"./switch-CEoEm86x.js";import{C as Bs}from"./checkbox-C3N8GrWh.js";import{u as Rs,a as Vs,D as $s,c as Ks,b as zs,d as Us,S as Hs,v as Ys,P as Ws,e as Gs,C as Zs}from"./sortable.esm-DPNraDQh.js";import{C as ke}from"./calendar-CIVUDgyE.js";import{U as qe}from"./users-B5V8Eox9.js";import{F as Je}from"./folder-kanban-B5zOYu_Y.js";import{L as qs}from"./list-CLDO-1gt.js";import{P as Js}from"./pencil-ClMqw3HQ.js";import{L as Bt}from"./label-BgWqrRLa.js";import{S as ls}from"./skeleton-BlsWxq22.js";import{C as Rt,a as Vt}from"./circle-check-B--SbOvi.js";import{C as $t}from"./clipboard-list-CbdxSj1J.js";import{F as Kt}from"./filter-CnjluwhZ.js";import{C as Xs,a as zt}from"./circle-x-C29xHoOr.js";import{C as Ut}from"./clock-DU-Ta7v3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=Ve("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Ve("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qs=Ve("Columns3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=Ve("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=Ve("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Wt=Pt({title:fe().trim().min(1,"Título obrigatório").max(200),parentTaskId:fe().min(1,"Tarefa-mãe obrigatória"),deadline:fe().optional(),status:fe().min(1),assignee:fe().optional(),notes:fe().max(2e3).optional(),numeroProcesso:fe().max(25).optional()});function Gt({open:d,onOpenChange:n,subtask:i,tasks:m,onSave:f,onDelete:v}){const g=!i,[b,w]=a.useState(!1),[O,z]=a.useState(""),{getOptions:h}=us(),y=h("subtarefa_status").map(x=>[x.value,x.label]),W=Object.entries(ms),G=y.length>0?y:W,[R,C]=a.useState(!1),U=a.useMemo(()=>{if(!O.trim())return m;const x=O.toLowerCase();return m.filter(p=>p.title.toLowerCase().includes(x))},[m,O]),P=vt({resolver:St(Wt),defaultValues:{title:"",parentTaskId:"",deadline:"",status:"agendado",assignee:"",notes:""}});a.useEffect(()=>{d&&(i?P.reset({title:i.title,parentTaskId:i.parentTaskId,deadline:i.dueDate??"",status:i.status,assignee:i.assignee??"",notes:i.notes??"",numeroProcesso:i.numeroProcesso??""}):P.reset({title:"",parentTaskId:"",deadline:"",status:"agendado",assignee:"",notes:"",numeroProcesso:""}))},[d,i]);const q=async x=>{w(!0);try{await f(x,g,i==null?void 0:i.id),n(!1)}catch(p){ht.error("Erro ao salvar subtarefa: "+p.message),console.error("Erro ao salvar subtarefa:",p)}finally{w(!1)}};return e.jsx(wt,{open:d,onOpenChange:n,children:e.jsxs(yt,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(Dt,{className:"mb-6",children:[e.jsx(Tt,{children:g?"Nova Subtarefa":"Editar Subtarefa"}),e.jsx(kt,{children:g?"Preencha os dados e selecione a tarefa-mãe relacionada.":"Altere os campos e salve."})]}),e.jsx(Nt,{...P,children:e.jsxs("form",{onSubmit:P.handleSubmit(q),className:"space-y-5",children:[e.jsx(xe,{control:P.control,name:"title",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Título *"}),e.jsx(Te,{children:e.jsx(xs,{placeholder:"Ex: Enviar documento",...x})}),e.jsx(pe,{})]})}),e.jsx(xe,{control:P.control,name:"parentTaskId",render:({field:x})=>{var p;return e.jsxs(me,{className:"flex flex-col",children:[e.jsx(he,{children:"Tarefa-mãe *"}),e.jsxs(Ye,{open:R,onOpenChange:C,children:[e.jsx(We,{asChild:!0,children:e.jsx(Te,{children:e.jsxs(Y,{variant:"outline",role:"combobox",className:j("w-full justify-between font-normal",!x.value&&"text-muted-foreground"),children:[e.jsx("span",{className:"truncate",children:x.value?((p=m.find(M=>M.id===x.value))==null?void 0:p.title)??"Tarefa não encontrada":"Selecione a tarefa-mãe..."}),e.jsx(Ht,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsxs(Ge,{className:"w-[--radix-popover-trigger-width] p-0",align:"start",children:[e.jsxs("div",{className:"flex items-center border-b px-3",children:[e.jsx(hs,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx("input",{className:"flex h-10 w-full bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground",placeholder:"Buscar tarefa...",value:O,onChange:M=>z(M.target.value)})]}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto p-1",children:U.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"Nenhuma tarefa encontrada."}):U.map(M=>e.jsxs("button",{type:"button",className:j("relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",x.value===M.id&&"bg-accent"),onClick:()=>{x.onChange(M.id),C(!1),z("")},children:[e.jsx(Ot,{className:j("mr-2 h-4 w-4",x.value===M.id?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:M.title})]},M.id))})]})]}),e.jsx(pe,{})]})}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(xe,{control:P.control,name:"deadline",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Prazo"}),e.jsx(Te,{children:e.jsx(Ct,{value:x.value??"",onChange:x.onChange})}),e.jsx(pe,{})]})}),e.jsx(xe,{control:P.control,name:"status",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Status"}),e.jsxs(T,{onValueChange:x.onChange,value:x.value,children:[e.jsx(Te,{children:e.jsx(k,{children:e.jsx(_,{})})}),e.jsx(A,{children:G.map(([p,M])=>e.jsx(u,{value:p,children:M},p))})]}),e.jsx(pe,{})]})})]}),e.jsx(xe,{control:P.control,name:"assignee",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Responsável"}),e.jsxs(T,{onValueChange:p=>x.onChange(p==="_none_"?"":p),value:x.value||"_none_",children:[e.jsx(Te,{children:e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Lt,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx(_,{placeholder:"Responsável..."})]})})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),os.map(p=>e.jsx(u,{value:p,children:p},p))]})]}),e.jsx(pe,{})]})}),e.jsx(xe,{control:P.control,name:"numeroProcesso",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Processo Judicial"}),e.jsx(gt,{value:x.value??"",onValueChange:x.onChange}),e.jsx(pe,{})]})}),e.jsx(xe,{control:P.control,name:"notes",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Observações"}),e.jsx(Te,{children:e.jsx(ft,{value:x.value??"",onChange:x.onChange,placeholder:"Observações...",modalTitle:"Editar Observações da Subtarefa"})}),e.jsx(pe,{})]})}),!g&&(i==null?void 0:i.id)&&e.jsx(jt,{folder:`subtarefas/${i.id}`}),e.jsxs(_t,{className:"gap-2 flex-col sm:flex-row",children:[!g&&i&&v&&e.jsxs(Y,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{v(i.id),n(!1)},disabled:b,children:[e.jsx(ps,{className:"w-4 h-4 mr-2"})," Excluir"]}),e.jsxs(Y,{type:"submit",disabled:b,className:"flex-1",children:[b&&e.jsx(Et,{className:"w-4 h-4 mr-2 animate-spin"}),g?"Criar Subtarefa":"Salvar Alterações"]})]})]})})]})})}const Zt=[{value:"deadline",label:"Prazo (mais distante)"},{value:"title",label:"Título (A → Z)"},{value:"status",label:"Status"}],gs={Pendente:0,Agendado:1,"A fazer":2,"Em andamento":3,Concluído:4},qt=["Pendente","Agendado","A fazer","Em andamento","Concluído"],Jt={Pendente:"border-t-red-500/60",Agendado:"border-t-blue-500/60","A fazer":"border-t-orange-500/60","Em andamento":"border-t-yellow-500/60",Concluído:"border-t-green-500/60"};function Xt(d,n){return[...d].sort((i,m)=>{switch(n){case"deadline":return!i.dueDate&&!m.dueDate?0:i.dueDate?m.dueDate?m.dueDate.localeCompare(i.dueDate):-1:1;case"title":return i.title.localeCompare(m.title,"pt-BR");case"status":return(gs[i.status]??0)-(gs[m.status]??0);default:return 0}})}function Qt({id:d,children:n}){const{attributes:i,listeners:m,setNodeRef:f,transform:v,transition:g,isDragging:b}=Gs({id:d}),w={transform:Zs.Transform.toString(v),transition:g};return e.jsx("div",{ref:f,style:w,...i,...m,className:j("touch-none",b&&"opacity-30"),children:n})}function ea({status:d,isOver:n,items:i,itemIds:m,today:f,onEdit:v,onDelete:g,showRichNotes:b,borderColor:w,badgeColor:O,statusLabel:z}){const{setNodeRef:h}=Us({id:d});return e.jsxs("div",{className:j("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",w||"border-t-muted/60",n&&"bg-card/80 ring-2 ring-primary/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border shadow-sm bg-background/50 backdrop-blur-md rounded-t-xl",children:[e.jsx(B,{variant:"secondary",className:O,children:z}),e.jsx(B,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50",children:i.length})]}),e.jsxs("div",{ref:h,"data-column-status":d,className:"flex-1 p-3 space-y-3",children:[e.jsx(Hs,{items:m,strategy:Ys,children:i.map(y=>e.jsx(Qt,{id:y.id,children:e.jsx(cs,{sub:y,today:f,onEdit:()=>v(y),onDelete:()=>g(y.id),showRichNotes:b})},y.id))}),i.length===0&&e.jsx("div",{className:"sticky top-[40vh] flex flex-col items-center justify-center border-2 border-dashed border-border/50 rounded-xl p-4 min-h-[80px]"})]})]})}const cs=a.memo(function({sub:n,today:i,showStatus:m,onEdit:f,onDelete:v,showRichNotes:g}){const b=n.dueDate&&n.dueDate<i&&n.status!=="Concluído";return e.jsx(Be,{className:j("group transition-shadow duration-150 hover:shadow-md cursor-pointer",b&&"border-destructive/50"),onClick:f,children:e.jsx(Re,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[m&&e.jsx(B,{variant:"secondary",className:j("text-[10px]",Cs[n.status]),children:ms[n.status]}),b&&e.jsx(B,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),e.jsx("p",{className:j("font-medium text-sm",n.completed&&"line-through text-muted-foreground"),children:n.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx("span",{className:"font-medium",children:"Tarefa:"})," ",n.parentTaskTitle]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:[n.projectName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),n.projectName]}),n.assignee&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),n.assignee]}),n.dueDate&&e.jsxs("span",{className:j("flex items-center gap-1",b&&"text-destructive font-medium"),children:[e.jsx(ke,{className:"w-3 h-3"}),new Date(n.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})]}),n.notes&&g&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Ns(n.notes)||n.notes}}),n.notes&&!g&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:n.notes.replace(/<[^>]*>/g,"")})]}),e.jsxs("div",{className:"flex gap-0.5 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(Y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:w=>{w.stopPropagation(),f()},children:e.jsx(Js,{className:"w-3.5 h-3.5"})}),e.jsx(Y,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:w=>{w.stopPropagation(),v()},children:e.jsx(ps,{className:"w-3.5 h-3.5"})})]})]})})})});function sa({tasks:d,projects:n,loading:i,onCreateSubtask:m,onUpdateSubtask:f,onDeleteSubtask:v}){const{allOptions:g,getOrderedValues:b,getLabelsMap:w,getColorsMap:O,getBorderColorsMap:z}=us(),h=a.useMemo(()=>{const t=b("subtarefa_status");return t.length>0?t:qt},[g]),y=a.useMemo(()=>{const t=w("subtarefa_status");return Object.keys(t).length>0?t:ms},[g]),W=a.useMemo(()=>{const t=O("subtarefa_status");return Object.keys(t).length>0?t:Cs},[g]),G=a.useMemo(()=>{const t=z("subtarefa_status");return Object.keys(t).length>0?t:Jt},[g]),[R,C]=a.useState(!1),[U,P]=a.useState(null),[q,x]=a.useState("kanban"),[p,M]=a.useState(""),[re,Xe]=a.useState("all"),[je,_e]=a.useState("all"),[Ae,Qe]=a.useState("all"),[N,J]=a.useState("all"),[X,ge]=a.useState("all"),[Me,be]=a.useState("deadline"),[ne,ve]=a.useState(!1),[Ne,Se]=a.useState(!1),[Ce,Z]=a.useState(null),[$e,we]=a.useState(null),[es,Q]=a.useState(null),ss=Rs(Vs(Ws,{activationConstraint:{distance:8}})),le=a.useMemo(()=>{const t={};return n.forEach(o=>{t[o.id]=o.name}),t},[n]),F=a.useMemo(()=>d.flatMap(t=>t.subtasks.map(o=>({...o,parentTaskTitle:t.title,projectId:t.projectId,projectName:t.projectId?le[t.projectId]:void 0}))),[d,le]),oe=a.useMemo(()=>{const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=new Date(o);c.setDate(o.getDate()+(7-o.getDay()));const V=new Date(t.getFullYear(),t.getMonth()+1,0),I=F.filter(D=>{if(p&&!D.title.toLowerCase().includes(p.toLowerCase())||re!=="all"&&D.status!==re||je!=="all"&&D.assignee!==je||Ae!=="all"&&D.projectId!==Ae||N!=="all"&&D.parentTaskId!==N||ne&&D.status==="Concluído")return!1;if(X!=="all"){if(!D.dueDate)return X==="sem_prazo";const $=new Date(D.dueDate+"T23:59:59");switch(X){case"atrasadas":return $<o&&D.status!=="Concluído";case"hoje":return D.dueDate===H;case"esta_semana":return $>=o&&$<=c;case"este_mes":return $>=o&&$<=V;case"sem_prazo":return!1}}return!0});return Xt(I,Me)},[F,p,re,je,Ae,N,Me,ne,X]),H=a.useMemo(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},[]);a.useMemo(()=>{const t={};h.forEach(c=>{t[c]=0});const o=F.filter(c=>c.dueDate&&c.dueDate<H&&c.status!=="Concluído").length;return F.forEach(c=>{t[c.status]!==void 0&&t[c.status]++}),{...t,overdue:o,total:F.length}},[F,H]);const ie=a.useCallback(()=>{P(null),C(!0)},[]),Oe=a.useCallback(t=>{P(t),C(!0)},[]),ce=a.useCallback(async(t,o,c)=>{o?await m(t.parentTaskId,{title:t.title,deadline:t.deadline||void 0,status:t.status,assignee:t.assignee||void 0,notes:t.notes||void 0}):c&&await f(c,{title:t.title,deadline:t.deadline||void 0,status:t.status,assignee:t.assignee||void 0,notes:t.notes||void 0})},[m,f]),ts=a.useCallback(async()=>{Ce&&(await v(Ce),Z(null))},[Ce,v]),de=a.useMemo(()=>{const t={};return h.forEach(o=>{t[o]=[]}),oe.forEach(o=>{t[o.status]&&t[o.status].push(o)}),t},[oe,h]),as=a.useCallback(t=>{we(String(t.active.id))},[]),ye=a.useCallback(t=>{const{over:o}=t;if(!o){Q(null);return}const c=String(o.id),V=F.find(D=>D.id===c),I=V?V.status:h.includes(c)?c:null;Q(I)},[F,h]),rs=a.useCallback(async t=>{const{active:o,over:c}=t;if(we(null),Q(null),!c)return;const V=String(o.id),I=String(c.id);if(V===I)return;const D=F.find(Ee=>Ee.id===V);if(!D)return;const $=F.find(Ee=>Ee.id===I),se=$?$.status:h.includes(I)?I:D.status;D.status!==se&&await f(V,{status:se})},[F,f,h]),De=a.useCallback(()=>{we(null),Q(null)},[]),Ke=$e?F.find(t=>t.id===$e):null,ee=a.useMemo(()=>h.filter(t=>!ne||t!=="Concluído"),[ne,h]),Le=a.useMemo(()=>[{key:"title",label:"Título",width:250,minWidth:150,sticky:!0,sortable:!0,sortFn:(t,o)=>t.title.localeCompare(o.title,"pt-BR"),render:t=>e.jsx("span",{className:"font-medium",children:t.title})},{key:"status",label:"Status",width:130,sortable:!0,sortFn:(t,o)=>t.status.localeCompare(o.status),render:t=>e.jsx(B,{variant:"secondary",className:j("text-[10px]",W[t.status]),children:y[t.status]||t.status}),inlineEdit:(t,o)=>e.jsxs(T,{value:t.status,onValueChange:o,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:h.map(c=>e.jsx(u,{value:c,children:y[c]||c},c))})]})},{key:"parentTaskTitle",label:"Tarefa-mãe",width:200,sortable:!0,sortFn:(t,o)=>t.parentTaskTitle.localeCompare(o.parentTaskTitle,"pt-BR"),render:t=>e.jsx("span",{className:"text-xs",children:t.parentTaskTitle})},{key:"dueDate",label:"Prazo",width:110,sortable:!0,sortFn:(t,o)=>!t.dueDate&&!o.dueDate?0:t.dueDate?o.dueDate?o.dueDate.localeCompare(t.dueDate):-1:1,render:t=>t.dueDate?e.jsxs("span",{className:j("text-xs flex items-center gap-1",t.dueDate<H&&t.status!=="Concluído"&&"text-destructive font-medium"),children:[e.jsx(ke,{className:"w-3 h-3"}),new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(t,o)=>e.jsxs(Ye,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(Y,{variant:"outline",className:j("h-7 text-xs w-full justify-start font-normal",!t.dueDate&&"text-muted-foreground"),children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),t.dueDate?new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR"):"Selecionar"]})}),e.jsx(Ge,{className:"w-auto p-0",align:"start",children:e.jsx(Ss,{mode:"single",selected:t.dueDate?new Date(t.dueDate+"T12:00:00"):void 0,onSelect:c=>{if(c){const V=c.getFullYear(),I=String(c.getMonth()+1).padStart(2,"0"),D=String(c.getDate()).padStart(2,"0");o(`${V}-${I}-${D}`)}else o("")},initialFocus:!0,className:"p-3 pointer-events-auto"})})]})},{key:"assignee",label:"Responsável",width:130,sortable:!0,sortFn:(t,o)=>(t.assignee??"").localeCompare(o.assignee??"","pt-BR"),render:t=>t.assignee?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),t.assignee]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(t,o)=>e.jsxs(T,{value:t.assignee||"_none_",onValueChange:c=>o(c==="_none_"?"":c),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),os.map(c=>e.jsx(u,{value:c,children:c},c))]})]})},{key:"project",label:"Projeto",width:130,render:t=>t.projectName?e.jsxs(B,{variant:"outline",className:"text-[10px] gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),t.projectName]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"relatorioMensal",label:"Rel. Mensal",width:90,render:t=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Bs,{checked:!!t.relatorioMensal,onCheckedChange:o=>f(t.id,{relatorioMensal:!!o})})})}],[H,f]),ae=a.useCallback((t,o,c)=>{o==="status"?f(t,{status:c}):o==="assignee"?f(t,{assignee:c||void 0}):o==="dueDate"?f(t,{deadline:c||void 0}):o==="relatorioMensal"&&f(t,{relatorioMensal:c==="true"})},[f]),ue=a.useCallback(t=>{t.forEach(o=>v(o))},[v]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 glass p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(xs,{placeholder:"Buscar subtarefa...",value:p,onChange:t=>M(t.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs(Y,{onClick:ie,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(Is,{className:"mr-1.5 h-4 w-4"})," Nova Subtarefa"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsxs("button",{onClick:()=>x("kanban"),className:j("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",q==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Qs,{className:"w-4 h-4"})," Kanban"]}),e.jsxs("button",{onClick:()=>x("list"),className:j("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",q==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(qs,{className:"w-4 h-4"})," Lista"]}),e.jsxs("button",{onClick:()=>x("table"),className:j("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",q==="table"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Ts,{className:"w-4 h-4"})," Tabela"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap flex-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),e.jsxs(T,{value:re,onValueChange:Xe,children:[e.jsx(k,{className:"w-[130px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos Status"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Status"}),h.map(t=>e.jsx(u,{value:t,children:y[t]||t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),e.jsxs(T,{value:X,onValueChange:ge,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),e.jsx(u,{value:"atrasadas",children:"Atrasadas"}),e.jsx(u,{value:"hoje",children:"Vence hoje"}),e.jsx(u,{value:"esta_semana",children:"Esta semana"}),e.jsx(u,{value:"este_mes",children:"Este mês"}),e.jsx(u,{value:"sem_prazo",children:"Sem prazo"})]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),e.jsxs(T,{value:je,onValueChange:_e,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),os.map(t=>e.jsx(u,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Tarefa-mãe"}),e.jsxs(T,{value:N,onValueChange:J,children:[e.jsx(k,{className:"w-[160px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todas"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todas"}),d.map(t=>e.jsx(u,{value:t.id,children:t.title},t.id))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),e.jsxs(T,{value:Me,onValueChange:t=>be(t),children:[e.jsx(k,{className:"w-[160px] h-8 text-xs",children:e.jsx(_,{})}),e.jsx(A,{children:Zt.map(t=>e.jsx(u,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 ml-auto shrink-0",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Ocultar concluídas",e.jsx(Ie,{checked:ne,onCheckedChange:ve,className:"scale-75"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Observações formatadas",e.jsx(Ie,{checked:Ne,onCheckedChange:Se,className:"scale-75"})]})]})]})]}),e.jsx(Gt,{open:R,onOpenChange:C,subtask:U,tasks:d,onSave:ce,onDelete:t=>Z(t)}),e.jsx(_s,{open:!!Ce,onOpenChange:t=>!t&&Z(null),children:e.jsxs(As,{children:[e.jsxs(Ms,{children:[e.jsx(Os,{children:"Remover subtarefa?"}),e.jsx(Ls,{children:"Esta ação não pode ser desfeita. A subtarefa será removida permanentemente."})]}),e.jsxs(Es,{children:[e.jsx(Ps,{children:"Cancelar"}),e.jsx(Fs,{onClick:ts,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),i?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx(Be,{children:e.jsx(Re,{className:"p-4",children:e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"})})},t))}):q==="table"?e.jsx(ks,{data:oe,columns:Le,onEdit:t=>Oe(t),onDelete:t=>Z(t),onBulkDelete:ue,onInlineChange:ae,emptyMessage:"Nenhuma subtarefa encontrada."}):q==="list"?e.jsx("div",{className:"space-y-3",children:oe.length===0?e.jsx(Be,{children:e.jsx(Re,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma subtarefa encontrada."})}):oe.map(t=>e.jsx(cs,{sub:t,today:H,showStatus:!0,onEdit:()=>Oe(t),onDelete:()=>Z(t.id),showRichNotes:Ne},t.id))}):e.jsxs($s,{sensors:ss,collisionDetection:Ks,onDragStart:as,onDragOver:ye,onDragEnd:rs,onDragCancel:De,children:[e.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:e.jsx("div",{className:"flex gap-4",style:{minWidth:`${ee.length*300}px`},children:ee.map(t=>{const o=es===t,c=de[t],V=c.map(I=>I.id);return e.jsx("div",{className:"flex-1 min-w-[260px]",children:e.jsx(ea,{status:t,isOver:o,items:c,itemIds:V,today:H,onEdit:Oe,onDelete:Z,showRichNotes:Ne,borderColor:G[t]||"border-t-muted/60",badgeColor:W[t]||"",statusLabel:y[t]||t})},t)})})}),e.jsx(zs,{children:Ke&&e.jsx("div",{className:"shadow-xl ring-2 ring-primary/30 rotate-[2deg] scale-105",children:e.jsx(cs,{sub:Ke,today:H,showStatus:!0,onEdit:()=>{},onDelete:()=>{},showRichNotes:Ne})})})]})]})}const ta=a.lazy(()=>pt(()=>import("./AdminCrmDashboard-Dos0oDzl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),aa=[{value:"deadline",label:"Prazo (mais distante)"},{value:"priority",label:"Prioridade (Alta → Baixa)"},{value:"title",label:"Título (A → Z)"},{value:"client",label:"Cliente (A → Z)"}],Ze={alta:0,media:1,baixa:2};function bs(d,n){return[...d].sort((i,m)=>{switch(n){case"deadline":return!i.dueDate&&!m.dueDate?0:i.dueDate?m.dueDate?m.dueDate.localeCompare(i.dueDate):-1:1;case"priority":return(Ze[i.priority]??1)-(Ze[m.priority]??1);case"title":return i.title.localeCompare(m.title,"pt-BR");case"client":return(i.client??"").localeCompare(m.client??"","pt-BR");default:return 0}})}const ra={client:!0,dueDate:!0,priority:!0,subtasks:!0,tags:!0,description:!1},vs={client:"Cliente",dueDate:"Data de entrega",priority:"Prioridade",subtasks:"Subtarefas",tags:"Tags",description:"Descrição"},na=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],la={pendente:"border-t-red-500/60",agendado:"border-t-blue-500/60",em_andamento:"border-t-yellow-500/60",em_tramite:"border-t-orange-500/60",concluida:"border-t-green-500/60",cancelada:"border-t-muted/60"},oa={pendente:Xs,agendado:Ut,em_andamento:is,em_tramite:is,concluida:Vt,cancelada:zt},ia=[{value:"all",label:"Todos"},{value:"today",label:"Hoje"},{value:"this_week",label:"Esta semana"},{value:"this_month",label:"Este mês"},{value:"overdue",label:"Atrasadas"},{value:"no_deadline",label:"Sem prazo"}],ds=a.memo(function({task:n,cardFields:i,today:m,isExpanded:f,onToggleExpand:v,onToggleSubtask:g,onEdit:b,onDelete:w,showStatus:O,isDragging:z,isOverlay:h,projectName:y}){const W=n.subtasks.filter(C=>C.status==="Concluído").length,G=n.subtasks.length,R=n.dueDate&&n.dueDate<m&&n.status!=="concluida"&&n.status!=="cancelada";return e.jsx(Be,{className:j("relative group transition-all duration-200 hover:shadow-md cursor-pointer",z?"opacity-40 scale-95":"",h&&"shadow-2xl ring-2 ring-primary/40 rotate-[2deg] scale-105 cursor-grabbing","border-border/50 bg-card"),onClick:()=>b==null?void 0:b(n),children:e.jsxs(Re,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[y&&e.jsx("div",{className:"mb-2",children:e.jsxs(B,{variant:"outline",className:"text-[10px] px-1.5 py-0 gap-1 font-normal",children:[e.jsx(Je,{className:"w-3 h-3"}),y]})}),e.jsx("p",{className:"font-medium text-sm mb-1",children:n.title})]}),!h&&e.jsxs("div",{className:"flex gap-0.5 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(Y,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:C=>{C.stopPropagation(),b==null||b(n)},children:e.jsx(Js,{className:"w-3.5 h-3.5"})}),e.jsx(Y,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:C=>{C.stopPropagation(),w(n.id)},children:e.jsx(ps,{className:"w-3.5 h-3.5"})})]})]}),i.description&&n.description&&e.jsx("div",{className:"text-xs text-muted-foreground mb-2 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Ns(n.description)||n.description}}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[i.priority&&e.jsx(B,{variant:"secondary",className:`text-[10px] ${Ds[n.priority]}`,children:Fe[n.priority]}),O&&e.jsx(B,{variant:"secondary",className:`text-[10px] ${ys[n.status]}`,children:ws[n.status]}),i.dueDate&&n.dueDate&&e.jsxs("span",{className:j("flex items-center gap-1",R&&"text-destructive font-medium"),children:[R?e.jsx(Xs,{className:"w-3 h-3"}):e.jsx(ke,{className:"w-3 h-3"}),new Date(n.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}),R&&e.jsx("span",{className:"text-destructive font-medium",children:"Atrasada"}),n.assignee&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),n.assignee]})]}),i.subtasks&&G>0&&!h&&e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(et,{className:"w-3 h-3"}),W,"/",G]})}),i.tags&&n.tags&&n.tags.length>0&&!h&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:n.tags.map(C=>e.jsx(B,{variant:"outline",className:"text-[10px]",children:C},C))})]})})});function ca(d){const{attributes:n,listeners:i,setNodeRef:m,transform:f,transition:v,isDragging:g}=Gs({id:d.task.id}),b={transform:Zs.Transform.toString(f),transition:v};return e.jsx("div",{ref:m,style:b,...n,...i,children:e.jsx(ds,{...d,isDragging:g})})}function da({status:d,tasks:n,isOver:i,cardFields:m,today:f,expandedTasks:v,onToggleExpand:g,onToggleSubtask:b,onEdit:w,onDelete:O,projectMap:z,statusLabel:h,borderColor:y,badgeColor:W}){const G=a.useMemo(()=>n.map(U=>U.id),[n]),{setNodeRef:R}=Us({id:d}),C=oa[d]||is;return e.jsxs("div",{className:j("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",y||"border-t-muted/60",i&&"bg-card/80 ring-2 ring-primary/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 px-4",children:[e.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(B,{variant:"secondary",className:j("text-xs",W),children:h}),e.jsx(B,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50 tabular-nums",children:n.length})]}),e.jsxs("div",{ref:R,"data-column-status":d,className:"flex-1 p-3 pt-0 space-y-3",children:[e.jsx(Hs,{items:G,strategy:Ys,children:n.map(U=>e.jsx(ca,{task:U,cardFields:m,today:f,isExpanded:v.has(U.id),onToggleExpand:g,onToggleSubtask:b,onEdit:w,onDelete:O,projectName:z.get(U.projectId||"")},U.id))}),n.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-border/50 rounded-xl p-4 min-h-[100px]"})]})]})}function ua({projectId:d,clientNameFilter:n,hideHeader:i,forceTab:m}={}){const{tasks:f,setTasks:v,loading:g,error:b,updateTaskStatus:w,deleteTask:O,createTask:z,updateTask:h,createSubtask:y,updateSubtask:W,deleteSubtask:G}=At(),{projects:R}=Mt(),{allOptions:C,getOrderedValues:U,getLabelsMap:P,getColorsMap:q,getBorderColorsMap:x}=us(),p=a.useMemo(()=>{const s=U("tarefa_status");return s.length>0?s:na},[C]),M=a.useMemo(()=>{const s=P("tarefa_status");return Object.keys(s).length>0?s:ws},[C]),re=a.useMemo(()=>{const s=q("tarefa_status");return Object.keys(s).length>0?s:ys},[C]),Xe=a.useMemo(()=>{const s=x("tarefa_status");return Object.keys(s).length>0?s:la},[C]),[je,_e]=a.useState(!1),[Ae,Qe]=a.useState(null),N=a.useMemo(()=>n||d?f.filter(s=>{var S;const r=n&&((S=s.client)==null?void 0:S.toLowerCase().includes(n.toLowerCase())),l=d&&s.projectId===d;return n&&d?r||l:n?r:l}):f,[f,n,d]),[J,X]=a.useState("kanban"),[ge,Me]=a.useState(""),[be,ne]=a.useState("all"),[ve,Ne]=a.useState("all"),[Se,Ce]=a.useState("all"),[Z,$e]=a.useState(d||"all"),[we,es]=a.useState(new Set),[Q,ss]=a.useState(ra),[le,F]=a.useState(null),[oe,H]=a.useState(null),[ie,Oe]=a.useState("deadline"),[ce,ts]=a.useState(!1),[de,as]=a.useState(!1),[ye,rs]=a.useState("all"),[De,Ke]=a.useState("all"),ee=a.useMemo(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},[]),Le=a.useMemo(()=>[...new Set(N.map(s=>s.assignee).filter(Boolean))],[N]),ae=a.useMemo(()=>{const r=!!(d&&n)?"all":d||Z,l=new Date,S=new Date(l);S.setDate(l.getDate()+7);const L=new Date(l.getFullYear(),l.getMonth()+1,0),te=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}-${String(S.getDate()).padStart(2,"0")}`,Ue=`${L.getFullYear()}-${String(L.getMonth()+1).padStart(2,"0")}-${String(L.getDate()).padStart(2,"0")}`,Pe=N.filter(E=>{var He;if(ge&&!E.title.toLowerCase().includes(ge.toLowerCase())||be!=="all"&&E.status!==be||ve!=="all"&&E.priority!==ve||Se!=="all"&&E.client!==Se||De!=="all"&&E.assignee!==De||r!=="all"&&E.projectId!==r||ce&&E.status==="concluida"||de&&E.status==="cancelada")return!1;if(ye!=="all"){const K=(He=E.dueDate)==null?void 0:He.split("T")[0];switch(ye){case"today":if(K!==ee)return!1;break;case"this_week":if(!K||K<ee||K>te)return!1;break;case"this_month":if(!K||K<ee||K>Ue)return!1;break;case"overdue":if(!K||K>=ee||E.status==="concluida"||E.status==="cancelada")return!1;break;case"no_deadline":if(K)return!1;break}}return!0});return bs(Pe,ie)},[N,ge,be,ve,Se,De,Z,ie,ye,ee,ce,de]),ue=ee,t=a.useMemo(()=>le?N.find(s=>s.id===le):null,[le,N]),o=a.useMemo(()=>[...new Set(N.map(s=>s.client).filter(Boolean))],[N]),c=a.useMemo(()=>{const s=new Map;return R.forEach(r=>s.set(r.id,r.name)),s},[R]),V=a.useMemo(()=>N.reduce((s,r)=>s+r.subtasks.length,0),[N]),I=a.useCallback(s=>{es(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},[]),D=a.useCallback((s,r)=>{v(l=>l.map(S=>S.id===s?{...S,subtasks:S.subtasks.map(L=>L.id===r?{...L,completed:!L.completed}:L)}:S))},[v]),[$,se]=a.useState(null),Ee=a.useCallback(async()=>{$&&(v(s=>s.filter(r=>r.id!==$)),O($),se(null))},[$,O,v]),st=a.useCallback(s=>{ss(r=>({...r,[s]:!r[s]}))},[]),tt=a.useCallback(()=>{Qe(null),_e(!0)},[]),ns=a.useCallback(s=>{Qe(s),_e(!0)},[]),at=a.useCallback(async(s,r,l)=>{r?await z({title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description,numeroProcesso:s.numeroProcesso,relatorioMensal:s.relatorioMensal}):l&&await h(l,{title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description,numeroProcesso:s.numeroProcesso,relatorioMensal:s.relatorioMensal})},[z,h]),rt=Rs(Vs(Ws,{activationConstraint:{distance:8}}));a.useCallback(s=>{const r=N.find(l=>l.id===s);return r==null?void 0:r.status},[N]);const nt=a.useCallback(s=>{F(s.active.id)},[]),lt=a.useCallback(s=>{const{over:r}=s;if(!r){H(null);return}const l=r.id,S=N.find(te=>te.id===l),L=S?S.status:p.includes(l)?l:null;H(L)},[N]),ot=a.useCallback(s=>{const{active:r,over:l}=s;if(F(null),H(null),!l)return;const S=r.id,L=l.id;if(S===L)return;const te=N.find(E=>E.id===S);if(!te)return;const Ue=N.find(E=>E.id===L),Pe=Ue?Ue.status:p.includes(L)?L:te.status;te.status!==Pe&&(v(E=>{const He=E.map(K=>K.id===S?{...K,status:Pe}:K);return bs(He,ie)}),w(S,Pe))},[N,w,ie]),it=a.useCallback(()=>{F(null),H(null)},[]),ct=a.useMemo(()=>{const s={};return p.forEach(r=>{s[r]=[]}),ae.forEach(r=>{s[r.status]&&s[r.status].push(r)}),s},[ae,p]),fs=a.useMemo(()=>p.filter(s=>!(ce&&s==="concluida"||de&&s==="cancelada")),[ce,de,p]),dt=a.useMemo(()=>[{key:"title",label:"Título",width:280,minWidth:150,sticky:!0,sortable:!0,sortFn:(s,r)=>s.title.localeCompare(r.title,"pt-BR"),render:s=>e.jsx("span",{className:"font-medium",children:s.title})},{key:"status",label:"Status",width:140,sortable:!0,sortFn:(s,r)=>s.status.localeCompare(r.status),render:s=>e.jsx(B,{variant:"secondary",className:j("text-[10px]",re[s.status]),children:M[s.status]||s.status}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.status,onValueChange:r,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:p.map(l=>e.jsx(u,{value:l,children:M[l]||l},l))})]})},{key:"priority",label:"Prioridade",width:110,sortable:!0,sortFn:(s,r)=>(Ze[s.priority]??1)-(Ze[r.priority]??1),render:s=>e.jsx(B,{variant:"secondary",className:j("text-[10px]",Ds[s.priority]),children:Fe[s.priority]}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.priority,onValueChange:r,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:Object.entries(Fe).map(([l,S])=>e.jsx(u,{value:l,children:S},l))})]})},{key:"dueDate",label:"Prazo",width:150,sortable:!0,sortFn:(s,r)=>!s.dueDate&&!r.dueDate?0:s.dueDate?r.dueDate?r.dueDate.localeCompare(s.dueDate):-1:1,render:s=>s.dueDate?e.jsxs("span",{className:j("text-xs flex items-center gap-1",s.dueDate<ue&&s.status!=="concluida"&&"text-destructive font-medium"),children:[e.jsx(ke,{className:"w-3 h-3"}),new Date(s.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(Ye,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(Y,{variant:"outline",className:j("h-7 text-xs w-full justify-start font-normal",!s.dueDate&&"text-muted-foreground"),children:[e.jsx(ke,{className:"w-3 h-3 mr-1"}),s.dueDate?new Date(s.dueDate+"T12:00:00").toLocaleDateString("pt-BR"):"Selecionar"]})}),e.jsx(Ge,{className:"w-auto p-0",align:"start",children:e.jsx(Ss,{mode:"single",selected:s.dueDate?new Date(s.dueDate+"T12:00:00"):void 0,onSelect:l=>{if(l){const S=l.getFullYear(),L=String(l.getMonth()+1).padStart(2,"0"),te=String(l.getDate()).padStart(2,"0");r(`${S}-${L}-${te}`)}else r("")},initialFocus:!0,className:"p-3 pointer-events-auto"})})]})},{key:"assignee",label:"Responsável",width:140,sortable:!0,sortFn:(s,r)=>(s.assignee??"").localeCompare(r.assignee??"","pt-BR"),render:s=>s.assignee?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),s.assignee]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.assignee||"_none_",onValueChange:l=>r(l==="_none_"?"":l),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),Le.map(l=>e.jsx(u,{value:l,children:l},l))]})]})},{key:"client",label:"Cliente",width:140,sortable:!0,sortFn:(s,r)=>(s.client??"").localeCompare(r.client??"","pt-BR"),render:s=>s.client?e.jsx("span",{className:"text-xs",children:s.client}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.client||"_none_",onValueChange:l=>r(l==="_none_"?"":l),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem cliente —"}),o.map(l=>e.jsx(u,{value:l,children:l},l))]})]})},{key:"project",label:"Projeto",width:140,render:s=>{const r=c.get(s.projectId||"");return r?e.jsxs(B,{variant:"outline",className:"text-[10px] gap-1",children:[e.jsx(Je,{className:"w-3 h-3"}),r]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"relatorioMensal",label:"Rel. Mensal",width:90,render:s=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Bs,{checked:!!s.relatorioMensal,onCheckedChange:r=>h(s.id,{relatorioMensal:!!r})})})}],[ue,Le,c,o,h]),ut=a.useCallback((s,r,l)=>{r==="status"?w(s,l):r==="assignee"?h(s,{responsavel:l||null}):r==="priority"?h(s,{prioridade:l}):r==="client"?h(s,{cliente:l||null}):r==="dueDate"?h(s,{deadline:l||null}):r==="relatorioMensal"&&h(s,{relatorioMensal:l==="true"})},[w,h]),xt=a.useCallback(s=>{s.forEach(r=>O(r))},[O]),[ze,mt]=a.useState(m||"overview");return e.jsxs(js.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[!m&&e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 mb-5 scrollbar-none",children:e.jsx("div",{className:"flex items-center gap-1 rounded-2xl border border-border bg-muted/40 p-1 w-fit backdrop-blur-sm",children:[{id:"overview",label:"Visão Geral",icon:Rt},{id:"tarefas",label:"Tarefas",icon:$t,count:ae.length},{id:"subtarefas",label:"Subtarefas",icon:et,count:V}].map(s=>{const r=ze===s.id,l=s.icon;return e.jsxs("button",{onClick:()=>mt(s.id),className:j("relative flex items-center gap-2 rounded-xl px-4 sm:px-5 py-2 sm:py-2.5 text-sm font-medium transition-all duration-200 whitespace-nowrap",r?"text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[r&&e.jsx(js.div,{layoutId:"tarefas-tab-bg",className:"absolute inset-0 rounded-xl gold-gradient shadow-sm",transition:{type:"spring",bounce:.15,duration:.5}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.id==="overview"?"Geral":s.label}),"count"in s&&e.jsx("span",{className:j("inline-flex items-center justify-center rounded-full px-2 py-0.5 text-[10px] font-semibold tabular-nums min-w-[22px] transition-colors",r?"bg-primary-foreground/20 text-primary-foreground":"bg-secondary text-muted-foreground"),children:s.count})]})]},s.id)})})}),ze==="overview"&&e.jsx(a.Suspense,{fallback:e.jsxs("div",{className:"space-y-4",children:[e.jsx(ls,{className:"h-10 w-full"}),e.jsx(ls,{className:"h-40 w-full"}),e.jsx(ls,{className:"h-40 w-full"})]}),children:e.jsx(ta,{})}),ze==="tarefas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 glass p-3 sm:p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(xs,{placeholder:"Buscar tarefas...",value:ge,onChange:s=>Me(s.target.value),className:"pl-9 w-full text-sm h-9"})]}),e.jsxs("div",{className:"flex gap-2 items-center sm:ml-auto flex-wrap",children:[e.jsxs(Y,{onClick:tt,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9 flex-1 sm:flex-none",children:[e.jsx(Is,{className:"mr-1.5 h-4 w-4"})," Nova Tarefa"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsxs("button",{onClick:()=>X("kanban"),className:j("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",J==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Qs,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Kanban"})]}),e.jsxs("button",{onClick:()=>X("list"),className:j("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",J==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(qs,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Lista"})]}),e.jsxs("button",{onClick:()=>X("table"),className:j("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",J==="table"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Ts,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Tabela"})]})]}),b&&e.jsx("span",{className:"text-xs text-destructive",children:"Erro ao carregar"}),e.jsxs(Ye,{children:[e.jsx(We,{asChild:!0,children:e.jsx(Y,{variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",children:e.jsx(Yt,{className:"w-4 h-4"})})}),e.jsx(Ge,{className:"w-56",align:"end",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Mostrar nos cards"}),Object.keys(vs).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx(Bt,{htmlFor:`field-${s}`,className:"text-sm cursor-pointer",children:vs[s]}),e.jsx(Ie,{id:`field-${s}`,checked:Q[s],onCheckedChange:()=>st(s)})]},s))]})})]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-3 px-3 sm:mx-0 sm:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex gap-2 items-end min-w-max",children:[e.jsx(Kt,{className:"w-4 h-4 text-muted-foreground shrink-0 mb-2"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),e.jsxs(T,{value:be,onValueChange:ne,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos Status"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Status"}),p.map(s=>e.jsx(u,{value:s,children:M[s]||s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prioridade"}),e.jsxs(T,{value:ve,onValueChange:Ne,children:[e.jsx(k,{className:"w-[100px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todas"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todas"}),Object.keys(Fe).map(s=>e.jsx(u,{value:s,children:Fe[s]},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),e.jsxs(T,{value:ye,onValueChange:s=>rs(s),children:[e.jsx(k,{className:"w-[100px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsx(A,{children:ia.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),e.jsxs(T,{value:De,onValueChange:Ke,children:[e.jsx(k,{className:"w-[110px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),Le.map(s=>e.jsx(u,{value:s,children:s},s))]})]})]}),!d&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Projeto"}),e.jsxs(T,{value:Z,onValueChange:$e,children:[e.jsx(k,{className:"w-[140px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Projetos"}),R.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]})]}),o.length>0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Cliente"}),e.jsxs(T,{value:Se,onValueChange:Ce,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Clientes"}),o.map(s=>e.jsx(u,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),e.jsxs(T,{value:ie,onValueChange:s=>Oe(s),children:[e.jsx(k,{className:"w-[140px] h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"deadline",children:"Sem ordenação"}),aa.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 shrink-0",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:[e.jsx("span",{className:"whitespace-nowrap",children:"Ocultar canc."}),e.jsx(Ie,{checked:de,onCheckedChange:as,className:"scale-75"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:[e.jsx("span",{className:"whitespace-nowrap",children:"Ocultar concl."}),e.jsx(Ie,{checked:ce,onCheckedChange:ts,className:"scale-75"})]})]})]})})]}),e.jsx(bt,{open:je,onOpenChange:_e,task:Ae,onSave:at,onDelete:s=>se(s),onCreateSubtask:y,onUpdateSubtask:W,onDeleteSubtask:G}),e.jsx(_s,{open:!!$,onOpenChange:s=>!s&&se(null),children:e.jsxs(As,{children:[e.jsxs(Ms,{children:[e.jsx(Os,{children:"Remover tarefa?"}),e.jsx(Ls,{children:"Esta ação não pode ser desfeita. A tarefa será removida permanentemente."})]}),e.jsxs(Es,{children:[e.jsx(Ps,{children:"Cancelar"}),e.jsx(Fs,{onClick:Ee,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),g?J==="list"||J==="table"?e.jsx(Ft,{}):e.jsx(It,{}):J==="table"?e.jsx(ks,{data:ae,columns:dt,onEdit:ns,onDelete:se,onBulkDelete:xt,onInlineChange:ut,emptyMessage:"Nenhuma tarefa encontrada."}):J==="list"?e.jsx("div",{className:"space-y-3",children:ae.length===0?e.jsx(Be,{children:e.jsx(Re,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):ae.map(s=>e.jsx(ds,{task:s,cardFields:Q,today:ue,isExpanded:we.has(s.id),onToggleExpand:I,onToggleSubtask:D,onEdit:ns,onDelete:se,showStatus:!0,projectName:c.get(s.projectId||"")},s.id))}):e.jsxs($s,{sensors:rt,collisionDetection:Ks,onDragStart:nt,onDragOver:lt,onDragEnd:ot,onDragCancel:it,children:[e.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:e.jsx("div",{className:"flex gap-4",style:{minWidth:`${fs.length*280}px`},children:fs.map(s=>e.jsx("div",{className:"flex-1 min-w-[260px]",children:e.jsx(da,{status:s,tasks:ct[s]||[],isOver:oe===s&&le!==null,cardFields:Q,today:ue,expandedTasks:we,onToggleExpand:I,onToggleSubtask:D,onEdit:ns,onDelete:se,projectMap:c,statusLabel:M[s]||s,borderColor:Xe[s]||"border-t-muted/60",badgeColor:re[s]||""})},s))})}),e.jsx(zs,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:t?e.jsx("div",{className:"w-[260px]",children:e.jsx(ds,{task:t,cardFields:Q,today:ue,isExpanded:!1,onToggleExpand:()=>{},onToggleSubtask:()=>{},onDelete:()=>{},isOverlay:!0,projectName:c.get(t.projectId||"")})}):null})]})]}),ze==="subtarefas"&&e.jsx(sa,{tasks:d?N.filter(s=>s.projectId===d):N,projects:R,loading:g,onCreateSubtask:y,onUpdateSubtask:W,onDeleteSubtask:G})]})}const Za=Object.freeze(Object.defineProperty({__proto__:null,default:ua},Symbol.toStringTag,{value:"Module"}));export{ua as A,et as L,Za as a};
