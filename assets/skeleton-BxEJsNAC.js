var wt=s=>{throw TypeError(s)};var ht=(s,t,e)=>t.has(s)||wt("Cannot "+e);var i=(s,t,e)=>(ht(s,t,"read from private field"),e?e.call(s):t.get(s)),p=(s,t,e)=>t.has(s)?wt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),c=(s,t,e,r)=>(ht(s,t,"write to private field"),r?r.call(s,e):t.set(s,e),e),d=(s,t,e)=>(ht(s,t,"access private method"),e);import{aj as Pt,ak as Et,al as E,am as et,an as W,ao as st,ap as ut,aq as xt,ar as kt,as as Lt,at as jt,au as Qt,av as it,aw as It,ax as At,r as C,ay as Ut,az as J,aA as K,j as Bt,c as Ht}from"./index-rGXuuAVG.js";var g,h,$,m,P,L,q,F,G,j,A,U,D,_,B,u,V,ct,lt,dt,ft,pt,yt,bt,Dt,Tt,zt=(Tt=class extends Pt{constructor(t,e){super();p(this,u);p(this,g);p(this,h);p(this,$);p(this,m);p(this,P);p(this,L);p(this,q);p(this,F);p(this,G);p(this,j);p(this,A);p(this,U);p(this,D);p(this,_);p(this,B,new Set);this.options=e,c(this,g,t),c(this,F,null),c(this,q,Et()),this.options.experimental_prefetchInRender||i(this,q).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,h).addObserver(this),qt(i(this,h),this.options)?d(this,u,V).call(this):this.updateResult(),d(this,u,ft).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return mt(i(this,h),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return mt(i(this,h),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,d(this,u,pt).call(this),d(this,u,yt).call(this),i(this,h).removeObserver(this)}setOptions(t){const e=this.options,r=i(this,h);if(this.options=i(this,g).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,i(this,h))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");d(this,u,bt).call(this),i(this,h).setOptions(this.options),e._defaulted&&!et(this.options,e)&&i(this,g).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,h),observer:this});const n=this.hasListeners();n&&Ft(i(this,h),r,this.options,e)&&d(this,u,V).call(this),this.updateResult(),n&&(i(this,h)!==r||E(this.options.enabled,i(this,h))!==E(e.enabled,i(this,h))||W(this.options.staleTime,i(this,h))!==W(e.staleTime,i(this,h)))&&d(this,u,ct).call(this);const a=d(this,u,lt).call(this);n&&(i(this,h)!==r||E(this.options.enabled,i(this,h))!==E(e.enabled,i(this,h))||a!==i(this,_))&&d(this,u,dt).call(this,a)}getOptimisticResult(t){const e=i(this,g).getQueryCache().build(i(this,g),t),r=this.createResult(e,t);return Vt(this,r)&&(c(this,m,r),c(this,L,this.options),c(this,P,i(this,h).state)),r}getCurrentResult(){return i(this,m)}trackResult(t,e){return new Proxy(t,{get:(r,n)=>(this.trackProp(n),e==null||e(n),Reflect.get(r,n))})}trackProp(t){i(this,B).add(t)}getCurrentQuery(){return i(this,h)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=i(this,g).defaultQueryOptions(t),r=i(this,g).getQueryCache().build(i(this,g),e);return r.fetch().then(()=>this.createResult(r,e))}fetch(t){return d(this,u,V).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,m)))}createResult(t,e){var Ot;const r=i(this,h),n=this.options,a=i(this,m),o=i(this,P),b=i(this,L),v=t!==r?t.state:i(this,$),{state:O}=t;let l={...O},H=!1,y;if(e._optimisticResults){const w=this.hasListeners(),Y=!w&&qt(t,e),k=w&&Ft(t,r,e,n);(Y||k)&&(l={...l,...jt(O.data,t.options)}),e._optimisticResults==="isRestoring"&&(l.fetchStatus="idle")}let{error:z,errorUpdatedAt:N,status:S}=l;y=l.data;let X=!1;if(e.placeholderData!==void 0&&y===void 0&&S==="pending"){let w;a!=null&&a.isPlaceholderData&&e.placeholderData===(b==null?void 0:b.placeholderData)?(w=a.data,X=!0):w=typeof e.placeholderData=="function"?e.placeholderData((Ot=i(this,A))==null?void 0:Ot.state.data,i(this,A)):e.placeholderData,w!==void 0&&(S="success",y=Qt(a==null?void 0:a.data,w,e),H=!0)}if(e.select&&y!==void 0&&!X)if(a&&y===(o==null?void 0:o.data)&&e.select===i(this,G))y=i(this,j);else try{c(this,G,e.select),y=e.select(y),y=Qt(a==null?void 0:a.data,y,e),c(this,j,y),c(this,F,null)}catch(w){c(this,F,w)}i(this,F)&&(z=i(this,F),y=i(this,j),N=Date.now(),S="error");const at=l.fetchStatus==="fetching",nt=S==="pending",ot=S==="error",Ct=nt&&at,St=y!==void 0,x={status:S,fetchStatus:l.fetchStatus,isPending:nt,isSuccess:S==="success",isError:ot,isInitialLoading:Ct,isLoading:Ct,data:y,dataUpdatedAt:l.dataUpdatedAt,error:z,errorUpdatedAt:N,failureCount:l.fetchFailureCount,failureReason:l.fetchFailureReason,errorUpdateCount:l.errorUpdateCount,isFetched:l.dataUpdateCount>0||l.errorUpdateCount>0,isFetchedAfterMount:l.dataUpdateCount>v.dataUpdateCount||l.errorUpdateCount>v.errorUpdateCount,isFetching:at,isRefetching:at&&!nt,isLoadingError:ot&&!St,isPaused:l.fetchStatus==="paused",isPlaceholderData:H,isRefetchError:ot&&St,isStale:gt(t,e),refetch:this.refetch,promise:i(this,q),isEnabled:E(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const w=Z=>{x.status==="error"?Z.reject(x.error):x.data!==void 0&&Z.resolve(x.data)},Y=()=>{const Z=c(this,q,x.promise=Et());w(Z)},k=i(this,q);switch(k.status){case"pending":t.queryHash===r.queryHash&&w(k);break;case"fulfilled":(x.status==="error"||x.data!==k.value)&&Y();break;case"rejected":(x.status!=="error"||x.error!==k.reason)&&Y();break}}return x}updateResult(){const t=i(this,m),e=this.createResult(i(this,h),this.options);if(c(this,P,i(this,h).state),c(this,L,this.options),i(this,P).data!==void 0&&c(this,A,i(this,h)),et(e,t))return;c(this,m,e);const r=()=>{if(!t)return!0;const{notifyOnChangeProps:n}=this.options,a=typeof n=="function"?n():n;if(a==="all"||!a&&!i(this,B).size)return!0;const o=new Set(a??i(this,B));return this.options.throwOnError&&o.add("error"),Object.keys(i(this,m)).some(b=>{const f=b;return i(this,m)[f]!==t[f]&&o.has(f)})};d(this,u,Dt).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&d(this,u,ft).call(this)}},g=new WeakMap,h=new WeakMap,$=new WeakMap,m=new WeakMap,P=new WeakMap,L=new WeakMap,q=new WeakMap,F=new WeakMap,G=new WeakMap,j=new WeakMap,A=new WeakMap,U=new WeakMap,D=new WeakMap,_=new WeakMap,B=new WeakMap,u=new WeakSet,V=function(t){d(this,u,bt).call(this);let e=i(this,h).fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(st)),e},ct=function(){d(this,u,pt).call(this);const t=W(this.options.staleTime,i(this,h));if(ut||i(this,m).isStale||!xt(t))return;const r=kt(i(this,m).dataUpdatedAt,t)+1;c(this,U,setTimeout(()=>{i(this,m).isStale||this.updateResult()},r))},lt=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,h)):this.options.refetchInterval)??!1},dt=function(t){d(this,u,yt).call(this),c(this,_,t),!(ut||E(this.options.enabled,i(this,h))===!1||!xt(i(this,_))||i(this,_)===0)&&c(this,D,setInterval(()=>{(this.options.refetchIntervalInBackground||Lt.isFocused())&&d(this,u,V).call(this)},i(this,_)))},ft=function(){d(this,u,ct).call(this),d(this,u,dt).call(this,d(this,u,lt).call(this))},pt=function(){i(this,U)&&(clearTimeout(i(this,U)),c(this,U,void 0))},yt=function(){i(this,D)&&(clearInterval(i(this,D)),c(this,D,void 0))},bt=function(){const t=i(this,g).getQueryCache().build(i(this,g),this.options);if(t===i(this,h))return;const e=i(this,h);c(this,h,t),c(this,$,t.state),this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))},Dt=function(t){it.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(i(this,m))}),i(this,g).getQueryCache().notify({query:i(this,h),type:"observerResultsUpdated"})})},Tt);function Nt(s,t){return E(t.enabled,s)!==!1&&s.state.data===void 0&&!(s.state.status==="error"&&t.retryOnMount===!1)}function qt(s,t){return Nt(s,t)||s.state.data!==void 0&&mt(s,t,t.refetchOnMount)}function mt(s,t,e){if(E(t.enabled,s)!==!1&&W(t.staleTime,s)!=="static"){const r=typeof e=="function"?e(s):e;return r==="always"||r!==!1&&gt(s,t)}return!1}function Ft(s,t,e,r){return(s!==t||E(r.enabled,s)===!1)&&(!e.suspense||s.state.status!=="error")&&gt(s,e)}function gt(s,t){return E(t.enabled,s)!==!1&&s.isStaleByTime(W(t.staleTime,s))}function Vt(s,t){return!et(s.getCurrentResult(),t)}var T,M,R,Q,I,tt,vt,Mt,Wt=(Mt=class extends Pt{constructor(t,e){super();p(this,I);p(this,T);p(this,M);p(this,R);p(this,Q);c(this,T,t),this.setOptions(e),this.bindMethods(),d(this,I,tt).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const e=this.options;this.options=i(this,T).defaultMutationOptions(t),et(this.options,e)||i(this,T).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,R),observer:this}),e!=null&&e.mutationKey&&this.options.mutationKey&&It(e.mutationKey)!==It(this.options.mutationKey)?this.reset():((r=i(this,R))==null?void 0:r.state.status)==="pending"&&i(this,R).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,R))==null||t.removeObserver(this)}onMutationUpdate(t){d(this,I,tt).call(this),d(this,I,vt).call(this,t)}getCurrentResult(){return i(this,M)}reset(){var t;(t=i(this,R))==null||t.removeObserver(this),c(this,R,void 0),d(this,I,tt).call(this),d(this,I,vt).call(this)}mutate(t,e){var r;return c(this,Q,e),(r=i(this,R))==null||r.removeObserver(this),c(this,R,i(this,T).getMutationCache().build(i(this,T),this.options)),i(this,R).addObserver(this),i(this,R).execute(t)}},T=new WeakMap,M=new WeakMap,R=new WeakMap,Q=new WeakMap,I=new WeakSet,tt=function(){var e;const t=((e=i(this,R))==null?void 0:e.state)??At();c(this,M,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},vt=function(t){it.batch(()=>{var e,r,n,a,o,b,f,v;if(i(this,Q)&&this.hasListeners()){const O=i(this,M).variables,l=i(this,M).context;(t==null?void 0:t.type)==="success"?((r=(e=i(this,Q)).onSuccess)==null||r.call(e,t.data,O,l),(a=(n=i(this,Q)).onSettled)==null||a.call(n,t.data,null,O,l)):(t==null?void 0:t.type)==="error"&&((b=(o=i(this,Q)).onError)==null||b.call(o,t.error,O,l),(v=(f=i(this,Q)).onSettled)==null||v.call(f,void 0,t.error,O,l))}this.listeners.forEach(O=>{O(i(this,M))})})},Mt),Kt=C.createContext(!1),$t=()=>C.useContext(Kt);Kt.Provider;function Gt(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}var Jt=C.createContext(Gt()),Xt=()=>C.useContext(Jt),Yt=(s,t)=>{(s.suspense||s.throwOnError||s.experimental_prefetchInRender)&&(t.isReset()||(s.retryOnMount=!1))},Zt=s=>{C.useEffect(()=>{s.clearReset()},[s])},te=({result:s,errorResetBoundary:t,throwOnError:e,query:r,suspense:n})=>s.isError&&!t.isReset()&&!s.isFetching&&r&&(n&&s.data===void 0||Ut(e,[s.error,r])),ee=s=>{if(s.suspense){const t=r=>r==="static"?r:Math.max(r??1e3,1e3),e=s.staleTime;s.staleTime=typeof e=="function"?(...r)=>t(e(...r)):t(e),typeof s.gcTime=="number"&&(s.gcTime=Math.max(s.gcTime,1e3))}},se=(s,t)=>s.isLoading&&s.isFetching&&!t,ie=(s,t)=>(s==null?void 0:s.suspense)&&t.isPending,_t=(s,t,e)=>t.fetchOptimistic(s).catch(()=>{e.clearReset()});function re(s,t,e){var l,H,y,z,N;const r=$t(),n=Xt(),a=J(),o=a.defaultQueryOptions(s);(H=(l=a.getDefaultOptions().queries)==null?void 0:l._experimental_beforeQuery)==null||H.call(l,o),o._optimisticResults=r?"isRestoring":"optimistic",ee(o),Yt(o,n),Zt(n);const b=!a.getQueryCache().get(o.queryHash),[f]=C.useState(()=>new t(a,o)),v=f.getOptimisticResult(o),O=!r&&s.subscribed!==!1;if(C.useSyncExternalStore(C.useCallback(S=>{const X=O?f.subscribe(it.batchCalls(S)):st;return f.updateResult(),X},[f,O]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),C.useEffect(()=>{f.setOptions(o)},[o,f]),ie(o,v))throw _t(o,f,n);if(te({result:v,errorResetBoundary:n,throwOnError:o.throwOnError,query:a.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw v.error;if((z=(y=a.getDefaultOptions().queries)==null?void 0:y._experimental_afterQuery)==null||z.call(y,o,v),o.experimental_prefetchInRender&&!ut&&se(v,r)){const S=b?_t(o,f,n):(N=a.getQueryCache().get(o.queryHash))==null?void 0:N.promise;S==null||S.catch(st).finally(()=>{f.updateResult()})}return o.notifyOnChangeProps?v:f.trackResult(v)}function rt(s,t){return re(s,zt)}function Rt(s,t){const e=J(),[r]=C.useState(()=>new Wt(e,s));C.useEffect(()=>{r.setOptions(s)},[r,s]);const n=C.useSyncExternalStore(C.useCallback(o=>r.subscribe(it.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),a=C.useCallback((o,b)=>{r.mutate(o,b).catch(st)},[r]);if(n.error&&Ut(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:a,mutateAsync:n.mutate}}function he(s={}){const{published:t,page:e=1,pageSize:r=10,search:n}=s;return rt({queryKey:["posts",{published:t,page:e,pageSize:r,search:n}],queryFn:async()=>{let a=K.from("mladv_posts").select("*",{count:"exact"});t!==void 0&&(a=a.eq("published",t)),n&&(a=a.or(`title.ilike.%${n}%,content_html.ilike.%${n}%`)),a=a.order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).range((e-1)*r,e*r-1);const{data:o,error:b,count:f}=await a;if(b)throw b;return{posts:o||[],total:f??0,totalPages:Math.ceil((f??0)/r)}}})}function ue(s){return rt({queryKey:["post",s],queryFn:async()=>{const{data:t,error:e}=await K.from("mladv_posts").select("*").eq("slug",s).eq("published",!0).maybeSingle();if(e)throw e;return t},enabled:!!s})}function ce(s){return rt({queryKey:["post-by-id",s],queryFn:async()=>{const{data:t,error:e}=await K.from("mladv_posts").select("*").eq("id",s).maybeSingle();if(e)throw e;return t},enabled:!!s})}function le(){return rt({queryKey:["all-posts"],queryFn:async()=>{const{data:s,error:t}=await K.from("mladv_posts").select("*").order("created_at",{ascending:!1});if(t)throw t;return s||[]}})}function de(){const s=J();return Rt({mutationFn:async t=>{const{data:e,error:r}=await K.from("mladv_posts").insert(t).select().single();if(r)throw r;return e},onSuccess:()=>{s.invalidateQueries({queryKey:["posts"]}),s.invalidateQueries({queryKey:["all-posts"]})}})}function fe(){const s=J();return Rt({mutationFn:async({id:t,...e})=>{const{data:r,error:n}=await K.from("mladv_posts").update({...e,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(n)throw n;return r},onSuccess:t=>{s.invalidateQueries({queryKey:["posts"]}),s.invalidateQueries({queryKey:["all-posts"]}),s.invalidateQueries({queryKey:["post",t.slug]}),s.invalidateQueries({queryKey:["post-by-id",t.id]})}})}function pe(){const s=J();return Rt({mutationFn:async t=>{const{error:e}=await K.from("mladv_posts").delete().eq("id",t);if(e)throw e},onSuccess:()=>{s.invalidateQueries({queryKey:["posts"]}),s.invalidateQueries({queryKey:["all-posts"]})}})}function ye({className:s,...t}){return Bt.jsx("div",{className:Ht("animate-pulse rounded-md bg-muted",s),...t})}export{ye as S,ue as a,fe as b,pe as c,le as d,de as e,ce as f,he as u};
