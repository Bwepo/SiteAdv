import{r as u,y as R,j as e}from"./index-BdXZqJOp.js";import{A as z}from"./AdminLayout-e4aBGtOV.js";import{B as h}from"./button-CyplsBo1.js";import{C,a as b,b as w,c as y}from"./card-Bh1YdBDx.js";import{T as B,a as F,b as p,c as d,d as _,e as r,A as q,f as O,g as V,h as G,i as J,j as K,k as Q,l as U}from"./alert-dialog-BOd9mKS9.js";import{S as o}from"./skeleton-CWdHDkw-.js";import{b as W,g as X,h as Y,i as Z}from"./useNewsletter-2NjaLql_.js";import{g as A}from"./supabaseErrors-eYWJjREL.js";import"./chevron-left-3ZbIeQJE.js";import"./house-cE4qeB5u.js";import"./file-text-BAASpnzx.js";import"./mail-EwiI4BEs.js";import"./index-Dx9O3Fa6.js";import"./index-CK2GlzLI.js";import"./useMutation-COuFGjyM.js";const E={draft:"Rascunho",queued:"Fila",sending:"Enviando",sent:"Enviada",partial:"Parcial",failed:"Falhou"},$={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},S=a=>a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",pe=()=>{const{data:a,isLoading:D}=W(),[j,g]=u.useState(null),[f,v]=u.useState(null),[c,m]=u.useState(null),{toast:x}=R(),T=X(),n=Y(),{data:i,isLoading:L}=Z(j),t=(i==null?void 0:i.campaign)??null,N=i==null?void 0:i.deliveryCounts,k=u.useMemo(()=>((a==null?void 0:a.length)??0)>0,[a]),H=s=>["draft","queued","partial"].includes(s),I=async s=>{v(s);try{await T.mutateAsync(s),x({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(l){const M=A(l,"Não foi possível iniciar o envio.");x({title:"Erro ao enviar",description:M,variant:"destructive"})}finally{v(null)}},P=async()=>{if(c)try{await n.mutateAsync(c),x({title:"Campanha excluída",description:"A campanha foi removida com sucesso."}),j===c&&g(null)}catch(s){const l=A(s,"Não foi possível excluir a campanha.");x({title:"Erro ao excluir",description:l,variant:"destructive"})}finally{m(null)}};return e.jsxs(z,{title:"Campanhas de Newsletter",children:[e.jsxs(C,{className:"mb-6",children:[e.jsx(b,{children:e.jsx(w,{children:"Campanhas"})}),e.jsx(y,{children:D?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"})]}):e.jsxs(B,{children:[e.jsx(F,{children:e.jsxs(p,{children:[e.jsx(d,{children:"Assunto"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Criado em"}),e.jsx(d,{children:"Enviado em"}),e.jsx(d,{className:"text-right",children:"Ações"})]})}),e.jsx(_,{children:k?a==null?void 0:a.map(s=>e.jsxs(p,{children:[e.jsx(r,{className:"font-medium",children:s.subject}),e.jsx(r,{children:E[s.status]??s.status}),e.jsx(r,{children:S(s.created_at)}),e.jsx(r,{children:S(s.sent_at)}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[H(s.status)&&e.jsx(h,{variant:"default",size:"sm",onClick:()=>I(s.id),disabled:f===s.id,children:f===s.id?"Enviando...":"Enviar agora"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>g(s.id),children:"Ver detalhes"}),e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(s.id),disabled:n.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(p,{children:e.jsx(r,{colSpan:5,className:"text-center text-muted-foreground py-8",children:'Nenhuma campanha cadastrada ainda. As campanhas são criadas automaticamente ao publicar posts com a opção "Enviar newsletter" ativada.'})})})]})})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(w,{children:"Detalhes da campanha"})}),e.jsx(y,{children:L?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-6 w-1/2"}),e.jsx(o,{className:"h-24 w-full"})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3",children:e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(t.id),disabled:n.isPending,children:"Excluir campanha"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assunto"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:t.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:E[t.status]??t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Post relacionado"}),t.post?e.jsxs("div",{className:"text-base font-medium text-foreground",children:[t.post.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["/blog/",t.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resumo de envios"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mt-2",children:Object.entries($).map(([s,l])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:l}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:N?N[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview HTML"}),e.jsx("div",{className:"mt-2 max-h-[320px] overflow-auto rounded-lg border border-border bg-background p-4",children:t.html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:t.html}}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem conteúdo HTML."})})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma campanha para ver os detalhes."})})]}),e.jsx(q,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(O,{children:[e.jsxs(V,{children:[e.jsx(G,{children:"Excluir campanha?"}),e.jsx(J,{children:"Esta ação remove a campanha e seu histórico de envios. Essa ação não pode ser desfeita."})]}),e.jsxs(K,{children:[e.jsx(Q,{children:"Cancelar"}),e.jsx(U,{onClick:P,disabled:n.isPending,children:n.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{pe as default};
