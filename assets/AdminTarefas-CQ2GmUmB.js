import{c as yt,r as o,j as r,e as q,h as Fr,a5 as Y,f as dt,m as pn}from"./index-Bl_6Uoau.js";import{E as zr,A as _r,m as Pn}from"./formatters-BRfsOrXZ.js";import{P as Br,T as $r}from"./TarefaSheet-DlTmJtUl.js";import{u as Kr,F as Ur,a as He,b as We,c as qe,d as Je,e as Ge,t as Yr}from"./form-BXGYnwlU.js";import{S as Vr,b as Xr,c as Hr,d as Wr,e as qr,f as Gr}from"./sheet--MDMMNpX.js";import{I as kt}from"./input-BNgSOOX1.js";import{B as Ue}from"./button-BvYdXv9R.js";import{S as ge,a as xe,b as pe,c as ve,d as B}from"./select-OVZjbvUN.js";import{P as Fn,a as zn,b as _n}from"./popover-D_e6AMA5.js";import{g as Bn,S as gt,h as tn,a as Jr,b as Zr,i as It,c as nn,T as Qr,j as es}from"./crmTypes-Dn4xFaQy.js";import{S as cn}from"./search-EIYqpv5r.js";import{C as ts}from"./check-CQlnsCrv.js";import{U as ns}from"./user-D-r7cLOE.js";import{T as $n}from"./trash-2-DM00DEZb.js";import{L as rs}from"./loader-circle-vFcLMjPn.js";import{o as ss,s as Ze,e as as}from"./types-C9wiu8_K.js";import{C as xt,c as pt}from"./card-W1hrYHER.js";import{A as Kn,a as Un,b as Yn,c as Vn,d as Xn,e as Hn,f as Wn,g as qn}from"./alert-dialog-kD6pt4qf.js";import{P as Gn,B as Oe}from"./badge-g3iwkDrd.js";import{S as ut}from"./switch-yEhZpEdH.js";import{L as Jn}from"./list-D93w3V9q.js";import{F as Zn}from"./folder-kanban-Cll1ichG.js";import{U as Qn}from"./users-DqEjyMHF.js";import{C as er}from"./calendar-gKNzVd1i.js";import{P as os}from"./pencil-BDBLmfod.js";import{L as is}from"./label-Dhkl9ll1.js";import{T as ls,K as cs}from"./CrmSkeletons-CMrCMUzZ.js";import{C as ds}from"./clipboard-list-vPbk6Bpg.js";import{F as us}from"./filter-Bq29PFOh.js";import{C as tr,a as fs}from"./circle-x-CLh1BIjB.js";import{C as hs}from"./clock-CcbvUEQA.js";import{C as ms}from"./circle-check-hhY3ZRi0.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=yt("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=yt("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nr=yt("Columns3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rr=yt("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=yt("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),ps=ss({title:Ze().trim().min(1,"Título obrigatório").max(200),parentTaskId:Ze().min(1,"Tarefa-mãe obrigatória"),deadline:Ze().optional(),status:as(["A fazer","Em andamento","Concluído"]),assignee:Ze().optional(),notes:Ze().max(2e3).optional(),numeroProcesso:Ze().max(25).optional()}),vs=Object.entries(gt);function bs({open:e,onOpenChange:t,subtask:n,tasks:s,onSave:a,onDelete:i}){const c=!n,[l,d]=o.useState(!1),[f,h]=o.useState(""),[m,v]=o.useState(!1),p=o.useMemo(()=>{if(!f.trim())return s;const x=f.toLowerCase();return s.filter(j=>j.title.toLowerCase().includes(x))},[s,f]),y=Kr({resolver:Yr(ps),defaultValues:{title:"",parentTaskId:"",deadline:"",status:"A fazer",assignee:"",notes:""}});o.useEffect(()=>{e&&(n?y.reset({title:n.title,parentTaskId:n.parentTaskId,deadline:n.dueDate??"",status:n.status,assignee:n.assignee??"",notes:n.notes??"",numeroProcesso:n.numeroProcesso??""}):y.reset({title:"",parentTaskId:"",deadline:"",status:"A fazer",assignee:"",notes:"",numeroProcesso:""}))},[e,n]);const b=async x=>{d(!0);try{await a(x,c,n==null?void 0:n.id),t(!1)}catch(j){Fr.error("Erro ao salvar subtarefa: "+j.message),console.error("Erro ao salvar subtarefa:",j)}finally{d(!1)}};return r.jsx(Vr,{open:e,onOpenChange:t,children:r.jsxs(Xr,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[r.jsxs(Hr,{className:"mb-6",children:[r.jsx(Wr,{children:c?"Nova Subtarefa":"Editar Subtarefa"}),r.jsx(qr,{children:c?"Preencha os dados e selecione a tarefa-mãe relacionada.":"Altere os campos e salve."})]}),r.jsx(Ur,{...y,children:r.jsxs("form",{onSubmit:y.handleSubmit(b),className:"space-y-5",children:[r.jsx(He,{control:y.control,name:"title",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Título *"}),r.jsx(Je,{children:r.jsx(kt,{placeholder:"Ex: Enviar documento",...x})}),r.jsx(Ge,{})]})}),r.jsx(He,{control:y.control,name:"parentTaskId",render:({field:x})=>{var j;return r.jsxs(We,{className:"flex flex-col",children:[r.jsx(qe,{children:"Tarefa-mãe *"}),r.jsxs(Fn,{open:m,onOpenChange:v,children:[r.jsx(zn,{asChild:!0,children:r.jsx(Je,{children:r.jsxs(Ue,{variant:"outline",role:"combobox",className:q("w-full justify-between font-normal",!x.value&&"text-muted-foreground"),children:[r.jsx("span",{className:"truncate",children:x.value?((j=s.find(C=>C.id===x.value))==null?void 0:j.title)??"Tarefa não encontrada":"Selecione a tarefa-mãe..."}),r.jsx(gs,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),r.jsxs(_n,{className:"w-[--radix-popover-trigger-width] p-0",align:"start",children:[r.jsxs("div",{className:"flex items-center border-b px-3",children:[r.jsx(cn,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),r.jsx("input",{className:"flex h-10 w-full bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground",placeholder:"Buscar tarefa...",value:f,onChange:C=>h(C.target.value)})]}),r.jsx("div",{className:"max-h-[200px] overflow-y-auto p-1",children:p.length===0?r.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"Nenhuma tarefa encontrada."}):p.map(C=>r.jsxs("button",{type:"button",className:q("relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",x.value===C.id&&"bg-accent"),onClick:()=>{x.onChange(C.id),v(!1),h("")},children:[r.jsx(ts,{className:q("mr-2 h-4 w-4",x.value===C.id?"opacity-100":"opacity-0")}),r.jsx("span",{className:"truncate",children:C.title})]},C.id))})]})]}),r.jsx(Ge,{})]})}}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx(He,{control:y.control,name:"deadline",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Prazo"}),r.jsx(Je,{children:r.jsx(kt,{type:"date",...x})}),r.jsx(Ge,{})]})}),r.jsx(He,{control:y.control,name:"status",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Status"}),r.jsxs(ge,{onValueChange:x.onChange,value:x.value,children:[r.jsx(Je,{children:r.jsx(xe,{children:r.jsx(pe,{})})}),r.jsx(ve,{children:vs.map(([j,C])=>r.jsx(B,{value:j,children:C},j))})]}),r.jsx(Ge,{})]})})]}),r.jsx(He,{control:y.control,name:"assignee",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Responsável"}),r.jsxs(ge,{onValueChange:j=>x.onChange(j==="_none_"?"":j),value:x.value||"_none_",children:[r.jsx(Je,{children:r.jsx(xe,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(ns,{className:"w-3.5 h-3.5 text-muted-foreground"}),r.jsx(pe,{placeholder:"Responsável..."})]})})}),r.jsxs(ve,{children:[r.jsx(B,{value:"_none_",children:"— Sem responsável —"}),Bn.map(j=>r.jsx(B,{value:j,children:j},j))]})]}),r.jsx(Ge,{})]})}),r.jsx(He,{control:y.control,name:"numeroProcesso",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Processo Judicial"}),r.jsx(Br,{value:x.value??"",onValueChange:x.onChange}),r.jsx(Ge,{})]})}),r.jsx(He,{control:y.control,name:"notes",render:({field:x})=>r.jsxs(We,{children:[r.jsx(qe,{children:"Observações"}),r.jsx(Je,{children:r.jsx(zr,{value:x.value??"",onChange:x.onChange,placeholder:"Observações...",modalTitle:"Editar Observações da Subtarefa"})}),r.jsx(Ge,{})]})}),!c&&(n==null?void 0:n.id)&&r.jsx(_r,{folder:`subtarefas/${n.id}`}),r.jsxs(Gr,{className:"gap-2 flex-col sm:flex-row",children:[!c&&n&&i&&r.jsxs(Ue,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{i(n.id),t(!1)},disabled:l,children:[r.jsx($n,{className:"w-4 h-4 mr-2"})," Excluir"]}),r.jsxs(Ue,{type:"submit",disabled:l,className:"flex-1",children:[l&&r.jsx(rs,{className:"w-4 h-4 mr-2 animate-spin"}),c?"Criar Subtarefa":"Salvar Alterações"]})]})]})})]})})}function ys(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.useMemo(()=>s=>{t.forEach(a=>a(s))},t)}const Bt=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function et(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function dn(e){return"nodeType"in e}function fe(e){var t,n;return e?et(e)?e:dn(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function un(e){const{Document:t}=fe(e);return e instanceof t}function jt(e){return et(e)?!1:e instanceof fe(e).HTMLElement}function sr(e){return e instanceof fe(e).SVGElement}function tt(e){return e?et(e)?e.document:dn(e)?un(e)?e:jt(e)||sr(e)?e.ownerDocument:document:document:document}const De=Bt?o.useLayoutEffect:o.useEffect;function $t(e){const t=o.useRef(e);return De(()=>{t.current=e}),o.useCallback(function(){for(var n=arguments.length,s=new Array(n),a=0;a<n;a++)s[a]=arguments[a];return t.current==null?void 0:t.current(...s)},[])}function js(){const e=o.useRef(null),t=o.useCallback((s,a)=>{e.current=setInterval(s,a)},[]),n=o.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function vt(e,t){t===void 0&&(t=[e]);const n=o.useRef(e);return De(()=>{n.current!==e&&(n.current=e)},t),n}function wt(e,t){const n=o.useRef();return o.useMemo(()=>{const s=e(n.current);return n.current=s,s},[...t])}function Mt(e){const t=$t(e),n=o.useRef(null),s=o.useCallback(a=>{a!==n.current&&(t==null||t(a,n.current)),n.current=a},[]);return[n,s]}function Lt(e){const t=o.useRef();return o.useEffect(()=>{t.current=e},[e]),t.current}let Jt={};function St(e,t){return o.useMemo(()=>{if(t)return t;const n=Jt[e]==null?0:Jt[e]+1;return Jt[e]=n,e+"-"+n},[e,t])}function ar(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s.reduce((i,c)=>{const l=Object.entries(c);for(const[d,f]of l){const h=i[d];h!=null&&(i[d]=h+e*f)}return i},{...t})}}const Qe=ar(1),Pt=ar(-1);function ws(e){return"clientX"in e&&"clientY"in e}function Kt(e){if(!e)return!1;const{KeyboardEvent:t}=fe(e.target);return t&&e instanceof t}function Ss(e){if(!e)return!1;const{TouchEvent:t}=fe(e.target);return t&&e instanceof t}function Ft(e){if(Ss(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return ws(e)?{x:e.clientX,y:e.clientY}:null}const Pe=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Pe.Translate.toString(e),Pe.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:s}=e;return t+" "+n+"ms "+s}}}),bn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Cs(e){return e.matches(bn)?e:e.querySelector(bn)}const Ns={display:"none"};function Ds(e){let{id:t,value:n}=e;return Y.createElement("div",{id:t,style:Ns},n)}function Ts(e){let{id:t,announcement:n,ariaLiveType:s="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Y.createElement("div",{id:t,style:a,role:"status","aria-live":s,"aria-atomic":!0},n)}function Es(){const[e,t]=o.useState("");return{announce:o.useCallback(s=>{s!=null&&t(s)},[]),announcement:e}}const or=o.createContext(null);function Rs(e){const t=o.useContext(or);o.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function As(){const[e]=o.useState(()=>new Set),t=o.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[o.useCallback(s=>{let{type:a,event:i}=s;e.forEach(c=>{var l;return(l=c[a])==null?void 0:l.call(c,i)})},[e]),t]}const Os={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},ks={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Is(e){let{announcements:t=ks,container:n,hiddenTextDescribedById:s,screenReaderInstructions:a=Os}=e;const{announce:i,announcement:c}=Es(),l=St("DndLiveRegion"),[d,f]=o.useState(!1);if(o.useEffect(()=>{f(!0)},[]),Rs(o.useMemo(()=>({onDragStart(m){let{active:v}=m;i(t.onDragStart({active:v}))},onDragMove(m){let{active:v,over:p}=m;t.onDragMove&&i(t.onDragMove({active:v,over:p}))},onDragOver(m){let{active:v,over:p}=m;i(t.onDragOver({active:v,over:p}))},onDragEnd(m){let{active:v,over:p}=m;i(t.onDragEnd({active:v,over:p}))},onDragCancel(m){let{active:v,over:p}=m;i(t.onDragCancel({active:v,over:p}))}}),[i,t])),!d)return null;const h=Y.createElement(Y.Fragment,null,Y.createElement(Ds,{id:s,value:a.draggable}),Y.createElement(Ts,{id:l,announcement:c}));return n?dt.createPortal(h,n):h}var Z;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(Z||(Z={}));function zt(){}function ir(e,t){return o.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function lr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return o.useMemo(()=>[...t].filter(s=>s!=null),[...t])}const Te=Object.freeze({x:0,y:0});function Ms(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ls(e,t){const n=Ft(e);if(!n)return"0 0";const s={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return s.x+"% "+s.y+"%"}function Ps(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return n-s}function Fs(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return s-n}function yn(e){let{left:t,top:n,height:s,width:a}=e;return[{x:t,y:n},{x:t+a,y:n},{x:t,y:n+s},{x:t+a,y:n+s}]}function zs(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}const cr=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const a=yn(t),i=[];for(const c of s){const{id:l}=c,d=n.get(l);if(d){const f=yn(d),h=a.reduce((v,p,y)=>v+Ms(f[y],p),0),m=Number((h/4).toFixed(4));i.push({id:l,data:{droppableContainer:c,value:m}})}}return i.sort(Ps)};function _s(e,t){const n=Math.max(t.top,e.top),s=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),i=Math.min(t.top+t.height,e.top+e.height),c=a-s,l=i-n;if(s<a&&n<i){const d=t.width*t.height,f=e.width*e.height,h=c*l,m=h/(d+f-h);return Number(m.toFixed(4))}return 0}const Bs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const a=[];for(const i of s){const{id:c}=i,l=n.get(c);if(l){const d=_s(l,t);d>0&&a.push({id:c,data:{droppableContainer:i,value:d}})}}return a.sort(Fs)};function $s(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function dr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:Te}function Ks(e){return function(n){for(var s=arguments.length,a=new Array(s>1?s-1:0),i=1;i<s;i++)a[i-1]=arguments[i];return a.reduce((c,l)=>({...c,top:c.top+e*l.y,bottom:c.bottom+e*l.y,left:c.left+e*l.x,right:c.right+e*l.x}),{...n})}}const Us=Ks(1);function ur(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Ys(e,t,n){const s=ur(t);if(!s)return e;const{scaleX:a,scaleY:i,x:c,y:l}=s,d=e.left-c-(1-a)*parseFloat(n),f=e.top-l-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),h=a?e.width/a:e.width,m=i?e.height/i:e.height;return{width:h,height:m,top:f,right:d+h,bottom:f+m,left:d}}const Vs={ignoreTransform:!1};function nt(e,t){t===void 0&&(t=Vs);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:f,transformOrigin:h}=fe(e).getComputedStyle(e);f&&(n=Ys(n,f,h))}const{top:s,left:a,width:i,height:c,bottom:l,right:d}=n;return{top:s,left:a,width:i,height:c,bottom:l,right:d}}function jn(e){return nt(e,{ignoreTransform:!0})}function Xs(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function Hs(e,t){return t===void 0&&(t=fe(e).getComputedStyle(e)),t.position==="fixed"}function Ws(e,t){t===void 0&&(t=fe(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const i=t[a];return typeof i=="string"?n.test(i):!1})}function fn(e,t){const n=[];function s(a){if(t!=null&&n.length>=t||!a)return n;if(un(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!jt(a)||sr(a)||n.includes(a))return n;const i=fe(e).getComputedStyle(a);return a!==e&&Ws(a,i)&&n.push(a),Hs(a,i)?n:s(a.parentNode)}return e?s(e):n}function fr(e){const[t]=fn(e,1);return t??null}function Zt(e){return!Bt||!e?null:et(e)?e:dn(e)?un(e)||e===tt(e).scrollingElement?window:jt(e)?e:null:null}function hr(e){return et(e)?e.scrollX:e.scrollLeft}function mr(e){return et(e)?e.scrollY:e.scrollTop}function rn(e){return{x:hr(e),y:mr(e)}}var re;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(re||(re={}));function gr(e){return!Bt||!e?!1:e===document.scrollingElement}function xr(e){const t={x:0,y:0},n=gr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},a=e.scrollTop<=t.y,i=e.scrollLeft<=t.x,c=e.scrollTop>=s.y,l=e.scrollLeft>=s.x;return{isTop:a,isLeft:i,isBottom:c,isRight:l,maxScroll:s,minScroll:t}}const qs={x:.2,y:.2};function Gs(e,t,n,s,a){let{top:i,left:c,right:l,bottom:d}=n;s===void 0&&(s=10),a===void 0&&(a=qs);const{isTop:f,isBottom:h,isLeft:m,isRight:v}=xr(e),p={x:0,y:0},y={x:0,y:0},b={height:t.height*a.y,width:t.width*a.x};return!f&&i<=t.top+b.height?(p.y=re.Backward,y.y=s*Math.abs((t.top+b.height-i)/b.height)):!h&&d>=t.bottom-b.height&&(p.y=re.Forward,y.y=s*Math.abs((t.bottom-b.height-d)/b.height)),!v&&l>=t.right-b.width?(p.x=re.Forward,y.x=s*Math.abs((t.right-b.width-l)/b.width)):!m&&c<=t.left+b.width&&(p.x=re.Backward,y.x=s*Math.abs((t.left+b.width-c)/b.width)),{direction:p,speed:y}}function Js(e){if(e===document.scrollingElement){const{innerWidth:i,innerHeight:c}=window;return{top:0,left:0,right:i,bottom:c,width:i,height:c}}const{top:t,left:n,right:s,bottom:a}=e.getBoundingClientRect();return{top:t,left:n,right:s,bottom:a,width:e.clientWidth,height:e.clientHeight}}function pr(e){return e.reduce((t,n)=>Qe(t,rn(n)),Te)}function Zs(e){return e.reduce((t,n)=>t+hr(n),0)}function Qs(e){return e.reduce((t,n)=>t+mr(n),0)}function vr(e,t){if(t===void 0&&(t=nt),!e)return;const{top:n,left:s,bottom:a,right:i}=t(e);fr(e)&&(a<=0||i<=0||n>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const ea=[["x",["left","right"],Zs],["y",["top","bottom"],Qs]];class hn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=fn(n),a=pr(s);this.rect={...t},this.width=t.width,this.height=t.height;for(const[i,c,l]of ea)for(const d of c)Object.defineProperty(this,d,{get:()=>{const f=l(s),h=a[i]-f;return this.rect[d]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ft{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=t}add(t,n,s){var a;(a=this.target)==null||a.addEventListener(t,n,s),this.listeners.push([t,n,s])}}function ta(e){const{EventTarget:t}=fe(e);return e instanceof t?e:tt(e)}function Qt(e,t){const n=Math.abs(e.x),s=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+s**2)>t:"x"in t&&"y"in t?n>t.x&&s>t.y:"x"in t?n>t.x:"y"in t?s>t.y:!1}var Ne;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ne||(Ne={}));function wn(e){e.preventDefault()}function na(e){e.stopPropagation()}var L;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(L||(L={}));const br={start:[L.Space,L.Enter],cancel:[L.Esc],end:[L.Space,L.Enter,L.Tab]},ra=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case L.Right:return{...n,x:n.x+25};case L.Left:return{...n,x:n.x-25};case L.Down:return{...n,y:n.y+25};case L.Up:return{...n,y:n.y-25}}};class yr{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new ft(tt(n)),this.windowListeners=new ft(fe(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ne.Resize,this.handleCancel),this.windowListeners.add(Ne.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ne.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,s=t.node.current;s&&vr(s),n(Te)}handleKeyDown(t){if(Kt(t)){const{active:n,context:s,options:a}=this.props,{keyboardCodes:i=br,coordinateGetter:c=ra,scrollBehavior:l="smooth"}=a,{code:d}=t;if(i.end.includes(d)){this.handleEnd(t);return}if(i.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:f}=s.current,h=f?{x:f.left,y:f.top}:Te;this.referenceCoordinates||(this.referenceCoordinates=h);const m=c(t,{active:n,context:s.current,currentCoordinates:h});if(m){const v=Pt(m,h),p={x:0,y:0},{scrollableAncestors:y}=s.current;for(const b of y){const x=t.code,{isTop:j,isRight:C,isLeft:T,isBottom:S,maxScroll:R,minScroll:A}=xr(b),N=Js(b),D={x:Math.min(x===L.Right?N.right-N.width/2:N.right,Math.max(x===L.Right?N.left:N.left+N.width/2,m.x)),y:Math.min(x===L.Down?N.bottom-N.height/2:N.bottom,Math.max(x===L.Down?N.top:N.top+N.height/2,m.y))},P=x===L.Right&&!C||x===L.Left&&!T,$=x===L.Down&&!S||x===L.Up&&!j;if(P&&D.x!==m.x){const k=b.scrollLeft+v.x,Q=x===L.Right&&k<=R.x||x===L.Left&&k>=A.x;if(Q&&!v.y){b.scrollTo({left:k,behavior:l});return}Q?p.x=b.scrollLeft-k:p.x=x===L.Right?b.scrollLeft-R.x:b.scrollLeft-A.x,p.x&&b.scrollBy({left:-p.x,behavior:l});break}else if($&&D.y!==m.y){const k=b.scrollTop+v.y,Q=x===L.Down&&k<=R.y||x===L.Up&&k>=A.y;if(Q&&!v.x){b.scrollTo({top:k,behavior:l});return}Q?p.y=b.scrollTop-k:p.y=x===L.Down?b.scrollTop-R.y:b.scrollTop-A.y,p.y&&b.scrollBy({top:-p.y,behavior:l});break}}this.handleMove(t,Qe(Pt(m,this.referenceCoordinates),p))}}}handleMove(t,n){const{onMove:s}=this.props;t.preventDefault(),s(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}yr.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:s=br,onActivation:a}=t,{active:i}=n;const{code:c}=e.nativeEvent;if(s.start.includes(c)){const l=i.activatorNode.current;return l&&e.target!==l?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function Sn(e){return!!(e&&"distance"in e)}function Cn(e){return!!(e&&"delay"in e)}class mn{constructor(t,n,s){var a;s===void 0&&(s=ta(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:i}=t,{target:c}=i;this.props=t,this.events=n,this.document=tt(c),this.documentListeners=new ft(this.document),this.listeners=new ft(s),this.windowListeners=new ft(fe(c)),this.initialCoordinates=(a=Ft(i))!=null?a:Te,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ne.Resize,this.handleCancel),this.windowListeners.add(Ne.DragStart,wn),this.windowListeners.add(Ne.VisibilityChange,this.handleCancel),this.windowListeners.add(Ne.ContextMenu,wn),this.documentListeners.add(Ne.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Cn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Sn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:s,onPending:a}=this.props;a(s,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ne.Click,na,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ne.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:s,initialCoordinates:a,props:i}=this,{onMove:c,options:{activationConstraint:l}}=i;if(!a)return;const d=(n=Ft(t))!=null?n:Te,f=Pt(a,d);if(!s&&l){if(Sn(l)){if(l.tolerance!=null&&Qt(f,l.tolerance))return this.handleCancel();if(Qt(f,l.distance))return this.handleStart()}if(Cn(l)&&Qt(f,l.tolerance))return this.handleCancel();this.handlePending(l,f);return}t.cancelable&&t.preventDefault(),c(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===L.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const sa={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ut extends mn{constructor(t){const{event:n}=t,s=tt(n.target);super(t,sa,s)}}Ut.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return!n.isPrimary||n.button!==0?!1:(s==null||s({event:n}),!0)}}];const aa={move:{name:"mousemove"},end:{name:"mouseup"}};var sn;(function(e){e[e.RightClick=2]="RightClick"})(sn||(sn={}));class oa extends mn{constructor(t){super(t,aa,tt(t.event.target))}}oa.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return n.button===sn.RightClick?!1:(s==null||s({event:n}),!0)}}];const en={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class ia extends mn{constructor(t){super(t,en)}static setup(){return window.addEventListener(en.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(en.move.name,t)};function t(){}}}ia.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;const{touches:a}=n;return a.length>1?!1:(s==null||s({event:n}),!0)}}];var ht;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(ht||(ht={}));var _t;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(_t||(_t={}));function la(e){let{acceleration:t,activator:n=ht.Pointer,canScroll:s,draggingRect:a,enabled:i,interval:c=5,order:l=_t.TreeOrder,pointerCoordinates:d,scrollableAncestors:f,scrollableAncestorRects:h,delta:m,threshold:v}=e;const p=da({delta:m,disabled:!i}),[y,b]=js(),x=o.useRef({x:0,y:0}),j=o.useRef({x:0,y:0}),C=o.useMemo(()=>{switch(n){case ht.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case ht.DraggableRect:return a}},[n,a,d]),T=o.useRef(null),S=o.useCallback(()=>{const A=T.current;if(!A)return;const N=x.current.x*j.current.x,D=x.current.y*j.current.y;A.scrollBy(N,D)},[]),R=o.useMemo(()=>l===_t.TreeOrder?[...f].reverse():f,[l,f]);o.useEffect(()=>{if(!i||!f.length||!C){b();return}for(const A of R){if((s==null?void 0:s(A))===!1)continue;const N=f.indexOf(A),D=h[N];if(!D)continue;const{direction:P,speed:$}=Gs(A,D,C,t,v);for(const k of["x","y"])p[k][P[k]]||($[k]=0,P[k]=0);if($.x>0||$.y>0){b(),T.current=A,y(S,c),x.current=$,j.current=P;return}}x.current={x:0,y:0},j.current={x:0,y:0},b()},[t,S,s,b,i,c,JSON.stringify(C),JSON.stringify(p),y,f,R,h,JSON.stringify(v)])}const ca={x:{[re.Backward]:!1,[re.Forward]:!1},y:{[re.Backward]:!1,[re.Forward]:!1}};function da(e){let{delta:t,disabled:n}=e;const s=Lt(t);return wt(a=>{if(n||!s||!a)return ca;const i={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[re.Backward]:a.x[re.Backward]||i.x===-1,[re.Forward]:a.x[re.Forward]||i.x===1},y:{[re.Backward]:a.y[re.Backward]||i.y===-1,[re.Forward]:a.y[re.Forward]||i.y===1}}},[n,t,s])}function ua(e,t){const n=t!=null?e.get(t):void 0,s=n?n.node.current:null;return wt(a=>{var i;return t==null?null:(i=s??a)!=null?i:null},[s,t])}function fa(e,t){return o.useMemo(()=>e.reduce((n,s)=>{const{sensor:a}=s,i=a.activators.map(c=>({eventName:c.eventName,handler:t(c.handler,s)}));return[...n,...i]},[]),[e,t])}var bt;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(bt||(bt={}));var an;(function(e){e.Optimized="optimized"})(an||(an={}));const Nn=new Map;function ha(e,t){let{dragging:n,dependencies:s,config:a}=t;const[i,c]=o.useState(null),{frequency:l,measure:d,strategy:f}=a,h=o.useRef(e),m=x(),v=vt(m),p=o.useCallback(function(j){j===void 0&&(j=[]),!v.current&&c(C=>C===null?j:C.concat(j.filter(T=>!C.includes(T))))},[v]),y=o.useRef(null),b=wt(j=>{if(m&&!n)return Nn;if(!j||j===Nn||h.current!==e||i!=null){const C=new Map;for(let T of e){if(!T)continue;if(i&&i.length>0&&!i.includes(T.id)&&T.rect.current){C.set(T.id,T.rect.current);continue}const S=T.node.current,R=S?new hn(d(S),S):null;T.rect.current=R,R&&C.set(T.id,R)}return C}return j},[e,i,n,m,d]);return o.useEffect(()=>{h.current=e},[e]),o.useEffect(()=>{m||p()},[n,m]),o.useEffect(()=>{i&&i.length>0&&c(null)},[JSON.stringify(i)]),o.useEffect(()=>{m||typeof l!="number"||y.current!==null||(y.current=setTimeout(()=>{p(),y.current=null},l))},[l,m,p,...s]),{droppableRects:b,measureDroppableContainers:p,measuringScheduled:i!=null};function x(){switch(f){case bt.Always:return!1;case bt.BeforeDragging:return n;default:return!n}}}function gn(e,t){return wt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function ma(e,t){return gn(e,t)}function ga(e){let{callback:t,disabled:n}=e;const s=$t(t),a=o.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(s)},[s,n]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Yt(e){let{callback:t,disabled:n}=e;const s=$t(t),a=o.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(s)},[n]);return o.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function xa(e){return new hn(nt(e),e)}function Dn(e,t,n){t===void 0&&(t=xa);const[s,a]=o.useState(null);function i(){a(d=>{if(!e)return null;if(e.isConnected===!1){var f;return(f=d??n)!=null?f:null}const h=t(e);return JSON.stringify(d)===JSON.stringify(h)?d:h})}const c=ga({callback(d){if(e)for(const f of d){const{type:h,target:m}=f;if(h==="childList"&&m instanceof HTMLElement&&m.contains(e)){i();break}}}}),l=Yt({callback:i});return De(()=>{i(),e?(l==null||l.observe(e),c==null||c.observe(document.body,{childList:!0,subtree:!0})):(l==null||l.disconnect(),c==null||c.disconnect())},[e]),s}function pa(e){const t=gn(e);return dr(e,t)}const Tn=[];function va(e){const t=o.useRef(e),n=wt(s=>e?s&&s!==Tn&&e&&t.current&&e.parentNode===t.current.parentNode?s:fn(e):Tn,[e]);return o.useEffect(()=>{t.current=e},[e]),n}function ba(e){const[t,n]=o.useState(null),s=o.useRef(e),a=o.useCallback(i=>{const c=Zt(i.target);c&&n(l=>l?(l.set(c,rn(c)),new Map(l)):null)},[]);return o.useEffect(()=>{const i=s.current;if(e!==i){c(i);const l=e.map(d=>{const f=Zt(d);return f?(f.addEventListener("scroll",a,{passive:!0}),[f,rn(f)]):null}).filter(d=>d!=null);n(l.length?new Map(l):null),s.current=e}return()=>{c(e),c(i)};function c(l){l.forEach(d=>{const f=Zt(d);f==null||f.removeEventListener("scroll",a)})}},[a,e]),o.useMemo(()=>e.length?t?Array.from(t.values()).reduce((i,c)=>Qe(i,c),Te):pr(e):Te,[e,t])}function En(e,t){t===void 0&&(t=[]);const n=o.useRef(null);return o.useEffect(()=>{n.current=null},t),o.useEffect(()=>{const s=e!==Te;s&&!n.current&&(n.current=e),!s&&n.current&&(n.current=null)},[e]),n.current?Pt(e,n.current):Te}function ya(e){o.useEffect(()=>{if(!Bt)return;const t=e.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function ja(e,t){return o.useMemo(()=>e.reduce((n,s)=>{let{eventName:a,handler:i}=s;return n[a]=c=>{i(c,t)},n},{}),[e,t])}function jr(e){return o.useMemo(()=>e?Xs(e):null,[e])}const Rn=[];function wa(e,t){t===void 0&&(t=nt);const[n]=e,s=jr(n?fe(n):null),[a,i]=o.useState(Rn);function c(){i(()=>e.length?e.map(d=>gr(d)?s:new hn(t(d),d)):Rn)}const l=Yt({callback:c});return De(()=>{l==null||l.disconnect(),c(),e.forEach(d=>l==null?void 0:l.observe(d))},[e]),a}function wr(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return jt(t)?t:e}function Sa(e){let{measure:t}=e;const[n,s]=o.useState(null),a=o.useCallback(f=>{for(const{target:h}of f)if(jt(h)){s(m=>{const v=t(h);return m?{...m,width:v.width,height:v.height}:v});break}},[t]),i=Yt({callback:a}),c=o.useCallback(f=>{const h=wr(f);i==null||i.disconnect(),h&&(i==null||i.observe(h)),s(h?t(h):null)},[t,i]),[l,d]=Mt(c);return o.useMemo(()=>({nodeRef:l,rect:n,setRef:d}),[n,l,d])}const Ca=[{sensor:Ut,options:{}},{sensor:yr,options:{}}],Na={current:{}},Ot={draggable:{measure:jn},droppable:{measure:jn,strategy:bt.WhileDragging,frequency:an.Optimized},dragOverlay:{measure:nt}};class mt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,s;return(n=(s=this.get(t))==null?void 0:s.node.current)!=null?n:void 0}}const Da={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new mt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:zt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ot,measureDroppableContainers:zt,windowRect:null,measuringScheduled:!1},Sr={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:zt,draggableNodes:new Map,over:null,measureDroppableContainers:zt},Ct=o.createContext(Sr),Cr=o.createContext(Da);function Ta(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new mt}}}function Ea(e,t){switch(t.type){case Z.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case Z.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case Z.DragEnd:case Z.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Z.RegisterDroppable:{const{element:n}=t,{id:s}=n,a=new mt(e.droppable.containers);return a.set(s,n),{...e,droppable:{...e.droppable,containers:a}}}case Z.SetDroppableDisabled:{const{id:n,key:s,disabled:a}=t,i=e.droppable.containers.get(n);if(!i||s!==i.key)return e;const c=new mt(e.droppable.containers);return c.set(n,{...i,disabled:a}),{...e,droppable:{...e.droppable,containers:c}}}case Z.UnregisterDroppable:{const{id:n,key:s}=t,a=e.droppable.containers.get(n);if(!a||s!==a.key)return e;const i=new mt(e.droppable.containers);return i.delete(n),{...e,droppable:{...e.droppable,containers:i}}}default:return e}}function Ra(e){let{disabled:t}=e;const{active:n,activatorEvent:s,draggableNodes:a}=o.useContext(Ct),i=Lt(s),c=Lt(n==null?void 0:n.id);return o.useEffect(()=>{if(!t&&!s&&i&&c!=null){if(!Kt(i)||document.activeElement===i.target)return;const l=a.get(c);if(!l)return;const{activatorNode:d,node:f}=l;if(!d.current&&!f.current)return;requestAnimationFrame(()=>{for(const h of[d.current,f.current]){if(!h)continue;const m=Cs(h);if(m){m.focus();break}}})}},[s,t,a,c,i]),null}function Nr(e,t){let{transform:n,...s}=t;return e!=null&&e.length?e.reduce((a,i)=>i({transform:a,...s}),n):n}function Aa(e){return o.useMemo(()=>({draggable:{...Ot.draggable,...e==null?void 0:e.draggable},droppable:{...Ot.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Ot.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Oa(e){let{activeNode:t,measure:n,initialRect:s,config:a=!0}=e;const i=o.useRef(!1),{x:c,y:l}=typeof a=="boolean"?{x:a,y:a}:a;De(()=>{if(!c&&!l||!t){i.current=!1;return}if(i.current||!s)return;const f=t==null?void 0:t.node.current;if(!f||f.isConnected===!1)return;const h=n(f),m=dr(h,s);if(c||(m.x=0),l||(m.y=0),i.current=!0,Math.abs(m.x)>0||Math.abs(m.y)>0){const v=fr(f);v&&v.scrollBy({top:m.y,left:m.x})}},[t,c,l,s,n])}const Vt=o.createContext({...Te,scaleX:1,scaleY:1});var Ke;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ke||(Ke={}));const Dr=o.memo(function(t){var n,s,a,i;let{id:c,accessibility:l,autoScroll:d=!0,children:f,sensors:h=Ca,collisionDetection:m=Bs,measuring:v,modifiers:p,...y}=t;const b=o.useReducer(Ea,void 0,Ta),[x,j]=b,[C,T]=As(),[S,R]=o.useState(Ke.Uninitialized),A=S===Ke.Initialized,{draggable:{active:N,nodes:D,translate:P},droppable:{containers:$}}=x,k=N!=null?D.get(N):null,Q=o.useRef({initial:null,translated:null}),ee=o.useMemo(()=>{var w;return N!=null?{id:N,data:(w=k==null?void 0:k.data)!=null?w:Na,rect:Q}:null},[N,k]),se=o.useRef(null),[le,ke]=o.useState(null),[H,Fe]=o.useState(null),G=vt(y,Object.values(y)),Ie=St("DndDescribedBy",c),je=o.useMemo(()=>$.getEnabled(),[$]),M=Aa(v),{droppableRects:oe,measureDroppableContainers:J,measuringScheduled:be}=ha(je,{dragging:A,dependencies:[P.x,P.y],config:M.droppable}),ae=ua(D,N),Ee=o.useMemo(()=>H?Ft(H):null,[H]),we=u(),ce=ma(ae,M.draggable.measure);Oa({activeNode:N!=null?D.get(N):null,config:we.layoutShiftCompensation,initialRect:ce,measure:M.draggable.measure});const I=Dn(ae,M.draggable.measure,ce),Se=Dn(ae?ae.parentElement:null),he=o.useRef({activatorEvent:null,active:null,activeNode:ae,collisionRect:null,collisions:null,droppableRects:oe,draggableNodes:D,draggingNode:null,draggingNodeRect:null,droppableContainers:$,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),ye=$.getNodeFor((n=he.current.over)==null?void 0:n.id),me=Sa({measure:M.dragOverlay.measure}),ie=(s=me.nodeRef.current)!=null?s:ae,g=A?(a=me.rect)!=null?a:I:null,O=!!(me.nodeRef.current&&me.rect),_=pa(O?null:I),te=jr(ie?fe(ie):null),V=va(A?ye??ae:null),K=wa(V),de=Nr(p,{transform:{x:P.x-_.x,y:P.y-_.y,scaleX:1,scaleY:1},activatorEvent:H,active:ee,activeNodeRect:I,containerNodeRect:Se,draggingNodeRect:g,over:he.current.over,overlayNodeRect:me.rect,scrollableAncestors:V,scrollableAncestorRects:K,windowRect:te}),ze=Ee?Qe(Ee,P):null,Me=ba(V),Ye=En(Me),Ve=En(Me,[I]),_e=Qe(de,Ye),Be=g?Us(g,de):null,Xe=ee&&Be?m({active:ee,collisionRect:Be,droppableRects:oe,droppableContainers:je,pointerCoordinates:ze}):null,rt=zs(Xe,"id"),[Re,Nt]=o.useState(null),Xt=O?de:Qe(de,Ve),Ht=$s(Xt,(i=Re==null?void 0:Re.rect)!=null?i:null,I),st=o.useRef(null),Dt=o.useCallback((w,E)=>{let{sensor:F,options:X}=E;if(se.current==null)return;const W=D.get(se.current);if(!W)return;const ne=w.nativeEvent,U=new F({active:se.current,activeNode:W,event:ne,options:X,context:he,onAbort(z){if(!D.get(z))return;const{onDragAbort:Ae}=G.current,Le={id:z};Ae==null||Ae(Le),C({type:"onDragAbort",event:Le})},onPending(z,Ce,Ae,Le){if(!D.get(z))return;const{onDragPending:lt}=G.current,$e={id:z,constraint:Ce,initialCoordinates:Ae,offset:Le};lt==null||lt($e),C({type:"onDragPending",event:$e})},onStart(z){const Ce=se.current;if(Ce==null)return;const Ae=D.get(Ce);if(!Ae)return;const{onDragStart:Le}=G.current,it={activatorEvent:ne,active:{id:Ce,data:Ae.data,rect:Q}};dt.unstable_batchedUpdates(()=>{Le==null||Le(it),R(Ke.Initializing),j({type:Z.DragStart,initialCoordinates:z,active:Ce}),C({type:"onDragStart",event:it}),ke(st.current),Fe(ne)})},onMove(z){j({type:Z.DragMove,coordinates:z})},onEnd:ue(Z.DragEnd),onCancel:ue(Z.DragCancel)});st.current=U;function ue(z){return async function(){const{active:Ae,collisions:Le,over:it,scrollAdjustedTranslate:lt}=he.current;let $e=null;if(Ae&&lt){const{cancelDrop:ct}=G.current;$e={activatorEvent:ne,active:Ae,collisions:Le,delta:lt,over:it},z===Z.DragEnd&&typeof ct=="function"&&await Promise.resolve(ct($e))&&(z=Z.DragCancel)}se.current=null,dt.unstable_batchedUpdates(()=>{j({type:z}),R(Ke.Uninitialized),Nt(null),ke(null),Fe(null),st.current=null;const ct=z===Z.DragEnd?"onDragEnd":"onDragCancel";if($e){const Gt=G.current[ct];Gt==null||Gt($e),C({type:ct,event:$e})}})}}},[D]),Wt=o.useCallback((w,E)=>(F,X)=>{const W=F.nativeEvent,ne=D.get(X);if(se.current!==null||!ne||W.dndKit||W.defaultPrevented)return;const U={active:ne};w(F,E.options,U)===!0&&(W.dndKit={capturedBy:E.sensor},se.current=X,Dt(F,E))},[D,Dt]),at=fa(h,Wt);ya(h),De(()=>{I&&S===Ke.Initializing&&R(Ke.Initialized)},[I,S]),o.useEffect(()=>{const{onDragMove:w}=G.current,{active:E,activatorEvent:F,collisions:X,over:W}=he.current;if(!E||!F)return;const ne={active:E,activatorEvent:F,collisions:X,delta:{x:_e.x,y:_e.y},over:W};dt.unstable_batchedUpdates(()=>{w==null||w(ne),C({type:"onDragMove",event:ne})})},[_e.x,_e.y]),o.useEffect(()=>{const{active:w,activatorEvent:E,collisions:F,droppableContainers:X,scrollAdjustedTranslate:W}=he.current;if(!w||se.current==null||!E||!W)return;const{onDragOver:ne}=G.current,U=X.get(rt),ue=U&&U.rect.current?{id:U.id,rect:U.rect.current,data:U.data,disabled:U.disabled}:null,z={active:w,activatorEvent:E,collisions:F,delta:{x:W.x,y:W.y},over:ue};dt.unstable_batchedUpdates(()=>{Nt(ue),ne==null||ne(z),C({type:"onDragOver",event:z})})},[rt]),De(()=>{he.current={activatorEvent:H,active:ee,activeNode:ae,collisionRect:Be,collisions:Xe,droppableRects:oe,draggableNodes:D,draggingNode:ie,draggingNodeRect:g,droppableContainers:$,over:Re,scrollableAncestors:V,scrollAdjustedTranslate:_e},Q.current={initial:g,translated:Be}},[ee,ae,Xe,Be,D,ie,g,oe,$,Re,V,_e]),la({...we,delta:P,draggingRect:Be,pointerCoordinates:ze,scrollableAncestors:V,scrollableAncestorRects:K});const ot=o.useMemo(()=>({active:ee,activeNode:ae,activeNodeRect:I,activatorEvent:H,collisions:Xe,containerNodeRect:Se,dragOverlay:me,draggableNodes:D,droppableContainers:$,droppableRects:oe,over:Re,measureDroppableContainers:J,scrollableAncestors:V,scrollableAncestorRects:K,measuringConfiguration:M,measuringScheduled:be,windowRect:te}),[ee,ae,I,H,Xe,Se,me,D,$,oe,Re,J,V,K,M,be,te]),qt=o.useMemo(()=>({activatorEvent:H,activators:at,active:ee,activeNodeRect:I,ariaDescribedById:{draggable:Ie},dispatch:j,draggableNodes:D,over:Re,measureDroppableContainers:J}),[H,at,ee,I,j,Ie,D,Re,J]);return Y.createElement(or.Provider,{value:T},Y.createElement(Ct.Provider,{value:qt},Y.createElement(Cr.Provider,{value:ot},Y.createElement(Vt.Provider,{value:Ht},f)),Y.createElement(Ra,{disabled:(l==null?void 0:l.restoreFocus)===!1})),Y.createElement(Is,{...l,hiddenTextDescribedById:Ie}));function u(){const w=(le==null?void 0:le.autoScrollEnabled)===!1,E=typeof d=="object"?d.enabled===!1:d===!1,F=A&&!w&&!E;return typeof d=="object"?{...d,enabled:F}:{enabled:F}}}),ka=o.createContext(null),An="button",Ia="Draggable";function Ma(e){let{id:t,data:n,disabled:s=!1,attributes:a}=e;const i=St(Ia),{activators:c,activatorEvent:l,active:d,activeNodeRect:f,ariaDescribedById:h,draggableNodes:m,over:v}=o.useContext(Ct),{role:p=An,roleDescription:y="draggable",tabIndex:b=0}=a??{},x=(d==null?void 0:d.id)===t,j=o.useContext(x?Vt:ka),[C,T]=Mt(),[S,R]=Mt(),A=ja(c,t),N=vt(n);De(()=>(m.set(t,{id:t,key:i,node:C,activatorNode:S,data:N}),()=>{const P=m.get(t);P&&P.key===i&&m.delete(t)}),[m,t]);const D=o.useMemo(()=>({role:p,tabIndex:b,"aria-disabled":s,"aria-pressed":x&&p===An?!0:void 0,"aria-roledescription":y,"aria-describedby":h.draggable}),[s,p,b,x,y,h.draggable]);return{active:d,activatorEvent:l,activeNodeRect:f,attributes:D,isDragging:x,listeners:s?void 0:A,node:C,over:v,setNodeRef:T,setActivatorNodeRef:R,transform:j}}function Tr(){return o.useContext(Cr)}const La="Droppable",Pa={timeout:25};function xn(e){let{data:t,disabled:n=!1,id:s,resizeObserverConfig:a}=e;const i=St(La),{active:c,dispatch:l,over:d,measureDroppableContainers:f}=o.useContext(Ct),h=o.useRef({disabled:n}),m=o.useRef(!1),v=o.useRef(null),p=o.useRef(null),{disabled:y,updateMeasurementsFor:b,timeout:x}={...Pa,...a},j=vt(b??s),C=o.useCallback(()=>{if(!m.current){m.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{f(Array.isArray(j.current)?j.current:[j.current]),p.current=null},x)},[x]),T=Yt({callback:C,disabled:y||!c}),S=o.useCallback((D,P)=>{T&&(P&&(T.unobserve(P),m.current=!1),D&&T.observe(D))},[T]),[R,A]=Mt(S),N=vt(t);return o.useEffect(()=>{!T||!R.current||(T.disconnect(),m.current=!1,T.observe(R.current))},[R,T]),o.useEffect(()=>(l({type:Z.RegisterDroppable,element:{id:s,key:i,disabled:n,node:R,rect:v,data:N}}),()=>l({type:Z.UnregisterDroppable,key:i,id:s})),[s]),o.useEffect(()=>{n!==h.current.disabled&&(l({type:Z.SetDroppableDisabled,id:s,key:i,disabled:n}),h.current.disabled=n)},[s,i,n,l]),{active:c,rect:v,isOver:(d==null?void 0:d.id)===s,node:R,over:d,setNodeRef:A}}function Fa(e){let{animation:t,children:n}=e;const[s,a]=o.useState(null),[i,c]=o.useState(null),l=Lt(n);return!n&&!s&&l&&a(l),De(()=>{if(!i)return;const d=s==null?void 0:s.key,f=s==null?void 0:s.props.id;if(d==null||f==null){a(null);return}Promise.resolve(t(f,i)).then(()=>{a(null)})},[t,s,i]),Y.createElement(Y.Fragment,null,n,s?o.cloneElement(s,{ref:c}):null)}const za={x:0,y:0,scaleX:1,scaleY:1};function _a(e){let{children:t}=e;return Y.createElement(Ct.Provider,{value:Sr},Y.createElement(Vt.Provider,{value:za},t))}const Ba={position:"fixed",touchAction:"none"},$a=e=>Kt(e)?"transform 250ms ease":void 0,Ka=o.forwardRef((e,t)=>{let{as:n,activatorEvent:s,adjustScale:a,children:i,className:c,rect:l,style:d,transform:f,transition:h=$a}=e;if(!l)return null;const m=a?f:{...f,scaleX:1,scaleY:1},v={...Ba,width:l.width,height:l.height,top:l.top,left:l.left,transform:Pe.Transform.toString(m),transformOrigin:a&&s?Ls(s,l):void 0,transition:typeof h=="function"?h(s):h,...d};return Y.createElement(n,{className:c,style:v,ref:t},i)}),Ua=e=>t=>{let{active:n,dragOverlay:s}=t;const a={},{styles:i,className:c}=e;if(i!=null&&i.active)for(const[l,d]of Object.entries(i.active))d!==void 0&&(a[l]=n.node.style.getPropertyValue(l),n.node.style.setProperty(l,d));if(i!=null&&i.dragOverlay)for(const[l,d]of Object.entries(i.dragOverlay))d!==void 0&&s.node.style.setProperty(l,d);return c!=null&&c.active&&n.node.classList.add(c.active),c!=null&&c.dragOverlay&&s.node.classList.add(c.dragOverlay),function(){for(const[d,f]of Object.entries(a))n.node.style.setProperty(d,f);c!=null&&c.active&&n.node.classList.remove(c.active)}},Ya=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:Pe.Transform.toString(t)},{transform:Pe.Transform.toString(n)}]},Va={duration:250,easing:"ease",keyframes:Ya,sideEffects:Ua({styles:{active:{opacity:"0"}}})};function Xa(e){let{config:t,draggableNodes:n,droppableContainers:s,measuringConfiguration:a}=e;return $t((i,c)=>{if(t===null)return;const l=n.get(i);if(!l)return;const d=l.node.current;if(!d)return;const f=wr(c);if(!f)return;const{transform:h}=fe(c).getComputedStyle(c),m=ur(h);if(!m)return;const v=typeof t=="function"?t:Ha(t);return vr(d,a.draggable.measure),v({active:{id:i,data:l.data,node:d,rect:a.draggable.measure(d)},draggableNodes:n,dragOverlay:{node:c,rect:a.dragOverlay.measure(f)},droppableContainers:s,measuringConfiguration:a,transform:m})})}function Ha(e){const{duration:t,easing:n,sideEffects:s,keyframes:a}={...Va,...e};return i=>{let{active:c,dragOverlay:l,transform:d,...f}=i;if(!t)return;const h={x:l.rect.left-c.rect.left,y:l.rect.top-c.rect.top},m={scaleX:d.scaleX!==1?c.rect.width*d.scaleX/l.rect.width:1,scaleY:d.scaleY!==1?c.rect.height*d.scaleY/l.rect.height:1},v={x:d.x-h.x,y:d.y-h.y,...m},p=a({...f,active:c,dragOverlay:l,transform:{initial:d,final:v}}),[y]=p,b=p[p.length-1];if(JSON.stringify(y)===JSON.stringify(b))return;const x=s==null?void 0:s({active:c,dragOverlay:l,...f}),j=l.node.animate(p,{duration:t,easing:n,fill:"forwards"});return new Promise(C=>{j.onfinish=()=>{x==null||x(),C()}})}}let On=0;function Wa(e){return o.useMemo(()=>{if(e!=null)return On++,On},[e])}const Er=Y.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:s,style:a,transition:i,modifiers:c,wrapperElement:l="div",className:d,zIndex:f=999}=e;const{activatorEvent:h,active:m,activeNodeRect:v,containerNodeRect:p,draggableNodes:y,droppableContainers:b,dragOverlay:x,over:j,measuringConfiguration:C,scrollableAncestors:T,scrollableAncestorRects:S,windowRect:R}=Tr(),A=o.useContext(Vt),N=Wa(m==null?void 0:m.id),D=Nr(c,{activatorEvent:h,active:m,activeNodeRect:v,containerNodeRect:p,draggingNodeRect:x.rect,over:j,overlayNodeRect:x.rect,scrollableAncestors:T,scrollableAncestorRects:S,transform:A,windowRect:R}),P=gn(v),$=Xa({config:s,draggableNodes:y,droppableContainers:b,measuringConfiguration:C}),k=P?x.setRef:void 0;return Y.createElement(_a,null,Y.createElement(Fa,{animation:$},m&&N?Y.createElement(Ka,{key:N,id:m.id,ref:k,as:l,activatorEvent:h,adjustScale:t,className:d,transition:i,rect:P,style:{zIndex:f,...a},transform:D},n):null))});function Rr(e,t,n){const s=e.slice();return s.splice(n<0?s.length+n:n,0,s.splice(t,1)[0]),s}function qa(e,t){return e.reduce((n,s,a)=>{const i=t.get(s);return i&&(n[a]=i),n},Array(e.length))}function Tt(e){return e!==null&&e>=0}function Ga(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Ja(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Ar=e=>{let{rects:t,activeIndex:n,overIndex:s,index:a}=e;const i=Rr(t,s,n),c=t[a],l=i[a];return!l||!c?null:{x:l.left-c.left,y:l.top-c.top,scaleX:l.width/c.width,scaleY:l.height/c.height}},Et={scaleX:1,scaleY:1},Or=e=>{var t;let{activeIndex:n,activeNodeRect:s,index:a,rects:i,overIndex:c}=e;const l=(t=i[n])!=null?t:s;if(!l)return null;if(a===n){const f=i[c];return f?{x:0,y:n<c?f.top+f.height-(l.top+l.height):f.top-l.top,...Et}:null}const d=Za(i,a,n);return a>n&&a<=c?{x:0,y:-l.height-d,...Et}:a<n&&a>=c?{x:0,y:l.height+d,...Et}:{x:0,y:0,...Et}};function Za(e,t,n){const s=e[t],a=e[t-1],i=e[t+1];return s?n<t?a?s.top-(a.top+a.height):i?i.top-(s.top+s.height):0:i?i.top-(s.top+s.height):a?s.top-(a.top+a.height):0:0}const kr="Sortable",Ir=Y.createContext({activeIndex:-1,containerId:kr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Ar,disabled:{draggable:!1,droppable:!1}});function Mr(e){let{children:t,id:n,items:s,strategy:a=Ar,disabled:i=!1}=e;const{active:c,dragOverlay:l,droppableRects:d,over:f,measureDroppableContainers:h}=Tr(),m=St(kr,n),v=l.rect!==null,p=o.useMemo(()=>s.map(A=>typeof A=="object"&&"id"in A?A.id:A),[s]),y=c!=null,b=c?p.indexOf(c.id):-1,x=f?p.indexOf(f.id):-1,j=o.useRef(p),C=!Ga(p,j.current),T=x!==-1&&b===-1||C,S=Ja(i);De(()=>{C&&y&&h(p)},[C,p,y,h]),o.useEffect(()=>{j.current=p},[p]);const R=o.useMemo(()=>({activeIndex:b,containerId:m,disabled:S,disableTransforms:T,items:p,overIndex:x,useDragOverlay:v,sortedRects:qa(p,d),strategy:a}),[b,m,S.draggable,S.droppable,T,p,x,d,v,a]);return Y.createElement(Ir.Provider,{value:R},t)}const Qa=e=>{let{id:t,items:n,activeIndex:s,overIndex:a}=e;return Rr(n,s,a).indexOf(t)},eo=e=>{let{containerId:t,isSorting:n,wasDragging:s,index:a,items:i,newIndex:c,previousItems:l,previousContainerId:d,transition:f}=e;return!f||!s||l!==i&&a===c?!1:n?!0:c!==a&&t===d},to={duration:200,easing:"ease"},Lr="transform",no=Pe.Transition.toString({property:Lr,duration:0,easing:"linear"}),ro={roleDescription:"sortable"};function so(e){let{disabled:t,index:n,node:s,rect:a}=e;const[i,c]=o.useState(null),l=o.useRef(n);return De(()=>{if(!t&&n!==l.current&&s.current){const d=a.current;if(d){const f=nt(s.current,{ignoreTransform:!0}),h={x:d.left-f.left,y:d.top-f.top,scaleX:d.width/f.width,scaleY:d.height/f.height};(h.x||h.y)&&c(h)}}n!==l.current&&(l.current=n)},[t,n,s,a]),o.useEffect(()=>{i&&c(null)},[i]),i}function Pr(e){let{animateLayoutChanges:t=eo,attributes:n,disabled:s,data:a,getNewIndex:i=Qa,id:c,strategy:l,resizeObserverConfig:d,transition:f=to}=e;const{items:h,containerId:m,activeIndex:v,disabled:p,disableTransforms:y,sortedRects:b,overIndex:x,useDragOverlay:j,strategy:C}=o.useContext(Ir),T=ao(s,p),S=h.indexOf(c),R=o.useMemo(()=>({sortable:{containerId:m,index:S,items:h},...a}),[m,a,S,h]),A=o.useMemo(()=>h.slice(h.indexOf(c)),[h,c]),{rect:N,node:D,isOver:P,setNodeRef:$}=xn({id:c,data:R,disabled:T.droppable,resizeObserverConfig:{updateMeasurementsFor:A,...d}}),{active:k,activatorEvent:Q,activeNodeRect:ee,attributes:se,setNodeRef:le,listeners:ke,isDragging:H,over:Fe,setActivatorNodeRef:G,transform:Ie}=Ma({id:c,data:R,attributes:{...ro,...n},disabled:T.draggable}),je=ys($,le),M=!!k,oe=M&&!y&&Tt(v)&&Tt(x),J=!j&&H,be=J&&oe?Ie:null,Ee=oe?be??(l??C)({rects:b,activeNodeRect:ee,activeIndex:v,overIndex:x,index:S}):null,we=Tt(v)&&Tt(x)?i({id:c,items:h,activeIndex:v,overIndex:x}):S,ce=k==null?void 0:k.id,I=o.useRef({activeId:ce,items:h,newIndex:we,containerId:m}),Se=h!==I.current.items,he=t({active:k,containerId:m,isDragging:H,isSorting:M,id:c,index:S,items:h,newIndex:I.current.newIndex,previousItems:I.current.items,previousContainerId:I.current.containerId,transition:f,wasDragging:I.current.activeId!=null}),ye=so({disabled:!he,index:S,node:D,rect:N});return o.useEffect(()=>{M&&I.current.newIndex!==we&&(I.current.newIndex=we),m!==I.current.containerId&&(I.current.containerId=m),h!==I.current.items&&(I.current.items=h)},[M,we,m,h]),o.useEffect(()=>{if(ce===I.current.activeId)return;if(ce!=null&&I.current.activeId==null){I.current.activeId=ce;return}const ie=setTimeout(()=>{I.current.activeId=ce},50);return()=>clearTimeout(ie)},[ce]),{active:k,activeIndex:v,attributes:se,data:R,rect:N,index:S,newIndex:we,items:h,isOver:P,isSorting:M,isDragging:H,listeners:ke,node:D,overIndex:x,over:Fe,setNodeRef:je,setActivatorNodeRef:G,setDroppableNodeRef:$,setDraggableNodeRef:le,transform:ye??Ee,transition:me()};function me(){if(ye||Se&&I.current.newIndex===S)return no;if(!(J&&!Kt(Q)||!f)&&(M||he))return Pe.Transition.toString({...f,property:Lr})}}function ao(e,t){var n,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(s=e==null?void 0:e.droppable)!=null?s:t.droppable}}L.Down,L.Right,L.Up,L.Left;const oo=[{value:"deadline",label:"Prazo (mais próximo)"},{value:"title",label:"Título (A → Z)"},{value:"status",label:"Status"}],kn={"A fazer":0,"Em andamento":1,Concluído:2},Rt=["A fazer","Em andamento","Concluído"],io={"A fazer":"border-t-red-500/60","Em andamento":"border-t-yellow-500/60",Concluído:"border-t-green-500/60"};function lo(e,t){return[...e].sort((n,s)=>{switch(t){case"deadline":return!n.dueDate&&!s.dueDate?0:n.dueDate?s.dueDate?n.dueDate.localeCompare(s.dueDate):-1:1;case"title":return n.title.localeCompare(s.title,"pt-BR");case"status":return(kn[n.status]??0)-(kn[s.status]??0);default:return 0}})}function co({id:e,children:t}){const{attributes:n,listeners:s,setNodeRef:a,transform:i,transition:c,isDragging:l}=Pr({id:e}),d={transform:Pe.Transform.toString(i),transition:c};return r.jsx("div",{ref:a,style:d,...n,...s,className:q("touch-none",l&&"opacity-30"),children:t})}function uo({status:e,isOver:t,items:n,itemIds:s,today:a,onEdit:i,onDelete:c,showRichNotes:l}){const{setNodeRef:d}=xn({id:e});return r.jsxs("div",{className:q("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",io[e]||"border-t-muted/60",t&&"bg-card/80 ring-2 ring-primary/20"),children:[r.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border shadow-sm bg-background/50 backdrop-blur-md rounded-t-xl",children:[r.jsx(Oe,{variant:"secondary",className:tn[e],children:gt[e]}),r.jsx(Oe,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50",children:n.length})]}),r.jsxs("div",{ref:d,"data-column-status":e,className:"flex-1 p-3 space-y-3",children:[r.jsx(Mr,{items:s,strategy:Or,children:n.map(f=>r.jsx(co,{id:f.id,children:r.jsx(on,{sub:f,today:a,onEdit:()=>i(f),onDelete:()=>c(f.id),showRichNotes:l})},f.id))}),n.length===0&&r.jsxs("div",{className:"sticky top-[40vh] flex flex-col items-center justify-center text-xs text-muted-foreground/50 border-2 border-dashed border-border/50 rounded-xl p-4 text-center gap-1",children:[r.jsx(Oe,{variant:"secondary",className:q("font-medium mb-1",tn[e]),children:gt[e]}),r.jsx("span",{children:"Arraste subtarefas para cá"})]})]})]})}const on=o.memo(function({sub:t,today:n,showStatus:s,onEdit:a,onDelete:i,showRichNotes:c}){const l=t.dueDate&&t.dueDate<n&&t.status!=="Concluído";return r.jsx(xt,{className:q("transition-shadow duration-150",l&&"border-destructive/50"),children:r.jsx(pt,{className:"p-3",children:r.jsxs("div",{className:"flex items-start gap-2",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[s&&r.jsx(Oe,{variant:"secondary",className:q("text-[10px]",tn[t.status]),children:gt[t.status]}),l&&r.jsx(Oe,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),r.jsx("p",{className:q("font-medium text-sm",t.completed&&"line-through text-muted-foreground"),children:t.title}),r.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[r.jsx("span",{className:"font-medium",children:"Tarefa:"})," ",t.parentTaskTitle]}),r.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:[t.projectName&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Zn,{className:"w-3 h-3"}),t.projectName]}),t.assignee&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Qn,{className:"w-3 h-3"}),t.assignee]}),t.dueDate&&r.jsxs("span",{className:q("flex items-center gap-1",l&&"text-destructive font-medium"),children:[r.jsx(er,{className:"w-3 h-3"}),new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})]}),t.notes&&c&&r.jsx("div",{className:"text-xs text-muted-foreground mt-1 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Pn(t.notes)||t.notes}}),t.notes&&!c&&r.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.notes.replace(/<[^>]*>/g,"")})]}),r.jsxs("div",{className:"flex gap-1 shrink-0",children:[r.jsx(Ue,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:a,children:r.jsx(os,{className:"w-3.5 h-3.5"})}),r.jsx(Ue,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:i,children:r.jsx($n,{className:"w-3.5 h-3.5"})})]})]})})})});function fo({tasks:e,projects:t,loading:n,onCreateSubtask:s,onUpdateSubtask:a,onDeleteSubtask:i}){const[c,l]=o.useState(!1),[d,f]=o.useState(null),[h,m]=o.useState("kanban"),[v,p]=o.useState(""),[y,b]=o.useState("all"),[x,j]=o.useState("all"),[C,T]=o.useState("all"),[S,R]=o.useState("all"),[A,N]=o.useState("all"),[D,P]=o.useState("deadline"),[$,k]=o.useState(!1),[Q,ee]=o.useState(!1),[se,le]=o.useState(null),[ke,H]=o.useState(null),[Fe,G]=o.useState(null),Ie=lr(ir(Ut,{activationConstraint:{distance:8}})),je=o.useMemo(()=>{const g={};return t.forEach(O=>{g[O.id]=O.name}),g},[t]),M=o.useMemo(()=>e.flatMap(g=>g.subtasks.map(O=>({...O,parentTaskTitle:g.title,projectId:g.projectId,projectName:g.projectId?je[g.projectId]:void 0}))),[e,je]),oe=o.useMemo(()=>{const g=new Date,O=new Date(g.getFullYear(),g.getMonth(),g.getDate()),_=new Date(O);_.setDate(O.getDate()+(7-O.getDay()));const te=new Date(g.getFullYear(),g.getMonth()+1,0),V=M.filter(K=>{if(v&&!K.title.toLowerCase().includes(v.toLowerCase())||y!=="all"&&K.status!==y||x!=="all"&&K.assignee!==x||C!=="all"&&K.projectId!==C||S!=="all"&&K.parentTaskId!==S)return!1;if(A!=="all"){if(!K.dueDate)return A==="sem_prazo";const de=new Date(K.dueDate+"T23:59:59");switch(A){case"atrasadas":return de<O&&K.status!=="Concluído";case"hoje":return K.dueDate===J;case"esta_semana":return de>=O&&de<=_;case"este_mes":return de>=O&&de<=te;case"sem_prazo":return!1}}return!0});return lo(V,D)},[M,v,y,x,C,S,D]),J=o.useMemo(()=>{const g=new Date;return`${g.getFullYear()}-${String(g.getMonth()+1).padStart(2,"0")}-${String(g.getDate()).padStart(2,"0")}`},[]);o.useMemo(()=>{const g={"A fazer":0,"Em andamento":0,Concluído:0},O=M.filter(_=>_.dueDate&&_.dueDate<J&&_.status!=="Concluído").length;return M.forEach(_=>{g[_.status]!==void 0&&g[_.status]++}),{...g,overdue:O,total:M.length}},[M,J]);const be=o.useCallback(()=>{f(null),l(!0)},[]),ae=o.useCallback(g=>{f(g),l(!0)},[]),Ee=o.useCallback(async(g,O,_)=>{O?await s(g.parentTaskId,{title:g.title,deadline:g.deadline||void 0,status:g.status,assignee:g.assignee||void 0,notes:g.notes||void 0}):_&&await a(_,{title:g.title,deadline:g.deadline||void 0,status:g.status,assignee:g.assignee||void 0,notes:g.notes||void 0})},[s,a]),we=o.useCallback(async()=>{se&&(await i(se),le(null))},[se,i]),ce=o.useMemo(()=>{const g={"A fazer":[],"Em andamento":[],Concluído:[]};return oe.forEach(O=>{g[O.status]&&g[O.status].push(O)}),g},[oe]),I=o.useCallback(g=>{H(String(g.active.id))},[]),Se=o.useCallback(g=>{const{over:O}=g;if(!O){G(null);return}const _=String(O.id),te=M.find(K=>K.id===_),V=te?te.status:Rt.includes(_)?_:null;G(V)},[M]),he=o.useCallback(async g=>{const{active:O,over:_}=g;if(H(null),G(null),!_)return;const te=String(O.id),V=String(_.id);if(te===V)return;const K=M.find(Me=>Me.id===te);if(!K)return;const de=M.find(Me=>Me.id===V),ze=de?de.status:Rt.includes(V)?V:K.status;K.status!==ze&&await a(te,{status:ze})},[M,a]),ye=o.useCallback(()=>{H(null),G(null)},[]),me=ke?M.find(g=>g.id===ke):null,ie=o.useMemo(()=>Rt.filter(g=>!$||g!=="Concluído"),[$]);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex flex-col gap-3 glass p-4 rounded-xl border border-border shadow-sm mb-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[r.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[r.jsx(cn,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),r.jsx(kt,{placeholder:"Buscar subtarefa...",value:v,onChange:g=>p(g.target.value),className:"pl-9 w-full text-sm"})]}),r.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[r.jsxs(Ue,{onClick:be,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[r.jsx(Gn,{className:"mr-1.5 h-4 w-4"})," Nova Subtarefa"]}),r.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[r.jsxs("button",{onClick:()=>m("kanban"),className:q("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",h==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[r.jsx(nr,{className:"w-4 h-4"})," Kanban"]}),r.jsxs("button",{onClick:()=>m("list"),className:q("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",h==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[r.jsx(Jn,{className:"w-4 h-4"})," Lista"]})]})]})]}),r.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap flex-1",children:[r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),r.jsxs(ge,{value:y,onValueChange:b,children:[r.jsx(xe,{className:"w-[130px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos Status"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos Status"}),Rt.map(g=>r.jsx(B,{value:g,children:gt[g]},g))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),r.jsxs(ge,{value:A,onValueChange:N,children:[r.jsx(xe,{className:"w-[120px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos"}),r.jsx(B,{value:"atrasadas",children:"Atrasadas"}),r.jsx(B,{value:"hoje",children:"Vence hoje"}),r.jsx(B,{value:"esta_semana",children:"Esta semana"}),r.jsx(B,{value:"este_mes",children:"Este mês"}),r.jsx(B,{value:"sem_prazo",children:"Sem prazo"})]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),r.jsxs(ge,{value:x,onValueChange:j,children:[r.jsx(xe,{className:"w-[120px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos"}),Bn.map(g=>r.jsx(B,{value:g,children:g},g))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Tarefa-mãe"}),r.jsxs(ge,{value:S,onValueChange:R,children:[r.jsx(xe,{className:"w-[160px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todas"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todas"}),e.map(g=>r.jsx(B,{value:g.id,children:g.title},g.id))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),r.jsxs(ge,{value:D,onValueChange:g=>P(g),children:[r.jsx(xe,{className:"w-[160px] h-8 text-xs",children:r.jsx(pe,{})}),r.jsx(ve,{children:oo.map(g=>r.jsx(B,{value:g.value,children:g.label},g.value))})]})]})]}),r.jsxs("div",{className:"flex flex-col gap-1.5 ml-auto shrink-0",children:[r.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Ocultar concluídas",r.jsx(ut,{checked:$,onCheckedChange:k,className:"scale-75"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Observações formatadas",r.jsx(ut,{checked:Q,onCheckedChange:ee,className:"scale-75"})]})]})]})]}),r.jsx(bs,{open:c,onOpenChange:l,subtask:d,tasks:e,onSave:Ee,onDelete:g=>le(g)}),r.jsx(Kn,{open:!!se,onOpenChange:g=>!g&&le(null),children:r.jsxs(Un,{children:[r.jsxs(Yn,{children:[r.jsx(Vn,{children:"Remover subtarefa?"}),r.jsx(Xn,{children:"Esta ação não pode ser desfeita. A subtarefa será removida permanentemente."})]}),r.jsxs(Hn,{children:[r.jsx(Wn,{children:"Cancelar"}),r.jsx(qn,{onClick:we,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),n?r.jsx("div",{className:"space-y-3",children:[1,2,3].map(g=>r.jsx(xt,{children:r.jsx(pt,{className:"p-4",children:r.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"})})},g))}):h==="list"?r.jsx("div",{className:"space-y-3",children:oe.length===0?r.jsx(xt,{children:r.jsx(pt,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma subtarefa encontrada."})}):oe.map(g=>r.jsx(on,{sub:g,today:J,showStatus:!0,onEdit:()=>ae(g),onDelete:()=>le(g.id),showRichNotes:Q},g.id))}):r.jsxs(Dr,{sensors:Ie,collisionDetection:cr,onDragStart:I,onDragOver:Se,onDragEnd:he,onDragCancel:ye,children:[r.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:r.jsx("div",{className:"flex gap-4",style:{minWidth:`${ie.length*300}px`},children:ie.map(g=>{const O=Fe===g,_=ce[g],te=_.map(V=>V.id);return r.jsx("div",{className:"flex-1 min-w-[260px]",children:r.jsx(uo,{status:g,isOver:O,items:_,itemIds:te,today:J,onEdit:ae,onDelete:le,showRichNotes:Q})},g)})})}),r.jsx(Er,{children:me&&r.jsx("div",{className:"shadow-xl ring-2 ring-primary/30 rotate-[2deg] scale-105",children:r.jsx(on,{sub:me,today:J,showStatus:!0,onEdit:()=>{},onDelete:()=>{},showRichNotes:Q})})})]})]})}const ho=[{value:"deadline",label:"Prazo (mais próximo)"},{value:"priority",label:"Prioridade (Alta → Baixa)"},{value:"title",label:"Título (A → Z)"},{value:"client",label:"Cliente (A → Z)"}],In={alta:0,media:1,baixa:2};function Mn(e,t){return[...e].sort((n,s)=>{switch(t){case"deadline":return!n.dueDate&&!s.dueDate?0:n.dueDate?s.dueDate?n.dueDate.localeCompare(s.dueDate):-1:1;case"priority":return(In[n.priority]??1)-(In[s.priority]??1);case"title":return n.title.localeCompare(s.title,"pt-BR");case"client":return(n.client??"").localeCompare(s.client??"","pt-BR");default:return 0}})}const mo={client:!0,dueDate:!0,priority:!0,subtasks:!0,tags:!0,description:!0,richDescription:!1},Ln={client:"Cliente",dueDate:"Data de entrega",priority:"Prioridade",subtasks:"Subtarefas",tags:"Tags",description:"Descrição",richDescription:"Observação formatada"},At=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],go={pendente:"border-t-red-500/60",agendado:"border-t-blue-500/60",em_andamento:"border-t-yellow-500/60",em_tramite:"border-t-orange-500/60",concluida:"border-t-green-500/60",cancelada:"border-t-muted/60"},xo={pendente:tr,agendado:hs,em_andamento:vn,em_tramite:vn,concluida:ms,cancelada:fs},po=[{value:"all",label:"Todos"},{value:"today",label:"Hoje"},{value:"this_week",label:"Esta semana"},{value:"this_month",label:"Este mês"},{value:"overdue",label:"Atrasadas"},{value:"no_deadline",label:"Sem prazo"}],ln=o.memo(function({task:t,cardFields:n,today:s,isExpanded:a,onToggleExpand:i,onToggleSubtask:c,onEdit:l,onDelete:d,showStatus:f,isDragging:h,isOverlay:m,projectName:v}){const p=t.subtasks.filter(x=>x.completed).length,y=t.subtasks.length,b=t.dueDate&&t.dueDate<s&&t.status!=="concluida"&&t.status!=="cancelada";return r.jsx(xt,{className:q("relative group transition-all duration-200 hover:shadow-md cursor-pointer",h?"opacity-40 scale-95":"",m&&"shadow-2xl ring-2 ring-primary/40 rotate-[2deg] scale-105 cursor-grabbing","border-border/50 bg-card"),onClick:()=>l==null?void 0:l(t),children:r.jsxs(pt,{className:"p-3.5",children:[v&&r.jsx("div",{className:"mb-2",children:r.jsxs(Oe,{variant:"outline",className:"text-[10px] px-1.5 py-0 gap-1 font-normal",children:[r.jsx(Zn,{className:"w-3 h-3"}),v]})}),r.jsx("p",{className:"font-medium text-sm mb-1",children:t.title}),n.description&&t.description&&!n.richDescription&&r.jsx("p",{className:"text-xs text-muted-foreground mb-2 line-clamp-2",children:t.description.replace(/<[^>]*>/g,"")}),n.richDescription&&t.description&&r.jsx("div",{className:"text-xs text-muted-foreground mb-2 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Pn(t.description)||t.description}}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[n.priority&&r.jsx(Oe,{variant:"secondary",className:`text-[10px] ${Qr[t.priority]}`,children:nn[t.priority]}),f&&r.jsx(Oe,{variant:"secondary",className:`text-[10px] ${es[t.status]}`,children:It[t.status]}),n.dueDate&&t.dueDate&&r.jsxs("span",{className:q("flex items-center gap-1",b&&"text-destructive font-medium"),children:[b?r.jsx(tr,{className:"w-3 h-3"}):r.jsx(er,{className:"w-3 h-3"}),new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}),b&&r.jsx("span",{className:"text-destructive font-medium",children:"Atrasada"}),t.assignee&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Qn,{className:"w-3 h-3"}),t.assignee]})]}),n.subtasks&&y>0&&!m&&r.jsx("div",{className:"flex justify-end mt-2",children:r.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[r.jsx(rr,{className:"w-3 h-3"}),p,"/",y]})}),n.tags&&t.tags&&t.tags.length>0&&!m&&r.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.tags.map(x=>r.jsx(Oe,{variant:"outline",className:"text-[10px]",children:x},x))})]})})});function vo(e){const{attributes:t,listeners:n,setNodeRef:s,transform:a,transition:i,isDragging:c}=Pr({id:e.task.id}),l={transform:Pe.Transform.toString(a),transition:i};return r.jsx("div",{ref:s,style:l,...t,...n,children:r.jsx(ln,{...e,isDragging:c})})}function bo({status:e,tasks:t,isOver:n,cardFields:s,today:a,expandedTasks:i,onToggleExpand:c,onToggleSubtask:l,onEdit:d,onDelete:f,projectMap:h}){const m=o.useMemo(()=>t.map(y=>y.id),[t]),{setNodeRef:v}=xn({id:e}),p=xo[e];return r.jsxs("div",{className:q("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",go[e]||"border-t-muted/60",n&&"bg-card/80 ring-2 ring-primary/20"),children:[r.jsxs("div",{className:"flex items-center gap-2 p-3 px-4",children:[r.jsx(p,{className:q("w-4 h-4",{"text-red-500":e==="pendente","text-blue-500":e==="agendado","text-yellow-500":e==="em_andamento","text-orange-500":e==="em_tramite","text-green-500":e==="concluida","text-muted-foreground":e==="cancelada"})}),r.jsx("span",{className:"text-sm font-medium",children:It[e]}),r.jsx(Oe,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50 tabular-nums",children:t.length})]}),r.jsxs("div",{ref:v,"data-column-status":e,className:"flex-1 p-3 pt-0 space-y-3",children:[r.jsx(Mr,{items:m,strategy:Or,children:t.map(y=>r.jsx(vo,{task:y,cardFields:s,today:a,isExpanded:i.has(y.id),onToggleExpand:c,onToggleSubtask:l,onEdit:d,onDelete:f,projectName:h.get(y.projectId||"")},y.id))}),t.length===0&&r.jsx("div",{className:"flex flex-col items-center justify-center text-xs text-muted-foreground/50 border-2 border-dashed border-border/50 rounded-xl p-4 text-center gap-1 min-h-[100px]",children:r.jsx("span",{children:"Arraste tarefas para cá"})})]})]})}function yo({projectId:e,clientNameFilter:t,hideHeader:n,forceTab:s}={}){const{tasks:a,setTasks:i,loading:c,error:l,updateTaskStatus:d,deleteTask:f,createTask:h,updateTask:m,createSubtask:v,updateSubtask:p,deleteSubtask:y}=Jr(),{projects:b}=Zr(),[x,j]=o.useState(!1),[C,T]=o.useState(null),S=o.useMemo(()=>t?a.filter(u=>{var w;return(w=u.client)==null?void 0:w.toLowerCase().includes(t.toLowerCase())}):a,[a,t]),[R,A]=o.useState("kanban"),[N,D]=o.useState(""),[P,$]=o.useState("all"),[k,Q]=o.useState("all"),[ee,se]=o.useState("all"),[le,ke]=o.useState(e||"all"),[H,Fe]=o.useState(new Set),[G,Ie]=o.useState(mo),[je,M]=o.useState(null),[oe,J]=o.useState(null),[be,ae]=o.useState("deadline"),[Ee,we]=o.useState(!1),[ce,I]=o.useState(!1),[Se,he]=o.useState("all"),[ye,me]=o.useState("all"),ie=o.useMemo(()=>{const u=new Date;return`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`},[]),g=o.useMemo(()=>[...new Set(S.map(u=>u.assignee).filter(Boolean))],[S]),O=o.useMemo(()=>{const u=e||le,w=new Date,E=new Date(w);E.setDate(w.getDate()+7);const F=new Date(w.getFullYear(),w.getMonth()+1,0),X=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}-${String(E.getDate()).padStart(2,"0")}`,W=`${F.getFullYear()}-${String(F.getMonth()+1).padStart(2,"0")}-${String(F.getDate()).padStart(2,"0")}`,ne=S.filter(U=>{var ue;if(N&&!U.title.toLowerCase().includes(N.toLowerCase())||P!=="all"&&U.status!==P||k!=="all"&&U.priority!==k||ee!=="all"&&U.client!==ee||ye!=="all"&&U.assignee!==ye||u!=="all"&&U.projectId!==u)return!1;if(Se!=="all"){const z=(ue=U.dueDate)==null?void 0:ue.split("T")[0];switch(Se){case"today":if(z!==ie)return!1;break;case"this_week":if(!z||z<ie||z>X)return!1;break;case"this_month":if(!z||z<ie||z>W)return!1;break;case"overdue":if(!z||z>=ie||U.status==="concluida"||U.status==="cancelada")return!1;break;case"no_deadline":if(z)return!1;break}}return!0});return Mn(ne,be)},[S,N,P,k,ee,ye,le,be,Se,ie]),_=ie,te=o.useMemo(()=>je?S.find(u=>u.id===je):null,[je,S]),V=o.useMemo(()=>[...new Set(S.map(u=>u.client).filter(Boolean))],[S]),K=o.useMemo(()=>{const u=new Map;return b.forEach(w=>u.set(w.id,w.name)),u},[b]),de=o.useMemo(()=>S.reduce((u,w)=>u+w.subtasks.length,0),[S]),ze=o.useCallback(u=>{Fe(w=>{const E=new Set(w);return E.has(u)?E.delete(u):E.add(u),E})},[]),Me=o.useCallback((u,w)=>{i(E=>E.map(F=>F.id===u?{...F,subtasks:F.subtasks.map(X=>X.id===w?{...X,completed:!X.completed}:X)}:F))},[i]),[Ye,Ve]=o.useState(null),_e=o.useCallback(async()=>{Ye&&(i(u=>u.filter(w=>w.id!==Ye)),f(Ye),Ve(null))},[Ye,f,i]),Be=o.useCallback(u=>{Ie(w=>({...w,[u]:!w[u]}))},[]),Xe=o.useCallback(()=>{T(null),j(!0)},[]),rt=o.useCallback(u=>{T(u),j(!0)},[]),Re=o.useCallback(async(u,w,E)=>{w?await h({title:u.title,deadline:u.deadline,priority:u.priority,status:u.status,clientName:u.clientName,projectId:u.projectId,assignee:u.assignee,description:u.description,numeroProcesso:u.numeroProcesso}):E&&await m(E,{title:u.title,deadline:u.deadline,priority:u.priority,status:u.status,clientName:u.clientName,projectId:u.projectId,assignee:u.assignee,description:u.description,numeroProcesso:u.numeroProcesso})},[h,m]),Nt=lr(ir(Ut,{activationConstraint:{distance:8}}));o.useCallback(u=>{const w=S.find(E=>E.id===u);return w==null?void 0:w.status},[S]);const Xt=o.useCallback(u=>{M(u.active.id)},[]),Ht=o.useCallback(u=>{const{over:w}=u;if(!w){J(null);return}const E=w.id,F=S.find(W=>W.id===E),X=F?F.status:At.includes(E)?E:null;J(X)},[S]),st=o.useCallback(u=>{const{active:w,over:E}=u;if(M(null),J(null),!E)return;const F=w.id,X=E.id;if(F===X)return;const W=S.find(ue=>ue.id===F);if(!W)return;const ne=S.find(ue=>ue.id===X),U=ne?ne.status:At.includes(X)?X:W.status;W.status!==U&&(i(ue=>{const z=ue.map(Ce=>Ce.id===F?{...Ce,status:U}:Ce);return Mn(z,be)}),d(F,U))},[S,d,be]),Dt=o.useCallback(()=>{M(null),J(null)},[]),Wt=o.useMemo(()=>{const u={};return At.forEach(w=>{u[w]=[]}),O.forEach(w=>{u[w.status]&&u[w.status].push(w)}),u},[O]),at=o.useMemo(()=>At.filter(u=>!(Ee&&u==="concluida"||ce&&u==="cancelada")),[Ee,ce]),[ot,qt]=o.useState(s||"tarefas");return r.jsxs(pn.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[!s&&r.jsx("div",{className:"flex items-center gap-1 rounded-2xl border border-border bg-muted/40 p-1 w-fit backdrop-blur-sm mb-5",children:[{id:"tarefas",label:"Tarefas",icon:ds,count:O.length},{id:"subtarefas",label:"Subtarefas",icon:rr,count:de}].map(u=>{const w=ot===u.id,E=u.icon;return r.jsxs("button",{onClick:()=>qt(u.id),className:q("relative flex items-center gap-2 rounded-xl px-5 py-2.5 text-sm font-medium transition-all duration-200",w?"text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[w&&r.jsx(pn.div,{layoutId:"tarefas-tab-bg",className:"absolute inset-0 rounded-xl gold-gradient shadow-sm",transition:{type:"spring",bounce:.15,duration:.5}}),r.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[r.jsx(E,{className:"h-4 w-4"}),u.label,r.jsx("span",{className:q("inline-flex items-center justify-center rounded-full px-2 py-0.5 text-[10px] font-semibold tabular-nums min-w-[22px] transition-colors",w?"bg-primary-foreground/20 text-primary-foreground":"bg-secondary text-muted-foreground"),children:u.count})]})]},u.id)})}),ot==="tarefas"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex flex-col gap-3 glass p-4 rounded-xl border border-border shadow-sm mb-6",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[r.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[r.jsx(cn,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),r.jsx(kt,{placeholder:"Buscar tarefas...",value:N,onChange:u=>D(u.target.value),className:"pl-9 w-full text-sm"})]}),r.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[r.jsxs(Ue,{onClick:Xe,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[r.jsx(Gn,{className:"mr-1.5 h-4 w-4"})," Nova Tarefa"]}),r.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[r.jsxs("button",{onClick:()=>A("kanban"),className:q("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",R==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[r.jsx(nr,{className:"w-4 h-4"})," Kanban"]}),r.jsxs("button",{onClick:()=>A("list"),className:q("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",R==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[r.jsx(Jn,{className:"w-4 h-4"})," Lista"]})]}),l&&r.jsx("span",{className:"text-xs text-destructive",children:"Erro ao carregar"}),r.jsxs(Fn,{children:[r.jsx(zn,{asChild:!0,children:r.jsx(Ue,{variant:"outline",size:"icon",className:"h-9 w-9",children:r.jsx(xs,{className:"w-4 h-4"})})}),r.jsx(_n,{className:"w-56",align:"end",children:r.jsxs("div",{className:"space-y-1",children:[r.jsx("p",{className:"text-sm font-medium mb-2",children:"Mostrar nos cards"}),Object.keys(Ln).map(u=>r.jsxs("div",{className:"flex items-center justify-between py-1",children:[r.jsx(is,{htmlFor:`field-${u}`,className:"text-sm cursor-pointer",children:Ln[u]}),r.jsx(ut,{id:`field-${u}`,checked:G[u],onCheckedChange:()=>Be(u)})]},u))]})})]})]})]}),r.jsxs("div",{className:"flex gap-2 flex-wrap items-end",children:[r.jsx(us,{className:"w-4 h-4 text-muted-foreground shrink-0 mb-2"}),r.jsxs("div",{className:"flex items-end gap-2 flex-wrap flex-1",children:[r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),r.jsxs(ge,{value:P,onValueChange:$,children:[r.jsx(xe,{className:"w-[130px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos Status"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos Status"}),Object.keys(It).map(u=>r.jsx(B,{value:u,children:It[u]},u))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prioridade"}),r.jsxs(ge,{value:k,onValueChange:Q,children:[r.jsx(xe,{className:"w-[110px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todas"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todas"}),Object.keys(nn).map(u=>r.jsx(B,{value:u,children:nn[u]},u))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),r.jsxs(ge,{value:Se,onValueChange:u=>he(u),children:[r.jsx(xe,{className:"w-[110px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsx(ve,{children:po.map(u=>r.jsx(B,{value:u.value,children:u.label},u.value))})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),r.jsxs(ge,{value:ye,onValueChange:me,children:[r.jsx(xe,{className:"w-[120px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos"}),g.map(u=>r.jsx(B,{value:u,children:u},u))]})]})]}),!e&&r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Projeto"}),r.jsxs(ge,{value:le,onValueChange:ke,children:[r.jsx(xe,{className:"w-[150px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos Projetos"}),b.map(u=>r.jsx(B,{value:u.id,children:u.name},u.id))]})]})]}),V.length>0&&r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Cliente"}),r.jsxs(ge,{value:ee,onValueChange:se,children:[r.jsx(xe,{className:"w-[130px] h-8 text-xs",children:r.jsx(pe,{placeholder:"Todos"})}),r.jsxs(ve,{children:[r.jsx(B,{value:"all",children:"Todos Clientes"}),V.map(u=>r.jsx(B,{value:u,children:u},u))]})]})]}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),r.jsxs(ge,{value:be,onValueChange:u=>ae(u),children:[r.jsx(xe,{className:"w-[160px] h-8 text-xs",children:r.jsx(pe,{})}),r.jsxs(ve,{children:[r.jsx(B,{value:"deadline",children:"Sem ordenação"}),ho.map(u=>r.jsx(B,{value:u.value,children:u.label},u.value))]})]})]})]}),r.jsxs("div",{className:"flex flex-col gap-1.5 ml-auto shrink-0",children:[r.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Ocultar canceladas",r.jsx(ut,{checked:ce,onCheckedChange:I,className:"scale-75"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Ocultar concluídas",r.jsx(ut,{checked:Ee,onCheckedChange:we,className:"scale-75"})]})]})]})]}),r.jsx($r,{open:x,onOpenChange:j,task:C,onSave:Re,onDelete:u=>Ve(u),onCreateSubtask:v,onUpdateSubtask:p,onDeleteSubtask:y}),r.jsx(Kn,{open:!!Ye,onOpenChange:u=>!u&&Ve(null),children:r.jsxs(Un,{children:[r.jsxs(Yn,{children:[r.jsx(Vn,{children:"Remover tarefa?"}),r.jsx(Xn,{children:"Esta ação não pode ser desfeita. A tarefa será removida permanentemente."})]}),r.jsxs(Hn,{children:[r.jsx(Wn,{children:"Cancelar"}),r.jsx(qn,{onClick:_e,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),c?R==="list"?r.jsx(ls,{}):r.jsx(cs,{}):R==="list"?r.jsx("div",{className:"space-y-3",children:O.length===0?r.jsx(xt,{children:r.jsx(pt,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):O.map(u=>r.jsx(ln,{task:u,cardFields:G,today:_,isExpanded:H.has(u.id),onToggleExpand:ze,onToggleSubtask:Me,onEdit:rt,onDelete:Ve,showStatus:!0,projectName:K.get(u.projectId||"")},u.id))}):r.jsxs(Dr,{sensors:Nt,collisionDetection:cr,onDragStart:Xt,onDragOver:Ht,onDragEnd:st,onDragCancel:Dt,children:[r.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:r.jsx("div",{className:"flex gap-4",style:{minWidth:`${at.length*280}px`},children:at.map(u=>r.jsx("div",{className:"flex-1 min-w-[260px]",children:r.jsx(bo,{status:u,tasks:Wt[u],isOver:oe===u&&je!==null,cardFields:G,today:_,expandedTasks:H,onToggleExpand:ze,onToggleSubtask:Me,onEdit:rt,onDelete:Ve,projectMap:K})},u))})}),r.jsx(Er,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:te?r.jsx("div",{className:"w-[260px]",children:r.jsx(ln,{task:te,cardFields:G,today:_,isExpanded:!1,onToggleExpand:()=>{},onToggleSubtask:()=>{},onDelete:()=>{},isOverlay:!0,projectName:K.get(te.projectId||"")})}):null})]})]}),ot==="subtarefas"&&r.jsx(fo,{tasks:e?S.filter(u=>u.projectId===e):S,projects:b,loading:c,onCreateSubtask:v,onUpdateSubtask:p,onDeleteSubtask:y})]})}const Qo=Object.freeze(Object.defineProperty({__proto__:null,default:yo},Symbol.toStringTag,{value:"Module"}));export{yo as A,rr as L,Qo as a};
