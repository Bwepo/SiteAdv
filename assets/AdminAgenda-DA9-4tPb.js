import{U as Ee,ak as Ae,r as l,l as V,j as e,e as d}from"./index-Ajtc2pdY.js";import{A as Le,P as Y,F as Me,B as T}from"./AdminLayout-Chnaz1Kr.js";import{C as y,c as w,a as _,b as H}from"./card-lFaZXfy7.js";import{B as c}from"./button-BQEQNDSv.js";import{I as ze}from"./input-BjdOWDEn.js";import{S as U,a as Q,b as W,d as K,e as p}from"./select-BeF7utcz.js";import{A as $e,a as Be,b as Oe,c as Fe,d as Pe,e as Ie,f as Re,g as Ve}from"./alert-dialog-eogzdcB6.js";import{a as E,c as q,E as A}from"./crmTypes-DtRnJ06N.js";import{S as Ye}from"./SyncToolbar-B2Te64AP.js";import{A as _e,C as He}from"./CrmSkeletons-BUMiFKYY.js";import{A as Ue}from"./AgendaEventSheet-yJ9zpnkN.js";import{S as Qe}from"./search-4cNC8DBc.js";import{L as We}from"./list-CFokEnjA.js";import{C as Ke}from"./calendar-DtJ-5zdK.js";import{C as G}from"./clock-DxHcFvAM.js";import{U as le}from"./users-CBVP10Y4.js";import{M as qe}from"./map-pin-DQ77k-qx.js";import{P as Ge}from"./pencil-_mKBwog5.js";import{T as Je}from"./trash-2-BQe1KpiD.js";import{C as ie}from"./dialog-pIHr3eBr.js";import{C as oe}from"./chevron-right-DIN4YI-g.js";import"./heart-DkYxd5Ue.js";import"./sparkles-sVGvsUal.js";import"./ThemeToggle-LVwQYcho.js";import"./house-C4uhVb96.js";import"./file-text-VlokvRjh.js";import"./index-Cx8OL7vk.js";import"./index-BlDPpaHy.js";import"./index-B94SeSax.js";import"./chevron-up-CfdU_c7T.js";import"./check-So31nmw3.js";import"./skeleton-BObmsekb.js";import"./form-AX_RfHrP.js";import"./label-RNGS_vhl.js";import"./textarea-CtYnJG-J.js";import"./loader-circle-DwOZqEbT.js";import"./types-C9wiu8_K.js";function Bt(){const{events:m,loading:ce,syncing:de,error:me,lastSync:xe,sync:he,deleteEvent:pe,createEvent:ue,updateEvent:L}=Ee(),{projects:ge}=Ae(),[x,M]=l.useState("calendar"),[h,J]=l.useState(""),[u,X]=l.useState("all"),[g,Z]=l.useState("all"),[j,ee]=l.useState("all"),[D,te]=l.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[je,f]=l.useState(!1),[z,b]=l.useState(null),[$,B]=l.useState(null),[fe,se]=l.useState(null),[Ne,O]=l.useState(null),ve=l.useCallback(async(t,s)=>{t.preventDefault(),O(null);const a=t.dataTransfer.getData("eventId");if(!a)return;const n=m.find(r=>r.id===a);if(!(!n||n.date===s))try{await L(a,{title:n.title,date:s,time:n.time,endTime:n.endTime,type:n.type,status:n.status,clientName:n.client,location:n.location,description:n.description,projectAirtableId:n.projectId}),V.success(`"${n.title}" reagendado para ${new Date(s+"T12:00:00").toLocaleDateString("pt-BR")}`)}catch{V.error("Erro ao reagendar")}},[m,L]),S=l.useMemo(()=>m.filter(t=>{var s;return!(h&&!t.title.toLowerCase().includes(h.toLowerCase())&&!((s=t.client)!=null&&s.toLowerCase().includes(h.toLowerCase()))||u!=="all"&&t.type!==u||g!=="all"&&t.status!==g||j!=="all"&&t.projectId!==j)}).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")),[m,h,u,g,j]),F=()=>{b(null),f(!0)},C=t=>{b(t),f(!0)},ye=async(t,s)=>{s?await ue(t):z&&await L(z.id,t)},we=async()=>{if($)try{await pe($)}catch{V.error("Erro ao remover compromisso.")}finally{B(null)}},De=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),be=l.useMemo(()=>{const{year:t,month:s}=D,a=new Date(t,s,1),n=new Date(t,s+1,0),r=a.getDay(),o=[],R=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`;for(let i=r-1;i>=0;i--){const k=new Date(t,s,-i);o.push({date:R(k),day:k.getDate(),isCurrentMonth:!1})}for(let i=1;i<=n.getDate();i++){const k=new Date(t,s,i);o.push({date:R(k),day:i,isCurrentMonth:!0})}for(;o.length<42;){const i=new Date(t,s+1,o.length-r-n.getDate()+1);o.push({date:R(i),day:i.getDate(),isCurrentMonth:!1})}return o},[D]),ae=l.useMemo(()=>{const t=new Map;return S.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[S]),N=(()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${n}`})(),re=l.useMemo(()=>m.filter(t=>t.date>=N).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[m,N]),Se=new Date(D.year,D.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),Ce=()=>te(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),ke=()=>te(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),[P,I]=l.useState(0),v=l.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()+P*7);const a=[];for(let n=0;n<7;n++){const r=new Date(s);r.setDate(s.getDate()+n),a.push(`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`)}return a},[P]),Te=l.useMemo(()=>{if(v.length===0)return"";const t=new Date(v[0]+"T12:00:00"),s=new Date(v[6]+"T12:00:00");return`${t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})} — ${s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}`},[v]),ne=l.useMemo(()=>{const t=new Map;return S.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[S]);return e.jsxs(Le,{title:"Agenda",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(ze,{placeholder:"Buscar compromisso ou cliente...",value:h,onChange:t=>J(t.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(c,{variant:x==="list"?"default":"ghost",size:"sm",onClick:()=>M("list"),className:"rounded-none",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx(c,{variant:x==="week"?"default":"ghost",size:"sm",onClick:()=>M("week"),className:"rounded-none text-xs px-2",children:"Sem"}),e.jsx(c,{variant:x==="calendar"?"default":"ghost",size:"sm",onClick:()=>M("calendar"),className:"rounded-none",children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs(c,{size:"sm",onClick:F,className:"gap-1.5",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]}),e.jsx(Ye,{syncing:de,lastSync:xe,onSync:he,error:me})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(U,{value:u,onValueChange:X,children:[e.jsx(Q,{className:"w-[130px] h-8 text-xs",children:e.jsx(W,{placeholder:"Tipo"})}),e.jsxs(K,{children:[e.jsx(p,{value:"all",children:"Todos"}),Object.keys(E).map(t=>e.jsx(p,{value:t,children:E[t]},t))]})]}),e.jsxs(U,{value:g,onValueChange:Z,children:[e.jsx(Q,{className:"w-[130px] h-8 text-xs",children:e.jsx(W,{placeholder:"Status"})}),e.jsxs(K,{children:[e.jsx(p,{value:"all",children:"Todos"}),Object.keys(q).map(t=>e.jsx(p,{value:t,children:q[t]},t))]})]}),e.jsxs(U,{value:j,onValueChange:ee,children:[e.jsxs(Q,{className:"w-[150px] h-8 text-xs",children:[e.jsx(Me,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx(W,{placeholder:"Projeto"})]}),e.jsxs(K,{children:[e.jsx(p,{value:"all",children:"Todos"}),ge.map(t=>e.jsx(p,{value:t.id,children:t.name},t.id))]})]}),(u!=="all"||g!=="all"||j!=="all"||h)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{X("all"),Z("all"),ee("all"),J("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]}),ce?x==="list"?e.jsx(_e,{}):e.jsx(He,{}):x==="list"?e.jsx("div",{className:"space-y-6",children:ne.length===0?e.jsx(y,{children:e.jsxs(w,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(c,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:F,children:[e.jsx(Y,{className:"w-4 h-4"})," Criar compromisso"]})]})}):ne.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[De(t),t===N&&e.jsx(T,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(y,{className:"hover:border-primary/30 transition-colors",children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(T,{variant:"secondary",className:`text-[10px] ${A[a.type]}`,children:E[a.type]}),e.jsx(T,{variant:"outline",className:"text-[10px]",children:q[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>C(a),children:e.jsx(Ge,{className:"w-3.5 h-3.5"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>B(a.id),children:e.jsx(Je,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):x==="week"?e.jsxs(y,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>I(t=>t-1),children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx(H,{className:"text-base",children:Te}),e.jsxs("div",{className:"flex items-center gap-1",children:[P!==0&&e.jsx(c,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:()=>I(0),children:"Hoje"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>I(t=>t+1),children:e.jsx(oe,{className:"w-4 h-4"})})]})]})}),e.jsx(w,{children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:v.map(t=>{const s=new Date(t+"T12:00:00"),a=t===N,n=ae.get(t)||[];return e.jsxs("div",{className:d("min-h-[140px] p-2 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",a?"bg-primary/5 border-primary/30":"border-border/50"),onClick:()=>{n.length===0&&(b(null),f(!0))},children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground capitalize",children:s.toLocaleDateString("pt-BR",{weekday:"short"})}),e.jsx("p",{className:d("text-lg font-bold",a&&"text-primary"),children:s.getDate()})]}),e.jsx("div",{className:"space-y-1",children:n.map(r=>e.jsxs("div",{className:d("text-[10px] px-1.5 py-1 rounded cursor-pointer hover:opacity-80",A[r.type]),onClick:o=>{o.stopPropagation(),C(r)},children:[r.time&&e.jsxs("span",{className:"font-semibold",children:[r.time," "]}),e.jsx("span",{className:"truncate",children:r.title})]},r.id))})]},t)})})})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(y,{children:[e.jsx(_,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:Ce,children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx(H,{className:"text-base capitalize",children:Se}),e.jsx(c,{variant:"ghost",size:"icon",onClick:ke,children:e.jsx(oe,{className:"w-4 h-4"})})]})}),e.jsx(w,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t)),be.map((t,s)=>{const a=ae.get(t.date)||[],n=t.date===N;return e.jsxs("div",{className:d("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!t.isCurrentMonth&&"opacity-40",n&&"bg-primary/5 border-primary/30",Ne===t.date&&"bg-primary/10 border-primary/40 ring-1 ring-primary/30"),onDragOver:r=>{r.preventDefault(),O(t.date)},onDragLeave:()=>O(null),onDrop:r=>ve(r,t.date),onClick:()=>{a.length===0&&(b(null),f(!0))},children:[e.jsx("p",{className:d("text-xs font-medium mb-0.5",n&&"text-primary font-bold"),children:t.day}),e.jsxs("div",{className:"space-y-0.5",children:[a.slice(0,2).map(r=>e.jsxs("div",{draggable:!0,onDragStart:o=>{o.dataTransfer.setData("eventId",r.id),se(r.id)},onDragEnd:()=>se(null),className:d("text-[9px] px-1 py-0.5 rounded truncate cursor-grab active:cursor-grabbing hover:opacity-80",A[r.type],fe===r.id&&"opacity-40"),title:`${r.title} — arraste para reagendar`,onClick:o=>{o.stopPropagation(),C(r)},children:[r.time&&e.jsxs("span",{className:"font-medium",children:[r.time," "]}),r.title]},r.id)),a.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",a.length-2," mais"]})]})]},s)})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(y,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(_,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(H,{className:"text-sm flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-primary"}),"Próximos"]}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:F,children:e.jsx(Y,{className:"w-4 h-4"})})]})}),e.jsx(w,{className:"space-y-3",children:re.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):re.map(t=>{const s=new Date(t.date+"T12:00:00"),a=new Date;a.setHours(0,0,0,0);const n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=Math.round((n.getTime()-a.getTime())/(1e3*60*60*24)),o=r===0?"Hoje":r===1?"Amanhã":`Em ${r} dias`;return e.jsxs("div",{className:"flex gap-3 p-2 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>C(t),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:s.getDate()}),e.jsx("span",{className:"text-[10px] capitalize text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(T,{variant:"outline",className:d("text-[10px] px-1.5 py-0",A[t.type]),children:E[t.type]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:o})]}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx(G,{className:"w-3 h-3 inline mr-1"}),t.time,t.endTime?` – ${t.endTime}`:""]}),t.client&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.jsx(le,{className:"w-3 h-3 inline mr-1"}),t.client]})]})]},t.id)})})]})})]}),e.jsx(Ue,{open:je,onOpenChange:f,event:z,onSave:ye}),e.jsx($e,{open:!!$,onOpenChange:t=>!t&&B(null),children:e.jsxs(Be,{children:[e.jsxs(Oe,{children:[e.jsx(Fe,{children:"Remover compromisso?"}),e.jsxs(Pe,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Ie,{children:[e.jsx(Re,{children:"Cancelar"}),e.jsx(Ve,{onClick:we,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Bt as default};
