import{c as te,r as S,y as ie,j as e,m as N}from"./index-lLR9KJZ_.js";import{A as re}from"./AdminLayout-Crl2Aghf.js";import{B as m}from"./button-BgSUsEcq.js";import{I as b}from"./input-BepCrCgg.js";import{C as h,a as f,b as v,c as j}from"./card-Bv6RU3ar.js";import{T as ne,a as le,b as w,c as p,d as oe,e as i,A as M,m as B,f as F,g as _,h as z,i as H,j as O,k as U,l as q}from"./alert-dialog-D9nn2Hbt.js";import{S as r}from"./skeleton-CNFfqd6z.js";import{c as ce,a as de,d as me,e as xe,f as he}from"./useNewsletter-_amMQF5i.js";import{g as k}from"./supabaseErrors-eYWJjREL.js";import{U as je}from"./users-DkcMojmo.js";import{D as V}from"./download-ySTSa0IQ.js";import{L as G}from"./loader-circle-CDXgs8S6.js";import{S as pe}from"./search-Hv7Qc7qr.js";import{M as W}from"./menu-BL3hDN0F.js";import{C as J}from"./calendar-CBv73zxu.js";import{T as K}from"./trash-2-BIXC-Ayb.js";import"./index-C3UFv43d.js";import"./index-C8lw-Z8G.js";import"./house-CvzKu_jh.js";import"./file-text-BL5AJSxZ.js";import"./useMutation-Cr7htQUG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=te("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),L=20,_e=()=>{const[x,Q]=S.useState(""),[X,y]=S.useState(1),{toast:n}=ie(),{data:o,isLoading:I}=ce(),{data:c}=de(),C=me(),Y=xe(),A=he(),[u,D]=S.useState({name:"",email:""}),t=o==null?void 0:o.filter(s=>s.email.toLowerCase().includes(x.toLowerCase())||s.name&&s.name.toLowerCase().includes(x.toLowerCase())),E=(t==null?void 0:t.length)||0,g=Math.max(1,Math.ceil(E/L)),l=Math.min(X,g),d=t==null?void 0:t.slice((l-1)*L,l*L),Z=s=>{Q(s),y(1)},P=async s=>{try{await Y.mutateAsync(s),n({title:"Inscrito removido",description:"O inscrito foi removido da lista."})}catch(a){const T=k(a,"Não foi possível remover o inscrito.");n({title:"Erro",description:T,variant:"destructive"})}},$=async()=>{try{await A.mutateAsync(),n({title:"Exportação concluída",description:"O arquivo CSV foi baixado com sucesso."})}catch(s){const a=k(s,"Não foi possível exportar a lista.");n({title:"Erro",description:a,variant:"destructive"})}},ee=async s=>{s.preventDefault();const a=u.email.trim(),T=u.name.trim()||void 0;if(!a){n({title:"E-mail obrigatório",description:"Informe o e-mail do inscrito para adicionar.",variant:"destructive"});return}try{await C.mutateAsync({email:a,name:T}),D({name:"",email:""}),n({title:"Inscrito adicionado",description:"O usuário foi incluído na lista de newsletter."})}catch(se){const ae=k(se,"Não foi possível adicionar o inscrito.");n({title:"Erro ao adicionar",description:ae,variant:"destructive"})}},R=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(re,{title:"Newsletter",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-8",children:[e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Total de Inscritos"}),e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(c==null?void 0:c.total)??e.jsx(r,{className:"h-8 w-16"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inscritos ativos na newsletter"})]})]})}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Novos esta Semana"}),e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(j,{children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["+",(c==null?void 0:c.newThisWeek)??e.jsx(r,{className:"h-8 w-12 inline-block"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Últimos 7 dias"})]})]})}),e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium",children:"Exportar Lista"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(j,{children:e.jsxs(m,{variant:"outline",size:"sm",onClick:$,disabled:A.isPending||!(o!=null&&o.length),children:[A.isPending?e.jsx(G,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(V,{className:"h-4 w-4 mr-2"}),"Baixar CSV"]})})]})})]}),e.jsxs(h,{className:"mb-6",children:[e.jsx(f,{children:e.jsx(v,{className:"text-base",children:"Adicionar inscrito manualmente"})}),e.jsx(j,{children:e.jsxs("form",{onSubmit:ee,className:"flex flex-col gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"newsletter-name",children:"Nome (opcional)"}),e.jsx(b,{id:"newsletter-name",placeholder:"Nome do inscrito",value:u.name,onChange:s=>D(a=>({...a,name:s.target.value})),maxLength:120})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"newsletter-email",children:"E-mail"}),e.jsx(b,{id:"newsletter-email",type:"email",placeholder:"email@dominio.com",value:u.email,onChange:s=>D(a=>({...a,email:s.target.value})),required:!0,maxLength:255})]}),e.jsx(m,{type:"submit",className:"md:w-48",disabled:C.isPending,children:C.isPending?e.jsx(G,{className:"h-4 w-4 animate-spin"}):"Adicionar inscrito"})]})})]}),e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Buscar por email ou nome...",value:x,onChange:s=>Z(s.target.value),className:"pl-10"})]})}),e.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:[e.jsx(h,{children:e.jsxs(j,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(w,{children:[e.jsx(p,{children:"Email"}),e.jsx(p,{children:"Nome"}),e.jsx(p,{children:"Data de Inscrição"}),e.jsx(p,{children:"Origem"}),e.jsx(p,{className:"w-[80px]",children:"Ações"})]})}),e.jsx(oe,{children:I?Array.from({length:5}).map((s,a)=>e.jsxs(w,{children:[e.jsx(i,{children:e.jsx(r,{className:"h-4 w-48"})}),e.jsx(i,{children:e.jsx(r,{className:"h-4 w-24"})}),e.jsx(i,{children:e.jsx(r,{className:"h-4 w-32"})}),e.jsx(i,{children:e.jsx(r,{className:"h-4 w-16"})}),e.jsx(i,{children:e.jsx(r,{className:"h-8 w-8"})})]},a)):(t==null?void 0:t.length)===0?e.jsx(w,{children:e.jsxs(i,{colSpan:5,className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:x?"Nenhum inscrito encontrado com esse termo.":"Nenhum inscrito ainda."})]})}):d==null?void 0:d.map(s=>e.jsxs(w,{children:[e.jsx(i,{className:"font-medium",children:s.email}),e.jsx(i,{className:"text-muted-foreground",children:s.name||"—"}),e.jsx(i,{className:"text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),R(s.subscribed_at)]})}),e.jsx(i,{children:e.jsx("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.source})}),e.jsx(i,{children:e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(F,{children:[e.jsxs(_,{children:[e.jsx(z,{children:"Remover inscrito?"}),e.jsxs(H,{children:["Esta ação removerá ",s.email," da lista de newsletter. Esta ação não pode ser desfeita."]})]}),e.jsxs(O,{children:[e.jsx(U,{children:"Cancelar"}),e.jsx(q,{onClick:()=>P(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden p-4 space-y-3",children:I?Array.from({length:3}).map((s,a)=>e.jsx(r,{className:"h-24 w-full"},a)):(t==null?void 0:t.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:x?"Nenhum inscrito encontrado.":"Nenhum inscrito ainda."})]}):d==null?void 0:d.map(s=>e.jsxs("div",{className:"bg-muted/30 rounded-lg border border-border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.email}),s.name&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.name})]}),e.jsxs(M,{children:[e.jsx(B,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",children:e.jsx(K,{className:"h-4 w-4"})})}),e.jsxs(F,{children:[e.jsxs(_,{children:[e.jsx(z,{children:"Remover inscrito?"}),e.jsxs(H,{children:["Esta ação removerá ",s.email," da lista."]})]}),e.jsxs(O,{children:[e.jsx(U,{children:"Cancelar"}),e.jsx(q,{onClick:()=>P(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),R(s.subscribed_at)]}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.source})]})]},s.id))})]})}),g>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 text-sm",children:[e.jsxs("p",{className:"text-muted-foreground text-xs",children:[E," inscrito",E!==1?"s":""]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs",disabled:l<=1,onClick:()=>y(l-1),children:"Anterior"}),e.jsxs("span",{className:"px-3 text-xs text-muted-foreground",children:[l," / ",g]}),e.jsx(m,{variant:"outline",size:"sm",className:"h-8 px-3 text-xs",disabled:l>=g,onClick:()=>y(l+1),children:"Próxima"})]})]})]})]})};export{_e as default};
