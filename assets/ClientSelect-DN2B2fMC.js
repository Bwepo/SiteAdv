import{r as l,$ as v,j as e,s as N,h as x}from"./index-sVkT8duI.js";import{f as S}from"./crmTypes-lczSRazm.js";import{B as f}from"./button-Dgwn-oEg.js";import{I as g}from"./input-B_KpMOuu.js";import{P as C,a as w,b}from"./popover-CzG0iY7x.js";import{P as y}from"./badge-Cc4e8nUU.js";import{L as P}from"./loader-circle-Dk6_wCYi.js";import{S as I,a as L,b as _,c as E,d as j}from"./select-DxnrQQPt.js";import{S as k}from"./search-eEERtae1.js";function q({onClientAdded:r}){const[c,m]=l.useState(!1),[i,a]=l.useState(""),[o,d]=l.useState(!1),u=v(),h=async()=>{if(i.trim()){d(!0);try{const n=i.trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),s=`local_${Date.now()}`,{data:t,error:p}=await N.from("mladv_crm_clientes").insert({nome:i.trim(),slug:n,airtable_id:s}).select().single();if(p)throw p;x.success(`Cliente "${i.trim()}" adicionado!`),u.invalidateQueries({queryKey:["crm","clientes"]}),r==null||r({id:t.airtable_id,name:t.nome}),a(""),m(!1)}catch(n){x.error("Erro ao adicionar cliente: "+n.message)}finally{d(!1)}}};return e.jsxs(C,{open:c,onOpenChange:m,children:[e.jsx(w,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",type:"button",title:"Adicionar cliente",children:e.jsx(y,{className:"h-4 w-4"})})}),e.jsxs(b,{className:"w-64 p-3",align:"end",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Novo Cliente"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{value:i,onChange:n=>a(n.target.value),placeholder:"Nome do cliente",className:"h-8 text-sm",autoFocus:!0,onKeyDown:n=>n.key==="Enter"&&h()}),e.jsx(f,{size:"sm",onClick:h,disabled:!i.trim()||o,className:"h-8",children:o?e.jsx(P,{className:"h-3.5 w-3.5 animate-spin"}):"Add"})]})]})]})}function T({value:r,onValueChange:c,matchBy:m="name",placeholder:i="Selecione um cliente..."}){const{clients:a}=S(),[o,d]=l.useState(""),u=l.useMemo(()=>{if(!o.trim())return a;const s=o.toLowerCase();return a.filter(t=>t.name.toLowerCase().includes(s))},[a,o]),h=l.useMemo(()=>{if(!r)return"";if(m==="id")return r;const s=a.find(t=>t.name===r);return(s==null?void 0:s.id)||""},[r,a,m]),n=s=>{if(s==="none"){c("","");return}const t=a.find(p=>p.id===s);c((t==null?void 0:t.name)??"",s)};return e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(I,{value:h||"none",onValueChange:n,children:[e.jsx(L,{children:e.jsx(_,{placeholder:i})}),e.jsxs(E,{children:[e.jsx("div",{className:"px-2 pb-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(k,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(g,{value:o,onChange:s=>d(s.target.value),placeholder:"Buscar...",className:"h-8 pl-7 text-sm",onKeyDown:s=>s.stopPropagation()})]})}),e.jsx(j,{value:"none",children:"— Sem cliente —"}),u.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id)),u.length===0&&o.trim()&&e.jsx("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Nenhum cliente encontrado"})]})]}),e.jsx(q,{onClientAdded:s=>c(s.name,s.id)})]})}export{T as C};
