import{r as A,aj as P,ak as _,j as e}from"./index--VkK_6xW.js";import{u as z,F as O,a as c,b as i,c as r,d,e as m,t as B}from"./form-1xsfOPso.js";import{S as D,a as k,b as H,c as M,f as R,g as U}from"./AdminLayout-BBlkaNDR.js";import{I as h}from"./input-XXLJvWnV.js";import{B as E}from"./button-BNnjEdlp.js";import{T as Y}from"./textarea-pt7U9Oic.js";import{S as f,a as b,b as g,d as T,e as j}from"./select-BEs-C6p3.js";import{a as G,e as q}from"./crmTypes-DP3iBdIv.js";import{L as J}from"./loader-circle-D38fRm10.js";import{o as K,s as l,e as L}from"./types-C9wiu8_K.js";const Q=K({title:l().trim().min(1,"Título obrigatório").max(200),date:l().min(1,"Data obrigatória"),time:l().optional(),endTime:l().optional(),type:L(["reuniao","audiencia","prazo","consulta","lembrete","outro"]),status:L(["confirmado","pendente","cancelado","reagendado"]),clientId:l().optional(),clientName:l().optional(),projectId:l().optional(),location:l().max(300).optional(),description:l().max(2e3).optional()}),W=Object.entries(G),X=Object.entries(q);function le({open:N,onOpenChange:y,event:t,onSave:V}){const p=!t,[C,I]=A.useState(!1),{clients:u}=P(),{projects:S}=_(),a=z({resolver:B(Q),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});A.useEffect(()=>{if(N)if(t){const s=u.find(n=>{var x;return n.name.toLowerCase()===((x=t.client)==null?void 0:x.toLowerCase())}),o=S.find(n=>{var x;return n.name.toLowerCase()===((x=t.client)==null?void 0:x.toLowerCase())});a.reset({title:t.title,date:t.date,time:t.time??"",endTime:t.endTime??"",type:t.type,status:t.status,clientId:(s==null?void 0:s.id)??"",clientName:t.client??"",projectId:(o==null?void 0:o.id)??"",location:t.location??"",description:t.description??""})}else a.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""})},[N,t,u,S]);const w=s=>{const o=u.find(n=>n.id===s);a.setValue("clientId",s),a.setValue("clientName",(o==null?void 0:o.name)??"")},F=s=>{if(a.setValue("projectId",s),!a.getValues("clientName")&&s!=="none"){const o=S.find(n=>n.id===s);o&&a.setValue("clientName",o.name)}},v=async s=>{I(!0);try{const o=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await V({...s,projectAirtableId:o},p),y(!1)}finally{I(!1)}};return e.jsx(D,{open:N,onOpenChange:y,children:e.jsxs(k,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(H,{className:"mb-6",children:[e.jsx(M,{children:p?"Novo Compromisso":"Editar Compromisso"}),e.jsx(R,{children:p?"Preencha os dados e salve para criar o compromisso no banco e sincronizar com o Airtable.":"Altere os campos e salve. A atualização será sincronizada com o Airtable automaticamente."})]}),e.jsx(O,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(v),className:"space-y-5",children:[e.jsx(c,{control:a.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Título *"}),e.jsx(d,{children:e.jsx(h,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{control:a.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Data *"}),e.jsx(d,{children:e.jsx(h,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"time",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Hora início"}),e.jsx(d,{children:e.jsx(h,{type:"time",...s})}),e.jsx(m,{})]})})]}),e.jsx(c,{control:a.control,name:"endTime",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Hora término"}),e.jsx(d,{children:e.jsx(h,{type:"time",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{control:a.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Tipo *"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(b,{children:e.jsx(g,{})})}),e.jsx(T,{children:W.map(([o,n])=>e.jsx(j,{value:o,children:n},o))})]}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Status *"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(b,{children:e.jsx(g,{})})}),e.jsx(T,{children:X.map(([o,n])=>e.jsx(j,{value:o,children:n},o))})]}),e.jsx(m,{})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:"Projeto (Airtable)"}),e.jsxs(f,{onValueChange:F,value:a.watch("projectId")||"",children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Selecione um projeto..."})}),e.jsxs(T,{children:[e.jsx(j,{value:"none",children:"— Sem projeto —"}),S.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:"Cliente"}),e.jsxs(f,{onValueChange:w,value:a.watch("clientId")||"",children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Selecione um cliente..."})}),e.jsxs(T,{children:[e.jsx(j,{value:"none",children:"— Sem cliente —"}),u.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))]})]})]}),e.jsx(c,{control:a.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Local / Link"}),e.jsx(d,{children:e.jsx(h,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Descrição / Observações"}),e.jsx(d,{children:e.jsx(Y,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(m,{})]})}),e.jsxs(U,{className:"pt-2 gap-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>y(!1),disabled:C,children:"Cancelar"}),e.jsxs(E,{type:"submit",disabled:C,children:[C&&e.jsx(J,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{le as A};
