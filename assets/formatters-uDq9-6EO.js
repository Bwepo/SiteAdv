import{c as z,r as j,s as b,j as s,X as k,h as $,e as M}from"./index-DixcKx3f.js";import{B as w}from"./button-UQeTJvbR.js";import{L as C}from"./label-BirSf-vf.js";import{A as F,a as I,b as O,c as _,d as B,e as P,f as V,g as q}from"./alert-dialog-BkSlHPy5.js";import{L as W}from"./loader-circle-DoMssvgx.js";import{D as S}from"./download-CuLfTgMi.js";import{F as H}from"./file-text-5jgPIr5i.js";import{E as G,U as X}from"./tabs-CGAKuXDS.js";import{T as J}from"./textarea-D2FpDeDK.js";import{D as Y,a as K,c as Q,d as Z,f as ee}from"./dialog-l1gdMXmA.js";import{T as se}from"./TipTapEditor-CS8s6shz.js";import{p as T}from"./purify.es-D9RiKzGB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=z("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=z("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),re=/\.(jpg|jpeg|png|webp|gif)$/i;function ve({folder:t,readOnly:e=!1,label:n="Anexos"}){const[a,m]=j.useState([]),[c,o]=j.useState(!1),[p,i]=j.useState(!0),[u,x]=j.useState(null),f=j.useCallback(async()=>{i(!0);try{const{data:r,error:l}=await b.storage.from("crm-anexos").list(t);if(l)throw l;const d=(r||[]).filter(v=>v.name!==".emptyFolderPlaceholder");if(d.length>0){const v=await Promise.all(d.map(async h=>{const A=re.test(h.name);let L;if(A){const{data:E}=await b.storage.from("crm-anexos").createSignedUrl(`${t}/${h.name}`,3600);L=(E==null?void 0:E.signedUrl)??void 0}return{name:h.name,signedUrl:L,isImage:A}}));m(v)}else m([])}catch{m([])}finally{i(!1)}},[t]);j.useEffect(()=>{f()},[f]);const N=async r=>{const l=r.target.files;if(!(!l||l.length===0)){o(!0);try{for(const d of Array.from(l)){const v=`${t}/${d.name}`,{error:h}=await b.storage.from("crm-anexos").upload(v,d,{upsert:!0});if(h)throw h}await f(),$.success("Arquivo(s) enviado(s)!")}catch(d){$.error("Erro no upload: "+d.message)}finally{o(!1),r.target.value=""}}},y=async()=>{if(u)try{const{error:r}=await b.storage.from("crm-anexos").remove([`${t}/${u}`]);if(r)throw r;m(l=>l.filter(d=>d.name!==u)),$.success("Arquivo removido.")}catch(r){$.error("Erro ao remover: "+r.message)}finally{x(null)}},g=async r=>{const{data:l,error:d}=await b.storage.from("crm-anexos").download(`${t}/${r}`);if(d){$.error("Erro ao baixar arquivo.");return}const v=URL.createObjectURL(l),h=document.createElement("a");h.href=v,h.download=r,h.click(),URL.revokeObjectURL(v)},D=async r=>{const{data:l,error:d}=await b.storage.from("crm-anexos").createSignedUrl(`${t}/${r}`,3600);if(d||!(l!=null&&l.signedUrl)){$.error("Erro ao gerar link de visualização.");return}window.open(l.signedUrl,"_blank")};return p?s.jsxs("div",{className:"space-y-2",children:[s.jsxs(C,{className:"flex items-center gap-1.5",children:[s.jsx(R,{className:"h-3.5 w-3.5"})," ",n]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(W,{className:"h-3 w-3 animate-spin"})," Carregando..."]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(C,{className:"flex items-center gap-1.5",children:[s.jsx(R,{className:"h-3.5 w-3.5"})," ",n,a.length>0&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.length,")"]})]}),a.length>0&&s.jsxs("div",{className:"space-y-1.5",children:[a.some(r=>r.isImage)&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.filter(r=>r.isImage&&r.signedUrl).map(r=>s.jsxs("div",{className:"relative group rounded-md overflow-hidden border border-border",children:[s.jsx("img",{src:r.signedUrl,alt:r.name,className:"h-16 w-16 object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>D(r.name)}),s.jsxs("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100",children:[s.jsx("button",{onClick:()=>g(r.name),className:"p-1 bg-background/80 rounded",title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx("button",{onClick:()=>x(r.name),className:"p-1 bg-background/80 rounded text-destructive",title:"Excluir",children:s.jsx(k,{className:"h-3 w-3"})})]}),s.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-1 truncate",children:r.name})]},r.name))}),a.filter(r=>!r.isImage).map(r=>s.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-md px-2.5 py-1.5 text-xs group",children:[s.jsx(H,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),s.jsx("span",{className:"truncate flex-1 max-w-[180px]",children:r.name}),s.jsxs("div",{className:"flex items-center gap-0.5 shrink-0",children:[s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>D(r.name),title:"Visualizar",children:s.jsx(G,{className:"h-3 w-3"})}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>g(r.name),title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive hover:text-destructive",onClick:()=>x(r.name),title:"Excluir",children:s.jsx(k,{className:"h-3 w-3"})})]})]},r.name))]}),a.length===0&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo."}),!e&&s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-sm text-primary hover:underline mt-1",children:[s.jsx(X,{className:"h-4 w-4"}),c?"Enviando...":"Adicionar arquivo",s.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:N,disabled:c})]})]}),s.jsx(F,{open:!!u,onOpenChange:r=>!r&&x(null),children:s.jsxs(I,{children:[s.jsxs(O,{children:[s.jsx(_,{children:"Excluir anexo?"}),s.jsxs(B,{children:['O arquivo "',u,'" será removido permanentemente. Esta ação não pode ser desfeita.']})]}),s.jsxs(P,{children:[s.jsx(V,{children:"Cancelar"}),s.jsx(q,{onClick:y,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function ae({open:t,onOpenChange:e,title:n="Editar Observações",value:a,onChange:m}){const[c,o]=j.useState(a);j.useEffect(()=>{t&&o(a)},[t,a]);const p=()=>{m(c),e(!1)};return s.jsx(Y,{open:t,onOpenChange:e,children:s.jsxs(K,{className:"max-w-4xl w-[95vw] max-h-[90vh] flex flex-col p-0",children:[s.jsx(Q,{className:"px-6 pt-6 pb-0",children:s.jsx(Z,{children:n})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 min-h-0",children:s.jsx("div",{className:"[&_.border]:overflow-visible [&_.border]:flex [&_.border]:flex-col [&_.border]:max-h-full",children:s.jsx(se,{content:c,onChange:o,placeholder:"Escreva suas observações aqui..."})})}),s.jsxs(ee,{className:"px-6 pb-6 pt-2 gap-2 border-t border-border",children:[s.jsx(w,{variant:"outline",onClick:()=>e(!1),children:"Cancelar"}),s.jsx(w,{onClick:p,children:"Salvar"})]})]})})}const U={ALLOWED_TAGS:["p","h1","h2","h3","h4","h5","h6","strong","em","ul","ol","li","br","hr"],ALLOWED_ATTR:[],ALLOW_DATA_ATTR:!1};function ne(t){if(!t)return"";const e=String(t).trim();if(!e)return"";if(/<[a-z][\s\S]*>/i.test(e))return T.sanitize(e,U);const n=e.split(/\r?\n/),a=[];let m=!1;const c=p=>{let i=p.replace(/\\-/g,"-");return i=i.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),i},o=()=>{m&&(a.push("</ul>"),m=!1)};for(const p of n){const i=p.trim();if(!i){o();continue}const u=i.match(/^(#{1,6})\s+(.+)$/);if(u){o();const g=Math.min(u[1].length,6);a.push(`<h${g}>${c(u[2])}</h${g}>`);continue}const x=i.match(/^\*\*(.+?)\*\*:?$/);if(x){o();const g=x[1];g.match(/^(\d+)\)\s+(.+)$/)?a.push(`<h3>${c(g)}</h3>`):a.push(`<p><strong>${c(g)}${i.endsWith(":")?":":""}</strong></p>`);continue}const f=i.match(/^(\d+)\)\s+(.+)$/);if(f){o(),a.push(`<h3>${f[1]}) ${c(f[2])}</h3>`);continue}const N=i.replace(/^\\-/,"-"),y=N.match(/^(-|•|\*)\s+(.+)$/);if(y&&!N.startsWith("**")){m||(a.push("<ul>"),m=!0),a.push(`<li>${c(y[2])}</li>`);continue}o(),a.push(`<p>${c(i)}</p>`)}return o(),T.sanitize(a.join(""),U)}function ie(t){return t?/<[a-z][\s\S]*>/i.test(t)?new DOMParser().parseFromString(t,"text/html").body.textContent||"":t:""}function be({value:t,onChange:e,placeholder:n="Observações...",className:a,modalTitle:m="Editar Observações"}){const[c,o]=j.useState(!1),p=ne(t)||t,i=/<[a-z][\s\S]*>/i.test(t),u=i?ie(t):t,x=i;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative group",children:[s.jsx(J,{placeholder:n,className:M("resize-none min-h-[80px] pr-10",a),value:u,onChange:f=>e(f.target.value)}),s.jsx(w,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1.5 right-1.5 h-7 w-7 opacity-50 group-hover:opacity-100 transition-opacity",onClick:()=>o(!0),title:"Expandir editor",children:s.jsx(te,{className:"w-3.5 h-3.5"})}),x&&s.jsx("span",{className:"absolute bottom-1.5 right-1.5 text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:"Texto formatado"})]}),s.jsx(ae,{open:c,onOpenChange:o,title:m,value:p,onChange:e})]})}function $e(t){const e=t.replace(/\D/g,"").slice(0,20);let n="";for(let a=0;a<e.length;a++)a===7&&(n+="-"),a===9&&(n+="."),a===13&&(n+="."),a===14&&(n+="."),a===16&&(n+="."),n+=e[a];return n}function we(t){const e=t.replace(/\D/g,"").slice(0,11);return e.length<=3?e:e.length<=6?`${e.slice(0,3)}.${e.slice(3)}`:e.length<=9?`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6)}`:`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6,9)}-${e.slice(9)}`}function Ne(t){const e=t.replace(/\D/g,"").slice(0,14);return e.length<=2?e:e.length<=5?`${e.slice(0,2)}.${e.slice(2)}`:e.length<=8?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5)}`:e.length<=12?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8)}`:`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8,12)}-${e.slice(12)}`}function ye(t){const e=t.replace(/\D/g,"").slice(0,11);return e.length<=2?`(${e}`:e.length<=7?`(${e.slice(0,2)}) ${e.slice(2)}`:`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7)}`}function De(t){const e=t.replace(/\D/g,"");return e?(parseInt(e,10)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""}function Ee(t){const e=t.replace(/\D/g,"");return e?parseInt(e,10)/100:null}function Ae(t){return t==null?"":t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}export{ve as A,be as E,ae as R,we as a,Ne as b,$e as c,De as d,ye as f,ne as m,Ae as n,Ee as p};
