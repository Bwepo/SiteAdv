import{u as c,a as m}from"./useMutation-CaVSTp5W.js";import{ae as l,I as o}from"./index-DqqvOfpS.js";function y(){const e=l();return c({mutationFn:async t=>{var a,i,u;const r=t.email.trim().toLowerCase(),n=((a=t.source)==null?void 0:a.trim())||"website",{error:s}=await o.from("mladv_newsletter_subscribers").upsert({email:r,name:((i=t.name)==null?void 0:i.trim())||null,source:n,confirmed:!0,unsubscribed_at:null},{onConflict:"email"});if(s)throw s;return{email:r,name:((u=t.name)==null?void 0:u.trim())||null,source:n}},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-subscribers"]}),e.invalidateQueries({queryKey:["newsletter-stats"]})}})}function f(){const e=l();return c({mutationFn:async t=>{var i;const r=t.email.trim().toLowerCase(),n=((i=t.name)==null?void 0:i.trim())||null,{data:s,error:a}=await o.from("mladv_newsletter_subscribers").upsert({email:r,name:n,source:"admin",confirmed:!0,unsubscribed_at:null},{onConflict:"email"}).select("*").single();if(a)throw a;return s},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-subscribers"]}),e.invalidateQueries({queryKey:["newsletter-stats"]})}})}function p(){return m({queryKey:["newsletter-subscribers"],queryFn:async()=>{const{data:e,error:t}=await o.from("mladv_newsletter_subscribers").select("*").order("subscribed_at",{ascending:!1});if(t)throw t;return e||[]}})}function q(){return m({queryKey:["newsletter-stats"],queryFn:async()=>{const{data:e,error:t,count:r}=await o.from("mladv_newsletter_subscribers").select("*",{count:"exact"}).is("unsubscribed_at",null);if(t)throw t;const n=new Date;n.setDate(n.getDate()-7);const s=(e||[]).filter(a=>new Date(a.subscribed_at)>=n).length;return{total:r||0,active:r||0,newThisWeek:s}}})}function _(){const e=l();return c({mutationFn:async t=>{const{error:r}=await o.from("mladv_newsletter_subscribers").delete().eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-subscribers"]}),e.invalidateQueries({queryKey:["newsletter-stats"]})}})}function g(){return c({mutationFn:async()=>{const{data:e,error:t}=await o.from("mladv_newsletter_subscribers").select("email, name, subscribed_at").is("unsubscribed_at",null).order("subscribed_at",{ascending:!1});if(t)throw t;const r=["Email","Nome","Data de Inscrição"],n=(e||[]).map(u=>[u.email,u.name||"",new Date(u.subscribed_at).toLocaleDateString("pt-BR")]),s=[r.join(","),...n.map(u=>u.map(d=>`"${d}"`).join(","))].join(`
`),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");return i.href=URL.createObjectURL(a),i.download=`newsletter-subscribers-${new Date().toISOString().split("T")[0]}.csv`,i.click(),s}})}function v(){return m({queryKey:["newsletter-campaigns"],queryFn:async()=>[]})}function h(e){return m({queryKey:["newsletter-campaign",e],enabled:!!e,queryFn:async()=>({campaign:null,deliveryCounts:{queued:0,sent:0,failed:0,skipped:0}})})}function C(){const e=l();return c({mutationFn:async t=>{throw new Error("Funcionalidade de campanhas ainda não implementada.")},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-campaigns"]}),e.invalidateQueries({queryKey:["newsletter-campaign"]})}})}function S(){const e=l();return c({mutationFn:async t=>{throw new Error("Funcionalidade de campanhas ainda não implementada.")},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-campaigns"]}),e.invalidateQueries({queryKey:["newsletter-campaign"]})}})}export{q as a,v as b,p as c,f as d,_ as e,g as f,C as g,S as h,h as i,y as u};
