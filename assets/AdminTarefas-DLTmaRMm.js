import{c as Ze,$ as qe,ao as We,r as t,j as e,e as w}from"./index-CC2g7BXp.js";import{A as Je,P as Qe,F as Xe,B as V}from"./AdminLayout-BIaoVi8D.js";import{T as es}from"./TarefaSheet-BOuQd1yG.js";import{u as ss,a as ts,C as as,A as rs,D as ns,c as ls,b as is,S as os,G as cs,d as ds,e as ms,v as us,P as xs,f as ps,g as hs}from"./SubtarefasTab-BbB05Fg-.js";import{C as ke,c as we}from"./card-DrwXuBN8.js";import{A as gs,a as fs,b as js,c as bs,d as Ss,e as vs,f as Ns,g as Cs}from"./alert-dialog-DdZMitm-.js";import{B as v}from"./button-CKII4Ca3.js";import{I as Ts}from"./input-D4Ny5lXD.js";import{S as je,C as ks}from"./checkbox-dWMeQs0V.js";import{L as ws}from"./label-Ag37qmII.js";import{T as ys,a as Ds,b as be,c as Se}from"./tabs-Q7yRbVXR.js";import{S as F,a as M,b as Z,d as K,e as g}from"./select-D_4yNPEv.js";import{P as As,a as Is,b as Ls}from"./popover-CQxCZDLE.js";import{T as W,c as te,b as Ps,d as ye}from"./crmTypes-C2SECzd8.js";import{S as Es}from"./SyncToolbar-B3p40OLs.js";import{T as Os,K as Rs}from"./CrmSkeletons-_AHYVQ2j.js";import{S as Bs}from"./search-CRuXS0DY.js";import{L as _s}from"./list-BRGMSJog.js";import{U as Fs}from"./users-D3X7ED9-.js";import{C as Ms}from"./calendar-C4LmLqyF.js";import{P as Ks}from"./pencil-Byygr_yM.js";import{T as Vs}from"./trash-2-DI5JE9b3.js";import{C as zs}from"./chevron-up-06V4YNk2.js";import{C as Us}from"./chevron-right-D91UW9mI.js";import"./dialog-DFSodkv1.js";import"./index-BF9YOj6b.js";import"./heart-Ckw0-9I9.js";import"./sparkles-C4v4JiNa.js";import"./house-ShKgI4ej.js";import"./menu-CSu1f_uB.js";import"./file-text-BlWUahmQ.js";import"./form-efL--t0x.js";import"./textarea-Mbfr8e-K.js";import"./separator-D9ZVDhO7.js";import"./loader-circle-Gvin8XfJ.js";import"./circle-check-DCmJN5wl.js";import"./circle-DpwOGgHv.js";import"./clock-B0JpVC35.js";import"./types-C9wiu8_K.js";import"./check-CRJ-IjN3.js";import"./triangle-alert-Dm0wF2yY.js";import"./index-BFsSXW-H.js";import"./index-CE6eAAS9.js";import"./index-D_t__hLD.js";import"./skeleton-AJqgeGjH.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=Ze("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),ve=[{value:"deadline",label:"Prazo (mais próximo)"},{value:"priority",label:"Prioridade (Alta → Baixa)"},{value:"title",label:"Título (A → Z)"},{value:"client",label:"Cliente (A → Z)"}],Ne={alta:0,media:1,baixa:2};function Ce(i,a){return[...i].sort((n,o)=>{switch(a){case"deadline":return!n.dueDate&&!o.dueDate?0:n.dueDate?o.dueDate?n.dueDate.localeCompare(o.dueDate):-1:1;case"priority":return(Ne[n.priority]??1)-(Ne[o.priority]??1);case"title":return n.title.localeCompare(o.title,"pt-BR");case"client":return(n.client??"").localeCompare(o.client??"","pt-BR");default:return 0}})}const Ys={client:!0,dueDate:!0,priority:!0,subtasks:!0,tags:!0,description:!1},Te={client:"Cliente",dueDate:"Data de entrega",priority:"Prioridade",subtasks:"Subtarefas",tags:"Tags",description:"Descrição"},q=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],ae=t.memo(function({task:a,cardFields:n,today:o,isExpanded:f,onToggleExpand:j,onToggleSubtask:b,onEdit:p,onDelete:N,showStatus:C,isDragging:T,isOverlay:h}){const u=a.subtasks.filter(c=>c.completed).length,S=a.subtasks.length,y=S>0?Math.round(u/S*100):0,D=a.dueDate&&a.dueDate<o&&a.status!=="concluida"&&a.status!=="cancelada";return e.jsx(ke,{className:w("transition-shadow duration-150",T&&"opacity-40",h&&"shadow-xl ring-2 ring-primary/30 rotate-[2deg]",D&&"border-destructive/50"),children:e.jsxs(we,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[!h&&e.jsx(cs,{className:"w-4 h-4 text-muted-foreground mt-0.5 shrink-0 cursor-grab active:cursor-grabbing"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[n.priority&&e.jsx(V,{variant:"secondary",className:`text-[10px] ${Ps[a.priority]}`,children:te[a.priority]}),C&&e.jsx(V,{variant:"secondary",className:`text-[10px] ${ye[a.status]}`,children:W[a.status]}),D&&e.jsx(V,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),n.description&&a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:[n.client&&a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fs,{className:"w-3 h-3"}),a.client]}),n.dueDate&&a.dueDate&&e.jsxs("span",{className:w("flex items-center gap-1",D&&"text-destructive font-medium"),children:[e.jsx(Ms,{className:"w-3 h-3"}),new Date(a.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})]})]}),!h&&e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(v,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>p==null?void 0:p(a),children:e.jsx(Ks,{className:"w-3.5 h-3.5"})}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>N(a.id),children:e.jsx(Vs,{className:"w-3.5 h-3.5"})})]})]}),n.subtasks&&S>0&&!h&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",onClick:()=>j(a.id),children:[f?e.jsx(zs,{className:"w-3 h-3"}):e.jsx(Us,{className:"w-3 h-3"}),e.jsxs("span",{children:[u,"/",S," subtarefas"]}),e.jsx("div",{className:"flex-1 mx-2 bg-muted rounded-full h-1.5",children:e.jsx("div",{className:"bg-primary rounded-full h-1.5 transition-all",style:{width:`${y}%`}})}),e.jsxs("span",{className:"text-[10px]",children:[y,"%"]})]}),f&&e.jsx("div",{className:"mt-2 space-y-1 pl-4",children:a.subtasks.map(c=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-muted/50 rounded p-1 -ml-1",children:[e.jsx(ks,{checked:c.completed,onCheckedChange:()=>b(a.id,c.id)}),e.jsx("span",{className:w(c.completed&&"line-through text-muted-foreground"),children:c.title})]},c.id))})]}),n.tags&&a.tags&&a.tags.length>0&&!h&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:a.tags.map(c=>e.jsx(V,{variant:"outline",className:"text-[10px]",children:c},c))})]})})});function Hs(i){const{attributes:a,listeners:n,setNodeRef:o,transform:f,transition:j,isDragging:b}=ps({id:i.task.id}),p={transform:hs.Transform.toString(f),transition:j};return e.jsx("div",{ref:o,style:p,...a,...n,children:e.jsx(ae,{...i,isDragging:b})})}function Gs({status:i,tasks:a,isOver:n,cardFields:o,today:f,expandedTasks:j,onToggleExpand:b,onToggleSubtask:p,onEdit:N,onDelete:C}){const T=t.useMemo(()=>a.map(u=>u.id),[a]),{setNodeRef:h}=ds({id:i});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(V,{variant:"secondary",className:ye[i],children:W[i]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.length,")"]})]}),e.jsx("div",{ref:h,"data-column-status":i,className:w("space-y-3 min-h-[400px] p-2 rounded-lg transition-colors duration-150",n?"bg-primary/10 border-2 border-dashed border-primary/40":"bg-muted/30 border-2 border-transparent"),children:e.jsx(ms,{items:T,strategy:us,children:a.length===0?e.jsx("p",{className:w("text-xs text-center py-8 transition-colors",n?"text-primary font-medium":"text-muted-foreground"),children:n?"↓ Soltar aqui":"Vazio"}):a.map(u=>e.jsx(Hs,{task:u,cardFields:o,today:f,isExpanded:j.has(u.id),onToggleExpand:b,onToggleSubtask:p,onEdit:N,onDelete:C},u.id))})})]})}function Mt(){var ge;const{tasks:i,setTasks:a,loading:n,syncing:o,error:f,lastSync:j,sync:b,updateTaskStatus:p,deleteTask:N,createTask:C,updateTask:T,createSubtask:h,updateSubtask:u,deleteSubtask:S}=qe(),{projects:y}=We(),[D,c]=t.useState(!1),[De,re]=t.useState(null),[d,z]=t.useState([]),[A,ne]=t.useState("kanban"),[I,le]=t.useState(""),[L,ie]=t.useState("all"),[P,oe]=t.useState("all"),[E,ce]=t.useState("all"),[O,de]=t.useState("all"),[me,Ae]=t.useState(new Set),[U,Ie]=t.useState(Ys),[$,J]=t.useState(null),[Le,Y]=t.useState(null),[k,Pe]=t.useState("deadline"),[Q,Ee]=t.useState(!1);t.useEffect(()=>{i.length>0&&z(i)},[i]);const Oe=t.useMemo(()=>[...new Set(d.map(s=>s.client).filter(Boolean))],[d]),H=t.useMemo(()=>{const s=d.filter(r=>!(I&&!r.title.toLowerCase().includes(I.toLowerCase())||L!=="all"&&r.status!==L||P!=="all"&&r.priority!==P||E!=="all"&&r.client!==E||O!=="all"&&r.projectId!==O));return Ce(s,k)},[d,I,L,P,E,O,k]),ue=t.useMemo(()=>$?d.find(s=>s.id===$):null,[$,d]),X=t.useMemo(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},[]),xe=t.useCallback(s=>{Ae(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},[]),pe=t.useCallback((s,r)=>{z(l=>l.map(m=>m.id===s?{...m,subtasks:m.subtasks.map(x=>x.id===r?{...x,completed:!x.completed}:x)}:m))},[]),[R,G]=t.useState(null),Re=t.useCallback(async()=>{R&&(N(R),z(s=>s.filter(r=>r.id!==R)),G(null))},[R,N]),Be=t.useCallback(s=>{Ie(r=>({...r,[s]:!r[s]}))},[]),_e=t.useCallback(()=>{re(null),c(!0)},[]),he=t.useCallback(s=>{re(s),c(!0)},[]),Fe=t.useCallback(async(s,r,l)=>{r?await C({title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description}):l&&await T(l,{title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description})},[C,T]),Me=ss(ts(xs,{activationConstraint:{distance:8}}));t.useCallback(s=>{const r=d.find(l=>l.id===s);return r==null?void 0:r.status},[d]);const Ke=t.useCallback(s=>{J(s.active.id)},[]),Ve=t.useCallback(s=>{const{over:r}=s;if(!r){Y(null);return}const l=r.id,m=d.find(B=>B.id===l),x=m?m.status:q.includes(l)?l:null;Y(x)},[d]),ze=t.useCallback(s=>{const{active:r,over:l}=s;if(J(null),Y(null),!l)return;const m=r.id,x=l.id;if(m===x)return;const B=d.find(_=>_.id===m);if(!B)return;const fe=d.find(_=>_.id===x),ee=fe?fe.status:q.includes(x)?x:B.status;B.status!==ee&&(z(_=>{const Ge=_.map(se=>se.id===m?{...se,status:ee}:se);return Ce(Ge,k)}),p(m,ee))},[d,p,k]),Ue=t.useCallback(()=>{J(null),Y(null)},[]),$e=t.useMemo(()=>{const s={};return q.forEach(r=>{s[r]=[]}),H.forEach(r=>{s[r.status]&&s[r.status].push(r)}),s},[H]),[Ye,He]=t.useState("tarefas");return e.jsx(Je,{title:"",children:e.jsxs(ys,{value:Ye,onValueChange:He,className:"w-full",children:[e.jsxs(Ds,{className:"mb-4",children:[e.jsx(be,{value:"tarefas",children:"Tarefas"}),e.jsx(be,{value:"subtarefas",children:"Subtarefas"})]}),e.jsxs(Se,{value:"tarefas",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Bs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(Ts,{placeholder:"Buscar tarefa...",value:I,onChange:s=>le(s.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(v,{variant:A==="list"?"default":"ghost",size:"sm",onClick:()=>ne("list"),className:"rounded-none",children:e.jsx(_s,{className:"w-4 h-4"})}),e.jsx(v,{variant:A==="kanban"?"default":"ghost",size:"sm",onClick:()=>ne("kanban"),className:"rounded-none",children:e.jsx(as,{className:"w-4 h-4"})})]}),A==="kanban"&&e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-muted-foreground cursor-pointer select-none",children:[e.jsx(je,{checked:Q,onCheckedChange:Ee,className:"scale-75"}),"Ocultar concluídas"]}),e.jsx(Es,{syncing:o,lastSync:j,onSync:b,error:f}),e.jsxs(v,{size:"sm",onClick:_e,className:"gap-1.5",children:[e.jsx(Qe,{className:"w-4 h-4"})," Nova Tarefa"]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(F,{value:L,onValueChange:ie,children:[e.jsx(M,{className:"w-[130px] h-8 text-xs",children:e.jsx(Z,{placeholder:"Status"})}),e.jsxs(K,{children:[e.jsx(g,{value:"all",children:"Todos"}),Object.keys(W).map(s=>e.jsx(g,{value:s,children:W[s]},s))]})]}),e.jsxs(F,{value:P,onValueChange:oe,children:[e.jsx(M,{className:"w-[110px] h-8 text-xs",children:e.jsx(Z,{placeholder:"Prioridade"})}),e.jsxs(K,{children:[e.jsx(g,{value:"all",children:"Todas"}),Object.keys(te).map(s=>e.jsx(g,{value:s,children:te[s]},s))]})]}),e.jsxs(F,{value:E,onValueChange:ce,children:[e.jsx(M,{className:"w-[140px] h-8 text-xs",children:e.jsx(Z,{placeholder:"Cliente"})}),e.jsxs(K,{children:[e.jsx(g,{value:"all",children:"Todos"}),Oe.map(s=>e.jsx(g,{value:s,children:s},s))]})]}),e.jsxs(F,{value:O,onValueChange:de,children:[e.jsxs(M,{className:"w-[150px] h-8 text-xs",children:[e.jsx(Xe,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx(Z,{placeholder:"Projeto"})]}),e.jsxs(K,{children:[e.jsx(g,{value:"all",children:"Todos"}),y.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))]})]}),e.jsxs(F,{value:k,onValueChange:s=>Pe(s),children:[e.jsxs(M,{className:"w-[44px] sm:w-[170px] h-8 text-xs gap-1.5",children:[e.jsx(rs,{className:"w-3.5 h-3.5 shrink-0 text-muted-foreground"}),e.jsx("span",{className:"hidden sm:inline truncate",children:(ge=ve.find(s=>s.value===k))==null?void 0:ge.label})]}),e.jsx(K,{children:ve.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]}),e.jsxs(As,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",className:"gap-1.5 h-8 text-xs",children:[e.jsx($s,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Campos"})]})}),e.jsx(Ls,{className:"w-56",align:"end",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Mostrar nos cards"}),Object.keys(Te).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx(ws,{htmlFor:`field-${s}`,className:"text-sm cursor-pointer",children:Te[s]}),e.jsx(je,{id:`field-${s}`,checked:U[s],onCheckedChange:()=>Be(s)})]},s))]})})]}),(L!=="all"||P!=="all"||E!=="all"||O!=="all"||I)&&e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>{ie("all"),oe("all"),ce("all"),de("all"),le("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]}),e.jsx(es,{open:D,onOpenChange:c,task:De,onSave:Fe,onCreateSubtask:h,onUpdateSubtask:u,onDeleteSubtask:S}),e.jsx(gs,{open:!!R,onOpenChange:s=>!s&&G(null),children:e.jsxs(fs,{children:[e.jsxs(js,{children:[e.jsx(bs,{children:"Remover tarefa?"}),e.jsx(Ss,{children:"Esta ação não pode ser desfeita. A tarefa será removida permanentemente do Airtable e do banco local."})]}),e.jsxs(vs,{children:[e.jsx(Ns,{children:"Cancelar"}),e.jsx(Cs,{onClick:Re,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),n?A==="list"?e.jsx(Os,{}):e.jsx(Rs,{}):A==="list"?e.jsx("div",{className:"space-y-3",children:H.length===0?e.jsx(ke,{children:e.jsx(we,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):H.map(s=>e.jsx(ae,{task:s,cardFields:U,today:X,isExpanded:me.has(s.id),onToggleExpand:xe,onToggleSubtask:pe,onEdit:he,onDelete:G,showStatus:!0},s.id))}):e.jsxs(ns,{sensors:Me,collisionDetection:ls,onDragStart:Ke,onDragOver:Ve,onDragEnd:ze,onDragCancel:Ue,children:[e.jsx("div",{className:w("grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",Q?"xl:grid-cols-4":"xl:grid-cols-6"),children:q.filter(s=>!Q||s!=="concluida"&&s!=="cancelada").map(s=>e.jsx(Gs,{status:s,tasks:$e[s],isOver:Le===s&&$!==null,cardFields:U,today:X,expandedTasks:me,onToggleExpand:xe,onToggleSubtask:pe,onEdit:he,onDelete:G},s))}),e.jsx(is,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:ue?e.jsx("div",{className:"w-[260px]",children:e.jsx(ae,{task:ue,cardFields:U,today:X,isExpanded:!1,onToggleExpand:()=>{},onToggleSubtask:()=>{},onDelete:()=>{},isOverlay:!0})}):null})]})]}),e.jsx(Se,{value:"subtarefas",children:e.jsx(os,{tasks:d,projects:y,loading:n,onCreateSubtask:h,onUpdateSubtask:u,onDeleteSubtask:S})})]})})}export{Mt as default};
