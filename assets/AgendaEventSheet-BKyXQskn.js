import{r as A,aj as _,ak as z,j as e}from"./index-Bs5i4_Nx.js";import{u as O,F as B,a as c,b as i,c as r,d,e as m,t as k}from"./form-CGE2muSX.js";import{S as D,a as H,b as M,c as R,f as U,g as Y}from"./AdminLayout-ByII4lUl.js";import{I as p}from"./input-BcLYvidQ.js";import{B as E}from"./button-ChJCpspy.js";import{T as G}from"./textarea-DLQn4WKq.js";import{S as f,a as b,b as g,d as T,e as j}from"./select-B_mHtC95.js";import{a as q,c as J}from"./crmTypes-DtRnJ06N.js";import{L as K}from"./loader-circle-Bz0xf6ed.js";import{o as Q,s as l,e as L}from"./types-C9wiu8_K.js";const W=Q({title:l().trim().min(1,"Título obrigatório").max(200),date:l().min(1,"Data obrigatória"),time:l().optional(),endTime:l().optional(),type:L(["reuniao","audiencia","prazo","consulta","lembrete","outro"]),status:L(["confirmado","pendente","cancelado","reagendado"]),clientId:l().optional(),clientName:l().optional(),projectId:l().optional(),location:l().max(300).optional(),description:l().max(2e3).optional()}),X=Object.entries(q),Z=Object.entries(J);function ce({open:C,onOpenChange:N,event:t,defaultClientName:w,onSave:V}){const u=!t,[y,I]=A.useState(!1),{clients:x}=_(),{projects:S}=z(),a=O({resolver:k(W),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});A.useEffect(()=>{if(C)if(t){const s=x.find(n=>{var h;return n.name.toLowerCase()===((h=t.client)==null?void 0:h.toLowerCase())}),o=S.find(n=>{var h;return n.name.toLowerCase()===((h=t.client)==null?void 0:h.toLowerCase())});a.reset({title:t.title,date:t.date,time:t.time??"",endTime:t.endTime??"",type:t.type,status:t.status,clientId:(s==null?void 0:s.id)??"",clientName:t.client??"",projectId:(o==null?void 0:o.id)??"",location:t.location??"",description:t.description??""})}else{const s=w??"",o=x.find(n=>n.name.toLowerCase()===s.toLowerCase());a.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:(o==null?void 0:o.id)??"",clientName:s,projectId:"",location:"",description:""})}},[C,t,x,S]);const F=s=>{const o=x.find(n=>n.id===s);a.setValue("clientId",s),a.setValue("clientName",(o==null?void 0:o.name)??"")},v=s=>{if(a.setValue("projectId",s),!a.getValues("clientName")&&s!=="none"){const o=S.find(n=>n.id===s);o&&a.setValue("clientName",o.name)}},P=async s=>{I(!0);try{const o=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await V({...s,projectAirtableId:o},u),N(!1)}finally{I(!1)}};return e.jsx(D,{open:C,onOpenChange:N,children:e.jsxs(H,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(M,{className:"mb-6",children:[e.jsx(R,{children:u?"Novo Compromisso":"Editar Compromisso"}),e.jsx(U,{children:u?"Preencha os dados e salve para criar o compromisso no banco e sincronizar com o Airtable.":"Altere os campos e salve. A atualização será sincronizada com o Airtable automaticamente."})]}),e.jsx(B,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(P),className:"space-y-5",children:[e.jsx(c,{control:a.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Título *"}),e.jsx(d,{children:e.jsx(p,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{control:a.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Data *"}),e.jsx(d,{children:e.jsx(p,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"time",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Hora início"}),e.jsx(d,{children:e.jsx(p,{type:"time",...s})}),e.jsx(m,{})]})})]}),e.jsx(c,{control:a.control,name:"endTime",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Hora término"}),e.jsx(d,{children:e.jsx(p,{type:"time",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(c,{control:a.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Tipo *"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(b,{children:e.jsx(g,{})})}),e.jsx(T,{children:X.map(([o,n])=>e.jsx(j,{value:o,children:n},o))})]}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Status *"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(b,{children:e.jsx(g,{})})}),e.jsx(T,{children:Z.map(([o,n])=>e.jsx(j,{value:o,children:n},o))})]}),e.jsx(m,{})]})})]}),e.jsxs(i,{children:[e.jsx(r,{children:"Projeto (Airtable)"}),e.jsxs(f,{onValueChange:v,value:a.watch("projectId")||"",children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Selecione um projeto..."})}),e.jsxs(T,{children:[e.jsx(j,{value:"none",children:"— Sem projeto —"}),S.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(i,{children:[e.jsx(r,{children:"Cliente"}),e.jsxs(f,{onValueChange:F,value:a.watch("clientId")||"",children:[e.jsx(b,{children:e.jsx(g,{placeholder:"Selecione um cliente..."})}),e.jsxs(T,{children:[e.jsx(j,{value:"none",children:"— Sem cliente —"}),x.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))]})]})]}),e.jsx(c,{control:a.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Local / Link"}),e.jsx(d,{children:e.jsx(p,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(r,{children:"Descrição / Observações"}),e.jsx(d,{children:e.jsx(G,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(m,{})]})}),e.jsxs(Y,{className:"pt-2 gap-2",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:y,children:"Cancelar"}),e.jsxs(E,{type:"submit",disabled:y,children:[y&&e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),u?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{ce as A};
