import{r as u,E as M,j as e}from"./index-DCAdrInU.js";import{A as R}from"./AdminLayout-62YnYTQF.js";import{B as h}from"./button-ByvqCem7.js";import{C,a as b,b as w,c as E}from"./card-Cf45HqUS.js";import{T as z,a as B,b as j,c as d,d as F,e as n,A as _,f as q,g as O,h as V,i as G,j as J,k as K,l as Q}from"./alert-dialog-3wZCFKON.js";import{S as o}from"./skeleton-sHoGxo5I.js";import{b as U,g as W,h as X,i as Y}from"./useNewsletter-T7EiK-on.js";import"./chevron-left-Cwkf9z3z.js";import"./mail-CrCEVdnX.js";import"./index-B2AcA7Qf.js";import"./Combination-Bp9VShgW.js";import"./useMutation-DC1xNDEr.js";const y={draft:"Rascunho",queued:"Fila",sending:"Enviando",sent:"Enviada",partial:"Parcial",failed:"Falhou"},Z={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},A=a=>a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",me=()=>{const{data:a,isLoading:S}=U(),[p,g]=u.useState(null),[f,v]=u.useState(null),[c,m]=u.useState(null),{toast:x}=M(),D=W(),l=X(),{data:i,isLoading:T}=Y(p),t=(i==null?void 0:i.campaign)??null,N=i==null?void 0:i.deliveryCounts,L=u.useMemo(()=>((a==null?void 0:a.length)??0)>0,[a]),k=s=>["draft","queued","partial"].includes(s),H=async s=>{v(s);try{await D.mutateAsync(s),x({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(r){const P=r instanceof Error?r.message:"Não foi possível iniciar o envio.";x({title:"Erro ao enviar",description:P,variant:"destructive"})}finally{v(null)}},I=async()=>{if(c)try{await l.mutateAsync(c),x({title:"Campanha excluída",description:"A campanha foi removida com sucesso."}),p===c&&g(null)}catch(s){const r=s instanceof Error?s.message:"Não foi possível excluir a campanha.";x({title:"Erro ao excluir",description:r,variant:"destructive"})}finally{m(null)}};return e.jsxs(R,{title:"Campanhas de Newsletter",children:[e.jsxs(C,{className:"mb-6",children:[e.jsx(b,{children:e.jsx(w,{children:"Campanhas"})}),e.jsx(E,{children:S?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"})]}):e.jsxs(z,{children:[e.jsx(B,{children:e.jsxs(j,{children:[e.jsx(d,{children:"Assunto"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Criado em"}),e.jsx(d,{children:"Enviado em"}),e.jsx(d,{className:"text-right",children:"Ações"})]})}),e.jsx(F,{children:L?a==null?void 0:a.map(s=>e.jsxs(j,{children:[e.jsx(n,{className:"font-medium",children:s.subject}),e.jsx(n,{children:y[s.status]??s.status}),e.jsx(n,{children:A(s.created_at)}),e.jsx(n,{children:A(s.sent_at)}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[k(s.status)&&e.jsx(h,{variant:"default",size:"sm",onClick:()=>H(s.id),disabled:f===s.id,children:f===s.id?"Enviando...":"Enviar agora"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>g(s.id),children:"Ver detalhes"}),e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(s.id),disabled:l.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(j,{children:e.jsx(n,{colSpan:5,className:"text-center text-muted-foreground py-8",children:'Nenhuma campanha cadastrada ainda. As campanhas são criadas automaticamente ao publicar posts com a opção "Enviar newsletter" ativada.'})})})]})})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(w,{children:"Detalhes da campanha"})}),e.jsx(E,{children:T?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-6 w-1/2"}),e.jsx(o,{className:"h-24 w-full"})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3",children:e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(t.id),disabled:l.isPending,children:"Excluir campanha"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assunto"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:t.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:y[t.status]??t.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Post relacionado"}),t.post?e.jsxs("div",{className:"text-base font-medium text-foreground",children:[t.post.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["/blog/",t.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resumo de envios"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mt-2",children:Object.entries(Z).map(([s,r])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:N?N[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview HTML"}),e.jsx("div",{className:"mt-2 max-h-[320px] overflow-auto rounded-lg border border-border bg-background p-4",children:t.html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:t.html}}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem conteúdo HTML."})})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma campanha para ver os detalhes."})})]}),e.jsx(_,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(q,{children:[e.jsxs(O,{children:[e.jsx(V,{children:"Excluir campanha?"}),e.jsx(G,{children:"Esta ação remove a campanha e seu histórico de envios. Essa ação não pode ser desfeita."})]}),e.jsxs(J,{children:[e.jsx(K,{children:"Cancelar"}),e.jsx(Q,{onClick:I,disabled:l.isPending,children:l.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{me as default};
