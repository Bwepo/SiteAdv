import{r as F,j as e}from"./index-DYRYbjUF.js";import{u as P,F as B,a as l,b as r,c as n,d as c,e as d,t as D}from"./form-B55I7jxE.js";import{S as M,b as O,c as R,d as _,e as G,f as q}from"./sheet-Db29pi5c.js";import{I as p}from"./input-DqSQfazl.js";import{B as C}from"./button-DwUST09_.js";import{T as J}from"./textarea-gsFl6mOS.js";import{S as y,a as N,b as I,c as T,d as b}from"./select-DrstghLR.js";import{f as K,b as Q}from"./crmTypes-CFtULajH.js";import{u as U}from"./useCrmFieldOptions-C7FiH8ko.js";import{C as W}from"./ClientSelect-B5e9FdZe.js";import{T as X}from"./trash-2-BJFk482R.js";import{L as Y}from"./loader-circle-M0bx847p.js";import{o as Z,s as i}from"./types-C9wiu8_K.js";const $=Z({title:i().trim().min(1,"Título obrigatório").max(200),date:i().min(1,"Data obrigatória"),time:i().optional(),endTime:i().optional(),type:i().min(1),status:i().min(1),clientId:i().optional(),clientName:i().optional(),projectId:i().optional(),location:i().max(300).optional(),description:i().max(2e3).optional()});function xe({open:g,onOpenChange:h,event:o,defaultClientName:L,onSave:V,onDelete:w}){const j=!o,[u,v]=F.useState(!1),{clients:S}=K(),{projects:f}=Q(),{getOptions:A}=U(),E=A("agenda_tipo"),z=A("agenda_status"),a=P({resolver:D($),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});F.useEffect(()=>{if(g)if(o){const s=S.find(m=>{var x;return m.name.toLowerCase()===((x=o.client)==null?void 0:x.toLowerCase())}),t=f.find(m=>{var x;return m.name.toLowerCase()===((x=o.client)==null?void 0:x.toLowerCase())});a.reset({title:o.title,date:o.date,time:o.time??"",endTime:o.endTime??"",type:o.type,status:o.status,clientId:(s==null?void 0:s.id)??"",clientName:o.client??"",projectId:(t==null?void 0:t.id)??"",location:o.location??"",description:o.description??""})}else{const s=L??"",t=S.find(m=>m.name.toLowerCase()===s.toLowerCase());a.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:(t==null?void 0:t.id)??"",clientName:s,projectId:"",location:"",description:""})}},[g,o,S,f]);const k=s=>{if(a.setValue("projectId",s),!a.getValues("clientName")&&s!=="none"){const t=f.find(m=>m.id===s);t&&a.setValue("clientName",t.name)}},H=async s=>{v(!0);try{const t=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await V({...s,projectAirtableId:t},j),h(!1)}finally{v(!1)}};return e.jsx(M,{open:g,onOpenChange:h,children:e.jsxs(O,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(R,{className:"mb-6",children:[e.jsx(_,{children:j?"Novo Compromisso":"Editar Compromisso"}),e.jsx(G,{children:j?"Preencha os dados e salve para criar o compromisso no banco e sincronizar com o Airtable.":"Altere os campos e salve. A atualização será sincronizada com o Airtable automaticamente."})]}),e.jsx(B,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(H),className:"space-y-5",children:[e.jsx(l,{control:a.control,name:"title",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Título *"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:a.control,name:"date",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Data *"}),e.jsx(c,{children:e.jsx(p,{type:"date",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"time",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Hora início"}),e.jsx(c,{children:e.jsx(p,{type:"time",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:a.control,name:"endTime",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Hora término"}),e.jsx(c,{children:e.jsx(p,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:a.control,name:"type",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Tipo *"}),e.jsxs(y,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(I,{})})}),e.jsx(T,{children:E.map(t=>e.jsx(b,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"status",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Status *"}),e.jsxs(y,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(I,{})})}),e.jsx(T,{children:z.map(t=>e.jsx(b,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})})]}),e.jsxs(r,{children:[e.jsx(n,{children:"Projeto (Airtable)"}),e.jsxs(y,{onValueChange:k,value:a.watch("projectId")||"",children:[e.jsx(N,{children:e.jsx(I,{placeholder:"Selecione um projeto..."})}),e.jsxs(T,{children:[e.jsx(b,{value:"none",children:"— Sem projeto —"}),f.map(s=>e.jsx(b,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(r,{children:[e.jsx(n,{children:"Cliente"}),e.jsx(W,{value:a.watch("clientName")||"",onValueChange:(s,t)=>{a.setValue("clientName",s),a.setValue("clientId",t)}})]}),e.jsx(l,{control:a.control,name:"location",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Local / Link"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Descrição / Observações"}),e.jsx(c,{children:e.jsx(J,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsxs(q,{className:"pt-2 gap-2 flex-col sm:flex-row",children:[!j&&o&&w&&e.jsxs(C,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{w(o.id),h(!1)},disabled:u,children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Excluir"]}),e.jsx(C,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:u,children:"Cancelar"}),e.jsxs(C,{type:"submit",disabled:u,children:[u&&e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),j?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{xe as A};
