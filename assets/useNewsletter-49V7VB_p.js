import{a as o,u as l}from"./skeleton-BqsjbR3P.js";import{ad as b,ac as a}from"./index-CIJIYq35.js";function y(){const t=b();return o({mutationFn:async e=>{const{data:s,error:r}=await a.from("mladv_newsletter_subscribers").insert({email:e.email,name:e.name||null,source:e.source||"website"}).select().single();if(r)throw r;return s},onSuccess:()=>{t.invalidateQueries({queryKey:["newsletter-subscribers"]}),t.invalidateQueries({queryKey:["newsletter-stats"]})}})}function f(){return l({queryKey:["newsletter-subscribers"],queryFn:async()=>{const{data:t,error:e}=await a.from("mladv_newsletter_subscribers").select("*").order("subscribed_at",{ascending:!1});if(e)throw e;return t||[]}})}function _(){return l({queryKey:["newsletter-stats"],queryFn:async()=>{const{data:t,error:e,count:s}=await a.from("mladv_newsletter_subscribers").select("*",{count:"exact"}).is("unsubscribed_at",null);if(e)throw e;const r=new Date;r.setDate(r.getDate()-7);const i=(t||[]).filter(u=>new Date(u.subscribed_at)>=r).length;return{total:s||0,active:s||0,newThisWeek:i}}})}function v(){const t=b();return o({mutationFn:async e=>{const{error:s}=await a.from("mladv_newsletter_subscribers").delete().eq("id",e);if(s)throw s},onSuccess:()=>{t.invalidateQueries({queryKey:["newsletter-subscribers"]}),t.invalidateQueries({queryKey:["newsletter-stats"]})}})}function p(){return o({mutationFn:async()=>{const{data:t,error:e}=await a.from("mladv_newsletter_subscribers").select("email, name, subscribed_at").is("unsubscribed_at",null).order("subscribed_at",{ascending:!1});if(e)throw e;const s=["Email","Nome","Data de Inscrição"],r=(t||[]).map(n=>[n.email,n.name||"",new Date(n.subscribed_at).toLocaleDateString("pt-BR")]),i=[s.join(","),...r.map(n=>n.map(w=>`"${w}"`).join(","))].join(`
`),u=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");return c.href=URL.createObjectURL(u),c.download=`newsletter-subscribers-${new Date().toISOString().split("T")[0]}.csv`,c.click(),i}})}export{f as a,_ as b,v as c,p as d,y as u};
