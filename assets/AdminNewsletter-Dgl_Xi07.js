import{a as W,r as T,E as Y,j as e,m as p}from"./index-C8cajgxC.js";import{A as Z}from"./AdminLayout-CBDTzeR9.js";import{B as g}from"./button-BbrME41E.js";import{I as b}from"./input-ylA7ACoQ.js";import{C as d,a as f,b as N,c as m}from"./card-DSFPd3C1.js";import{T as $,a as ee,b as v,c as x,d as se,e as i}from"./table-DY84Ibmu.js";import{A as L,h as I,a as R,b as B,c as M,d as F,e as H,f as q,g as O}from"./alert-dialog-C2BV42My.js";import{S as n}from"./skeleton-BLS7NcCS.js";import{a as ae,b as te,u as ie,c as re,d as ne}from"./useNewsletter-Q1hmPoOg.js";import{D as P}from"./download-OinbTKsx.js";import{L as U}from"./loader-circle-BrEiM6Ks.js";import{S as oe}from"./search-CK5kGpwr.js";import{M as _}from"./ThemeToggle-BIhgdhHs.js";import{C as z}from"./calendar-Cd6bH2yR.js";import{T as V}from"./trash-2-rTOBV81R.js";import"./chevron-left-kEICEdwe.js";import"./index-CrfCcQFz.js";import"./Combination-C_MFA-4S.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=W("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=W("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),De=()=>{const[c,G]=T.useState(""),{toast:r}=Y(),{data:o,isLoading:E}=ae(),{data:l}=te(),h=ie(),J=re(),w=ne(),[j,u]=T.useState({name:"",email:""}),a=o==null?void 0:o.filter(s=>s.email.toLowerCase().includes(c.toLowerCase())||s.name&&s.name.toLowerCase().includes(c.toLowerCase())),k=async s=>{try{await J.mutateAsync(s),r({title:"Inscrito removido",description:"O inscrito foi removido da lista."})}catch{r({title:"Erro",description:"Não foi possível remover o inscrito.",variant:"destructive"})}},K=async()=>{try{await w.mutateAsync(),r({title:"Exportação concluída",description:"O arquivo CSV foi baixado com sucesso."})}catch{r({title:"Erro",description:"Não foi possível exportar a lista.",variant:"destructive"})}},Q=async s=>{s.preventDefault();const t=j.email.trim(),S=j.name.trim()||void 0;if(!t){r({title:"E-mail obrigatório",description:"Informe o e-mail do inscrito para adicionar.",variant:"destructive"});return}try{await h.mutateAsync({email:t,name:S,source:"admin"}),u({name:"",email:""}),r({title:"Inscrito adicionado",description:"O usuário foi incluído na lista de newsletter."})}catch(y){const C=y instanceof Error?y.message:String(y);if(C.toLowerCase().includes("duplicate")){r({title:"Inscrito já existe",description:"Este e-mail já está cadastrado na newsletter.",variant:"destructive"});return}if(C.toLowerCase().includes("row-level security"))try{await h.mutateAsync({email:t,name:S,source:"website"}),u({name:"",email:""}),r({title:"Inscrito adicionado",description:"Inscrito criado com origem website porque o usuário não está cadastrado como admin no Supabase."});return}catch(A){const X=A instanceof Error?A.message:String(A);r({title:"Erro ao adicionar",description:X||"Não foi possível adicionar o inscrito.",variant:"destructive"});return}r({title:"Erro ao adicionar",description:C||"Não foi possível adicionar o inscrito.",variant:"destructive"})}},D=s=>new Date(s).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs(Z,{title:"Newsletter",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-8",children:[e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:e.jsxs(d,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total de Inscritos"}),e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(l==null?void 0:l.total)??e.jsx(n,{className:"h-8 w-16"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Inscritos ativos na newsletter"})]})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(d,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Novos esta Semana"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["+",(l==null?void 0:l.newThisWeek)??e.jsx(n,{className:"h-8 w-12 inline-block"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Últimos 7 dias"})]})]})}),e.jsx(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(d,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Exportar Lista"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsxs(g,{variant:"outline",size:"sm",onClick:K,disabled:w.isPending||!(o!=null&&o.length),children:[w.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),"Baixar CSV"]})})]})})]}),e.jsxs(d,{className:"mb-6",children:[e.jsx(f,{children:e.jsx(N,{className:"text-base",children:"Adicionar inscrito manualmente"})}),e.jsx(m,{children:e.jsxs("form",{onSubmit:Q,className:"flex flex-col gap-4 md:flex-row md:items-end",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"newsletter-name",children:"Nome (opcional)"}),e.jsx(b,{id:"newsletter-name",placeholder:"Nome do inscrito",value:j.name,onChange:s=>u(t=>({...t,name:s.target.value})),maxLength:120})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",htmlFor:"newsletter-email",children:"E-mail"}),e.jsx(b,{id:"newsletter-email",type:"email",placeholder:"email@dominio.com",value:j.email,onChange:s=>u(t=>({...t,email:s.target.value})),required:!0,maxLength:255})]}),e.jsx(g,{type:"submit",className:"md:w-48",disabled:h.isPending,children:h.isPending?e.jsx(U,{className:"h-4 w-4 animate-spin"}):"Adicionar inscrito"})]})})]}),e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(b,{placeholder:"Buscar por email ou nome...",value:c,onChange:s=>G(s.target.value),className:"pl-10"})]})}),e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:e.jsx(d,{children:e.jsxs(m,{className:"p-0",children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs($,{children:[e.jsx(ee,{children:e.jsxs(v,{children:[e.jsx(x,{children:"Email"}),e.jsx(x,{children:"Nome"}),e.jsx(x,{children:"Data de Inscrição"}),e.jsx(x,{children:"Origem"}),e.jsx(x,{className:"w-[80px]",children:"Ações"})]})}),e.jsx(se,{children:E?Array.from({length:5}).map((s,t)=>e.jsxs(v,{children:[e.jsx(i,{children:e.jsx(n,{className:"h-4 w-48"})}),e.jsx(i,{children:e.jsx(n,{className:"h-4 w-24"})}),e.jsx(i,{children:e.jsx(n,{className:"h-4 w-32"})}),e.jsx(i,{children:e.jsx(n,{className:"h-4 w-16"})}),e.jsx(i,{children:e.jsx(n,{className:"h-8 w-8"})})]},t)):(a==null?void 0:a.length)===0?e.jsx(v,{children:e.jsxs(i,{colSpan:5,className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:c?"Nenhum inscrito encontrado com esse termo.":"Nenhum inscrito ainda."})]})}):a==null?void 0:a.map(s=>e.jsxs(v,{children:[e.jsx(i,{className:"font-medium",children:s.email}),e.jsx(i,{className:"text-muted-foreground",children:s.name||"—"}),e.jsx(i,{className:"text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),D(s.subscribed_at)]})}),e.jsx(i,{children:e.jsx("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.source})}),e.jsx(i,{children:e.jsxs(L,{children:[e.jsx(I,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(R,{children:[e.jsxs(B,{children:[e.jsx(M,{children:"Remover inscrito?"}),e.jsxs(F,{children:["Esta ação removerá ",s.email," da lista de newsletter. Esta ação não pode ser desfeita."]})]}),e.jsxs(H,{children:[e.jsx(q,{children:"Cancelar"}),e.jsx(O,{onClick:()=>k(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})]})})]},s.id))})]})}),e.jsx("div",{className:"md:hidden p-4 space-y-3",children:E?Array.from({length:3}).map((s,t)=>e.jsx(n,{className:"h-24 w-full"},t)):(a==null?void 0:a.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:c?"Nenhum inscrito encontrado.":"Nenhum inscrito ainda."})]}):a==null?void 0:a.map(s=>e.jsxs("div",{className:"bg-muted/30 rounded-lg border border-border p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.email}),s.name&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.name})]}),e.jsxs(L,{children:[e.jsx(I,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive shrink-0",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(R,{children:[e.jsxs(B,{children:[e.jsx(M,{children:"Remover inscrito?"}),e.jsxs(F,{children:["Esta ação removerá ",s.email," da lista."]})]}),e.jsxs(H,{children:[e.jsx(q,{children:"Cancelar"}),e.jsx(O,{onClick:()=>k(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"h-3 w-3"}),D(s.subscribed_at)]}),e.jsx("span",{className:"bg-muted px-2 py-0.5 rounded",children:s.source})]})]},s.id))})]})})})]})};export{De as default};
