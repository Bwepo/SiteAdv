import{r as v,j as e}from"./index-BQQTb6fi.js";import{u as H,F as O,a as l,b as r,c as n,d as c,e as d,t as P}from"./form-hJojq2nQ.js";import{S as k,b as B,c as M,d as R,e as _,f as G}from"./sheet-4Od2LD5-.js";import{I as x}from"./input-CE2c-gnk.js";import{B as A}from"./button-BYLOxE-2.js";import{T as q}from"./textarea-DR-tS-F2.js";import{S as C,a as y,b as N,c as I,d as u}from"./select-DQAAOv5a.js";import{f as J,b as K}from"./crmTypes-CAMEoS1a.js";import{u as Q}from"./useCrmFieldOptions-C6JGyQjT.js";import{C as U}from"./ClientSelect-lI4Gz5nG.js";import{L as W}from"./loader-circle-xgMqgjFX.js";import{o as X,s as i}from"./types-C9wiu8_K.js";const Y=X({title:i().trim().min(1,"Título obrigatório").max(200),date:i().min(1,"Data obrigatória"),time:i().optional(),endTime:i().optional(),type:i().min(1),status:i().min(1),clientId:i().optional(),clientName:i().optional(),projectId:i().optional(),location:i().max(300).optional(),description:i().max(2e3).optional()});function de({open:f,onOpenChange:b,event:a,defaultClientName:F,onSave:L}){const p=!a,[g,T]=v.useState(!1),{clients:S}=J(),{projects:h}=K(),{getOptions:w}=Q(),V=w("agenda_tipo"),E=w("agenda_status"),o=H({resolver:P(Y),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});v.useEffect(()=>{if(f)if(a){const s=S.find(m=>{var j;return m.name.toLowerCase()===((j=a.client)==null?void 0:j.toLowerCase())}),t=h.find(m=>{var j;return m.name.toLowerCase()===((j=a.client)==null?void 0:j.toLowerCase())});o.reset({title:a.title,date:a.date,time:a.time??"",endTime:a.endTime??"",type:a.type,status:a.status,clientId:(s==null?void 0:s.id)??"",clientName:a.client??"",projectId:(t==null?void 0:t.id)??"",location:a.location??"",description:a.description??""})}else{const s=F??"",t=S.find(m=>m.name.toLowerCase()===s.toLowerCase());o.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:(t==null?void 0:t.id)??"",clientName:s,projectId:"",location:"",description:""})}},[f,a,S,h]);const z=s=>{if(o.setValue("projectId",s),!o.getValues("clientName")&&s!=="none"){const t=h.find(m=>m.id===s);t&&o.setValue("clientName",t.name)}},D=async s=>{T(!0);try{const t=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await L({...s,projectAirtableId:t},p),b(!1)}finally{T(!1)}};return e.jsx(k,{open:f,onOpenChange:b,children:e.jsxs(B,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(M,{className:"mb-6",children:[e.jsx(R,{children:p?"Novo Compromisso":"Editar Compromisso"}),e.jsx(_,{children:p?"Preencha os dados e salve para criar o compromisso no banco e sincronizar com o Airtable.":"Altere os campos e salve. A atualização será sincronizada com o Airtable automaticamente."})]}),e.jsx(O,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(D),className:"space-y-5",children:[e.jsx(l,{control:o.control,name:"title",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Título *"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"date",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Data *"}),e.jsx(c,{children:e.jsx(x,{type:"date",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"time",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Hora início"}),e.jsx(c,{children:e.jsx(x,{type:"time",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:o.control,name:"endTime",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Hora término"}),e.jsx(c,{children:e.jsx(x,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"type",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Tipo *"}),e.jsxs(C,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(y,{children:e.jsx(N,{})})}),e.jsx(I,{children:V.map(t=>e.jsx(u,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"status",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Status *"}),e.jsxs(C,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(y,{children:e.jsx(N,{})})}),e.jsx(I,{children:E.map(t=>e.jsx(u,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})})]}),e.jsxs(r,{children:[e.jsx(n,{children:"Projeto (Airtable)"}),e.jsxs(C,{onValueChange:z,value:o.watch("projectId")||"",children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Selecione um projeto..."})}),e.jsxs(I,{children:[e.jsx(u,{value:"none",children:"— Sem projeto —"}),h.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(r,{children:[e.jsx(n,{children:"Cliente"}),e.jsx(U,{value:o.watch("clientName")||"",onValueChange:(s,t)=>{o.setValue("clientName",s),o.setValue("clientId",t)}})]}),e.jsx(l,{control:o.control,name:"location",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Local / Link"}),e.jsx(c,{children:e.jsx(x,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(n,{children:"Descrição / Observações"}),e.jsx(c,{children:e.jsx(q,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsxs(G,{className:"pt-2 gap-2",children:[e.jsx(A,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:g,children:"Cancelar"}),e.jsxs(A,{type:"submit",disabled:g,children:[g&&e.jsx(W,{className:"w-4 h-4 mr-2 animate-spin"}),p?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{de as A};
