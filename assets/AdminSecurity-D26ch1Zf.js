import{y,r,j as e,E as d}from"./index-DoNos3Vo.js";import{A as P,f as A}from"./AdminLayout-I_rOkXZq.js";import{B as E}from"./button-D87mQ-TS.js";import{C as q,a as z,b as F,d as I,c as L}from"./card-BkHiXjYP.js";import{I as l}from"./input-CpjY_UaW.js";import{L as c}from"./label-ouTMA31U.js";import{T,C as R}from"./triangle-alert-D4gMu4A-.js";import"./index-DXxkaa6A.js";import"./index-Bs5S3k11.js";import"./house-DEjKdd0_.js";import"./menu-C1oiybBT.js";import"./file-text-llzi4XgT.js";const U=[{label:"Pelo menos 8 caracteres",test:a=>a.length>=8},{label:"Uma letra maiúscula",test:a=>/[A-Z]/.test(a)},{label:"Um número",test:a=>/\d/.test(a)},{label:"Um caractere especial",test:a=>/[^A-Za-z0-9]/.test(a)}],O=()=>{const{toast:a}=y(),[i,m]=r.useState(""),[t,u]=r.useState(""),[n,p]=r.useState(""),[h,o]=r.useState(!1),x=r.useMemo(()=>U.map(s=>({...s,valid:s.test(t)})),[t]),j=x.every(s=>s.valid),f=i.trim().length>0&&t.trim().length>0&&n.trim().length>0&&t===n&&j,C=async s=>{var w,g;if(s.preventDefault(),!f){a({title:"Revise os dados",description:"Preencha todos os campos e atenda aos requisitos da senha.",variant:"destructive"});return}o(!0);const{data:v,error:b}=await d.auth.getSession();if(b||!((g=(w=v.session)==null?void 0:w.user)!=null&&g.email)){a({title:"Sessão inválida",description:"Faça login novamente para alterar sua senha.",variant:"destructive"}),o(!1);return}const{error:N}=await d.auth.signInWithPassword({email:v.session.user.email,password:i});if(N){a({title:"Senha atual incorreta",description:"Confira sua senha atual e tente novamente.",variant:"destructive"}),o(!1);return}const{error:S}=await d.auth.updateUser({password:t});S?a({title:"Não foi possível atualizar",description:"Tente novamente em instantes.",variant:"destructive"}):(a({title:"Senha atualizada",description:"Sua senha foi alterada com sucesso."}),m(""),u(""),p("")),o(!1)};return e.jsx(P,{title:"Segurança",children:e.jsx("div",{className:"max-w-2xl",children:e.jsxs(q,{children:[e.jsxs(z,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Alterar senha"]}),e.jsx(I,{children:"Atualize sua senha seguindo as regras de segurança abaixo."})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"current-password",children:"Senha atual"}),e.jsx(l,{id:"current-password",type:"password",autoComplete:"current-password",value:i,onChange:s=>m(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"new-password",children:"Nova senha"}),e.jsx(l,{id:"new-password",type:"password",autoComplete:"new-password",value:t,onChange:s=>u(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"confirm-password",children:"Confirmar nova senha"}),e.jsx(l,{id:"confirm-password",type:"password",autoComplete:"new-password",value:n,onChange:s=>p(s.target.value),required:!0})]}),e.jsx(E,{type:"submit",disabled:!f||h,children:h?"Salvando...":"Atualizar senha"})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),"Requisitos da senha"]}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-muted-foreground",children:x.map(s=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:`h-4 w-4 ${s.valid?"text-emerald-500":"text-muted-foreground/60"}`}),e.jsx("span",{className:s.valid?"text-foreground":void 0,children:s.label})]},s.label))})]})]})]})})})};export{O as default};
