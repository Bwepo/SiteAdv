import{r as i,$ as h,j as e,s as C,h as p}from"./index-DRlkAaou.js";import{c as T}from"./useAirtable-D1dj7Ls_.js";import{B as S}from"./button-DLMKOCBr.js";import{I as f}from"./input-_XQ-klIu.js";import{P as _,a as E,b as A,S as j,c as y,d as L,e as w,f as b}from"./popover-BVRC4BIT.js";import{P as N}from"./badge-CNu_xf_F.js";import{L as v}from"./loader-circle-BmKbPMDk.js";import{S as P}from"./search-Ci7U5frY.js";function O({onClientAdded:r}){const[c,d]=i.useState(!1),[o,n]=i.useState(""),[l,m]=i.useState(!1),u=h(),g=async()=>{if(o.trim()){m(!0);try{const s=o.trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),a=`local_${Date.now()}`,{data:t,error:x}=await C.from("mladv_crm_clientes").insert({nome:o.trim(),slug:s,airtable_id:a}).select().single();if(x)throw x;p.success(`Cliente "${o.trim()}" adicionado!`),u.invalidateQueries({queryKey:["crm","clientes"]}),r==null||r({id:t.airtable_id,name:t.nome}),n(""),d(!1)}catch(s){p.error("Erro ao adicionar cliente: "+s.message)}finally{m(!1)}}};return e.jsxs(_,{open:c,onOpenChange:d,children:[e.jsx(E,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",type:"button",title:"Adicionar cliente",children:e.jsx(N,{className:"h-4 w-4"})})}),e.jsxs(A,{className:"w-64 p-3",align:"end",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Novo Cliente"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{value:o,onChange:s=>n(s.target.value),placeholder:"Nome do cliente",className:"h-8 text-sm",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&g()}),e.jsx(S,{size:"sm",onClick:g,disabled:!o.trim()||l,className:"h-8",children:l?e.jsx(v,{className:"h-3.5 w-3.5 animate-spin"}):"Add"})]})]})]})}function V({value:r,onValueChange:c,matchBy:d="name",placeholder:o="Selecione um cliente..."}){const{clients:n}=T(),[l,m]=i.useState(""),u=i.useMemo(()=>{if(!l.trim())return n;const a=l.toLowerCase();return n.filter(t=>t.name.toLowerCase().includes(a))},[n,l]),g=i.useMemo(()=>{if(!r)return"";if(d==="id")return r;const a=n.find(t=>t.name===r);return(a==null?void 0:a.id)||""},[r,n,d]),s=a=>{if(a==="none"){c("","");return}const t=n.find(x=>x.id===a);c((t==null?void 0:t.name)??"",a)};return e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(j,{value:g||"none",onValueChange:s,children:[e.jsx(y,{children:e.jsx(L,{placeholder:o})}),e.jsxs(w,{children:[e.jsx("div",{className:"px-2 pb-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(P,{className:"absolute left-2 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground"}),e.jsx(f,{value:l,onChange:a=>m(a.target.value),placeholder:"Buscar...",className:"h-8 pl-7 text-sm",onKeyDown:a=>a.stopPropagation()})]})}),e.jsx(b,{value:"none",children:"— Sem cliente —"}),u.map(a=>e.jsx(b,{value:a.id,children:a.name},a.id)),u.length===0&&l.trim()&&e.jsx("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"Nenhum cliente encontrado"})]})]}),e.jsx(O,{onClientAdded:a=>c(a.name,a.id)})]})}const Y={"A fazer":"A fazer","Em andamento":"Em andamento",Concluído:"Concluído"},k={"A fazer":"bg-red-100 text-red-800","Em andamento":"bg-yellow-100 text-yellow-800",Concluído:"bg-green-100 text-green-800"},D={reuniao:"Reunião",audiencia:"Audiência",prazo:"Prazo",consulta:"Consulta",lembrete:"Lembrete",outro:"Outro"},$={confirmado:"Confirmado",pendente:"Pendente",cancelado:"Cancelado",reagendado:"Reagendado"},Q={pendente:"Pendente",agendado:"Agendado",em_andamento:"Em Andamento",em_tramite:"Em Trâmite",concluida:"Concluída",cancelada:"Cancelada"},F={alta:"Alta",media:"Média",baixa:"Baixa"},G={reuniao:"bg-blue-100 text-blue-800",audiencia:"bg-purple-100 text-purple-800",prazo:"bg-red-100 text-red-800",consulta:"bg-green-100 text-green-800",lembrete:"bg-yellow-100 text-yellow-800",outro:"bg-gray-100 text-gray-800"},H={alta:"bg-red-100 text-red-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-green-100 text-green-800"},J={pendente:"bg-red-100 text-red-800",agendado:"bg-slate-100 text-slate-800",em_andamento:"bg-yellow-100 text-yellow-800",em_tramite:"bg-blue-100 text-blue-800",concluida:"bg-green-100 text-green-800",cancelada:"bg-gray-100 text-gray-800"},W=["Mariana Lima","Equipe ML"];export{V as C,G as E,Y as S,H as T,F as a,D as b,$ as c,W as d,k as e,Q as f,J as g};
