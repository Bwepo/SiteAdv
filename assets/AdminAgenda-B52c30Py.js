import{a6 as Me,at as Le,r as o,l as H,j as e,m as $e,e as x}from"./index-C5rdV3ki.js";import{C as w,c as D,a as U,b as Q}from"./card-DeLiqJaA.js";import{B as b}from"./badge-BMLAq-mz.js";import{B as c}from"./button-V3BEsbEG.js";import{I as Be}from"./input-B61CGZ39.js";import{S as W,g as q,h as G,i as J,j as h}from"./form-DG7uB_oU.js";import{A as Pe,a as Oe,b as ze,c as Fe,d as Re,e as Ie,f as Ve,g as _e}from"./alert-dialog-fZtWGPG7.js";import{E as A,a as K,c as M,P as Ye}from"./crmTypes-CSOUCF6B.js";import{S as He}from"./SyncToolbar-BYT4VdAg.js";import{A as Ue,C as Qe}from"./CrmSkeletons-BUdVWqbk.js";import{A as We}from"./AgendaEventSheet-CCiNOAbT.js";import{P as X}from"./plus-B1CoPVXr.js";import{C as ce}from"./clock-DLn3XL0K.js";import{U as qe}from"./users-CkoqQKX3.js";import{M as Ge}from"./map-pin-BHx3vCaD.js";import{T as Je}from"./trash-2-H5_0A3gc.js";import{C as de}from"./chevron-left-DDrp74a_.js";import{C as me}from"./chevron-right-B3DLkH4w.js";import{C as Ke}from"./calendar-C3sKBTp-.js";import{S as Xe}from"./search-Ca7hmoNW.js";import"./index-FK3-Dmxm.js";import"./index-YIY_kSu2.js";import"./index-BT9qmzog.js";import"./chevron-up-CgXdGGql.js";import"./check-CsZJdN-T.js";import"./label-CNpBZ07K.js";import"./index-DhX7exH0.js";import"./refresh-cw-BjslH46I.js";import"./skeleton-v7DQooK3.js";import"./sheet-Bq_BPsEQ.js";import"./textarea-M7ib3y3c.js";import"./loader-circle-DjI6FToJ.js";import"./types-C9wiu8_K.js";function Ze(d){const L=d.split("T")[0],[m,$,B]=L.split("-");return`${B}/${$}/${m}`}function $t({projectId:d,hideHeader:L}={}){const{events:m,loading:$,syncing:B,error:xe,lastSync:pe,sync:he,deleteEvent:ue,createEvent:ge,updateEvent:P}=Me(),{projects:je}=Le(),[u,Z]=o.useState("calendar"),[p,ee]=o.useState(""),[g,te]=o.useState("all"),[j,se]=o.useState("all"),[C,ae]=o.useState(d||"all"),[S,re]=o.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[fe,f]=o.useState(!1),[O,k]=o.useState(null),[z,F]=o.useState(null),[Ne,ne]=o.useState(null),[ve,R]=o.useState(null),ye=o.useCallback(async(t,s)=>{t.preventDefault(),R(null);const a=t.dataTransfer.getData("eventId");if(!a)return;const n=m.find(r=>r.id===a);if(!(!n||n.date===s))try{await P(a,{title:n.title,date:s,time:n.time,endTime:n.endTime,type:n.type,status:n.status,clientName:n.client,location:n.location,description:n.description,projectAirtableId:n.projectId}),H.success(`"${n.title}" reagendado para ${new Date(s+"T12:00:00").toLocaleDateString("pt-BR")}`)}catch{H.error("Erro ao reagendar")}},[m,P]),N=o.useMemo(()=>{const t=d||C;return m.filter(s=>{var a;return!(p&&!s.title.toLowerCase().includes(p.toLowerCase())&&!((a=s.client)!=null&&a.toLowerCase().includes(p.toLowerCase()))||g!=="all"&&s.type!==g||j!=="all"&&s.status!==j||t!=="all"&&s.projectId!==t)}).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||""))},[m,p,g,j,C,d]),I=()=>{k(null),f(!0)},T=t=>{k(t),f(!0)},we=async(t,s)=>{s?await ge(t):O&&await P(O.id,t)},De=async()=>{if(z)try{await ue(z)}catch{H.error("Erro ao remover compromisso.")}finally{F(null)}},be=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),Ce=o.useMemo(()=>{const{year:t,month:s}=S,a=new Date(t,s,1),n=new Date(t,s+1,0),r=a.getDay(),l=[],Y=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`;for(let i=r-1;i>=0;i--){const E=new Date(t,s,-i);l.push({date:Y(E),day:E.getDate(),isCurrentMonth:!1})}for(let i=1;i<=n.getDate();i++){const E=new Date(t,s,i);l.push({date:Y(E),day:i,isCurrentMonth:!0})}for(;l.length<42;){const i=new Date(t,s+1,l.length-r-n.getDate()+1);l.push({date:Y(i),day:i.getDate(),isCurrentMonth:!1})}return l},[S]),oe=o.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[N]),v=(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),ie=o.useMemo(()=>(d?m.filter(s=>s.projectId===d):m).filter(s=>s.date>=v).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||"")).slice(0,8),[m,v,d]),Se=new Date(S.year,S.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),ke=()=>re(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),Te=()=>re(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),[V,_]=o.useState(0),y=o.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()+V*7);const a=[];for(let n=0;n<7;n++){const r=new Date(s);r.setDate(s.getDate()+n),a.push(`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`)}return a},[V]),Ee=o.useMemo(()=>{if(y.length===0)return"";const t=new Date(y[0]+"T12:00:00"),s=new Date(y[6]+"T12:00:00");return`${t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})} — ${s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}`},[y]),le=o.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[N]),Ae=()=>L?e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(b,{variant:"secondary",className:"text-xs",children:[N.length," eventos"]}),e.jsxs(c,{onClick:I,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(X,{className:"mr-1.5 h-4 w-4"})," Novo Compromisso"]})]}):e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Xe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(Be,{placeholder:"Buscar compromisso ou cliente...",value:p,onChange:t=>ee(t.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs(c,{onClick:I,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(X,{className:"mr-1.5 h-4 w-4"})," Novo Compromisso"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsx("button",{onClick:()=>Z("calendar"),className:x("px-4 py-1.5 text-sm font-medium transition-colors",u==="calendar"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Mês"}),e.jsx("button",{onClick:()=>Z("week"),className:x("px-4 py-1.5 text-sm font-medium transition-colors",u==="week"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Semana"})]}),e.jsx(He,{syncing:B,lastSync:pe,onSync:he,error:xe})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center text-xs text-muted-foreground",children:[e.jsxs(W,{value:g,onValueChange:te,children:[e.jsx(q,{className:"w-[130px] h-8 text-xs",children:e.jsx(G,{placeholder:"Tipo"})}),e.jsxs(J,{children:[e.jsx(h,{value:"all",children:"Todos Tipos"}),Object.keys(K).map(t=>e.jsx(h,{value:t,children:K[t]},t))]})]}),e.jsxs(W,{value:j,onValueChange:se,children:[e.jsx(q,{className:"w-[140px] h-8 text-xs",children:e.jsx(G,{placeholder:"Status"})}),e.jsxs(J,{children:[e.jsx(h,{value:"all",children:"Todos Status"}),Object.keys(M).map(t=>e.jsx(h,{value:t,children:M[t]},t))]})]}),!d&&e.jsxs(W,{value:C,onValueChange:ae,children:[e.jsx(q,{className:"w-[150px] h-8 text-xs",children:e.jsx(G,{placeholder:"Projeto"})}),e.jsxs(J,{children:[e.jsx(h,{value:"all",children:"Todos Projetos"}),je.map(t=>e.jsx(h,{value:t.id,children:t.name},t.id))]})]}),(g!=="all"||j!=="all"||C!=="all"||p)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{te("all"),se("all"),ae("all"),ee("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]});return e.jsxs($e.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[Ae(),$?u==="list"?e.jsx(Ue,{}):e.jsx(Qe,{}):u==="list"?e.jsx("div",{className:"space-y-6",children:le.length===0?e.jsx(w,{children:e.jsxs(D,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(c,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:I,children:[e.jsx(X,{className:"w-4 h-4"})," Criar compromisso"]})]})}):le.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[be(t),t===v&&e.jsx(b,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(w,{className:"hover:border-primary/30 transition-colors",children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(b,{variant:"secondary",className:`text-[10px] ${A[a.type]}`,children:K[a.type]}),e.jsx(b,{variant:"outline",className:"text-[10px]",children:M[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>T(a),children:e.jsx(Ye,{className:"w-3.5 h-3.5"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>F(a.id),children:e.jsx(Je,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):u==="week"?e.jsxs(w,{children:[e.jsx(U,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_(t=>t-1),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(Q,{className:"text-base",children:Ee}),e.jsxs("div",{className:"flex items-center gap-1",children:[V!==0&&e.jsx(c,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:()=>_(0),children:"Hoje"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>_(t=>t+1),children:e.jsx(me,{className:"w-4 h-4"})})]})]})}),e.jsx(D,{children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:y.map(t=>{const s=new Date(t+"T12:00:00"),a=t===v,n=oe.get(t)||[];return e.jsxs("div",{className:x("min-h-[140px] p-2 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",a?"bg-primary/5 border-primary/30":"border-border/50"),onClick:()=>{n.length===0&&(k(null),f(!0))},children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground capitalize",children:s.toLocaleDateString("pt-BR",{weekday:"short"})}),e.jsx("p",{className:x("text-lg font-bold",a&&"text-primary"),children:s.getDate()})]}),e.jsx("div",{className:"space-y-1",children:n.map(r=>e.jsxs("div",{className:x("text-[10px] px-1.5 py-1 rounded cursor-pointer hover:opacity-80",A[r.type]),onClick:l=>{l.stopPropagation(),T(r)},children:[r.time&&e.jsxs("span",{className:"font-semibold",children:[r.time," "]}),e.jsx("span",{className:"truncate",children:r.title})]},r.id))})]},t)})})})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(w,{children:[e.jsx(U,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:ke,children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(Q,{className:"text-base capitalize",children:Se}),e.jsx(c,{variant:"ghost",size:"icon",onClick:Te,children:e.jsx(me,{className:"w-4 h-4"})})]})}),e.jsx(D,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t)),Ce.map((t,s)=>{const a=oe.get(t.date)||[],n=t.date===v;return e.jsxs("div",{className:x("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!t.isCurrentMonth&&"opacity-40",n&&"bg-primary/5 border-primary/30",ve===t.date&&"bg-primary/10 border-primary/40 ring-1 ring-primary/30"),onDragOver:r=>{r.preventDefault(),R(t.date)},onDragLeave:()=>R(null),onDrop:r=>ye(r,t.date),onClick:()=>{a.length===0&&(k(null),f(!0))},children:[e.jsx("p",{className:x("text-xs font-medium mb-0.5",n&&"text-primary font-bold"),children:t.day}),e.jsxs("div",{className:"space-y-0.5",children:[a.slice(0,2).map(r=>e.jsxs("div",{draggable:!0,onDragStart:l=>{l.dataTransfer.setData("eventId",r.id),ne(r.id)},onDragEnd:()=>ne(null),className:x("text-[9px] px-1 py-0.5 rounded truncate cursor-grab active:cursor-grabbing hover:opacity-80",A[r.type],Ne===r.id&&"opacity-40"),title:`${r.title} — arraste para reagendar`,onClick:l=>{l.stopPropagation(),T(r)},children:[r.time&&e.jsxs("span",{className:"font-medium",children:[r.time," "]}),r.title]},r.id)),a.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",a.length-2," mais"]})]})]},s)})]})})]}),e.jsxs(w,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(U,{className:"pb-3",children:e.jsx(Q,{className:"text-sm",children:"Próximos compromissos"})}),e.jsx(D,{className:"space-y-3",children:ie.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):ie.map(t=>e.jsxs("div",{className:"p-3 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer space-y-1.5",onClick:()=>T(t),children:[e.jsx("p",{className:"text-sm font-medium",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(b,{variant:"outline",className:x("text-[10px] px-1.5 py-0",A[t.type]),children:M[t.status]||t.status}),e.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(Ke,{className:"w-3 h-3"}),Ze(t.date)]}),t.time&&e.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3"}),t.time]})]})]},t.id))})]})]}),e.jsx(We,{open:fe,onOpenChange:f,event:O,onSave:we}),e.jsx(Pe,{open:!!z,onOpenChange:t=>!t&&F(null),children:e.jsxs(Oe,{children:[e.jsxs(ze,{children:[e.jsx(Fe,{children:"Remover compromisso?"}),e.jsxs(Re,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Ie,{children:[e.jsx(Ve,{children:"Cancelar"}),e.jsx(_e,{onClick:De,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{$t as default};
