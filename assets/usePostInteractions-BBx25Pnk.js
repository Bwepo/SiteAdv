import{a5 as a,s,V as i}from"./index-DecnLHKo.js";import{u}from"./useMutation-C7Y7h9a9.js";function c(e){return a({queryKey:["post-likes",e],queryFn:async()=>{const{count:t,error:r}=await s.from("mladv_post_likes").select("*",{count:"exact",head:!0}).eq("post_id",e);if(r)throw r;return t??0},enabled:!!e})}function d(e,t){return a({queryKey:["user-liked",e,t],queryFn:async()=>{const{data:r,error:n}=await s.from("mladv_post_likes").select("id").eq("post_id",e).eq("user_fingerprint",t).maybeSingle();if(n)throw n;return!!r},enabled:!!e&&!!t})}function y(){const e=i();return u({mutationFn:async({postId:t,fingerprint:r})=>{const{data:n}=await s.from("mladv_post_likes").select("id").eq("post_id",t).eq("user_fingerprint",r).maybeSingle();if(n){const{error:o}=await s.from("mladv_post_likes").delete().eq("id",n.id);if(o)throw o;return{liked:!1}}else{const{error:o}=await s.from("mladv_post_likes").insert({post_id:t,user_fingerprint:r});if(o)throw o;return{liked:!0}}},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-likes",r.postId]}),e.invalidateQueries({queryKey:["user-liked",r.postId,r.fingerprint]})}})}function f(e){return a({queryKey:["post-comments",e],queryFn:async()=>{const{data:t,error:r}=await s.from("mladv_public_comments").select("*").eq("post_id",e).eq("approved",!0).order("created_at",{ascending:!0});if(r)throw r;return t||[]},enabled:!!e})}function _(){return a({queryKey:["all-comments"],queryFn:async()=>{const{data:e,error:t}=await s.from("mladv_post_comments").select("*, mladv_posts(title, slug)").order("created_at",{ascending:!1});if(t)throw t;return e||[]}})}function p(){const e=i();return u({mutationFn:async t=>{const{data:r,error:n}=await s.from("mladv_post_comments").insert({...t,approved:!0}).select().single();if(n)throw n;return r},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-comments",r.post_id]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function q(){const e=i();return u({mutationFn:async({commentId:t,userId:r})=>{const{error:n}=await s.from("mladv_post_comments").update({approved:!0,reviewed_at:new Date().toISOString(),reviewed_by:r||null}).eq("id",t);if(n)throw n},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function v(){const e=i();return u({mutationFn:async t=>{const{error:r}=await s.from("mladv_post_comments").delete().eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function w(){const e=localStorage.getItem("mladv_fingerprint");if(e)return e;const t=`${Date.now()}-${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem("mladv_fingerprint",t),t}export{d as a,y as b,f as c,p as d,_ as e,q as f,w as g,v as h,c as u};
