import{V as je,al as fe,r as l,j as e,e as w,l as Ne}from"./index-DhJFBbWG.js";import{A as ye,F as ve,P as B}from"./AdminLayout-CDbhK-g5.js";import{C,c as S,a as J,b as W}from"./card-Hjm0KW_H.js";import{B as D}from"./badge-CDc01jpx.js";import{B as i}from"./button-CTgOP9BP.js";import{I as we}from"./input-BEyB0Bda.js";import{S as F,a as P,b as $,d as V,e as d}from"./select-Cw38bR30.js";import{A as Ce,a as Se,b as De,c as be,d as Ee,e as Ae,f as Te,g as ke}from"./alert-dialog-DWG2k6K2.js";import{a as b,e as O,E as R}from"./crmTypes-DP3iBdIv.js";import{S as Me}from"./SyncToolbar-D8VZzcGK.js";import{A as Le,C as ze}from"./CrmSkeletons-DxHGj8po.js";import{A as Be}from"./AgendaEventSheet-cIy4VCmI.js";import{S as Fe}from"./search-D0j5I04E.js";import{L as Pe}from"./list-C2Jax-CB.js";import{C as $e}from"./calendar-A6NhF1Y-.js";import{C as _}from"./clock-BwWpl41w.js";import{U as X}from"./users-BQGUgHhH.js";import{M as Ve}from"./map-pin-B76EKdYI.js";import{P as Oe}from"./pencil-D858aD_s.js";import{T as Re}from"./trash-2-D5coiWg1.js";import{C as _e}from"./dialog-CuSga5C6.js";import{C as Ie}from"./chevron-right-DEhnMEow.js";import"./heart-7CwMcy4p.js";import"./sparkles-BXA2HqAb.js";import"./house-Br8nU-l7.js";import"./menu-CAk_CmdA.js";import"./file-text-DvZETzYg.js";import"./index-BAaUBjb8.js";import"./index-uMC9S6FD.js";import"./index-T5SEvGUW.js";import"./chevron-up-Cw17qWFG.js";import"./check-DHh9ZPzw.js";import"./skeleton-BxCEHRwB.js";import"./form-ipqBocWH.js";import"./label-B5HqNB-O.js";import"./textarea-CaRkNUTz.js";import"./loader-circle-C-BpveA3.js";import"./types-C9wiu8_K.js";function Et(){const{events:u,loading:Z,syncing:ee,error:te,lastSync:se,sync:ae,deleteEvent:re,createEvent:ne,updateEvent:le}=je(),{projects:oe}=fe(),[g,I]=l.useState("calendar"),[m,Y]=l.useState(""),[x,H]=l.useState("all"),[h,U]=l.useState("all"),[p,Q]=l.useState("all"),[j,K]=l.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[ie,f]=l.useState(!1),[E,A]=l.useState(null),[T,k]=l.useState(null),N=l.useMemo(()=>u.filter(t=>{var s;return!(m&&!t.title.toLowerCase().includes(m.toLowerCase())&&!((s=t.client)!=null&&s.toLowerCase().includes(m.toLowerCase()))||x!=="all"&&t.type!==x||h!=="all"&&t.status!==h||p!=="all"&&t.projectId!==p)}).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")),[u,m,x,h,p]),M=()=>{A(null),f(!0)},L=t=>{A(t),f(!0)},ce=async(t,s)=>{s?await ne(t):E&&await le(E.id,t)},me=async()=>{if(T)try{await re(T)}catch{Ne.error("Erro ao remover compromisso.")}finally{k(null)}},de=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),xe=l.useMemo(()=>{const{year:t,month:s}=j,a=new Date(t,s,1),c=new Date(t,s+1,0),n=a.getDay(),o=[],z=r=>`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;for(let r=n-1;r>=0;r--){const v=new Date(t,s,-r);o.push({date:z(v),day:v.getDate(),isCurrentMonth:!1})}for(let r=1;r<=c.getDate();r++){const v=new Date(t,s,r);o.push({date:z(v),day:r,isCurrentMonth:!0})}for(;o.length<42;){const r=new Date(t,s+1,o.length-n-c.getDate()+1);o.push({date:z(r),day:r.getDate(),isCurrentMonth:!1})}return o},[j]),he=l.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[N]),y=(()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${c}`})(),q=l.useMemo(()=>u.filter(t=>t.date>=y).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[u,y]),pe=new Date(j.year,j.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),ue=()=>K(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),ge=()=>K(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),G=l.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[N]);return e.jsxs(ye,{title:"Agenda",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(we,{placeholder:"Buscar compromisso ou cliente...",value:m,onChange:t=>Y(t.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(F,{value:x,onValueChange:H,children:[e.jsx(P,{className:"w-[130px]",children:e.jsx($,{placeholder:"Tipo"})}),e.jsxs(V,{children:[e.jsx(d,{value:"all",children:"Todos"}),Object.keys(b).map(t=>e.jsx(d,{value:t,children:b[t]},t))]})]}),e.jsxs(F,{value:h,onValueChange:U,children:[e.jsx(P,{className:"w-[130px]",children:e.jsx($,{placeholder:"Status"})}),e.jsxs(V,{children:[e.jsx(d,{value:"all",children:"Todos"}),Object.keys(O).map(t=>e.jsx(d,{value:t,children:O[t]},t))]})]}),e.jsxs(F,{value:p,onValueChange:Q,children:[e.jsxs(P,{className:"w-[150px]",children:[e.jsx(ve,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx($,{placeholder:"Projeto"})]}),e.jsxs(V,{children:[e.jsx(d,{value:"all",children:"Todos"}),oe.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),(x!=="all"||h!=="all"||p!=="all"||m)&&e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>{H("all"),U("all"),Q("all"),Y("")},className:"text-xs gap-1",children:"✕ Limpar filtros"}),e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(i,{variant:g==="list"?"default":"ghost",size:"sm",onClick:()=>I("list"),className:"rounded-none",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(i,{variant:g==="calendar"?"default":"ghost",size:"sm",onClick:()=>I("calendar"),className:"rounded-none",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsxs(i,{size:"sm",onClick:M,className:"gap-1.5",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]}),e.jsx(Me,{syncing:ee,lastSync:se,onSync:ae,error:te})]})]}),Z?g==="list"?e.jsx(Le,{}):e.jsx(ze,{}):g==="list"?e.jsx("div",{className:"space-y-6",children:G.length===0?e.jsx(C,{children:e.jsxs(S,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(i,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:M,children:[e.jsx(B,{className:"w-4 h-4"})," Criar compromisso"]})]})}):G.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[de(t),t===y&&e.jsx(D,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(C,{className:"hover:border-primary/30 transition-colors",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{variant:"secondary",className:`text-[10px] ${R[a.type]}`,children:b[a.type]}),e.jsx(D,{variant:"outline",className:"text-[10px]",children:O[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>L(a),children:e.jsx(Oe,{className:"w-3.5 h-3.5"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>k(a.id),children:e.jsx(Re,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(C,{children:[e.jsx(J,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:ue,children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(W,{className:"text-base capitalize",children:pe}),e.jsx(i,{variant:"ghost",size:"icon",onClick:ge,children:e.jsx(Ie,{className:"w-4 h-4"})})]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t)),xe.map((t,s)=>{const a=he.get(t.date)||[],c=t.date===y;return e.jsxs("div",{className:w("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!t.isCurrentMonth&&"opacity-40",c&&"bg-primary/5 border-primary/30"),onClick:()=>{a.length===0&&(A(null),f(!0))},children:[e.jsx("p",{className:w("text-xs font-medium mb-0.5",c&&"text-primary font-bold"),children:t.day}),e.jsxs("div",{className:"space-y-0.5",children:[a.slice(0,2).map(n=>e.jsxs("div",{className:w("text-[9px] px-1 py-0.5 rounded truncate cursor-pointer hover:opacity-80",R[n.type]),title:n.title,onClick:o=>{o.stopPropagation(),L(n)},children:[n.time&&e.jsxs("span",{className:"font-medium",children:[n.time," "]}),n.title]},n.id)),a.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",a.length-2," mais"]})]})]},s)})]})})]}),e.jsxs(C,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(J,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(W,{className:"text-sm flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-primary"}),"Próximos Compromissos"]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:M,children:e.jsx(B,{className:"w-4 h-4"})})]})}),e.jsx(S,{className:"space-y-3",children:q.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):q.map(t=>{const s=new Date(t.date+"T12:00:00"),a=new Date;a.setHours(0,0,0,0);const c=new Date(s.getFullYear(),s.getMonth(),s.getDate()),n=Math.round((c.getTime()-a.getTime())/(1e3*60*60*24)),o=n===0?"Hoje":n===1?"Amanhã":`Em ${n} dias`;return e.jsxs("div",{className:"flex gap-3 p-2 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>L(t),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:s.getDate()}),e.jsx("span",{className:"text-[10px] capitalize text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(D,{variant:"outline",className:w("text-[10px] px-1.5 py-0",R[t.type]),children:b[t.type]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:o})]}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx(_,{className:"w-3 h-3 inline mr-1"}),t.time,t.endTime?` – ${t.endTime}`:""]}),t.client&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.jsx(X,{className:"w-3 h-3 inline mr-1"}),t.client]})]})]},t.id)})})]})]}),e.jsx(Be,{open:ie,onOpenChange:f,event:E,onSave:ce}),e.jsx(Ce,{open:!!T,onOpenChange:t=>!t&&k(null),children:e.jsxs(Se,{children:[e.jsxs(De,{children:[e.jsx(be,{children:"Remover compromisso?"}),e.jsxs(Ee,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Ae,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(ke,{onClick:me,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Et as default};
