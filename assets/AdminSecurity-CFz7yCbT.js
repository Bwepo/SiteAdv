import{n as y,r,j as e,s as d}from"./index-C0fbWft3.js";import{A as P,e as A}from"./AdminLayout-ByDE43MT.js";import{B as q}from"./button-DKkDnD_H.js";import{C as z,a as E,b as F,d as I,c as L}from"./card-DQuJncvP.js";import{I as l}from"./input-CwtS6LtH.js";import{L as m}from"./label-BsB-CMgW.js";import{T}from"./triangle-alert-yRQmegML.js";import{C as R}from"./circle-check-DKtEbzmU.js";import"./dialog-2trSxfIN.js";import"./index-Bi9BIILL.js";import"./heart-CVPeks9w.js";import"./sparkles-BO127kSM.js";import"./search-DXqz9zkm.js";import"./calendar-DWFHOdAL.js";import"./house-BIxJB1_q.js";import"./menu-7TsGcqDU.js";import"./users-BZ2IOsqf.js";import"./file-text-BiE4kwXJ.js";const U=[{label:"Pelo menos 8 caracteres",test:a=>a.length>=8},{label:"Uma letra maiúscula",test:a=>/[A-Z]/.test(a)},{label:"Um número",test:a=>/\d/.test(a)},{label:"Um caractere especial",test:a=>/[^A-Za-z0-9]/.test(a)}],se=()=>{const{toast:a}=y(),[i,c]=r.useState(""),[t,u]=r.useState(""),[n,p]=r.useState(""),[h,o]=r.useState(!1),x=r.useMemo(()=>U.map(s=>({...s,valid:s.test(t)})),[t]),j=x.every(s=>s.valid),f=i.trim().length>0&&t.trim().length>0&&n.trim().length>0&&t===n&&j,C=async s=>{var w,g;if(s.preventDefault(),!f){a({title:"Revise os dados",description:"Preencha todos os campos e atenda aos requisitos da senha.",variant:"destructive"});return}o(!0);const{data:v,error:b}=await d.auth.getSession();if(b||!((g=(w=v.session)==null?void 0:w.user)!=null&&g.email)){a({title:"Sessão inválida",description:"Faça login novamente para alterar sua senha.",variant:"destructive"}),o(!1);return}const{error:N}=await d.auth.signInWithPassword({email:v.session.user.email,password:i});if(N){a({title:"Senha atual incorreta",description:"Confira sua senha atual e tente novamente.",variant:"destructive"}),o(!1);return}const{error:S}=await d.auth.updateUser({password:t});S?a({title:"Não foi possível atualizar",description:"Tente novamente em instantes.",variant:"destructive"}):(a({title:"Senha atualizada",description:"Sua senha foi alterada com sucesso."}),c(""),u(""),p("")),o(!1)};return e.jsx(P,{title:"Segurança",children:e.jsx("div",{className:"max-w-2xl",children:e.jsxs(z,{children:[e.jsxs(E,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Alterar senha"]}),e.jsx(I,{children:"Atualize sua senha seguindo as regras de segurança abaixo."})]}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"current-password",children:"Senha atual"}),e.jsx(l,{id:"current-password",type:"password",autoComplete:"current-password",value:i,onChange:s=>c(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"new-password",children:"Nova senha"}),e.jsx(l,{id:"new-password",type:"password",autoComplete:"new-password",value:t,onChange:s=>u(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirm-password",children:"Confirmar nova senha"}),e.jsx(l,{id:"confirm-password",type:"password",autoComplete:"new-password",value:n,onChange:s=>p(s.target.value),required:!0})]}),e.jsx(q,{type:"submit",disabled:!f||h,children:h?"Salvando...":"Atualizar senha"})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),"Requisitos da senha"]}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-muted-foreground",children:x.map(s=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:`h-4 w-4 ${s.valid?"text-emerald-500":"text-muted-foreground/60"}`}),e.jsx("span",{className:s.valid?"text-foreground":void 0,children:s.label})]},s.label))})]})]})]})})})};export{se as default};
