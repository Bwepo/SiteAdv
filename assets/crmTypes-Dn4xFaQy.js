import{$ as T,r as d,h as v,s as k}from"./index-Bl_6Uoau.js";import{u as E}from"./useQuery-Bx5HeV_0.js";const u=i=>k.from(i),C={agenda:["crm","agenda"],tarefas:["crm","tarefas"],clientes:["crm","clientes"],projetos:["crm","projetos"],all:["crm"]};function A(){return`local_${crypto.randomUUID().slice(0,12)}`}async function j(){const{data:i,error:r}=await u("mladv_crm_agenda").select("*").order("data_local",{ascending:!1});if(r)throw r;return{events:(i||[]).map(e=>({id:e.airtable_id,title:e.titulo||"",date:e.data_local||"",time:e.hora_local||void 0,type:e.tipo||"reuniao",status:e.status||"pendente",client:e.cliente||void 0,location:e.local_evento||void 0,description:e.descricao||void 0,projectId:e.projeto_airtable_id||void 0,airtableId:e.airtable_id}))}}async function q(){const[{data:i,error:r},{data:p,error:e}]=await Promise.all([u("mladv_crm_tarefas").select("*").order("deadline",{ascending:!0,nullsFirst:!1}),u("mladv_crm_subtarefas").select("*")]);if(r)throw r;if(e)throw e;return{tasks:(i||[]).map(l=>{const t=(p||[]).filter(m=>m.tarefa_airtable_id===l.airtable_id).map(m=>{const S=m.raw_fields||{},y=m.status||"A fazer";return{id:m.airtable_id,title:m.titulo||"",completed:y==="Concluído",status:y,dueDate:m.deadline||void 0,assignee:m.responsavel||void 0,notes:S.Observações||void 0,numeroProcesso:m.numero_processo||void 0,parentTaskId:l.airtable_id}});return{id:l.airtable_id,title:l.titulo||"",description:l.descricao||void 0,status:l.status||"pendente",priority:l.prioridade||"media",dueDate:l.deadline||void 0,client:l.cliente||void 0,assignee:l.responsavel||void 0,projectId:l.projeto_airtable_id||void 0,numeroProcesso:l.numero_processo||void 0,subtasks:t,createdAt:"",updatedAt:"",airtableId:l.airtable_id}})}}async function P(){const{data:i,error:r}=await u("mladv_crm_clientes").select("*").order("nome",{ascending:!0});if(r)throw r;return{clients:(i||[]).map(e=>({id:e.airtable_id,name:e.nome||"",slug:e.slug||"",email:e.email||void 0,telefone:e.telefone||void 0,endereco:e.endereco||void 0,documento:e.documento||void 0,tipoDocumento:e.tipo_documento||"cpf",numeroProcesso:e.numero_processo||void 0,dataNascimento:e.data_nascimento||void 0}))}}async function x(){const{data:i,error:r}=await u("mladv_crm_projetos").select("*").order("nome",{ascending:!0});if(r)throw r;return{projects:(i||[]).map(e=>{var b;return{id:e.airtable_id,name:e.nome||"",slug:e.slug||"",status:e.status||"Ativo",tipo:e.tipo||void 0,dataInicio:e.data_inicio||void 0,observacoes:e.observacoes||void 0,coverUrl:((b=e.raw_fields)==null?void 0:b.cover_url)||e.cover_url||void 0,cliente:e.cliente||void 0}})}}function O(){const i=T(),{data:r,isLoading:p,error:e}=E({queryKey:C.agenda,queryFn:j}),b=(r==null?void 0:r.events)??[],l=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:C.agenda})},[i]),m=d.useCallback(async(n,o)=>{await u("mladv_crm_agenda").update({status:o}).eq("airtable_id",n),t()},[t]),S=d.useCallback(async n=>{await u("mladv_crm_agenda").delete().eq("airtable_id",n),t(),v.success("Compromisso removido com sucesso.")},[t]),y=d.useCallback(async n=>{const o=A();await u("mladv_crm_agenda").insert({airtable_id:o,titulo:n.title,data_local:n.date,hora_local:n.time||null,tipo:n.type,status:n.status,cliente:n.clientName||null,local_evento:n.location||null,descricao:n.description||null,projeto_airtable_id:n.projectAirtableId||null}),t(),v.success("Compromisso criado.")},[t]),_=d.useCallback(async(n,o)=>{const g={};o.title!==void 0&&(g.titulo=o.title),o.date!==void 0&&(g.data_local=o.date),o.time!==void 0&&(g.hora_local=o.time||null),o.type!==void 0&&(g.tipo=o.type),o.status!==void 0&&(g.status=o.status),o.clientName!==void 0&&(g.cliente=o.clientName||null),o.location!==void 0&&(g.local_evento=o.location||null),o.description!==void 0&&(g.descricao=o.description||null),await u("mladv_crm_agenda").update(g).eq("airtable_id",n),t(),v.success("Compromisso atualizado.")},[t]);return{events:b,loading:p,error:l,updateEventStatus:m,updateEvent:_,createEvent:y,deleteEvent:S}}function R(){const i=T(),{data:r,isLoading:p,error:e}=E({queryKey:C.tarefas,queryFn:q}),b=(r==null?void 0:r.tasks)??[],l=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:C.tarefas})},[i]),m=d.useCallback(s=>{i.setQueryData(C.tarefas,a=>{if(!a)return a;const c=typeof s=="function"?s(a.tasks):s;return{...a,tasks:c}})},[i]),S=d.useCallback(async(s,a)=>{await u("mladv_crm_tarefas").update({status:a}).eq("airtable_id",s),t()},[t]),y=d.useCallback(async s=>{await u("mladv_crm_tarefas").delete().eq("airtable_id",s),t(),v.success("Tarefa removida.")},[t]),_=d.useCallback(async s=>{const a=A();await u("mladv_crm_tarefas").insert({airtable_id:a,titulo:s.title,deadline:s.deadline||null,prioridade:s.priority,status:s.status,cliente:s.clientName||null,responsavel:s.assignee||null,descricao:s.description||null,projeto_airtable_id:s.projectId||null,numero_processo:s.numeroProcesso||null}),t(),v.success("Tarefa criada.")},[t]),n=d.useCallback(async(s,a)=>{const c={};a.title!==void 0&&(c.titulo=a.title),a.deadline!==void 0&&(c.deadline=a.deadline||null),a.priority!==void 0&&(c.prioridade=a.priority),a.status!==void 0&&(c.status=a.status),a.clientName!==void 0&&(c.cliente=a.clientName||null),a.assignee!==void 0&&(c.responsavel=a.assignee||null),a.description!==void 0&&(c.descricao=a.description||null),a.projectId!==void 0&&(c.projeto_airtable_id=a.projectId||null),a.numeroProcesso!==void 0&&(c.numero_processo=a.numeroProcesso||null),await u("mladv_crm_tarefas").update(c).eq("airtable_id",s),t(),v.success("Tarefa atualizada.")},[t]),o=d.useCallback(async(s,a)=>{const c=A();return await u("mladv_crm_subtarefas").insert({airtable_id:c,titulo:a.title,tarefa_airtable_id:s,status:a.status??"A fazer",deadline:a.deadline||null,responsavel:a.assignee||null,raw_fields:a.notes?{Observações:a.notes}:{},numero_processo:a.numeroProcesso||null}),t(),v.success("Sub-tarefa criada."),c},[t]),g=d.useCallback(async(s,a)=>{const c={};a.title!==void 0&&(c.titulo=a.title),a.status!==void 0&&(c.status=a.status),a.deadline!==void 0&&(c.deadline=a.deadline||null),a.assignee!==void 0&&(c.responsavel=a.assignee||null),a.numeroProcesso!==void 0&&(c.numero_processo=a.numeroProcesso||null),await u("mladv_crm_subtarefas").update(c).eq("airtable_id",s),t(),v.success("Sub-tarefa atualizada.")},[t]),w=d.useCallback(async s=>{await u("mladv_crm_subtarefas").delete().eq("airtable_id",s),t(),v.success("Sub-tarefa removida.")},[t]);return{tasks:b,setTasks:m,loading:p,error:l,updateTaskStatus:S,deleteTask:y,createTask:_,updateTask:n,createSubtask:o,updateSubtask:g,deleteSubtask:w}}function U(){const{data:i,isLoading:r,error:p}=E({queryKey:C.clientes,queryFn:P}),e=(i==null?void 0:i.clients)??[],b=p?p.message:null;return{clients:e,loading:r,error:b}}function f(){const i=T(),{data:r,isLoading:p,error:e}=E({queryKey:C.projetos,queryFn:x}),b=(r==null?void 0:r.projects)??[],l=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:C.projetos})},[i]),m=d.useCallback(async _=>{const n=A(),o=_.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");await u("mladv_crm_projetos").insert({airtable_id:n,nome:_.name,slug:o,status:_.status||"Ativo",tipo:_.tipo||null,observacoes:_.observacoes||null,cliente:_.cliente||null}),t(),v.success("Projeto criado.")},[t]),S=d.useCallback(async(_,n)=>{const o={};n.name!==void 0&&(o.nome=n.name,o.slug=n.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),n.status!==void 0&&(o.status=n.status),n.tipo!==void 0&&(o.tipo=n.tipo||null),n.observacoes!==void 0&&(o.observacoes=n.observacoes||null),n.cliente!==void 0&&(o.cliente=n.cliente||null),await u("mladv_crm_projetos").update(o).eq("airtable_id",_),t(),v.success("Projeto atualizado.")},[t]),y=d.useCallback(async _=>{await u("mladv_crm_projetos").delete().eq("airtable_id",_),t(),v.success("Projeto removido.")},[t]);return{projects:b,loading:p,error:l,createProject:m,updateProject:S,deleteProject:y}}const h={"A fazer":"A fazer","Em andamento":"Em andamento",Concluído:"Concluído"},z={"A fazer":"bg-red-100 text-red-800","Em andamento":"bg-yellow-100 text-yellow-800",Concluído:"bg-green-100 text-green-800"},K=["Ativo","Arquivado","Encerrado","Suspenso"],N={reuniao:"Reunião",audiencia:"Audiência",prazo:"Prazo",consulta:"Consulta",lembrete:"Lembrete",outro:"Outro"},B={confirmado:"Confirmado",pendente:"Pendente",cancelado:"Cancelado",reagendado:"Reagendado"},F={pendente:"Pendente",agendado:"Agendado",em_andamento:"Em Andamento",em_tramite:"Em Trâmite",concluida:"Concluída",cancelada:"Cancelada"},M={alta:"Alta",media:"Média",baixa:"Baixa"},Q={reuniao:"bg-blue-100 text-blue-800",audiencia:"bg-purple-100 text-purple-800",prazo:"bg-red-100 text-red-800",consulta:"bg-green-100 text-green-800",lembrete:"bg-yellow-100 text-yellow-800",outro:"bg-gray-100 text-gray-800"},Y={alta:"bg-red-100 text-red-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-green-100 text-green-800"},D={pendente:"bg-red-100 text-red-800",agendado:"bg-slate-100 text-slate-800",em_andamento:"bg-yellow-100 text-yellow-800",em_tramite:"bg-blue-100 text-blue-800",concluida:"bg-green-100 text-green-800",cancelada:"bg-gray-100 text-gray-800"},V=["Mariana Lima","Equipe ML"];export{Q as E,K as P,h as S,Y as T,R as a,f as b,M as c,N as d,B as e,U as f,V as g,z as h,F as i,D as j,O as u};
