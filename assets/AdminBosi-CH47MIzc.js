import{c as z,r as h,$ as Ve,j as e,e as $,h as Z,s as Qe,m as X}from"./index-DixcKx3f.js";import{u as Ge,a as Ue}from"./crmTypes-CiPVSVr_.js";import{C as We,P as Je}from"./ProjectOverview-BiGHTEFE.js";import{B as Ze,a as ue}from"./CrmSkeletons-D0-O1d6D.js";import{u as pe}from"./useQuery-DFTDskKo.js";import{u as Xe}from"./useMutation-YQ3zCmRo.js";import{B as A}from"./button-UQeTJvbR.js";import{C as ee,c as te}from"./card-CmUM6BfH.js";import{B as et}from"./badge-CmeA_QT4.js";import{S as se}from"./skeleton-BV0OOwzS.js";import{S as he,a as fe,b as be,c as ge,d as je}from"./select-CLbTsJJp.js";import{C as ve}from"./checkbox-MtKtJYR3.js";import{R as tt,m as st}from"./formatters-uDq9-6EO.js";import{A as at,a as rt,b as ot,c as it,d as lt,e as nt,f as dt,g as Ne}from"./alert-dialog-BkSlHPy5.js";import{C as ct}from"./chevron-left-BsBmMDTr.js";import{C as mt}from"./chevron-right-bjNG9heW.js";import{S as xt}from"./square-check-big-C96gjJZt.js";import{C as Ce}from"./clipboard-list-Dx4REkR9.js";import{L as qe,A as ye}from"./AdminTarefas-BGSHtRCD.js";import{P as ut}from"./pencil-D2l7Rrk1.js";import{S as pt}from"./star-8OIai4lt.js";import ht from"./AdminAgenda-UkaGU8op.js";import{B as _e}from"./building-2-chXjDLb2.js";import{C as ft}from"./circle-check-DtZLtjOO.js";import{C as bt}from"./calendar-Z9o670Zz.js";import{F as gt}from"./file-text-5jgPIr5i.js";import"./TipTapEditor-CS8s6shz.js";import"./index-CjPrdvIn.js";import"./dropdown-menu-wbYYQtYw.js";import"./index-D0AoI_jk.js";import"./index-BWrivf-P.js";import"./index-Doth8aA5.js";import"./check-BwRU3RkH.js";import"./input-S4SE4ieG.js";import"./tabs-CGAKuXDS.js";import"./link-BQ8adp-s.js";import"./loader-circle-DoMssvgx.js";import"./list-D0VCIBFD.js";import"./quote-uslgbSGq.js";import"./trash-2-DfpIpLp4.js";import"./trending-up-Bh9aZqA-.js";import"./clock-ChVSFK-z.js";import"./triangle-alert-Dvk2RYHp.js";import"./list-todo-Bu8qy9bp.js";import"./arrow-up-down-C1Wg1ZCE.js";import"./index-DJsWYCEK.js";import"./chevron-up-DsofAcH6.js";import"./label-BirSf-vf.js";import"./download-CuLfTgMi.js";import"./textarea-D2FpDeDK.js";import"./dialog-l1gdMXmA.js";import"./index-XNB_glvr.js";import"./purify.es-D9RiKzGB.js";import"./TarefaSheet-BjX1o2RX.js";import"./form-DJi3DG1h.js";import"./DatePickerInput-CXgRWxwT.js";import"./pt-BR-ZY5I46FX.js";import"./popover-BSZ4nNJ6.js";import"./useCrmFieldOptions-CIW6wzYt.js";import"./sheet-BjCYXMp8.js";import"./separator-ufYdAZKN.js";import"./ClientSelect-DNdvzJbO.js";import"./search-DRk7yPhG.js";import"./ProcessosList-DeOZ8KEM.js";import"./scale-XVNlWcaS.js";import"./user-CwbXQKSa.js";import"./types-Ba-nZvwf.js";import"./switch-Bk2qqYMm.js";import"./sortable.esm-CuLhkGgB.js";import"./users-YOvpsGCv.js";import"./folder-kanban-CEyoKlWd.js";import"./filter-B_FaUucy.js";import"./circle-x-BN38sNNp.js";import"./scroll-area-poBler_c.js";import"./AgendaEventSheet-DEf1_Yqo.js";import"./map-pin-CqQMChJF.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=z("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=z("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=z("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=z("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=z("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]),q=i=>Qe.from(i),ae=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];function wt(i){if(!i)return"";const r=String(i).slice(0,10);return/^\d{4}-\d{2}-\d{2}$/.test(r)?r:""}function M(i){const r=wt(i);return r?`${r.slice(8,10)}/${r.slice(5,7)}/${r.slice(0,4)}`:String(i||"")}function re(i){const r=String(i||"").trim().toLowerCase();return r.includes("conclu")||r.includes("finaliz")||r.includes("encerrad")?{label:"Concluído",kind:"done",order:0}:r.includes("andamento")||r.includes("trâmite")||r.includes("tramite")||r.includes("process")?{label:r.includes("trâmite")||r.includes("tramite")?"Em trâmite":"Em andamento",kind:"wip",order:1}:r.includes("agend")?{label:"Agendado",kind:"sched",order:2}:{label:i||"—",kind:"other",order:3}}function St(i){const r=i.match(/\s*\(([^)]+)\)\s*$/);return r?{titulo:i.replace(/\s*\(([^)]+)\)\s*$/,"").trim(),projeto:r[1].trim()}:{titulo:i,projeto:""}}function we(i){if(!i)return e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Sem observações registradas."});const r=String(i).split(/\r?\n/).map(n=>n.trim()).filter(Boolean),d=[];let f=[],y=0;const m=n=>n.split(/\*\*(.+?)\*\*/g).map((b,j)=>j%2===1?e.jsx("strong",{children:b},j):b),v=()=>{f.length&&(d.push(e.jsx("ul",{className:"list-disc list-inside space-y-0.5 text-xs leading-relaxed ml-2",children:f.map((n,x)=>e.jsx("li",{children:m(n)},x))},y++)),f=[])};for(const n of r){const x=n.match(/^#{1,6}\s+(.+)$/);if(x){v(),d.push(e.jsx("p",{className:"text-xs font-bold mt-2 mb-1",children:m(x[1])},y++));continue}const b=n.match(/^(\d+)\)\s+(.+)$/);if(b){v(),d.push(e.jsxs("p",{className:"text-xs font-bold mt-2 mb-1",children:[b[1],") ",m(b[2])]},y++));continue}const j=n.match(/^\*\*(.+?)\*\*:?$/);if(j){v(),d.push(e.jsx("p",{className:"text-xs font-bold mt-2 mb-1",children:m(j[1])},y++));continue}if(/^(-|•|o)\s+/i.test(n)){f.push(n.replace(/^(-|•|o)\s+/i,""));continue}v(),d.push(e.jsx("p",{className:"text-xs leading-relaxed",children:m(n)},y++))}return v(),e.jsx(e.Fragment,{children:d})}const kt={done:"bg-green-100 text-green-800 border-green-200",wip:"bg-amber-100 text-amber-800 border-amber-200",sched:"bg-orange-100 text-orange-700 border-orange-200",other:"bg-muted text-muted-foreground border-border"},Ct={reuniao:"Reunião",audiencia:"Audiência",prazo:"Prazo",consulta:"Consulta",lembrete:"Lembrete",outro:"Outro"},Se="bosi",ke="rec7FQdbM5wF0R5RW";async function qt(){const[i,r,d]=await Promise.all([q("mladv_crm_tarefas").select("airtable_id, titulo, status, deadline, descricao, raw_fields, cliente, projeto_airtable_id, relatorio_mensal").or(`cliente.ilike.%${Se}%,projeto_airtable_id.eq.${ke}`),q("mladv_crm_agenda").select("airtable_id, titulo, status, tipo, data_local, hora_local, descricao, cliente, local_evento").or(`cliente.ilike.%${Se}%,projeto_airtable_id.eq.${ke}`),q("mladv_crm_subtarefas").select("airtable_id, titulo, status, deadline, responsavel, tarefa_airtable_id, numero_processo, relatorio_mensal")]);if(i.error)throw i.error;if(r.error)throw r.error;if(d.error)throw d.error;const f=i.data||[],y=r.data||[],m=new Set(f.map(n=>n.airtable_id)),v=(d.data||[]).filter(n=>n.tarefa_airtable_id&&m.has(n.tarefa_airtable_id));return{tasks:f,events:y,subtasks:v}}async function Tt(i){const{data:r,error:d}=await q("mladv_crm_relatorio_config").select("*").eq("ano_mes",i).maybeSingle();if(d)throw d;return r?{id:r.id,ano_mes:r.ano_mes,selected_ids:r.selected_ids||[],destaque_ids:r.destaque_ids||[],destaque_textos:r.destaque_textos||{}}:null}async function Dt(i){const r={ano_mes:i.ano_mes,selected_ids:i.selected_ids,destaque_ids:i.destaque_ids,destaque_textos:i.destaque_textos};if(i.id){const{error:d}=await q("mladv_crm_relatorio_config").update(r).eq("id",i.id);if(d)throw d}else{const{error:d}=await q("mladv_crm_relatorio_config").insert(r);if(d)throw d}}function It(){var xe;const i=h.useRef(null),r=Ve(),d=new Date,[f,y]=h.useState(d.getFullYear()),[m,v]=h.useState(d.getMonth()),[n,x]=h.useState(new Set),[b,j]=h.useState(new Set),[N,w]=h.useState({}),[P,V]=h.useState(null),[Te,Q]=h.useState(""),[K,B]=h.useState(!1),[oe,ie]=h.useState(),[H,G]=h.useState({open:!1,itemId:"",itemTitle:"",category:"tarefa"}),T=`${f}-${String(m+1).padStart(2,"0")}`,{data:U,isLoading:De}=pe({queryKey:["crm","bosi-report-all"],queryFn:qt}),{data:D,isLoading:Ie}=pe({queryKey:["crm","bosi-report-config",T],queryFn:()=>Tt(T)}),Ae=De||Ie,le=Xe({mutationFn:Dt,onSuccess:()=>{r.invalidateQueries({queryKey:["crm","bosi-report-config",T]})}}),W=f===d.getFullYear()&&m===d.getMonth(),g=h.useMemo(()=>{if(!U)return[];const{tasks:t,events:a,subtasks:u}=U,l=[];return t.forEach(s=>{var C;if(!s.relatorio_mensal||((C=s.titulo)==null?void 0:C.toLowerCase())==="tarefa sem nome")return;const o=s.raw_fields||{},_=re(s.status),k=o.Observações||s.descricao||null,{titulo:I,projeto:F}=St(s.titulo);l.push({id:`tarefa-${s.airtable_id}`,category:"tarefa",titulo:s.titulo,tituloClean:I,projeto:F,status:s.status,statusLabel:_.label,statusKind:_.kind,statusOrder:_.order,deadline:s.deadline,observacoes:k,airtableId:s.airtable_id})}),a.forEach(s=>{const o=re(s.status);l.push({id:`reuniao-${s.airtable_id}`,category:"reuniao",titulo:s.titulo,tituloClean:s.titulo,projeto:"",status:s.status,statusLabel:o.label,statusKind:o.kind,statusOrder:o.order,deadline:s.data_local,observacoes:s.descricao,extra:[Ct[s.tipo]||s.tipo,s.hora_local,s.local_evento].filter(Boolean).join(" · "),airtableId:s.airtable_id})}),u.forEach(s=>{if(!s.relatorio_mensal)return;const o=re(s.status);l.push({id:`subtarefa-${s.airtable_id}`,category:"subtarefa",titulo:s.titulo,tituloClean:s.titulo,projeto:"",status:s.status,statusLabel:o.label,statusKind:o.kind,statusOrder:o.order,deadline:s.deadline,observacoes:null,extra:[s.responsavel,s.numero_processo].filter(Boolean).join(" · "),airtableId:s.airtable_id})}),l.sort((s,o)=>{if(s.category!==o.category){const _={tarefa:0,reuniao:1,subtarefa:2};return _[s.category]-_[o.category]}return s.statusOrder!==o.statusOrder?s.statusOrder-o.statusOrder:s.tituloClean.localeCompare(o.tituloClean,"pt-BR")}),l},[U]);h.useEffect(()=>{g.length!==0&&(D?(x(new Set(D.selected_ids)),j(new Set(D.destaque_ids)),w(D.destaque_textos||{}),ie(D.id)):(x(new Set(g.map(t=>t.id))),j(new Set),w({}),ie(void 0)),B(!0))},[D,g,T]);const O=h.useRef(null),Me=h.useCallback(()=>{K&&(O.current&&clearTimeout(O.current),O.current=setTimeout(()=>{le.mutate({id:oe,ano_mes:T,selected_ids:Array.from(n),destaque_ids:Array.from(b),destaque_textos:N})},800))},[K,oe,T,n,b,N,le]);h.useEffect(()=>(K&&Me(),()=>{O.current&&clearTimeout(O.current)}),[n,b,N,K]);const Le=()=>{B(!1),m===0?(v(11),y(t=>t-1)):v(t=>t-1)},Ee=()=>{B(!1),m===11?(v(0),y(t=>t+1)):v(t=>t+1)},ne=t=>{if(n.has(t)){const a=g.find(u=>u.id===t);if(a&&(a.category==="tarefa"||a.category==="subtarefa")){G({open:!0,itemId:t,itemTitle:a.tituloClean,category:a.category});return}x(u=>{const l=new Set(u);return l.delete(t),l}),j(u=>{const l=new Set(u);return l.delete(t),l})}else x(a=>new Set(a).add(t))},de=async t=>{const{itemId:a,category:u}=H;if(x(l=>{const s=new Set(l);return s.delete(a),s}),j(l=>{const s=new Set(l);return s.delete(a),s}),t){const l=a.replace(/^(tarefa|subtarefa)-/,""),s=u==="tarefa"?"mladv_crm_tarefas":"mladv_crm_subtarefas",{error:o}=await q(s).update({relatorio_mensal:!1}).eq("airtable_id",l);o?Z.error("Erro ao atualizar no banco"):(Z.success("Relatório mensal desmarcado na tarefa original"),r.invalidateQueries({queryKey:["crm"]}))}G(l=>({...l,open:!1}))},Re=t=>{j(a=>{const u=new Set(a);return u.has(t)?u.delete(t):u.add(t),u})},$e=t=>{const a=g.filter(l=>l.category===t),u=a.every(l=>n.has(l.id));x(l=>{const s=new Set(l);return a.forEach(o=>u?s.delete(o.id):s.add(o.id)),s})},Be=()=>x(new Set(g.map(t=>t.id))),Oe=()=>{x(new Set),j(new Set)},Fe=t=>{const a=g.find(s=>s.id===t),u=N[t]||(a==null?void 0:a.observacoes)||"",l=/<[a-z][\s\S]*>/i.test(u)?u:st(u);Q(l),V(t)},ze=t=>{P&&(w(a=>({...a,[P]:t})),V(null),Q(""))},S=h.useMemo(()=>g.filter(t=>n.has(t.id)),[g,n]),ce=h.useMemo(()=>({endDay:W?String(d.getDate()).padStart(2,"0"):String(new Date(f,m+1,0).getDate()).padStart(2,"0")}),[f,m,W]),c=h.useMemo(()=>{if(S.length===0)return null;const t=`01 a ${ce.endDay} de ${ae[m]} de ${f}`,a=`${ae[m]} de ${f}`,u=new Date,l=M(`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}`),s=`${f}-${String(m+1).padStart(2,"0")}`,o=S.filter(p=>p.category==="tarefa"),_=S.filter(p=>p.category==="reuniao"),k=S.filter(p=>p.category==="subtarefa"),I=S.length,F=S.filter(p=>p.statusKind==="done").length,C=S.filter(p=>p.statusKind==="wip").length,He=S.filter(p=>p.statusKind==="sched").length,Ye=S.filter(p=>b.has(p.id)).map(p=>({id:p.id,titulo:p.tituloClean,projeto:p.projeto,observacoes:N[p.id]||p.observacoes,deadline:p.deadline,statusLabel:p.statusLabel,statusKind:p.statusKind}));return{tarefas:o,reunioes:_,subtarefas:k,periodoTxt:t,mesAno:a,geradoEm:l,reportId:s,total:I,concluidas:F,emAndamento:C,agendado:He,destaques:Ye}},[S,b,N,ce,m,f]),me=h.useCallback(()=>{if(!i.current)return;const t=window.open("","_blank");if(!t)return;const a=i.current.innerHTML,l=Array.from(document.querySelectorAll('style, link[rel="stylesheet"]')).map(s=>s.outerHTML).join(`
`);t.document.write(`
      <!DOCTYPE html><html lang="pt-br"><head><meta charset="UTF-8">
      <title>Relatório Executivo – ${(c==null?void 0:c.mesAno)||""}</title>
      ${l}
      <style>
        @page { size: A4; margin: 12mm; }
        * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        body { margin: 0; padding: 0; background: white; }
        .page-break { page-break-before: always; break-before: page; }
      </style>
      </head><body>
      <div class="bg-white text-slate-900 p-6 sm:p-8 max-w-[680px] mx-auto">${a}</div>
      </body></html>
    `),t.document.close(),setTimeout(()=>t.print(),500)},[c]);if(Ae)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(se,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(t=>e.jsx(se,{className:"h-20"},t))}),e.jsx(se,{className:"h-64"})]});const Pe={tarefa:g.filter(t=>t.category==="tarefa").length,reuniao:g.filter(t=>t.category==="reuniao").length,subtarefa:g.filter(t=>t.category==="subtarefa").length},Ke={tarefa:g.filter(t=>t.category==="tarefa"&&n.has(t.id)).length,reuniao:g.filter(t=>t.category==="reuniao"&&n.has(t.id)).length,subtarefa:g.filter(t=>t.category==="subtarefa"&&n.has(t.id)).length},J=!c||c.total===0;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:Le,children:e.jsx(ct,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(he,{value:String(m),onValueChange:t=>{B(!1),v(Number(t))},children:[e.jsx(fe,{className:"w-[130px] h-8 text-xs capitalize",children:e.jsx(be,{})}),e.jsx(ge,{children:ae.map((t,a)=>e.jsx(je,{value:String(a),className:"capitalize",children:t},a))})]}),e.jsxs(he,{value:String(f),onValueChange:t=>{B(!1),y(Number(t))},children:[e.jsx(fe,{className:"w-[80px] h-8 text-xs",children:e.jsx(be,{})}),e.jsx(ge,{children:Array.from({length:5},(t,a)=>d.getFullYear()-a).map(t=>e.jsx(je,{value:String(t),children:t},t))})]})]}),e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:Ee,disabled:W,children:e.jsx(mt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(A,{variant:"outline",size:"sm",className:"text-xs gap-1.5",onClick:Be,children:[e.jsx(xt,{className:"w-3.5 h-3.5"})," Todos"]}),e.jsxs(A,{variant:"outline",size:"sm",className:"text-xs gap-1.5",onClick:Oe,children:[e.jsx(Nt,{className:"w-3.5 h-3.5"})," Nenhum"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:me,className:"gap-1.5 text-xs",disabled:J,children:[e.jsx(jt,{className:"w-3.5 h-3.5"})," PDF"]}),e.jsxs(A,{variant:"outline",size:"sm",disabled:J,onClick:me,className:"gap-1.5 text-xs",children:[e.jsx(vt,{className:"w-3.5 h-3.5"})," Imprimir"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-[380px_1fr] gap-4",children:[e.jsxs("div",{className:"space-y-3 max-h-[calc(100vh-220px)] overflow-y-auto pr-1",children:[g.length===0?e.jsx(ee,{children:e.jsx(te,{className:"p-6 text-center text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Nenhum item BOSI encontrado."})})}):[{cat:"tarefa",label:"Tarefas",icon:Ce},{cat:"reuniao",label:"Reuniões / Agenda",icon:We},{cat:"subtarefa",label:"Subtarefas",icon:qe}].map(({cat:t,label:a,icon:u})=>{const l=g.filter(o=>o.category===t);if(l.length===0)return null;const s=l.every(o=>n.has(o.id));return e.jsx(ee,{children:e.jsxs(te,{className:"p-0",children:[e.jsxs("button",{onClick:()=>$e(t),className:"w-full flex items-center gap-3 px-4 py-2.5 border-b border-border hover:bg-muted/30 transition-colors",children:[e.jsx(ve,{checked:s,className:"pointer-events-none"}),e.jsx(u,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-semibold flex-1 text-left",children:a}),e.jsxs(et,{variant:"secondary",className:"text-xs",children:[Ke[t],"/",Pe[t]]})]}),e.jsx("div",{className:"divide-y divide-border",children:l.map(o=>{const _=n.has(o.id),k=b.has(o.id),I=!!N[o.id];return e.jsxs("div",{className:$("flex items-start gap-2 px-3 py-2 transition-colors hover:bg-muted/20",!_&&"opacity-40"),children:[e.jsx("button",{onClick:()=>ne(o.id),className:"mt-0.5 shrink-0",children:e.jsx(ve,{checked:_,className:"pointer-events-none"})}),e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>ne(o.id),children:[e.jsx("p",{className:"text-xs font-semibold truncate",children:o.tituloClean}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[o.deadline&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:M(o.deadline)}),o.extra&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:o.extra}),I&&e.jsx("span",{className:"text-[10px] text-primary font-medium",children:"✎ editado"})]})]}),_&&e.jsxs(e.Fragment,{children:[k&&e.jsxs("div",{className:"flex items-center gap-0.5 mt-0.5 shrink-0",children:[e.jsx("button",{onClick:()=>Fe(o.id),className:"p-0.5 rounded text-muted-foreground/60 hover:text-primary transition-colors",title:"Editar texto do destaque",children:e.jsx(ut,{className:"w-3 h-3"})}),I&&e.jsx("button",{onClick:()=>{w(F=>{const C={...F};return delete C[o.id],C}),Z.success("Texto revertido ao original")},className:"p-0.5 rounded text-muted-foreground/60 hover:text-destructive transition-colors",title:"Reverter ao texto original",children:e.jsx(_t,{className:"w-3 h-3"})})]}),e.jsx("button",{onClick:()=>Re(o.id),className:$("mt-0.5 shrink-0 p-0.5 rounded transition-colors",k?"text-amber-500":"text-muted-foreground/40 hover:text-amber-400"),title:k?"Remover do destaque estratégico":"Marcar como destaque estratégico",children:k?e.jsx(pt,{className:"w-3.5 h-3.5 fill-current"}):e.jsx(yt,{className:"w-3.5 h-3.5"})})]}),e.jsx(L,{label:o.statusLabel,kind:o.statusKind})]},o.id)})})]})},t)}),e.jsx(tt,{open:!!P,onOpenChange:t=>{t||(V(null),Q(""))},title:`Editar destaque: ${((xe=g.find(t=>t.id===P))==null?void 0:xe.tituloClean)||""}`,value:Te,onChange:ze})]}),e.jsx(ee,{className:"overflow-hidden",children:e.jsx(te,{className:"p-0 max-h-[calc(100vh-220px)] overflow-y-auto",children:J?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{className:"text-sm font-medium",children:"Selecione itens à esquerda para gerar o relatório."})}):e.jsxs("div",{ref:i,className:"bg-white text-slate-900 p-6 sm:p-8 max-w-[680px] mx-auto",children:[e.jsxs("div",{className:"report-header pb-3 mb-4 border-b-2 border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/logo-horizontal_transparent.png",alt:"Mariana Lima Advocacia",style:{maxHeight:70}}),e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/bosi_logo.png",alt:"BOSI",style:{maxHeight:34}})]}),e.jsxs("h1",{className:"text-lg font-extrabold text-slate-900",children:["Atuação jurídica do período – ",c.mesAno]}),e.jsxs("p",{className:"subtitle text-xs text-slate-500 mt-1",children:["Período: ",c.periodoTxt]})]}),e.jsxs("div",{className:"kpi-grid grid grid-cols-2 sm:grid-cols-4 gap-2.5 mb-5",children:[e.jsx(Y,{label:"Total",value:c.total,kind:"other"}),e.jsx(Y,{label:"Concluídas",value:c.concluidas,kind:"done"}),e.jsx(Y,{label:"Em andamento",value:c.emAndamento,kind:"wip"}),e.jsx(Y,{label:"Agendadas",value:c.agendado,kind:"sched"})]}),c.destaques.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:c.destaques.length===1?"Destaque estratégico":"Destaques estratégicos"}),e.jsx("div",{className:"space-y-3",children:c.destaques.map((t,a)=>e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50/80 p-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs font-extrabold text-slate-900",children:[t.titulo,t.projeto&&e.jsxs("span",{className:"text-slate-500 font-bold",children:[" · ",t.projeto]})]}),t.deadline&&e.jsxs("p",{className:"text-[11px] text-slate-600 font-semibold mt-0.5",children:["Prazo: ",M(t.deadline)]})]}),e.jsx(L,{label:t.statusLabel,kind:t.statusKind})]}),t.observacoes?e.jsx("div",{className:"text-xs text-slate-700 leading-relaxed border-t border-slate-200/60 pt-2 mt-1 [&_strong]:font-bold [&_em]:italic [&_ul]:list-disc [&_ul]:list-inside [&_ul]:space-y-0.5 [&_ul]:ml-1 [&_ol]:list-decimal [&_ol]:list-inside [&_ol]:space-y-0.5 [&_ol]:ml-1 [&_li]:text-xs [&_p]:text-xs [&_p]:leading-relaxed [&_h1]:text-sm [&_h1]:font-bold [&_h1]:mt-2 [&_h1]:mb-1 [&_h2]:text-xs [&_h2]:font-bold [&_h2]:mt-2 [&_h2]:mb-1 [&_h3]:text-xs [&_h3]:font-bold [&_h3]:mt-1.5 [&_h3]:mb-0.5 [&_blockquote]:border-l-2 [&_blockquote]:border-slate-300 [&_blockquote]:pl-3 [&_blockquote]:italic [&_blockquote]:text-slate-600 [&_hr]:my-2 [&_hr]:border-slate-200",children:/<[a-z][\s\S]*>/i.test(t.observacoes)?e.jsx("div",{dangerouslySetInnerHTML:{__html:t.observacoes}}):we(t.observacoes)}):e.jsx("p",{className:"text-xs text-slate-500 italic mt-1",children:"Atualização registrada no período."})]},a))})]}),c.tarefas.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:["Tarefas (",c.tarefas.length,")"]}),e.jsx("div",{className:"border-t border-slate-100",children:c.tarefas.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 py-1.5 border-b border-slate-50 last:border-0",children:[e.jsxs("p",{className:"text-[11px] font-bold text-slate-900 leading-tight flex-1 min-w-0",children:[t.tituloClean,t.projeto&&e.jsxs("span",{className:"text-slate-500 font-bold",children:[" · ",t.projeto]})]}),e.jsx(L,{label:t.statusLabel,kind:t.statusKind})]},a))})]}),c.reunioes.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:["Reuniões e compromissos (",c.reunioes.length,")"]}),e.jsx("div",{className:"space-y-0",children:c.reunioes.map((t,a)=>e.jsxs("div",{className:"flex items-start justify-between gap-2 py-1.5 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-bold text-slate-900 leading-tight",children:t.tituloClean}),t.extra&&e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:t.extra}),t.deadline&&e.jsx("p",{className:"text-[10px] text-slate-500",children:M(t.deadline)})]}),e.jsx(L,{label:t.statusLabel,kind:t.statusKind})]},a))})]}),c.subtarefas.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:["Subtarefas (",c.subtarefas.length,")"]}),e.jsx("div",{className:"space-y-0",children:c.subtarefas.map((t,a)=>e.jsxs("div",{className:"flex items-start justify-between gap-2 py-1.5 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[11px] font-bold text-slate-900 leading-tight",children:t.tituloClean}),t.extra&&e.jsx("p",{className:"text-[10px] text-slate-500 mt-0.5",children:t.extra}),t.deadline&&e.jsx("p",{className:"text-[10px] text-slate-500",children:M(t.deadline)})]}),e.jsx(L,{label:t.statusLabel,kind:t.statusKind})]},a))})]}),c.tarefas.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"page-break"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-center py-4 mb-4 bg-slate-50 rounded-lg",children:[e.jsx("h2",{className:"text-base font-extrabold text-slate-900",children:"Detalhamento das Tarefas"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Resumo técnico e jurídico de cada frente acompanhada em ",e.jsx("strong",{children:c.mesAno}),"."]})]}),e.jsx("div",{className:"space-y-0",children:c.tarefas.map((t,a)=>e.jsxs("div",{className:"task-detail py-3 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("p",{className:"task-title text-xs font-extrabold text-slate-900",children:[a+1,". ",t.tituloClean,t.projeto&&e.jsxs("span",{className:"task-projeto text-slate-500 font-bold",children:[" · ",t.projeto]})]}),e.jsx(L,{label:t.statusLabel,kind:t.statusKind})]}),t.deadline&&e.jsxs("p",{className:"text-[11px] text-slate-600 font-semibold mt-1",children:["Prazo: ",M(t.deadline)]}),e.jsx("div",{className:"task-obs mt-2",children:we(t.observacoes)})]},a))})]})]}),e.jsxs("div",{className:"footer mt-6 pt-3 border-t-2 border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-extrabold text-slate-700",children:"Mariana Lima Advocacia"}),e.jsxs("p",{className:"text-[11px] text-slate-500 mt-1",children:["Telefone: (31) 99404-8797",e.jsx("br",{}),"E-mail: contato@marianalima.adv.br",e.jsx("br",{}),"Rua Hugo Santos Silva, nº 100 – Centro, Sete Lagoas – MG"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/logo-horizontal_transparent.png",alt:"Mariana Lima Advocacia",style:{maxHeight:70,marginLeft:"auto"},className:"mb-2"}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Gerado em: ",c.geradoEm]}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Relatório #",c.reportId]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-slate-100",children:[e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"Este relatório é confidencial e destinado exclusivamente ao destinatário."}),e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/bosi_logo.png",alt:"BOSI",style:{maxHeight:28}})]})]})]})})})]}),e.jsx(at,{open:H.open,onOpenChange:t=>!t&&G(a=>({...a,open:!1})),children:e.jsxs(rt,{className:"max-w-[92vw] sm:max-w-lg",children:[e.jsxs(ot,{children:[e.jsxs(it,{className:"text-sm leading-snug break-words",children:['Desmarcar "',H.itemTitle,'"?']}),e.jsxs(lt,{className:"text-xs leading-relaxed",children:['Remover apenas deste relatório, ou também desmarcar "Relatório Mensal" na ',H.category==="tarefa"?"tarefa":"subtarefa"," original?"]})]}),e.jsxs(nt,{className:"flex flex-wrap gap-2 justify-end",children:[e.jsx(dt,{className:"text-xs h-8 px-3",children:"Cancelar"}),e.jsx(Ne,{onClick:()=>de(!1),className:"bg-secondary text-secondary-foreground hover:bg-secondary/80 text-xs h-8 px-3",children:"Só neste relatório"}),e.jsx(Ne,{onClick:()=>de(!0),className:"text-xs h-8 px-3",children:"Desmarcar na tarefa"})]})]})})]})}function Y({label:i,value:r,kind:d}){const f={done:"bg-green-50 border-green-200 text-green-900",wip:"bg-amber-50 border-amber-200 text-amber-900",sched:"bg-orange-50 border-orange-200 text-orange-900",other:"bg-slate-50 border-slate-200 text-slate-900"};return e.jsxs("div",{className:$("kpi-card rounded-lg border p-3",f[d]),children:[e.jsx("p",{className:"value text-2xl font-black leading-none",children:r}),e.jsx("p",{className:"label text-[10px] font-bold uppercase tracking-wide mt-1.5",children:i})]})}function L({label:i,kind:r}){return e.jsx("span",{className:$("badge inline-block px-2 py-0.5 rounded-full text-[10px] font-bold border shrink-0 whitespace-nowrap",kt[r]),children:i})}const E="bosi",R="rec7FQdbM5wF0R5RW",At=[{id:"visao_geral",label:"Visão Geral",icon:ft},{id:"agenda",label:"Agenda",icon:bt},{id:"tarefas",label:"Tarefas",icon:Ce},{id:"subtarefas",label:"Subtarefas",icon:qe},{id:"relatorio",label:"Relatório",icon:gt}];function ta(){const{events:i,loading:r}=Ge(),{tasks:d,loading:f}=Ue(),y=r||f,[m,v]=h.useState("visao_geral"),n=h.useMemo(()=>{const x=i.filter(N=>{var w;return((w=N.client)==null?void 0:w.toLowerCase().includes(E))||N.projectId===R}),b=d.filter(N=>{var w;return((w=N.client)==null?void 0:w.toLowerCase().includes(E))||N.projectId===R}),j=b.flatMap(N=>N.subtasks);return{visao_geral:0,agenda:x.length,tarefas:b.length,subtarefas:j.length,relatorio:0}},[i,d]);return y?e.jsxs("div",{className:"space-y-6 pb-20 md:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(_e,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"BOSI Empreendimentos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Painel exclusivo do cliente"})]})]}),e.jsx(Ze,{}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(ue,{}),e.jsx(ue,{})]})]}):e.jsxs(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-6 pb-20 md:pb-0",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(_e,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"BOSI Empreendimentos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Painel exclusivo do cliente"})]})]})}),e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 scrollbar-none",children:e.jsx("div",{className:"flex items-center gap-1 rounded-2xl border border-border bg-muted/40 p-1 w-fit backdrop-blur-sm",children:At.map(x=>{const b=m===x.id,j=x.icon;return e.jsxs("button",{onClick:()=>v(x.id),className:$("relative flex items-center gap-1.5 sm:gap-2 rounded-xl px-3 sm:px-5 py-2 sm:py-2.5 text-xs sm:text-sm font-medium transition-all duration-200 whitespace-nowrap",b?"text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[b&&e.jsx(X.div,{layoutId:"bosi-tab-bg",className:"absolute inset-0 rounded-xl gold-gradient shadow-sm",transition:{type:"spring",bounce:.15,duration:.5}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:x.label}),e.jsx("span",{className:"sm:hidden",children:x.id==="visao_geral"?"Geral":x.id==="relatorio"?"Relat.":x.label}),n[x.id]>0&&e.jsx("span",{className:$("inline-flex items-center justify-center rounded-full px-1.5 sm:px-2 py-0.5 text-[10px] font-semibold tabular-nums min-w-[20px] transition-colors",b?"bg-primary-foreground/20 text-primary-foreground":"bg-secondary text-muted-foreground"),children:n[x.id]})]})]},x.id)})})}),e.jsxs(X.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.2},children:[m==="visao_geral"&&e.jsx(Je,{projectId:R,clientFilter:E,tasks:d,events:i}),m==="agenda"&&e.jsx(ht,{projectId:R,clientFilter:E,hideHeader:!0}),m==="tarefas"&&e.jsx(ye,{projectId:R,clientNameFilter:E,hideHeader:!0,forceTab:"tarefas"}),m==="subtarefas"&&e.jsx(ye,{projectId:R,clientNameFilter:E,hideHeader:!0,forceTab:"subtarefas"}),m==="relatorio"&&e.jsx(It,{})]},m)]})}export{ta as default};
