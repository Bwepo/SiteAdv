import{u as b}from"./useQuery-CUG2E1MQ.js";import{$ as w,s as i,h as a}from"./index-sVkT8duI.js";import{u as l}from"./useMutation-CLzU-3R5.js";const c="crm-field-options";function F(){const d=w(),{data:u=[],isLoading:m}=b({queryKey:[c],queryFn:async()=>{const{data:r,error:e}=await i.from("mladv_crm_field_options").select("*").order("sort_order",{ascending:!0});if(e)throw e;return r},staleTime:1e3*60*5}),n=r=>u.filter(e=>e.field_name===r),p=r=>{const e=n(r);return Object.fromEntries(e.map(o=>[o.value,o.label]))},f=r=>{const e=n(r);return Object.fromEntries(e.map(o=>[o.value,o.color]))},_=r=>{const e=n(r);return Object.fromEntries(e.map(o=>{const t=o.color.match(/bg-(\w+)-\d+/),s=t?t[1]:"muted";return[o.value,`border-t-${s}-500/60`]}))},y=r=>n(r).map(e=>e.value),v=l({mutationFn:async r=>{const e=u.filter(s=>s.field_name===r.field_name),o=e.length>0?Math.max(...e.map(s=>s.sort_order)):0,{error:t}=await i.from("mladv_crm_field_options").insert({field_name:r.field_name,value:r.value,label:r.label,color:r.color,sort_order:o+1});if(t)throw t},onSuccess:()=>{d.invalidateQueries({queryKey:[c]}),a.success("Opção adicionada!")},onError:r=>a.error("Erro ao adicionar: "+r.message)}),O=l({mutationFn:async r=>{const{id:e,...o}=r,{error:t}=await i.from("mladv_crm_field_options").update(o).eq("id",e);if(t)throw t},onSuccess:()=>{d.invalidateQueries({queryKey:[c]}),a.success("Opção atualizada!")},onError:r=>a.error("Erro ao atualizar: "+r.message)}),g=l({mutationFn:async r=>{const{error:e}=await i.from("mladv_crm_field_options").delete().eq("id",r);if(e)throw e},onSuccess:()=>{d.invalidateQueries({queryKey:[c]}),a.success("Opção removida!")},onError:r=>a.error("Erro ao remover: "+r.message)}),E=l({mutationFn:async r=>{const e=r.map(s=>i.from("mladv_crm_field_options").update({sort_order:s.sort_order}).eq("id",s.id)),t=(await Promise.all(e)).find(s=>s.error);if(t!=null&&t.error)throw t.error},onSuccess:()=>{d.invalidateQueries({queryKey:[c]})},onError:r=>a.error("Erro ao reordenar: "+r.message)});return{allOptions:u,isLoading:m,getOptions:n,getLabelsMap:p,getColorsMap:f,getBorderColorsMap:_,getOrderedValues:y,addOption:v,updateOption:O,deleteOption:g,reorderOptions:E}}export{F as u};
