import{c as M,r as g,s as b,j as s,X as L,h as $,e as R}from"./index-CVUt1wCy.js";import{B as w}from"./button-M3QFLZwx.js";import{L as A}from"./label-DwIqh7px.js";import{A as T,a as z,b as B,c as F,d as I,e as O,f as P,g as V}from"./alert-dialog-DqzMIbyM.js";import{L as q}from"./loader-circle-BFmEUsru.js";import{D as S}from"./download-f-rYYM5v.js";import{F as _}from"./file-text-sgsqDBLC.js";import{E as H}from"./tabs-C37Gu0z-.js";import{U as W,T as X}from"./TipTapEditor-Djv5sCrz.js";import{T as G}from"./textarea-DnrXfJ1M.js";import{D as J,a as K,c as Q,d as Y,f as Z}from"./dialog-D_Z-9rs9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=M("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=M("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),se=/\.(jpg|jpeg|png|webp|gif)$/i;function fe({folder:r,readOnly:e=!1,label:i="Anexos"}){const[a,d]=g.useState([]),[c,l]=g.useState(!1),[h,n]=g.useState(!0),[m,x]=g.useState(null),v=g.useCallback(async()=>{n(!0);try{const{data:t,error:o}=await b.storage.from("crm-anexos").list(r);if(o)throw o;const u=(t||[]).filter(j=>j.name!==".emptyFolderPlaceholder");if(u.length>0){const j=await Promise.all(u.map(async p=>{const D=se.test(p.name);let C;if(D){const{data:E}=await b.storage.from("crm-anexos").createSignedUrl(`${r}/${p.name}`,3600);C=(E==null?void 0:E.signedUrl)??void 0}return{name:p.name,signedUrl:C,isImage:D}}));d(j)}else d([])}catch{d([])}finally{n(!1)}},[r]);g.useEffect(()=>{v()},[v]);const N=async t=>{const o=t.target.files;if(!(!o||o.length===0)){l(!0);try{for(const u of Array.from(o)){const j=`${r}/${u.name}`,{error:p}=await b.storage.from("crm-anexos").upload(j,u,{upsert:!0});if(p)throw p}await v(),$.success("Arquivo(s) enviado(s)!")}catch(u){$.error("Erro no upload: "+u.message)}finally{l(!1),t.target.value=""}}},y=async()=>{if(m)try{const{error:t}=await b.storage.from("crm-anexos").remove([`${r}/${m}`]);if(t)throw t;d(o=>o.filter(u=>u.name!==m)),$.success("Arquivo removido.")}catch(t){$.error("Erro ao remover: "+t.message)}finally{x(null)}},f=async t=>{const{data:o,error:u}=await b.storage.from("crm-anexos").download(`${r}/${t}`);if(u){$.error("Erro ao baixar arquivo.");return}const j=URL.createObjectURL(o),p=document.createElement("a");p.href=j,p.download=t,p.click(),URL.revokeObjectURL(j)},k=async t=>{const{data:o,error:u}=await b.storage.from("crm-anexos").createSignedUrl(`${r}/${t}`,3600);if(u||!(o!=null&&o.signedUrl)){$.error("Erro ao gerar link de visualização.");return}window.open(o.signedUrl,"_blank")};return h?s.jsxs("div",{className:"space-y-2",children:[s.jsxs(A,{className:"flex items-center gap-1.5",children:[s.jsx(U,{className:"h-3.5 w-3.5"})," ",i]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(q,{className:"h-3 w-3 animate-spin"})," Carregando..."]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(A,{className:"flex items-center gap-1.5",children:[s.jsx(U,{className:"h-3.5 w-3.5"})," ",i,a.length>0&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.length,")"]})]}),a.length>0&&s.jsxs("div",{className:"space-y-1.5",children:[a.some(t=>t.isImage)&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.filter(t=>t.isImage&&t.signedUrl).map(t=>s.jsxs("div",{className:"relative group rounded-md overflow-hidden border border-border",children:[s.jsx("img",{src:t.signedUrl,alt:t.name,className:"h-16 w-16 object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>k(t.name)}),s.jsxs("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100",children:[s.jsx("button",{onClick:()=>f(t.name),className:"p-1 bg-background/80 rounded",title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx("button",{onClick:()=>x(t.name),className:"p-1 bg-background/80 rounded text-destructive",title:"Excluir",children:s.jsx(L,{className:"h-3 w-3"})})]}),s.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-1 truncate",children:t.name})]},t.name))}),a.filter(t=>!t.isImage).map(t=>s.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-md px-2.5 py-1.5 text-xs group",children:[s.jsx(_,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),s.jsx("span",{className:"truncate flex-1 max-w-[180px]",children:t.name}),s.jsxs("div",{className:"flex items-center gap-0.5 shrink-0",children:[s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>k(t.name),title:"Visualizar",children:s.jsx(H,{className:"h-3 w-3"})}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>f(t.name),title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive hover:text-destructive",onClick:()=>x(t.name),title:"Excluir",children:s.jsx(L,{className:"h-3 w-3"})})]})]},t.name))]}),a.length===0&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo."}),!e&&s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-sm text-primary hover:underline mt-1",children:[s.jsx(W,{className:"h-4 w-4"}),c?"Enviando...":"Adicionar arquivo",s.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:N,disabled:c})]})]}),s.jsx(T,{open:!!m,onOpenChange:t=>!t&&x(null),children:s.jsxs(z,{children:[s.jsxs(B,{children:[s.jsx(F,{children:"Excluir anexo?"}),s.jsxs(I,{children:['O arquivo "',m,'" será removido permanentemente. Esta ação não pode ser desfeita.']})]}),s.jsxs(O,{children:[s.jsx(P,{children:"Cancelar"}),s.jsx(V,{onClick:y,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function te({open:r,onOpenChange:e,title:i="Editar Observações",value:a,onChange:d}){const[c,l]=g.useState(a),h=g.useCallback(m=>{m&&l(a),e(m)},[a,e]),n=()=>{d(c),e(!1)};return s.jsx(J,{open:r,onOpenChange:h,children:s.jsxs(K,{className:"max-w-4xl w-[95vw] max-h-[90vh] flex flex-col p-0",children:[s.jsx(Q,{className:"px-6 pt-6 pb-0",children:s.jsx(Y,{children:i})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 min-h-0",children:s.jsx("div",{className:"[&_.border]:overflow-visible [&_.border]:flex [&_.border]:flex-col [&_.border]:max-h-full",children:s.jsx(X,{content:c,onChange:l,placeholder:"Escreva suas observações aqui..."})})}),s.jsxs(Z,{className:"px-6 pb-6 pt-2 gap-2 border-t border-border",children:[s.jsx(w,{variant:"outline",onClick:()=>e(!1),children:"Cancelar"}),s.jsx(w,{onClick:n,children:"Salvar"})]})]})})}function re(r){if(!r)return"";const e=String(r).trim();if(!e)return"";if(/<[a-z][\s\S]*>/i.test(e))return e;const i=e.split(/\r?\n/),a=[];let d=!1;const c=h=>{let n=h.replace(/\\-/g,"-");return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n},l=()=>{d&&(a.push("</ul>"),d=!1)};for(const h of i){const n=h.trim();if(!n){l();continue}const m=n.match(/^(#{1,6})\s+(.+)$/);if(m){l();const f=Math.min(m[1].length,6);a.push(`<h${f}>${c(m[2])}</h${f}>`);continue}const x=n.match(/^\*\*(.+?)\*\*:?$/);if(x){l();const f=x[1];f.match(/^(\d+)\)\s+(.+)$/)?a.push(`<h3>${c(f)}</h3>`):a.push(`<p><strong>${c(f)}${n.endsWith(":")?":":""}</strong></p>`);continue}const v=n.match(/^(\d+)\)\s+(.+)$/);if(v){l(),a.push(`<h3>${v[1]}) ${c(v[2])}</h3>`);continue}const N=n.replace(/^\\-/,"-"),y=N.match(/^(-|•|\*)\s+(.+)$/);if(y&&!N.startsWith("**")){d||(a.push("<ul>"),d=!0),a.push(`<li>${c(y[2])}</li>`);continue}l(),a.push(`<p>${c(n)}</p>`)}return l(),a.join("")}function ae(r){return r?/<[a-z][\s\S]*>/i.test(r)?new DOMParser().parseFromString(r,"text/html").body.textContent||"":r:""}function ge({value:r,onChange:e,placeholder:i="Observações...",className:a,modalTitle:d="Editar Observações"}){const[c,l]=g.useState(!1),h=re(r)||r,n=ae(h),m=h!==n&&h.includes("<");return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative group",children:[s.jsx(G,{placeholder:i,className:R("resize-none min-h-[80px] pr-10",a),value:n,onChange:x=>e(x.target.value)}),s.jsx(w,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1.5 right-1.5 h-7 w-7 opacity-50 group-hover:opacity-100 transition-opacity",onClick:()=>l(!0),title:"Expandir editor",children:s.jsx(ee,{className:"w-3.5 h-3.5"})}),m&&s.jsx("span",{className:"absolute bottom-1.5 right-1.5 text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:"Texto formatado"})]}),s.jsx(te,{open:c,onOpenChange:l,title:d,value:h,onChange:e})]})}function je(r){const e=r.replace(/\D/g,"").slice(0,20);let i="";for(let a=0;a<e.length;a++)a===7&&(i+="-"),a===9&&(i+="."),a===13&&(i+="."),a===14&&(i+="."),a===16&&(i+="."),i+=e[a];return i}function ve(r){const e=r.replace(/\D/g,"").slice(0,11);return e.length<=3?e:e.length<=6?`${e.slice(0,3)}.${e.slice(3)}`:e.length<=9?`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6)}`:`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6,9)}-${e.slice(9)}`}function be(r){const e=r.replace(/\D/g,"").slice(0,14);return e.length<=2?e:e.length<=5?`${e.slice(0,2)}.${e.slice(2)}`:e.length<=8?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5)}`:e.length<=12?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8)}`:`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8,12)}-${e.slice(12)}`}function $e(r){const e=r.replace(/\D/g,"").slice(0,11);return e.length<=2?`(${e}`:e.length<=7?`(${e.slice(0,2)}) ${e.slice(2)}`:`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7)}`}function we(r){const e=r.replace(/\D/g,"");return e?(parseInt(e,10)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""}function Ne(r){const e=r.replace(/\D/g,"");return e?parseInt(e,10)/100:null}function ye(r){return r==null?"":r.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}export{fe as A,ge as E,ve as a,be as b,je as c,we as d,$e as f,re as m,ye as n,Ne as p};
