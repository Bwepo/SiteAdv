import{u as a,a as i}from"./skeleton-C622kORU.js";import{ad as u,ae as n}from"./index-CH2LE9ah.js";function l(e){return a({queryKey:["post-likes",e],queryFn:async()=>{const{count:t,error:r}=await n.from("mladv_post_likes").select("*",{count:"exact",head:!0}).eq("post_id",e);if(r)throw r;return t??0},enabled:!!e})}function d(e,t){return a({queryKey:["user-liked",e,t],queryFn:async()=>{const{data:r,error:s}=await n.from("mladv_post_likes").select("id").eq("post_id",e).eq("user_fingerprint",t).maybeSingle();if(s)throw s;return!!r},enabled:!!e&&!!t})}function y(){const e=u();return i({mutationFn:async({postId:t,fingerprint:r})=>{const{data:s}=await n.from("mladv_post_likes").select("id").eq("post_id",t).eq("user_fingerprint",r).maybeSingle();if(s){const{error:o}=await n.from("mladv_post_likes").delete().eq("id",s.id);if(o)throw o;return{liked:!1}}else{const{error:o}=await n.from("mladv_post_likes").insert({post_id:t,user_fingerprint:r});if(o)throw o;return{liked:!0}}},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-likes",r.postId]}),e.invalidateQueries({queryKey:["user-liked",r.postId,r.fingerprint]})}})}function f(e){return a({queryKey:["post-comments",e],queryFn:async()=>{const{data:t,error:r}=await n.from("mladv_post_comments").select("*").eq("post_id",e).eq("approved",!0).order("created_at",{ascending:!0});if(r)throw r;return t||[]},enabled:!!e})}function p(){return a({queryKey:["all-comments"],queryFn:async()=>{const{data:e,error:t}=await n.from("mladv_post_comments").select("*, mladv_posts(title, slug)").order("created_at",{ascending:!1});if(t)throw t;return e||[]}})}function _(){const e=u();return i({mutationFn:async t=>{const{data:r,error:s}=await n.from("mladv_post_comments").insert({...t,approved:!1}).select().single();if(s)throw s;return r},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-comments",r.post_id]})}})}function q(){const e=u();return i({mutationFn:async t=>{const{error:r}=await n.from("mladv_post_comments").update({approved:!0}).eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function v(){const e=u();return i({mutationFn:async t=>{const{error:r}=await n.from("mladv_post_comments").delete().eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function g(){const e=localStorage.getItem("mladv_fingerprint");if(e)return e;const t=`${Date.now()}-${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem("mladv_fingerprint",t),t}export{d as a,y as b,f as c,_ as d,p as e,q as f,g,v as h,l as u};
