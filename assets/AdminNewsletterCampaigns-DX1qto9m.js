import{c as q,r as l,y as F,j as e}from"./index-BMi_G2aQ.js";import{P as T,A as B}from"./AdminLayout-Crf21vjA.js";import{B as x}from"./button-CLTjtWEi.js";import{I as V}from"./input-B9MJYkaX.js";import{L as D}from"./label-Cj1Kh4bO.js";import{T as U}from"./textarea-BX5ofDc5.js";import{T as W,a as G,b as A}from"./tabs-53cTQdQx.js";import{D as J,b as K,a as Q,c as X,d as Y,e as Z,f as $}from"./dialog-B5U1mpo5.js";import{b as S,C as ee,T as se}from"./newsletterTemplate-B6b44_iV.js";import{g as ae,b as te,h as ie,i as re,j as ne}from"./useNewsletter-9H7jxTAF.js";import{g as E}from"./supabaseErrors-eYWJjREL.js";import{E as oe,a as le}from"./eye-E_KJswo8.js";import{L as de}from"./loader-circle-DnF7ebpD.js";import{C as L,a as k,b as P,c as H}from"./card-FvmdAdt7.js";import{T as ce,a as me,b as y,c as N,d as xe,e as j,A as ue,f as he,g as pe,h as je,i as ve,j as ge,k as fe,l as Ne}from"./alert-dialog-Ejy4wBfg.js";import{S as b}from"./skeleton-DlXhQc5K.js";import"./chevron-left-B6XPOTh1.js";import"./house-HIG3P3VO.js";import"./file-text-BMME2LbX.js";import"./mail-DmCJRpfO.js";import"./index-4U0UhDdA.js";import"./index-DS4TtjAo.js";import"./index-IObd9uXq.js";import"./index-DoZP8mze.js";import"./index-DW6qo_HE.js";import"./dropdown-menu-Bn0ksYvc.js";import"./chevron-right-CEcNQJO3.js";import"./check-DK1fWxKI.js";import"./link-DX6tzafM.js";import"./list-CwyJUOkX.js";import"./quote-CEKYytTi.js";import"./trash-2-DXGi4PDu.js";import"./useMutation-a59Q_35T.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=q("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);function Ce(){const[i,v]=l.useState(!1),[d,p]=l.useState(""),[c,u]=l.useState(""),[h,m]=l.useState("visual"),[n,g]=l.useState(!1),o=ae(),{toast:r}=F(),w=async()=>{if(!d.trim()){r({title:"Assunto obrigat√≥rio",description:"Informe o assunto do e-mail.",variant:"destructive"});return}if(!c.trim()){r({title:"Conte√∫do obrigat√≥rio",description:"Escreva o conte√∫do do e-mail.",variant:"destructive"});return}try{const t=S({title:d.trim(),content:c,postUrl:"https://marianalima.adv.br"});await o.mutateAsync({subject:d.trim(),html:t,post_id:""}),r({title:"Campanha criada!",description:"A campanha foi criada com os deliveries na fila."}),p(""),u(""),g(!1),m("visual"),v(!1)}catch(t){r({title:"Erro ao criar campanha",description:E(t,"N√£o foi poss√≠vel criar a campanha."),variant:"destructive"})}},a=()=>{v(!1),p(""),u(""),g(!1),m("visual")},C=S({title:d.trim()||"Assunto do e-mail",content:c||"<p>Conte√∫do do e-mail aparecer√° aqui...</p>",postUrl:"https://marianalima.adv.br"});return e.jsxs(J,{open:i,onOpenChange:t=>t?v(!0):a(),children:[e.jsx(K,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Nova campanha"]})}),e.jsxs(Q,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Nova campanha manual"}),e.jsx(Z,{children:"Crie uma campanha sem v√≠nculo a um post. O conte√∫do ser√° enviado a todos os inscritos ativos."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-2 pr-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"campaign-subject",children:"Assunto do e-mail *"}),e.jsx(V,{id:"campaign-subject",value:d,onChange:t=>p(t.target.value),placeholder:"Novidades do escrit√≥rio...",maxLength:200})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{children:"Conte√∫do *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n&&e.jsx(W,{value:h,onValueChange:t=>m(t),children:e.jsxs(G,{className:"h-8",children:[e.jsxs(A,{value:"visual",className:"text-xs px-3",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Visual"]}),e.jsxs(A,{value:"html",className:"text-xs px-3",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"HTML"]})]})}),e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>g(!n),children:n?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Editar"]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Preview"]})})]})]}),n?e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-muted/30",children:[e.jsx("div",{className:"bg-muted/50 px-4 py-2 border-b border-border",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Preview do e-mail completo (como ser√° recebido pelo inscrito)"})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto",children:e.jsx("iframe",{srcDoc:C,title:"Email Preview",className:"w-full min-h-[350px] border-0 rounded bg-background",sandbox:"allow-same-origin"})})]}):h==="visual"?e.jsx("div",{className:"min-h-[300px]",children:e.jsx(se,{content:c,onChange:u,placeholder:"Escreva o conte√∫do da campanha..."})}):e.jsx(U,{value:c,onChange:t=>u(t.target.value),placeholder:"<p>Conte√∫do do e-mail em HTML...</p>",className:"min-h-[300px] font-mono text-sm"}),!n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"üí° O conte√∫do ser√° automaticamente envolvido no template de e-mail do escrit√≥rio, com logo, footer e link de descadastro."})]})]}),e.jsxs($,{className:"pt-4 border-t border-border",children:[e.jsx(x,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsxs(x,{onClick:w,disabled:o.isPending,children:[o.isPending?e.jsx(de,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(T,{className:"w-4 h-4 mr-2"}),"Criar campanha"]})]})]})]})}const I={draft:"Rascunho",queued:"Fila",sending:"Enviando",sent:"Enviada",partial:"Parcial",failed:"Falhou"},we={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},M=i=>i?new Date(i).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî",ts=()=>{const{data:i,isLoading:v}=te(),[d,p]=l.useState(null),[c,u]=l.useState(null),[h,m]=l.useState(null),{toast:n}=F(),g=ie(),o=re(),{data:r,isLoading:w}=ne(d),a=(r==null?void 0:r.campaign)??null,C=r==null?void 0:r.deliveryCounts,t=l.useMemo(()=>((i==null?void 0:i.length)??0)>0,[i]),O=s=>["draft","queued","partial"].includes(s),z=async s=>{u(s);try{await g.mutateAsync(s),n({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(f){const _=E(f,"N√£o foi poss√≠vel iniciar o envio.");n({title:"Erro ao enviar",description:_,variant:"destructive"})}finally{u(null)}},R=async()=>{if(h)try{await o.mutateAsync(h),n({title:"Campanha exclu√≠da",description:"A campanha foi removida com sucesso."}),d===h&&p(null)}catch(s){const f=E(s,"N√£o foi poss√≠vel excluir a campanha.");n({title:"Erro ao excluir",description:f,variant:"destructive"})}finally{m(null)}};return e.jsxs(B,{title:"Campanhas de Newsletter",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("div",{}),e.jsx(Ce,{})]}),e.jsxs(L,{className:"mb-6",children:[e.jsx(k,{children:e.jsx(P,{children:"Campanhas"})}),e.jsx(H,{children:v?e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{className:"h-8 w-full"}),e.jsx(b,{className:"h-8 w-full"}),e.jsx(b,{className:"h-8 w-full"})]}):e.jsxs(ce,{children:[e.jsx(me,{children:e.jsxs(y,{children:[e.jsx(N,{children:"Assunto"}),e.jsx(N,{children:"Status"}),e.jsx(N,{children:"Criado em"}),e.jsx(N,{children:"Enviado em"}),e.jsx(N,{className:"text-right",children:"A√ß√µes"})]})}),e.jsx(xe,{children:t?i==null?void 0:i.map(s=>e.jsxs(y,{children:[e.jsx(j,{className:"font-medium",children:s.subject}),e.jsx(j,{children:I[s.status]??s.status}),e.jsx(j,{children:M(s.created_at)}),e.jsx(j,{children:M(s.sent_at)}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[O(s.status)&&e.jsx(x,{variant:"default",size:"sm",onClick:()=>z(s.id),disabled:c===s.id,children:c===s.id?"Enviando...":"Enviar agora"}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>p(s.id),children:"Ver detalhes"}),e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>m(s.id),disabled:o.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(y,{children:e.jsx(j,{colSpan:5,className:"text-center text-muted-foreground py-8",children:'Nenhuma campanha cadastrada ainda. As campanhas s√£o criadas automaticamente ao publicar posts com a op√ß√£o "Enviar newsletter" ativada.'})})})]})})]}),e.jsxs(L,{children:[e.jsx(k,{children:e.jsx(P,{children:"Detalhes da campanha"})}),e.jsx(H,{children:w?e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{className:"h-6 w-1/2"}),e.jsx(b,{className:"h-24 w-full"})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3",children:e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>m(a.id),disabled:o.isPending,children:"Excluir campanha"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assunto"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:I[a.status]??a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Post relacionado"}),a.post?e.jsxs("div",{className:"text-base font-medium text-foreground",children:[a.post.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["/blog/",a.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"‚Äî"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resumo de envios"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mt-2",children:Object.entries(we).map(([s,f])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:f}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:C?C[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview HTML"}),e.jsx("div",{className:"mt-2 max-h-[320px] overflow-auto rounded-lg border border-border bg-background p-4",children:a.html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:a.html}}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem conte√∫do HTML."})})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma campanha para ver os detalhes."})})]}),e.jsx(ue,{open:!!h,onOpenChange:()=>m(null),children:e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(je,{children:"Excluir campanha?"}),e.jsx(ve,{children:"Esta a√ß√£o remove a campanha e seu hist√≥rico de envios. Essa a√ß√£o n√£o pode ser desfeita."})]}),e.jsxs(ge,{children:[e.jsx(fe,{children:"Cancelar"}),e.jsx(Ne,{onClick:R,disabled:o.isPending,children:o.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{ts as default};
