import{r as j,j as e,X as S,L as U,t as p}from"./index-vkSbvdJQ.js";import{A as X,M}from"./AdminLayout-DK1K1dE0.js";import{T as G,a as J,b as F,c as o,d as K,e as d,A as Q,f as W,g as Y,h as Z,i as ee,j as se,k as te,l as ae}from"./alert-dialog-CuQ7NKN1.js";import{B as g}from"./button-rvQRTKtB.js";import{B as R}from"./badge-CoGvpl8T.js";import{f as re,h as le,e as ie}from"./usePostInteractions-Dh-BzuG_.js";import{g as y}from"./supabaseErrors-eYWJjREL.js";import{a as B,C as H}from"./chevron-up-DWbT6KRN.js";import{C as P}from"./check-scEJn4lK.js";import{E as ne}from"./external-link-CklcHcW9.js";import{f as L,p as O}from"./pt-BR-BnWYOt86.js";import{C as w,c as b}from"./card-DvR8mTpw.js";import{S as oe}from"./skeleton-BqMKsuZM.js";import{T as de,a as ce,b as C}from"./tabs-HT6lKb6x.js";import{C as V}from"./clock-CiEFsXUC.js";import{C as z}from"./circle-alert-CWFQAMke.js";import{C as $}from"./circle-check-big-DSLGGFtZ.js";import"./chevron-left-KWiV1Phe.js";import"./house-Cpprpp-n.js";import"./file-text-CuluadDo.js";import"./mail-C3bHdm0I.js";import"./index-B3xCLgfa.js";import"./index-B6KRPo5n.js";import"./useMutation-DdO9mrS-.js";import"./index-C7vSMApN.js";import"./index-DCzPQUUp.js";function xe({comments:m,filter:n}){const[a,c]=j.useState(!1),[x,h]=j.useState(null),[i,u]=j.useState(new Set),r=re(),v=le(),N=m.filter(s=>n==="pending"?!s.reviewed_at:n==="approved"?!!s.reviewed_at:!0),D=s=>{const t=new Set(i);t.has(s)?t.delete(s):t.add(s),u(t)},A=(s,t)=>{var E,k;const l=((E=s.mladv_posts)==null?void 0:E.title)||"Post não encontrado",f=(k=s.mladv_posts)==null?void 0:k.slug,I=e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"line-clamp-2 text-sm",children:l}),f&&e.jsx(ne,{className:"w-3 h-3 flex-shrink-0"})]});return f?e.jsx(U,{to:`/blog/${f}`,target:"_blank",className:`text-foreground/90 hover:text-primary hover:underline flex items-center gap-1 ${t??""}`,children:I}):e.jsx("div",{className:`text-foreground/70 flex items-center gap-1 ${t??""}`,children:e.jsx("span",{className:"line-clamp-2 text-sm",children:l})})},T=async s=>{try{await r.mutateAsync({commentId:s}),p({title:"Comentário mantido",description:"O comentário foi marcado como revisado."})}catch(t){const l=y(t,"Não foi possível aprovar o comentário.");p({title:"Erro ao aprovar",description:l,variant:"destructive"})}},q=async()=>{if(x)try{await v.mutateAsync(x),p({title:"Comentário excluído",description:"O comentário foi removido permanentemente."})}catch(s){const t=y(s,"Não foi possível excluir o comentário.");p({title:"Erro ao excluir",description:t,variant:"destructive"})}finally{c(!1),h(null)}},_=s=>{h(s),c(!0)};return N.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:n==="pending"?"Nenhum comentário novo para revisar.":n==="approved"?"Nenhum comentário revisado ainda.":"Nenhum comentário encontrado."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block rounded-lg border border-border overflow-hidden",children:e.jsxs(G,{children:[e.jsx(J,{children:e.jsxs(F,{className:"bg-muted/50",children:[e.jsx(o,{className:"w-[200px]",children:"Post"}),e.jsx(o,{className:"w-[150px]",children:"Autor"}),e.jsx(o,{children:"Comentário"}),e.jsx(o,{className:"w-[120px]",children:"Data"}),e.jsx(o,{className:"w-[100px]",children:"Status"}),e.jsx(o,{className:"w-[100px] text-right",children:"Ações"})]})}),e.jsx(K,{children:N.map(s=>{const t=i.has(s.id),l=s.content.length>100;return e.jsxs(F,{children:[e.jsx(d,{children:A(s)}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.author_email})]})}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:!t&&l?"line-clamp-2":"",children:s.content}),l&&e.jsx("button",{onClick:()=>D(s.id),className:"text-xs text-primary hover:underline mt-1 flex items-center gap-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-3 h-3"})," Ver menos"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-3 h-3"})," Ver mais"]})})]})}),e.jsx(d,{className:"text-sm text-muted-foreground",children:L(new Date(s.created_at),"dd/MM/yyyy HH:mm",{locale:O})}),e.jsx(d,{children:e.jsx(R,{variant:s.reviewed_at?"default":"secondary",className:s.reviewed_at?"bg-green-500/20 text-green-600 hover:bg-green-500/30":"bg-yellow-500/20 text-yellow-600 hover:bg-yellow-500/30",children:s.reviewed_at?"Revisado":"Novo"})}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[!s.reviewed_at&&e.jsx(g,{size:"icon",variant:"ghost",className:"h-8 w-8 text-green-600 hover:text-green-700 hover:bg-green-500/10",onClick:()=>T(s.id),disabled:r.isPending,title:"Manter comentário",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(g,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>_(s.id),disabled:v.isPending,title:"Excluir comentário",children:e.jsx(S,{className:"w-4 h-4"})})]})})]},s.id)})})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:N.map(s=>{const t=i.has(s.id),l=s.content.length>100;return e.jsxs("div",{className:"bg-card rounded-lg border border-border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.author_email})]}),e.jsx(R,{variant:s.reviewed_at?"default":"secondary",className:s.reviewed_at?"bg-green-500/20 text-green-600":"bg-yellow-500/20 text-yellow-600",children:s.reviewed_at?"Revisado":"Novo"})]}),A(s,"text-xs"),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:!t&&l?"line-clamp-3":"",children:s.content}),l&&e.jsx("button",{onClick:()=>D(s.id),className:"text-xs text-primary hover:underline mt-1 flex items-center gap-1",children:t?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-3 h-3"})," Ver menos"]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-3 h-3"})," Ver mais"]})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-border",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:L(new Date(s.created_at),"dd/MM/yyyy HH:mm",{locale:O})}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.reviewed_at&&e.jsxs(g,{size:"sm",variant:"ghost",className:"h-8 text-green-600 hover:text-green-700 hover:bg-green-500/10",onClick:()=>T(s.id),disabled:r.isPending,children:[e.jsx(P,{className:"w-4 h-4 mr-1"}),"Manter"]}),e.jsxs(g,{size:"sm",variant:"ghost",className:"h-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>_(s.id),disabled:v.isPending,children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Excluir"]})]})]})]},s.id)})}),e.jsx(Q,{open:a,onOpenChange:c,children:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Excluir comentário?"}),e.jsx(ee,{children:"Esta ação não pode ser desfeita. O comentário será removido permanentemente."})]}),e.jsxs(se,{children:[e.jsx(te,{children:"Cancelar"}),e.jsx(ae,{onClick:q,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}const Le=()=>{const[m,n]=j.useState("pending"),{data:a,isLoading:c,error:x}=ie(),h=(a==null?void 0:a.length)||0,i=(a==null?void 0:a.filter(r=>!r.reviewed_at).length)||0,u=(a==null?void 0:a.filter(r=>!!r.reviewed_at).length)||0;return e.jsxs(X,{title:"Moderação de Comentários",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-8",children:[e.jsx(w,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-primary/10",children:e.jsx(M,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:h}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de comentários"})]})]})})}),e.jsx(w,{className:i>0?"ring-2 ring-yellow-500/50":"",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-yellow-500/10",children:e.jsx(V,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:i}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Novos"})]}),i>0&&e.jsx(z,{className:"w-5 h-5 text-yellow-500 ml-auto"})]})})}),e.jsx(w,{children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-green-500/10",children:e.jsx($,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Revisados"})]})]})})})]}),e.jsx("div",{className:"mb-6 -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsx(de,{value:m,onValueChange:r=>n(r),children:e.jsxs(ce,{className:"w-full sm:w-auto flex",children:[e.jsxs(C,{value:"pending",className:"flex-1 sm:flex-none gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-4",children:[e.jsx(V,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Novos"}),e.jsx("span",{className:"xs:hidden",children:"Novos"}),i>0&&e.jsx("span",{className:"ml-0.5 sm:ml-1 px-1.5 sm:px-2 py-0.5 text-[10px] sm:text-xs rounded-full bg-yellow-500/20 text-yellow-600",children:i})]}),e.jsxs(C,{value:"approved",className:"flex-1 sm:flex-none gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-4",children:[e.jsx($,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Revisados"}),e.jsx("span",{className:"xs:hidden",children:"Rev."})]}),e.jsxs(C,{value:"all",className:"flex-1 sm:flex-none gap-1 sm:gap-2 text-xs sm:text-sm px-2 sm:px-4",children:[e.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"}),"Todos"]})]})})}),c?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(r=>e.jsx(oe,{className:"h-20 w-full"},r))}):x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(z,{className:"w-12 h-12 text-destructive mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:y(x,"Erro ao carregar comentários. Verifique se as tabelas foram criadas no banco de dados.")})]}):e.jsx(xe,{comments:a||[],filter:m})]})};export{Le as default};
