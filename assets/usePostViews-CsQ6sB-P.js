import{r as a,$ as o,s as n}from"./index-bbQFiBMP.js";import{g as u}from"./usePostInteractions-C1Bp2H7U.js";function p(t){const e=a.useRef(!1);a.useEffect(()=>{if(!t||e.current)return;(async()=>{const s=u(),i=new Date().toISOString().split("T")[0];try{await n.from("mladv_post_views").insert({post_id:t,viewer_fingerprint:s,viewed_date:i,user_agent:navigator.userAgent.substring(0,255),referrer:document.referrer.substring(0,500)||null}),e.current=!0}catch{console.debug("View tracking skipped (likely duplicate)")}})()},[t])}function w(){return o({queryKey:["all-posts-view-counts"],queryFn:async()=>{const{data:t,error:e}=await n.from("mladv_post_views").select("post_id");if(e)throw e;const r={};return(t||[]).forEach(s=>{r[s.post_id]=(r[s.post_id]||0)+1}),r}})}function d(){return o({queryKey:["total-view-count"],queryFn:async()=>{const{count:t,error:e}=await n.from("mladv_post_views").select("*",{count:"exact",head:!0});if(e)throw e;return t??0}})}export{d as a,w as b,p as u};
