import{r as L,j as e}from"./index-CBKbDdfZ.js";import{u as B,F as D,a as l,b as i,c as n,d as c,e as d,t as M}from"./form-_osZiHEt.js";import{S as O,b as R,c as _,d as z,e as G,f as q}from"./sheet-D1lg-Wii.js";import{I as p}from"./input-DJQ3KMhp.js";import{B as C}from"./button-D7qP377h.js";import{T as J}from"./textarea-nXkd-R7d.js";import{S as y,a as N,b as I,c as T,d as g}from"./select-Bz0W1g4z.js";import{f as K,b as Q}from"./crmTypes-BpGos2A4.js";import{u as U}from"./useCrmFieldOptions-jBbz-4hK.js";import{C as W}from"./ClientSelect-CJ04VGZ_.js";import{T as X}from"./trash-2-DTUK66cE.js";import{L as Y}from"./loader-circle-CZFBpDtK.js";import{o as Z,s as r}from"./types-3c7sL9OC.js";const $=Z({title:r().trim().min(1,"Título obrigatório").max(200),date:r().min(1,"Data obrigatória"),time:r().optional(),endTime:r().optional(),type:r().min(1),status:r().min(1),clientId:r().optional(),clientName:r().optional(),projectId:r().optional(),location:r().max(300).optional(),description:r().max(2e3).optional()});function xe({open:S,onOpenChange:h,event:a,defaultClientName:V,onSave:E,onDelete:w}){const j=!a,[u,v]=L.useState(!1),{clients:b}=K(),{projects:f}=Q(),{getOptions:F}=U(),A=F("agenda_tipo"),k=F("agenda_status"),o=B({resolver:M($),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});L.useEffect(()=>{if(S)if(a){const s=b.find(m=>{var x;return m.name.toLowerCase()===((x=a.client)==null?void 0:x.toLowerCase())}),t=f.find(m=>{var x;return m.name.toLowerCase()===((x=a.client)==null?void 0:x.toLowerCase())});o.reset({title:a.title,date:a.date,time:a.time??"",endTime:a.endTime??"",type:a.type,status:a.status,clientId:(s==null?void 0:s.id)??"",clientName:a.client??"",projectId:(t==null?void 0:t.id)??"",location:a.location??"",description:a.description??""})}else{const s=V??"",t=b.find(m=>m.name.toLowerCase()===s.toLowerCase());o.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:(t==null?void 0:t.id)??"",clientName:s,projectId:"",location:"",description:""})}},[S,a,b,f]);const H=s=>{if(o.setValue("projectId",s),!o.getValues("clientName")&&s!=="none"){const t=f.find(m=>m.id===s);t&&o.setValue("clientName",t.name)}},P=async s=>{v(!0);try{const t=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await E({...s,projectAirtableId:t},j),h(!1)}finally{v(!1)}};return e.jsx(O,{open:S,onOpenChange:h,children:e.jsxs(R,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(_,{className:"mb-6",children:[e.jsx(z,{children:j?"Novo Compromisso":"Editar Compromisso"}),e.jsx(G,{children:j?"Preencha os dados e salve para criar o compromisso.":"Altere os campos e salve."})]}),e.jsx(D,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(P),className:"space-y-5",children:[e.jsx(l,{control:o.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Título *"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Data *"}),e.jsx(c,{children:e.jsx(p,{type:"date",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"time",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Hora início"}),e.jsx(c,{children:e.jsx(p,{type:"time",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:o.control,name:"endTime",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Hora término"}),e.jsx(c,{children:e.jsx(p,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Tipo *"}),e.jsxs(y,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(I,{})})}),e.jsx(T,{children:A.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Status *"}),e.jsxs(y,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(I,{})})}),e.jsx(T,{children:k.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})})]}),e.jsxs(i,{children:[e.jsx(n,{children:"Projeto"}),e.jsxs(y,{onValueChange:H,value:o.watch("projectId")||"",children:[e.jsx(N,{children:e.jsx(I,{placeholder:"Selecione um projeto..."})}),e.jsxs(T,{children:[e.jsx(g,{value:"none",children:"— Sem projeto —"}),f.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(i,{children:[e.jsx(n,{children:"Cliente"}),e.jsx(W,{value:o.watch("clientName")||"",onValueChange:(s,t)=>{o.setValue("clientName",s),o.setValue("clientId",t)}})]}),e.jsx(l,{control:o.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Local / Link"}),e.jsx(c,{children:e.jsx(p,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Descrição / Observações"}),e.jsx(c,{children:e.jsx(J,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsxs(q,{className:"pt-2 gap-2 flex-col sm:flex-row",children:[!j&&a&&w&&e.jsxs(C,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{w(a.id),h(!1)},disabled:u,children:[e.jsx(X,{className:"w-4 h-4 mr-2"})," Excluir"]}),e.jsx(C,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:u,children:"Cancelar"}),e.jsxs(C,{type:"submit",disabled:u,children:[u&&e.jsx(Y,{className:"w-4 h-4 mr-2 animate-spin"}),j?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{xe as A};
