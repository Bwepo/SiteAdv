import{c as Rs,r as l,$ as dt,j as e,e as b,s as mt,Z as xt,_ as ut,an as ht,l as qe}from"./index-BbYBTSnr.js";import{A as pt,L as gt,B as V,P as ps}from"./AdminLayout-96K9ZAW6.js";import{C as D,c as E,a as Ue,b as Ge}from"./card-BrKoq-Dh.js";import{B as S}from"./button-A1Qu9K1N.js";import{I as gs}from"./input-DG1fOFyT.js";import{S as jt,C as ft}from"./checkbox-DE9EhGfw.js";import{T as bt,a as Nt,b as oe,c as ce}from"./tabs-gm3RP8Eo.js";import{P as vt}from"./progress-ru_7Qom6.js";import{S as q,a as U,b as G,d as Q,e as P}from"./select-CXp2WOl0.js";import{A as js,a as fs,b as bs,c as Ns,d as vs,e as ys,f as Ss,g as ws}from"./alert-dialog-Cy5Phfoi.js";import{T as me,E as Qe,a as De,c as Je,e as We,b as yt,d as ts}from"./crmTypes-C2SECzd8.js";import{S as St}from"./SyncToolbar-DBIqG5M9.js";import{B as wt,a as ks}from"./CrmSkeletons-BVgRzQ4k.js";import{T as kt}from"./TarefaSheet-Bk7_dDFm.js";import{A as Ct}from"./AgendaEventSheet-DLZLcnfI.js";import{u as Tt,a as Dt,C as Et,A as At,D as Mt,c as Lt,b as Bt,S as It,G as Ot,d as Rt,e as Pt,v as _t,P as $t,f as zt,g as Ft}from"./SubtarefasTab-DuyqwAM8.js";import{S as Ze}from"./skeleton-DW_q9c4W.js";import{C as Ps}from"./dialog-CA-CmOks.js";import{C as as}from"./chevron-right-MQg7O8sp.js";import{E as Vt}from"./eye-Db0MYnoP.js";import{B as Kt}from"./building-2-B5qZzLYB.js";import{C as Le}from"./calendar-Bdfdodqk.js";import{C as Cs}from"./clock-BWCSRoEN.js";import{T as Ts}from"./triangle-alert-DeOibraT.js";import{C as Ds}from"./circle-check-Ca1wjF8M.js";import{T as Yt}from"./trending-up-CXlHnTFK.js";import{C as Ht}from"./chart-column-DBRQ1Wc6.js";import{F as qt}from"./file-text-nOCnpWv9.js";import{S as Es}from"./search-AxxJVOh1.js";import{L as As}from"./list-D2FUAJEi.js";import{M as Ut}from"./map-pin-bTwzVTuw.js";import{P as _s}from"./pencil-Cdi3DF-g.js";import{T as $s}from"./trash-2-D5_UNS_X.js";import{C as Gt}from"./chevron-up-B4A-Sec2.js";import"./heart-B3wopCk0.js";import"./sparkles-Dg2vWfD2.js";import"./ThemeToggle-Qn75DwrM.js";import"./house-BFexXjjp.js";import"./users-BPns1ADy.js";import"./index-BtZmYU82.js";import"./check-2jopwpsj.js";import"./index-BPZazOHh.js";import"./index-DqC36S2S.js";import"./index-C9pD9JTc.js";import"./form-YWQ5eGdb.js";import"./label-DqmsxqQH.js";import"./textarea-qOUF9bEB.js";import"./separator-BOlnme_o.js";import"./loader-circle-DXmV-T6n.js";import"./circle-EWLdRiYE.js";import"./types-C9wiu8_K.js";import"./popover-9DOqPUDK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=Rs("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=Rs("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]),Zt=n=>mt.from(n),de=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];function Xe(n){if(!n)return"";const t=String(n).slice(0,10);return/^\d{4}-\d{2}-\d{2}$/.test(t)?t:""}function Ms(n){const t=Xe(n);return t?`${t.slice(8,10)}/${t.slice(5,7)}/${t.slice(0,4)}`:String(n||"")}function Ls(n){if(typeof n=="boolean")return n;if(typeof n=="number")return n!==0;const t=String(n??"").trim().toLowerCase();return["true","yes","sim","1","checked","on","x"].includes(t)}function Bs(n){const t=Number(n.slice(0,4));let d=Number(n.slice(5,7))-1+1,u=t;return d>11&&(d=0,u=t+1),{anoRef:u,mesRef:d}}function Jt(n){const t=String(n||"").trim().toLowerCase();return t.includes("conclu")||t.includes("finaliz")||t.includes("encerrad")?{label:"Concluído",kind:"done",order:0}:t.includes("andamento")||t.includes("trâmite")||t.includes("tramite")||t.includes("process")?{label:t.includes("trâmite")||t.includes("tramite")?"Em trâmite":"Em andamento",kind:"wip",order:1}:t.includes("agend")?{label:"Agendado",kind:"sched",order:2}:{label:n||"—",kind:"other",order:3}}function Xt(n){const t=n.match(/\s*\(([^)]+)\)\s*$/);return t?{titulo:n.replace(/\s*\(([^)]+)\)\s*$/,"").trim(),projeto:t[1].trim()}:{titulo:n,projeto:""}}function ea(n){if(!n)return"";const t=String(n).split(/\r?\n/).map(c=>c.trim()).filter(Boolean);for(let c of t){c=c.replace(/^#{1,6}\s+/,"").replace(/^\d+\)\s+/,"").replace(/^(-|•|o)\s+/i,"");const d=c.replace(/\*\*(.+?)\*\*/g,"$1").replace(/[_`]+/g,"").replace(/\s+/g," ").trim();if(d)return d.length>140?d.slice(0,137).trim()+"...":d}return""}function sa(n){if(!n)return e.jsx("span",{className:"text-muted-foreground text-xs italic",children:"Sem observações registradas."});const t=String(n).split(/\r?\n/).map(h=>h.trim()).filter(Boolean),c=[];let d=[],u=0;const g=h=>h.split(/\*\*(.+?)\*\*/g).map((w,T)=>T%2===1?e.jsx("strong",{children:w},T):w),N=()=>{d.length&&(c.push(e.jsx("ul",{className:"list-disc list-inside space-y-0.5 text-xs leading-relaxed ml-2",children:d.map((h,C)=>e.jsx("li",{children:g(h)},C))},u++)),d=[])};for(const h of t){const C=h.match(/^#{1,6}\s+(.+)$/);if(C){N(),c.push(e.jsx("p",{className:"text-xs font-bold mt-2 mb-1",children:g(C[1])},u++));continue}const w=h.match(/^(\d+)\)\s+(.+)$/);if(w){N(),c.push(e.jsxs("p",{className:"text-xs font-bold mt-2 mb-1",children:[w[1],") ",g(w[2])]},u++));continue}const T=h.match(/^\*\*(.+?)\*\*:?$/);if(T){N(),c.push(e.jsx("p",{className:"text-xs font-bold mt-2 mb-1",children:g(T[1])},u++));continue}if(/^(-|•|o)\s+/i.test(h)){d.push(h.replace(/^(-|•|o)\s+/i,""));continue}N(),c.push(e.jsx("p",{className:"text-xs leading-relaxed",children:g(h)},u++))}return N(),e.jsx(e.Fragment,{children:c})}const zs={done:"bg-green-100 text-green-800 border-green-200",wip:"bg-amber-100 text-amber-800 border-amber-200",sched:"bg-orange-100 text-orange-700 border-orange-200",other:"bg-muted text-muted-foreground border-border"};async function ta(){const{data:n,error:t}=await Zt("mladv_crm_tarefas").select("titulo, status, deadline, descricao, raw_fields").ilike("cliente","%bosi%");if(t)throw t;return n||[]}function aa(){const n=l.useRef(null),t=new Date,[c,d]=l.useState(t.getFullYear()),[u,g]=l.useState(t.getMonth()),{data:N,isLoading:h}=dt({queryKey:["crm","bosi-report"],queryFn:ta}),C=l.useMemo(()=>{if(!N)return[];const r=new Set;return N.forEach(j=>{const k=j.raw_fields||{};if(!Ls(k.Bosi))return;const p=Xe(k.Date);if(!p)return;const A=Bs(p);r.add(`${A.anoRef}-${String(A.mesRef).padStart(2,"0")}`)}),Array.from(r).sort().reverse()},[N]),w=()=>{u===0?(g(11),d(r=>r-1)):g(r=>r-1)},T=()=>{u===11?(g(0),d(r=>r+1)):g(r=>r+1)},L=c===t.getFullYear()&&u===t.getMonth(),i=l.useMemo(()=>{if(!N)return null;const r=c,j=u,k=N.filter(m=>{const M=m.raw_fields||{};if(!Ls(M.Bosi))return!1;const _=Xe(M.Date);if(!_)return!1;const Y=Bs(_);return Y.anoRef===r&&Y.mesRef===j});if(k.length===0)return null;const p=k.filter(m=>m.titulo&&m.titulo.toLowerCase()!=="tarefa sem nome").map(m=>{var ee;const M=Jt(m.status),_=((ee=m.raw_fields)==null?void 0:ee.Observações)||m.descricao||null,{titulo:Y,projeto:H}=Xt(m.titulo);return{titulo:m.titulo,observacoes:_,deadline:m.deadline,statusLabel:M.label,statusKind:M.kind,statusOrder:M.order,projeto:H,tituloClean:Y}}).sort((m,M)=>m.statusOrder!==M.statusOrder?m.statusOrder-M.statusOrder:m.tituloClean.localeCompare(M.tituloClean,"pt-BR"));let A=j-1,Z=r;A<0&&(A=11,Z=r-1);const R=new Date(Z,A+1,0).getDate(),Oe=p.length,J=p.filter(m=>m.statusKind==="done").length,Re=p.filter(m=>m.statusKind==="wip").length,je=p.filter(m=>m.statusKind==="sched").length,fe=p.filter(m=>m.observacoes).slice(0,3).map(m=>({titulo:m.tituloClean,projeto:m.projeto,impacto:ea(m.observacoes),statusLabel:m.statusLabel,statusKind:m.statusKind})),X=new Date;return{tasks:p,periodoTxt:`01 a ${String(R).padStart(2,"0")} de ${de[A]} de ${Z}`,mesAno:`${de[j]} de ${r}`,geradoEm:Ms(`${X.getFullYear()}-${String(X.getMonth()+1).padStart(2,"0")}-${String(X.getDate()).padStart(2,"0")}`),reportId:`${r}-${String(j+1).padStart(2,"0")}`,total:Oe,concluidas:J,emAndamento:Re,agendado:je,destaques:fe}},[N,c,u]),B=l.useCallback(()=>{if(!n.current)return;const r=window.open("","_blank");if(!r)return;const j=n.current.innerHTML,p=Array.from(document.querySelectorAll('style, link[rel="stylesheet"]')).map(A=>A.outerHTML).join(`
`);r.document.write(`
      <!DOCTYPE html>
      <html lang="pt-br">
      <head>
        <meta charset="UTF-8">
        <title>Relatório Executivo – ${(i==null?void 0:i.mesAno)||""}</title>
        ${p}
        <style>
          @page { size: A4; margin: 12mm; }
          * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
          body { margin: 0; padding: 0; background: white; }
          .page-break { page-break-before: always; break-before: page; }
          @media print { body { padding: 0; } }
        </style>
      </head>
      <body>
        <div class="bg-white text-slate-900 p-6 sm:p-8 max-w-[680px] mx-auto">${j}</div>
      </body>
      </html>
    `),r.document.close(),setTimeout(()=>{r.print()},500)},[i]);if(h)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Ze,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(r=>e.jsx(Ze,{className:"h-20"},r))}),e.jsx(Ze,{className:"h-64"})]});const K=!i||i.total===0,I=(i==null?void 0:i.tasks)??[],O=(i==null?void 0:i.periodoTxt)??"",W=(i==null?void 0:i.mesAno)??"",xe=(i==null?void 0:i.geradoEm)??"",ue=(i==null?void 0:i.reportId)??"",he=(i==null?void 0:i.total)??0,pe=(i==null?void 0:i.concluidas)??0,Be=(i==null?void 0:i.emAndamento)??0,Ie=(i==null?void 0:i.agendado)??0,ge=(i==null?void 0:i.destaques)??[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:w,children:e.jsx(Ps,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{value:String(u),onValueChange:r=>g(Number(r)),children:[e.jsx(U,{className:"w-[130px] h-8 text-xs capitalize",children:e.jsx(G,{})}),e.jsx(Q,{children:de.map((r,j)=>e.jsx(P,{value:String(j),className:"capitalize",children:r},j))})]}),e.jsxs(q,{value:String(c),onValueChange:r=>d(Number(r)),children:[e.jsx(U,{className:"w-[80px] h-8 text-xs",children:e.jsx(G,{})}),e.jsx(Q,{children:Array.from({length:5},(r,j)=>t.getFullYear()-j).map(r=>e.jsx(P,{value:String(r),children:r},r))})]})]}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:T,disabled:L,children:e.jsx(as,{className:"w-4 h-4"})}),!L&&e.jsx(S,{variant:"outline",size:"sm",className:"text-xs h-8",onClick:()=>{d(t.getFullYear()),g(t.getMonth())},children:"Mês atual"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(S,{variant:"outline",size:"sm",onClick:B,className:"gap-1.5",disabled:K,children:[e.jsx(Qt,{className:"w-3.5 h-3.5"}),"Exportar PDF"]}),e.jsxs(S,{variant:"outline",size:"sm",disabled:K,onClick:B,className:"gap-1.5",children:[e.jsx(Wt,{className:"w-3.5 h-3.5"}),"Imprimir"]})]})]}),K?e.jsx(D,{children:e.jsxs(E,{className:"p-8 text-center text-muted-foreground",children:[e.jsx(Vt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm font-medium",children:["Nenhuma tarefa BOSI encontrada para ",de[u]," de ",c,"."]}),e.jsx("p",{className:"text-xs mt-1",children:'Verifique se as tarefas possuem o campo "Bosi" marcado e "Date" preenchido no Airtable.'}),C.length>0&&e.jsxs("p",{className:"text-xs mt-2 text-muted-foreground",children:["Meses com dados: ",C.slice(0,6).map(r=>{const[j,k]=r.split("-");return`${de[Number(k)]}/${j}`}).join(", ")]})]})}):e.jsx(e.Fragment,{children:e.jsx(D,{className:"overflow-hidden",children:e.jsx(E,{className:"p-0",children:e.jsxs("div",{ref:n,className:"bg-white text-slate-900 p-6 sm:p-8 max-w-[680px] mx-auto",children:[e.jsxs("div",{className:"report-header pb-3 mb-4 border-b-2 border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/logo-horizontal_transparent.png",alt:"Mariana Lima Advocacia",style:{maxHeight:70}}),e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/bosi_logo.png",alt:"BOSI",style:{maxHeight:34}})]}),e.jsxs("h1",{className:"text-lg font-extrabold text-slate-900",children:["Atuação jurídica do período – ",W]}),e.jsxs("p",{className:"subtitle text-xs text-slate-500 mt-1",children:["Período: ",O]})]}),e.jsxs("div",{className:"kpi-grid grid grid-cols-2 sm:grid-cols-4 gap-2.5 mb-5",children:[e.jsx(Ee,{label:"Total",value:he,kind:"other"}),e.jsx(Ee,{label:"Concluídas",value:pe,kind:"done"}),e.jsx(Ee,{label:"Em andamento",value:Be,kind:"wip"}),e.jsx(Ee,{label:"Agendadas",value:Ie,kind:"sched"})]}),ge.length>0&&e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:"Destaques estratégicos"}),e.jsx("div",{className:"space-y-2",children:ge.map((r,j)=>e.jsxs("div",{className:"flex items-start justify-between gap-3 py-2 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs font-extrabold text-slate-900",children:[r.titulo,r.projeto&&e.jsxs("span",{className:"text-slate-500 font-bold",children:[" · ",r.projeto]})]}),e.jsx("p",{className:"text-xs text-slate-600 font-semibold mt-0.5 leading-snug",children:r.impacto||"Atualização registrada no período."})]}),e.jsx(es,{label:r.statusLabel,kind:r.statusKind})]},j))})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("h2",{className:"section-title text-sm font-extrabold text-slate-900 mb-2 pb-1 border-b border-slate-200",children:"Frentes acompanhadas"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4",children:[e.jsx(Ae,{title:"Concluídas",kind:"done",tasks:I.filter(r=>r.statusKind==="done")}),e.jsx(Ae,{title:"Em andamento / Em trâmite",kind:"wip",tasks:I.filter(r=>r.statusKind==="wip")}),e.jsx(Ae,{title:"Agendadas",kind:"sched",tasks:I.filter(r=>r.statusKind==="sched")}),e.jsx(Ae,{title:"Outras",kind:"other",tasks:I.filter(r=>r.statusKind==="other")})]})]}),e.jsx("div",{className:"page-break"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-center py-4 mb-4 bg-slate-50 rounded-lg",children:[e.jsx("h2",{className:"text-base font-extrabold text-slate-900",children:"Detalhamento das Tarefas"}),e.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Resumo técnico e jurídico de cada frente acompanhada em ",e.jsx("strong",{children:W}),"."]})]}),e.jsx("div",{className:"space-y-0",children:I.map((r,j)=>e.jsxs("div",{className:"task-detail py-3 border-b border-slate-100 last:border-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("p",{className:"task-title text-xs font-extrabold text-slate-900",children:[j+1,". ",r.tituloClean,r.projeto&&e.jsxs("span",{className:"task-projeto text-slate-500 font-bold",children:[" · ",r.projeto]})]}),e.jsx(es,{label:r.statusLabel,kind:r.statusKind})]}),r.deadline&&e.jsxs("p",{className:"text-[11px] text-slate-600 font-semibold mt-1",children:["Prazo: ",Ms(r.deadline)]}),e.jsx("div",{className:"task-obs mt-2",children:sa(r.observacoes)})]},j))})]}),e.jsxs("div",{className:"footer mt-6 pt-3 border-t-2 border-slate-200",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-extrabold text-slate-700",children:"Mariana Lima Advocacia"}),e.jsxs("p",{className:"text-[11px] text-slate-500 mt-1",children:["Telefone: (31) 99404-8797",e.jsx("br",{}),"E-mail: contato@marianalima.adv.br",e.jsx("br",{}),"Rua Hugo Santos Silva, nº 100 – Centro, Sete Lagoas – MG"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/logo-horizontal_transparent.png",alt:"Mariana Lima Advocacia",style:{maxHeight:70,marginLeft:"auto"},className:"mb-2"}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Gerado em: ",xe]}),e.jsxs("p",{className:"text-[10px] text-slate-400",children:["Relatório #",ue]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-2 border-t border-slate-100",children:[e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"Este relatório é confidencial e destinado exclusivamente ao destinatário."}),e.jsx("img",{src:"https://vps2-public-videos.m7brnq.easypanel.host/bosi_logo.png",alt:"BOSI",style:{maxHeight:28}})]})]})]})})})})]})}function Ee({label:n,value:t,kind:c}){const d={done:"bg-green-50 border-green-200 text-green-900",wip:"bg-amber-50 border-amber-200 text-amber-900",sched:"bg-orange-50 border-orange-200 text-orange-900",other:"bg-slate-50 border-slate-200 text-slate-900"};return e.jsxs("div",{className:b("kpi-card rounded-lg border p-3",d[c]),children:[e.jsx("p",{className:"value text-2xl font-black leading-none",children:t}),e.jsx("p",{className:"label text-[10px] font-bold uppercase tracking-wide mt-1.5",children:n})]})}function es({label:n,kind:t}){return e.jsx("span",{className:b("badge inline-block px-2 py-0.5 rounded-full text-[10px] font-bold border shrink-0 whitespace-nowrap",zs[t]),children:n})}function Ae({title:n,kind:t,tasks:c}){return c.length===0?null:e.jsxs("div",{className:"mb-3 break-inside-avoid",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 pb-1",children:[e.jsx("p",{className:"text-xs font-extrabold text-slate-900",children:n}),e.jsx("span",{className:b("badge inline-block px-1.5 py-0 rounded-full text-[10px] font-black border",zs[t]),children:c.length})]}),e.jsx("div",{className:"border-t border-slate-100",children:c.map((d,u)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 py-1 border-b border-slate-50 last:border-0",children:[e.jsxs("p",{className:"text-[11px] font-bold text-slate-900 leading-tight flex-1 min-w-0",children:[d.tituloClean,d.projeto&&e.jsxs("span",{className:"text-slate-500 font-bold",children:[" · ",d.projeto]})]}),e.jsx(es,{label:d.statusLabel,kind:d.statusKind})]},u))})]})}const ra=["pendente","agendado","em_andamento","em_tramite"],Me=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],na=[{value:"deadline",label:"Prazo"},{value:"priority",label:"Prioridade"},{value:"title",label:"Título"}],Is={alta:0,media:1,baixa:2};function Os(n,t){return[...n].sort((c,d)=>{switch(t){case"deadline":return!c.dueDate&&!d.dueDate?0:c.dueDate?d.dueDate?c.dueDate.localeCompare(d.dueDate):-1:1;case"priority":return(Is[c.priority]??1)-(Is[d.priority]??1);case"title":return c.title.localeCompare(d.title,"pt-BR");default:return 0}})}const la={dueDate:!0,priority:!0,subtasks:!0,description:!1},ss=l.memo(function({task:t,cardFields:c,today:d,isExpanded:u,onToggleExpand:g,onToggleSubtask:N,onEdit:h,onDelete:C,showStatus:w,isDragging:T,isOverlay:L}){const i=t.subtasks.filter(O=>O.completed).length,B=t.subtasks.length,K=B>0?Math.round(i/B*100):0,I=t.dueDate&&t.dueDate<d&&t.status!=="concluida"&&t.status!=="cancelada";return e.jsx(D,{className:b("transition-shadow duration-150",T&&"opacity-40",L&&"shadow-xl ring-2 ring-primary/30 rotate-[2deg]",I&&"border-destructive/50"),children:e.jsxs(E,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[!L&&e.jsx(Ot,{className:"w-4 h-4 text-muted-foreground mt-0.5 shrink-0 cursor-grab active:cursor-grabbing"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[c.priority&&e.jsx(V,{variant:"secondary",className:b("text-[10px]",yt[t.priority]),children:Je[t.priority]}),w&&e.jsx(V,{variant:"secondary",className:b("text-[10px]",ts[t.status]),children:me[t.status]}),I&&e.jsx(V,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),e.jsx("p",{className:"font-medium text-sm",children:t.title}),c.description&&t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:t.description}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:c.dueDate&&t.dueDate&&e.jsxs("span",{className:b("flex items-center gap-1",I&&"text-destructive font-medium"),children:[e.jsx(Le,{className:"w-3 h-3"}),new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})})]}),!L&&e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(S,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>h==null?void 0:h(t),children:e.jsx(_s,{className:"w-3.5 h-3.5"})}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>C(t.id),children:e.jsx($s,{className:"w-3.5 h-3.5"})})]})]}),c.subtasks&&B>0&&!L&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",onClick:()=>g(t.id),children:[u?e.jsx(Gt,{className:"w-3 h-3"}):e.jsx(as,{className:"w-3 h-3"}),e.jsxs("span",{children:[i,"/",B," subtarefas"]}),e.jsx("div",{className:"flex-1 mx-2 bg-muted rounded-full h-1.5",children:e.jsx("div",{className:"bg-primary rounded-full h-1.5 transition-all",style:{width:`${K}%`}})}),e.jsxs("span",{className:"text-[10px]",children:[K,"%"]})]}),u&&e.jsx("div",{className:"mt-2 space-y-1 pl-4",children:t.subtasks.map(O=>e.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-muted/50 rounded p-1 -ml-1",children:[e.jsx(ft,{checked:O.completed,onCheckedChange:()=>N(t.id,O.id)}),e.jsx("span",{className:b(O.completed&&"line-through text-muted-foreground"),children:O.title})]},O.id))})]})]})})});function ia(n){const{attributes:t,listeners:c,setNodeRef:d,transform:u,transition:g,isDragging:N}=zt({id:n.task.id}),h={transform:Ft.Transform.toString(u),transition:g};return e.jsx("div",{ref:d,style:h,...t,...c,children:e.jsx(ss,{...n,isDragging:N})})}function oa({status:n,tasks:t,isOver:c,cardFields:d,today:u,expandedTasks:g,onToggleExpand:N,onToggleSubtask:h,onEdit:C,onDelete:w}){const T=l.useMemo(()=>t.map(i=>i.id),[t]),{setNodeRef:L}=Rt({id:n});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(V,{variant:"secondary",className:ts[n],children:me[n]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t.length,")"]})]}),e.jsx("div",{ref:L,"data-column-status":n,className:b("space-y-3 min-h-[400px] p-2 rounded-lg transition-colors duration-150",c?"bg-primary/10 border-2 border-dashed border-primary/40":"bg-muted/30 border-2 border-transparent"),children:e.jsx(Pt,{items:T,strategy:_t,children:t.length===0?e.jsx("p",{className:b("text-xs text-center py-8 transition-colors",c?"text-primary font-medium":"text-muted-foreground"),children:c?"↓ Soltar aqui":"Vazio"}):t.map(i=>e.jsx(ia,{task:i,cardFields:d,today:u,isExpanded:g.has(i.id),onToggleExpand:N,onToggleSubtask:h,onEdit:C,onDelete:w},i.id))})})]})}function or(){const n=new Date,t=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`,{events:c,loading:d,syncing:u,lastSync:g,sync:N,deleteEvent:h,createEvent:C,updateEvent:w}=xt(),{tasks:T,loading:L,syncing:i,lastSync:B,sync:K,updateTaskStatus:I,deleteTask:O,createTask:W,updateTask:xe,createSubtask:ue,updateSubtask:he,deleteSubtask:pe}=ut(),{projects:Be}=ht(),Ie=()=>{N(),K()},ge=u||i,r=g&&B?g>B?B:g:g||B,j=d||L,k=l.useMemo(()=>c.filter(s=>{var a;return(a=s.client)==null?void 0:a.toLowerCase().includes("bosi")}).sort((s,a)=>s.date.localeCompare(a.date)),[c]),p=l.useMemo(()=>T.filter(s=>{var a;return(a=s.client)==null?void 0:a.toLowerCase().includes("bosi")}),[T]),A=l.useMemo(()=>k.filter(s=>s.date>=t&&s.status!=="cancelado"),[k,t]),Z=p.filter(s=>ra.includes(s.status)),R=p.filter(s=>s.dueDate&&s.dueDate<t&&s.status!=="concluida"&&s.status!=="cancelada"),Oe=p.filter(s=>s.status==="concluida"),J=l.useMemo(()=>p.flatMap(s=>s.subtasks),[p]),Re=J.filter(s=>s.completed),je=J.length>0?Math.round(Re.length/J.length*100):0,fe=l.useMemo(()=>{const s={};return p.forEach(a=>{s[a.status]=(s[a.status]||0)+1}),s},[p]),X=s=>{const a=new Date(s+"T12:00:00"),o=new Date;return o.setHours(12,0,0,0),Math.round((a.getTime()-o.getTime())/(1e3*60*60*24))},[m,M]=l.useState("kanban"),[_,Y]=l.useState(""),[H,ee]=l.useState("all"),[se,rs]=l.useState("all"),[te,Fs]=l.useState("deadline"),[Pe,Vs]=l.useState(!1),[ns,Ks]=l.useState(new Set),[_e,ca]=l.useState(la),[be,$e]=l.useState(null),[Ys,Ne]=l.useState(null),[Hs,ve]=l.useState(!1),[qs,ze]=l.useState(null),[ae,ye]=l.useState(null),[F,Se]=l.useState([]);l.useEffect(()=>{Se(p)},[p]);const we=l.useMemo(()=>{const s=F.filter(a=>!(_&&!a.title.toLowerCase().includes(_.toLowerCase())||H!=="all"&&a.status!==H||se!=="all"&&a.priority!==se));return Os(s,te)},[F,_,H,se,te]),Us=l.useMemo(()=>{const s={};return Me.forEach(a=>{s[a]=[]}),we.forEach(a=>{s[a.status]&&s[a.status].push(a)}),s},[we]),ls=l.useMemo(()=>be?F.find(s=>s.id===be):null,[be,F]),Gs=Tt(Dt($t,{activationConstraint:{distance:8}})),is=l.useCallback(s=>{Ks(a=>{const o=new Set(a);return o.has(s)?o.delete(s):o.add(s),o})},[]),os=l.useCallback((s,a)=>{Se(o=>o.map(x=>x.id===s?{...x,subtasks:x.subtasks.map(v=>v.id===a?{...v,completed:!v.completed}:v)}:x))},[]),Qs=l.useCallback(s=>{$e(s.active.id)},[]),Ws=l.useCallback(s=>{const{over:a}=s;if(!a){Ne(null);return}const o=a.id,x=F.find(v=>v.id===o);Ne(x?x.status:Me.includes(o)?o:null)},[F]),Zs=l.useCallback(s=>{const{active:a,over:o}=s;if($e(null),Ne(null),!o)return;const x=a.id,v=o.id;if(x===v)return;const f=F.find(z=>z.id===x);if(!f)return;const $=F.find(z=>z.id===v),y=$?$.status:Me.includes(v)?v:f.status;f.status!==y&&(Se(z=>Os(z.map(He=>He.id===x?{...He,status:y}:He),te)),I(x,y))},[F,I,te]),Js=l.useCallback(()=>{$e(null),Ne(null)},[]),Xs=l.useCallback(async(s,a,o)=>{a?await W({title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName||"BOSI Empreendimentos",projectId:s.projectId,assignee:s.assignee,description:s.description}):o&&await xe(o,{title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description})},[W,xe]),et=l.useCallback(async()=>{ae&&(O(ae),Se(s=>s.filter(a=>a.id!==ae)),ye(null))},[ae,O]),[Fe,cs]=l.useState("calendar"),[re,ds]=l.useState(""),[ne,ms]=l.useState("all"),[le,xs]=l.useState("all"),[ke,us]=l.useState(()=>({year:n.getFullYear(),month:n.getMonth()})),[st,ie]=l.useState(!1),[Ve,Ce]=l.useState(null),[Ke,Ye]=l.useState(null),Te=l.useMemo(()=>k.filter(s=>!(re&&!s.title.toLowerCase().includes(re.toLowerCase())||ne!=="all"&&s.type!==ne||le!=="all"&&s.status!==le)),[k,re,ne,le]),tt=l.useMemo(()=>{const s=new Map;return Te.forEach(a=>{s.has(a.date)||s.set(a.date,[]),s.get(a.date).push(a)}),s},[Te]),at=l.useMemo(()=>{const{year:s,month:a}=ke,o=new Date(s,a,1),x=new Date(s,a+1,0),v=o.getDay(),f=[],$=y=>`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}-${String(y.getDate()).padStart(2,"0")}`;for(let y=v-1;y>=0;y--){const z=new Date(s,a,-y);f.push({date:$(z),day:z.getDate(),isCurrentMonth:!1})}for(let y=1;y<=x.getDate();y++){const z=new Date(s,a,y);f.push({date:$(z),day:y,isCurrentMonth:!0})}for(;f.length<42;){const y=new Date(s,a+1,f.length-v-x.getDate()+1);f.push({date:$(y),day:y.getDate(),isCurrentMonth:!1})}return f},[ke]),rt=new Date(ke.year,ke.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),nt=()=>us(s=>s.month===0?{year:s.year-1,month:11}:{...s,month:s.month-1}),lt=()=>us(s=>s.month===11?{year:s.year+1,month:0}:{...s,month:s.month+1}),it=async(s,a)=>{const o={...s,clientName:s.clientName||"BOSI Empreendimentos"};a?await C(o):Ve&&await w(Ve.id,o)},ot=async()=>{if(Ke)try{await h(Ke)}catch{qe.error("Erro ao remover.")}finally{Ye(null)}},hs=l.useMemo(()=>{const s=new Map;return Te.forEach(a=>{s.has(a.date)||s.set(a.date,[]),s.get(a.date).push(a)}),Array.from(s.entries())},[Te]),ct=l.useCallback(async(s,a)=>{s.preventDefault();const o=s.dataTransfer.getData("eventId");if(!o)return;const x=k.find(v=>v.id===o);if(!(!x||x.date===a))try{await w(o,{title:x.title,date:a,time:x.time,endTime:x.endTime,type:x.type,status:x.status,clientName:x.client,location:x.location,description:x.description,projectAirtableId:x.projectId}),qe.success(`"${x.title}" reagendado`)}catch{qe.error("Erro ao reagendar")}},[k,w]);return e.jsxs(pt,{title:"",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(Kt,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"BOSI Empreendimentos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Painel exclusivo do cliente"})]})]}),e.jsx(St,{syncing:ge,lastSync:r,onSync:Ie})]}),j?e.jsxs(e.Fragment,{children:[e.jsx(wt,{}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(ks,{}),e.jsx(ks,{})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6",children:[e.jsx(D,{className:"border-l-4 border-l-blue-500",children:e.jsx(E,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:A.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Compromissos"})]}),e.jsx(Le,{className:"w-5 h-5 text-blue-500"})]})})}),e.jsx(D,{className:"border-l-4 border-l-amber-500",children:e.jsx(E,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Z.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Em andamento"})]}),e.jsx(Cs,{className:"w-5 h-5 text-amber-500"})]})})}),e.jsx(D,{className:b("border-l-4",R.length>0?"border-l-destructive":"border-l-muted"),children:e.jsx(E,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:R.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Atrasadas"})]}),e.jsx(Ts,{className:b("w-5 h-5",R.length>0?"text-destructive":"text-muted-foreground")})]})})}),e.jsx(D,{className:"border-l-4 border-l-green-500",children:e.jsx(E,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Oe.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Concluídas"})]}),e.jsx(Ds,{className:"w-5 h-5 text-green-500"})]})})}),e.jsx(D,{className:"border-l-4 border-l-primary",children:e.jsxs(E,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[je,"%"]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Progresso geral"})]}),e.jsx(Yt,{className:"w-5 h-5 text-primary"})]}),e.jsx(vt,{value:je,className:"h-1.5 mt-2"})]})})]}),R.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-6 rounded-lg bg-destructive/10 border border-destructive/20",children:[e.jsx(Ts,{className:"w-4 h-4 text-destructive shrink-0"}),e.jsxs("p",{className:"text-xs font-medium text-destructive",children:[R.length," tarefa",R.length>1?"s":""," atrasada",R.length>1?"s":"",":"," ",R.slice(0,3).map(s=>s.title).join(", "),R.length>3&&` e mais ${R.length-3}`]})]}),e.jsxs(bt,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Nt,{className:"mb-4",children:[e.jsxs(oe,{value:"overview",className:"gap-1.5",children:[e.jsx(Ht,{className:"w-3.5 h-3.5"}),"Visão Geral"]}),e.jsxs(oe,{value:"agenda",className:"gap-1.5",children:[e.jsx(Le,{className:"w-3.5 h-3.5"}),"Agenda"]}),e.jsxs(oe,{value:"tarefas",className:"gap-1.5",children:[e.jsx(gt,{className:"w-3.5 h-3.5"}),"Tarefas"]}),e.jsxs(oe,{value:"subtarefas",className:"gap-1.5",children:[e.jsx(Ds,{className:"w-3.5 h-3.5"}),"Subtarefas"]}),e.jsxs(oe,{value:"relatorio",className:"gap-1.5",children:[e.jsx(qt,{className:"w-3.5 h-3.5"}),"Relatório"]})]}),e.jsx(ce,{value:"overview",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(D,{children:[e.jsx(Ue,{className:"pb-3",children:e.jsx(Ge,{className:"text-sm",children:"Distribuição de Tarefas"})}),e.jsxs(E,{className:"space-y-2.5",children:[Object.entries(fe).map(([s,a])=>{const o=p.length>0?Math.round(a/p.length*100):0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{variant:"secondary",className:b("text-[10px] w-24 justify-center",ts[s]),children:me[s]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:b("h-2 rounded-full transition-all",s==="concluida"?"bg-green-500":s==="cancelada"?"bg-muted-foreground/30":"bg-primary"),style:{width:`${o}%`}})})}),e.jsxs("span",{className:"text-xs text-muted-foreground w-12 text-right",children:[a," (",o,"%)"]})]},s)}),Object.keys(fe).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Sem tarefas"})]})]}),e.jsxs(D,{children:[e.jsx(Ue,{className:"pb-3",children:e.jsx(Ge,{className:"text-sm",children:"Próximos Compromissos"})}),e.jsx(E,{children:A.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:"Nenhum compromisso futuro"}):e.jsx("div",{className:"space-y-3",children:A.slice(0,6).map(s=>{const a=X(s.date),o=a===0?"Hoje":a===1?"Amanhã":`Em ${a}d`;return e.jsxs("div",{className:"flex items-center gap-3 p-2.5 rounded-lg border border-border/60 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[40px] rounded bg-muted px-1.5 py-1",children:[e.jsx("span",{className:"text-[9px] uppercase text-muted-foreground leading-none",children:new Date(s.date+"T12:00:00").toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-base font-bold leading-tight",children:new Date(s.date+"T12:00:00").getDate()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(V,{variant:"outline",className:b("text-[10px] px-1.5 py-0",Qe[s.type]),children:De[s.type]}),s.time&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.time})]})]}),e.jsx("span",{className:b("text-[10px] font-medium shrink-0 px-2 py-0.5 rounded-full",a<=1?"bg-destructive/10 text-destructive":a<=3?"bg-amber-100 text-amber-700":"bg-muted text-muted-foreground"),children:o})]},s.id)})})})]})]})}),e.jsxs(ce,{value:"tarefas",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(gs,{placeholder:"Buscar tarefa...",value:_,onChange:s=>Y(s.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(S,{variant:m==="list"?"default":"ghost",size:"sm",onClick:()=>M("list"),className:"rounded-none",children:e.jsx(As,{className:"w-4 h-4"})}),e.jsx(S,{variant:m==="kanban"?"default":"ghost",size:"sm",onClick:()=>M("kanban"),className:"rounded-none",children:e.jsx(Et,{className:"w-4 h-4"})})]}),m==="kanban"&&e.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-muted-foreground cursor-pointer select-none",children:[e.jsx(jt,{checked:Pe,onCheckedChange:Vs,className:"scale-75"}),"Ocultar concluídas"]}),e.jsxs(S,{size:"sm",onClick:()=>{ze(null),ve(!0)},className:"gap-1.5",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nova"})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(q,{value:H,onValueChange:ee,children:[e.jsx(U,{className:"w-[130px] h-8 text-xs",children:e.jsx(G,{placeholder:"Status"})}),e.jsxs(Q,{children:[e.jsx(P,{value:"all",children:"Todos"}),Object.keys(me).map(s=>e.jsx(P,{value:s,children:me[s]},s))]})]}),e.jsxs(q,{value:se,onValueChange:rs,children:[e.jsx(U,{className:"w-[110px] h-8 text-xs",children:e.jsx(G,{placeholder:"Prioridade"})}),e.jsxs(Q,{children:[e.jsx(P,{value:"all",children:"Todas"}),Object.keys(Je).map(s=>e.jsx(P,{value:s,children:Je[s]},s))]})]}),e.jsxs(q,{value:te,onValueChange:s=>Fs(s),children:[e.jsxs(U,{className:"w-[130px] h-8 text-xs gap-1.5",children:[e.jsx(At,{className:"w-3.5 h-3.5 shrink-0 text-muted-foreground"}),e.jsx(G,{})]}),e.jsx(Q,{children:na.map(s=>e.jsx(P,{value:s.value,children:s.label},s.value))})]}),(H!=="all"||se!=="all"||_)&&e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>{ee("all"),rs("all"),Y("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]}),e.jsx(kt,{open:Hs,onOpenChange:ve,task:qs,onSave:Xs,onCreateSubtask:ue,onUpdateSubtask:he,onDeleteSubtask:pe}),e.jsx(js,{open:!!ae,onOpenChange:s=>!s&&ye(null),children:e.jsxs(fs,{children:[e.jsxs(bs,{children:[e.jsx(Ns,{children:"Remover tarefa?"}),e.jsx(vs,{children:"Esta ação não pode ser desfeita."})]}),e.jsxs(ys,{children:[e.jsx(Ss,{children:"Cancelar"}),e.jsx(ws,{onClick:et,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),m==="list"?e.jsx("div",{className:"space-y-3",children:we.length===0?e.jsx(D,{children:e.jsx(E,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):we.map(s=>e.jsx(ss,{task:s,cardFields:_e,today:t,isExpanded:ns.has(s.id),onToggleExpand:is,onToggleSubtask:os,onEdit:a=>{ze(a),ve(!0)},onDelete:ye,showStatus:!0},s.id))}):e.jsxs(Mt,{sensors:Gs,collisionDetection:Lt,onDragStart:Qs,onDragOver:Ws,onDragEnd:Zs,onDragCancel:Js,children:[e.jsx("div",{className:b("grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",Pe?"xl:grid-cols-4":"xl:grid-cols-6"),children:Me.filter(s=>!Pe||s!=="concluida"&&s!=="cancelada").map(s=>e.jsx(oa,{status:s,tasks:Us[s],isOver:Ys===s&&be!==null,cardFields:_e,today:t,expandedTasks:ns,onToggleExpand:is,onToggleSubtask:os,onEdit:a=>{ze(a),ve(!0)},onDelete:ye},s))}),e.jsx(Bt,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:ls?e.jsx("div",{className:"w-[260px]",children:e.jsx(ss,{task:ls,cardFields:_e,today:t,isExpanded:!1,onToggleExpand:()=>{},onToggleSubtask:()=>{},onDelete:()=>{},isOverlay:!0})}):null})]})]}),e.jsx(ce,{value:"subtarefas",children:e.jsx(It,{tasks:p,projects:Be,loading:L,onCreateSubtask:ue,onUpdateSubtask:he,onDeleteSubtask:pe})}),e.jsxs(ce,{value:"agenda",children:[e.jsxs("div",{className:"flex flex-col gap-3 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(gs,{placeholder:"Buscar compromisso...",value:re,onChange:s=>ds(s.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(S,{variant:Fe==="list"?"default":"ghost",size:"sm",onClick:()=>cs("list"),className:"rounded-none",children:e.jsx(As,{className:"w-4 h-4"})}),e.jsx(S,{variant:Fe==="calendar"?"default":"ghost",size:"sm",onClick:()=>cs("calendar"),className:"rounded-none",children:e.jsx(Le,{className:"w-4 h-4"})})]}),e.jsxs(S,{size:"sm",onClick:()=>{Ce(null),ie(!0)},className:"gap-1.5",children:[e.jsx(ps,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(q,{value:ne,onValueChange:ms,children:[e.jsx(U,{className:"w-[130px] h-8 text-xs",children:e.jsx(G,{placeholder:"Tipo"})}),e.jsxs(Q,{children:[e.jsx(P,{value:"all",children:"Todos"}),Object.keys(De).map(s=>e.jsx(P,{value:s,children:De[s]},s))]})]}),e.jsxs(q,{value:le,onValueChange:xs,children:[e.jsx(U,{className:"w-[130px] h-8 text-xs",children:e.jsx(G,{placeholder:"Status"})}),e.jsxs(Q,{children:[e.jsx(P,{value:"all",children:"Todos"}),Object.keys(We).map(s=>e.jsx(P,{value:s,children:We[s]},s))]})]}),(ne!=="all"||le!=="all"||re)&&e.jsx(S,{variant:"ghost",size:"sm",onClick:()=>{ms("all"),xs("all"),ds("")},className:"text-xs gap-1 h-8",children:"✕ Limpar"})]})]}),e.jsx(Ct,{open:st,onOpenChange:ie,event:Ve,onSave:it}),e.jsx(js,{open:!!Ke,onOpenChange:s=>!s&&Ye(null),children:e.jsxs(fs,{children:[e.jsxs(bs,{children:[e.jsx(Ns,{children:"Remover compromisso?"}),e.jsx(vs,{children:"Esta ação não pode ser desfeita."})]}),e.jsxs(ys,{children:[e.jsx(Ss,{children:"Cancelar"}),e.jsx(ws,{onClick:ot,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),Fe==="list"?e.jsx("div",{className:"space-y-6",children:hs.length===0?e.jsx(D,{children:e.jsx(E,{className:"p-8 text-center text-muted-foreground",children:"Nenhum compromisso encontrado."})}):hs.map(([s,a])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[new Date(s+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),s===t&&e.jsx(V,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:a.map(o=>e.jsx(D,{className:"hover:border-primary/30 transition-colors",children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(V,{variant:"secondary",className:b("text-[10px]",Qe[o.type]),children:De[o.type]}),e.jsx(V,{variant:"outline",className:"text-[10px]",children:We[o.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:o.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[o.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:"w-3 h-3"}),o.time]}),o.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ut,{className:"w-3 h-3"}),o.location]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(S,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{Ce(o),ie(!0)},children:e.jsx(_s,{className:"w-3.5 h-3.5"})}),e.jsx(S,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>Ye(o.id),children:e.jsx($s,{className:"w-3.5 h-3.5"})})]})]})})},o.id))})]},s))}):e.jsxs(D,{children:[e.jsx(Ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:nt,children:e.jsx(Ps,{className:"w-4 h-4"})}),e.jsx(Ge,{className:"text-base capitalize",children:rt}),e.jsx(S,{variant:"ghost",size:"icon",onClick:lt,children:e.jsx(as,{className:"w-4 h-4"})})]})}),e.jsxs(E,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(s=>e.jsx("div",{className:"text-center text-[10px] font-medium text-muted-foreground py-1",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:at.map(({date:s,day:a,isCurrentMonth:o})=>{const x=tt.get(s)||[],v=s===t;return e.jsxs("div",{className:b("min-h-[80px] p-1.5 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",!o&&"opacity-40",v?"bg-primary/5 border-primary/30":"border-border/30"),onClick:()=>{x.length===0&&(Ce(null),ie(!0))},onDragOver:f=>{f.preventDefault()},onDrop:f=>ct(f,s),children:[e.jsx("p",{className:b("text-xs font-medium mb-1",v&&"text-primary"),children:a}),e.jsxs("div",{className:"space-y-0.5",children:[x.slice(0,3).map(f=>e.jsxs("div",{className:b("text-[10px] leading-tight px-1 py-0.5 rounded truncate cursor-move",Qe[f.type]),draggable:!0,onDragStart:$=>$.dataTransfer.setData("eventId",f.id),onClick:$=>{$.stopPropagation(),Ce(f),ie(!0)},children:[f.time&&e.jsxs("span",{className:"font-medium",children:[f.time," "]}),f.title]},f.id)),x.length>3&&e.jsxs("p",{className:"text-[9px] text-muted-foreground text-center",children:["+",x.length-3]})]})]},s)})})]})]})]}),e.jsx(ce,{value:"relatorio",children:e.jsx(aa,{})})]})]})]})}export{or as default};
