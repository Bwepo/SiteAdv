import{$ as q,r as d,h as _,s as I}from"./index-DRlkAaou.js";import{u as C}from"./useQuery-mcZAZQAc.js";const l=i=>I.from(i),k={agenda:["crm","agenda"],tarefas:["crm","tarefas"],clientes:["crm","clientes"],projetos:["crm","projetos"],all:["crm"]};function j(){return`local_${crypto.randomUUID().slice(0,12)}`}async function A(){const{data:i,error:r}=await l("mladv_crm_agenda").select("*").order("data_local",{ascending:!1});if(r)throw r;return{events:(i||[]).map(e=>({id:e.airtable_id,title:e.titulo||"",date:e.data_local||"",time:e.hora_local||void 0,type:e.tipo||"reuniao",status:e.status||"pendente",client:e.cliente||void 0,location:e.local_evento||void 0,description:e.descricao||void 0,projectId:e.projeto_airtable_id||void 0,airtableId:e.airtable_id}))}}async function h(){const[{data:i,error:r},{data:p,error:e}]=await Promise.all([l("mladv_crm_tarefas").select("*").order("deadline",{ascending:!0,nullsFirst:!1}),l("mladv_crm_subtarefas").select("*")]);if(r)throw r;if(e)throw e;return{tasks:(i||[]).map(u=>{const t=(p||[]).filter(v=>v.tarefa_airtable_id===u.airtable_id).map(v=>{const w=v.raw_fields||{},g=v.status||"A fazer";return{id:v.airtable_id,title:v.titulo||"",completed:g==="Concluído",status:g,dueDate:v.deadline||void 0,assignee:v.responsavel||void 0,notes:w.Observações||void 0,parentTaskId:u.airtable_id}});return{id:u.airtable_id,title:u.titulo||"",description:u.descricao||void 0,status:u.status||"pendente",priority:u.prioridade||"media",dueDate:u.deadline||void 0,client:u.cliente||void 0,assignee:u.responsavel||void 0,projectId:u.projeto_airtable_id||void 0,subtasks:t,createdAt:"",updatedAt:"",airtableId:u.airtable_id}})}}async function T(){const{data:i,error:r}=await l("mladv_crm_clientes").select("*").order("nome",{ascending:!0});if(r)throw r;return{clients:(i||[]).map(e=>({id:e.airtable_id,name:e.nome||"",slug:e.slug||""}))}}async function f(){const{data:i,error:r}=await l("mladv_crm_projetos").select("*").order("nome",{ascending:!0});if(r)throw r;return{projects:(i||[]).map(e=>{var b;return{id:e.airtable_id,name:e.nome||"",slug:e.slug||"",status:e.status||"Ativo",tipo:e.tipo||void 0,dataInicio:e.data_inicio||void 0,observacoes:e.observacoes||void 0,coverUrl:((b=e.raw_fields)==null?void 0:b.cover_url)||e.cover_url||void 0,cliente:e.cliente||void 0}})}}function z(){const i=q(),{data:r,isLoading:p,error:e}=C({queryKey:k.agenda,queryFn:A}),b=(r==null?void 0:r.events)??[],u=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:k.agenda})},[i]),v=d.useCallback(async(s,o)=>{await l("mladv_crm_agenda").update({status:o}).eq("airtable_id",s),t()},[t]),w=d.useCallback(async s=>{await l("mladv_crm_agenda").delete().eq("airtable_id",s),t(),_.success("Compromisso removido com sucesso.")},[t]),g=d.useCallback(async s=>{const o=j();await l("mladv_crm_agenda").insert({airtable_id:o,titulo:s.title,data_local:s.date,hora_local:s.time||null,tipo:s.type,status:s.status,cliente:s.clientName||null,local_evento:s.location||null,descricao:s.description||null,projeto_airtable_id:s.projectAirtableId||null}),t(),_.success("Compromisso criado.")},[t]),m=d.useCallback(async(s,o)=>{const y={};o.title!==void 0&&(y.titulo=o.title),o.date!==void 0&&(y.data_local=o.date),o.time!==void 0&&(y.hora_local=o.time||null),o.type!==void 0&&(y.tipo=o.type),o.status!==void 0&&(y.status=o.status),o.clientName!==void 0&&(y.cliente=o.clientName||null),o.location!==void 0&&(y.local_evento=o.location||null),o.description!==void 0&&(y.descricao=o.description||null),await l("mladv_crm_agenda").update(y).eq("airtable_id",s),t(),_.success("Compromisso atualizado.")},[t]);return{events:b,loading:p,error:u,updateEventStatus:v,updateEvent:m,createEvent:g,deleteEvent:w}}function K(){const i=q(),{data:r,isLoading:p,error:e}=C({queryKey:k.tarefas,queryFn:h}),b=(r==null?void 0:r.tasks)??[],u=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:k.tarefas})},[i]),v=d.useCallback(n=>{i.setQueryData(k.tarefas,a=>{if(!a)return a;const c=typeof n=="function"?n(a.tasks):n;return{...a,tasks:c}})},[i]),w=d.useCallback(async(n,a)=>{await l("mladv_crm_tarefas").update({status:a}).eq("airtable_id",n),t()},[t]),g=d.useCallback(async n=>{await l("mladv_crm_tarefas").delete().eq("airtable_id",n),t(),_.success("Tarefa removida.")},[t]),m=d.useCallback(async n=>{const a=j();await l("mladv_crm_tarefas").insert({airtable_id:a,titulo:n.title,deadline:n.deadline||null,prioridade:n.priority,status:n.status,cliente:n.clientName||null,responsavel:n.assignee||null,descricao:n.description||null,projeto_airtable_id:n.projectId||null}),t(),_.success("Tarefa criada.")},[t]),s=d.useCallback(async(n,a)=>{const c={};a.title!==void 0&&(c.titulo=a.title),a.deadline!==void 0&&(c.deadline=a.deadline||null),a.priority!==void 0&&(c.prioridade=a.priority),a.status!==void 0&&(c.status=a.status),a.clientName!==void 0&&(c.cliente=a.clientName||null),a.assignee!==void 0&&(c.responsavel=a.assignee||null),a.description!==void 0&&(c.descricao=a.description||null),a.projectId!==void 0&&(c.projeto_airtable_id=a.projectId||null),await l("mladv_crm_tarefas").update(c).eq("airtable_id",n),t(),_.success("Tarefa atualizada.")},[t]),o=d.useCallback(async(n,a)=>{const c=j();return await l("mladv_crm_subtarefas").insert({airtable_id:c,titulo:a.title,tarefa_airtable_id:n,status:a.status??"A fazer",deadline:a.deadline||null,responsavel:a.assignee||null,raw_fields:a.notes?{Observações:a.notes}:{}}),t(),_.success("Sub-tarefa criada."),c},[t]),y=d.useCallback(async(n,a)=>{const c={};a.title!==void 0&&(c.titulo=a.title),a.status!==void 0&&(c.status=a.status),a.deadline!==void 0&&(c.deadline=a.deadline||null),a.assignee!==void 0&&(c.responsavel=a.assignee||null),await l("mladv_crm_subtarefas").update(c).eq("airtable_id",n),t(),_.success("Sub-tarefa atualizada.")},[t]),E=d.useCallback(async n=>{await l("mladv_crm_subtarefas").delete().eq("airtable_id",n),t(),_.success("Sub-tarefa removida.")},[t]);return{tasks:b,setTasks:v,loading:p,error:u,updateTaskStatus:w,deleteTask:g,createTask:m,updateTask:s,createSubtask:o,updateSubtask:y,deleteSubtask:E}}function U(){const{data:i,isLoading:r,error:p}=C({queryKey:k.clientes,queryFn:T}),e=(i==null?void 0:i.clients)??[],b=p?p.message:null;return{clients:e,loading:r,error:b}}function F(){const i=q(),{data:r,isLoading:p,error:e}=C({queryKey:k.projetos,queryFn:f}),b=(r==null?void 0:r.projects)??[],u=e?e.message:null,t=d.useCallback(()=>{i.invalidateQueries({queryKey:k.projetos})},[i]),v=d.useCallback(async m=>{const s=j(),o=m.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");await l("mladv_crm_projetos").insert({airtable_id:s,nome:m.name,slug:o,status:m.status||"Ativo",tipo:m.tipo||null,observacoes:m.observacoes||null,cliente:m.cliente||null}),t(),_.success("Projeto criado.")},[t]),w=d.useCallback(async(m,s)=>{const o={};s.name!==void 0&&(o.nome=s.name,o.slug=s.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),s.status!==void 0&&(o.status=s.status),s.tipo!==void 0&&(o.tipo=s.tipo||null),s.observacoes!==void 0&&(o.observacoes=s.observacoes||null),s.cliente!==void 0&&(o.cliente=s.cliente||null),await l("mladv_crm_projetos").update(o).eq("airtable_id",m),t(),_.success("Projeto atualizado.")},[t]),g=d.useCallback(async m=>{await l("mladv_crm_projetos").delete().eq("airtable_id",m),t(),_.success("Projeto removido.")},[t]);return{projects:b,loading:p,error:u,createProject:v,updateProject:w,deleteProject:g}}export{K as a,F as b,U as c,z as u};
