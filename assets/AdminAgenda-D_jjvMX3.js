import{_ as Ee,ao as Ae,r as i,l as Y,j as e,e as d}from"./index-C0fbWft3.js";import{A as Le,F as Me,P as H,B as A}from"./AdminLayout-ByDE43MT.js";import{C as u,c as g,a as Q,b as U}from"./card-DQuJncvP.js";import{B as o}from"./button-DKkDnD_H.js";import{I as ze}from"./input-CwtS6LtH.js";import{S as W,a as K,b as q,d as G,e as j}from"./select-D1Ddc20P.js";import{A as $e,a as Be,b as Ie,c as Oe,d as Fe,e as Pe,f as Re,g as Ve}from"./alert-dialog-DDafD9Ju.js";import{a as L,e as J,E as D}from"./crmTypes-C2SECzd8.js";import{S as _e}from"./SyncToolbar-DVqtpM26.js";import{A as Ye,C as He}from"./CrmSkeletons-CD22YbbE.js";import{A as Qe}from"./AgendaEventSheet-BcqyDuUC.js";import{S as Ue}from"./search-DXqz9zkm.js";import{L as We}from"./list-B1BdlcZo.js";import{C as Ke}from"./calendar-DWFHOdAL.js";import{C as X}from"./clock-CohXX1Oy.js";import{U as xe}from"./users-BZ2IOsqf.js";import{M as qe}from"./map-pin-C87g5ezR.js";import{P as Ge}from"./pencil-CklnTTYU.js";import{T as Je}from"./trash-2-DSrpR4-L.js";import{C as Z}from"./dialog-2trSxfIN.js";import{C as ee}from"./chevron-right-C5--IYVp.js";import"./heart-CVPeks9w.js";import"./sparkles-BO127kSM.js";import"./house-BIxJB1_q.js";import"./menu-7TsGcqDU.js";import"./file-text-BiE4kwXJ.js";import"./index-Bipj6uqk.js";import"./index-Bi9BIILL.js";import"./index-2XTeQkZa.js";import"./chevron-up-DbQOH6o7.js";import"./check-DnSg4QYN.js";import"./skeleton-DLGYyiGB.js";import"./form-Dl2HGJxz.js";import"./label-BsB-CMgW.js";import"./textarea-Da9_Pq1-.js";import"./loader-circle-Bp15b49c.js";import"./types-C9wiu8_K.js";function Bt(){const{events:m,loading:pe,syncing:he,error:ue,lastSync:ge,sync:je,deleteEvent:fe,createEvent:Ne,updateEvent:M}=Ee(),{projects:ve}=Ae(),[x,z]=i.useState("calendar"),[p,te]=i.useState(""),[f,se]=i.useState("all"),[N,ae]=i.useState("all"),[v,re]=i.useState("all"),[C,$]=i.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[ye,y]=i.useState(!1),[B,S]=i.useState(null),[I,O]=i.useState(null),[be,ne]=i.useState(null),[we,F]=i.useState(null),De=i.useCallback(async(t,s)=>{t.preventDefault(),F(null);const a=t.dataTransfer.getData("eventId");if(!a)return;const n=m.find(r=>r.id===a);if(!(!n||n.date===s))try{await M(a,{title:n.title,date:s,time:n.time,endTime:n.endTime,type:n.type,status:n.status,clientName:n.client,location:n.location,description:n.description,projectAirtableId:n.projectId}),Y.success(`"${n.title}" reagendado para ${new Date(s+"T12:00:00").toLocaleDateString("pt-BR")}`)}catch{Y.error("Erro ao reagendar")}},[m,M]),k=i.useMemo(()=>m.filter(t=>{var s;return!(p&&!t.title.toLowerCase().includes(p.toLowerCase())&&!((s=t.client)!=null&&s.toLowerCase().includes(p.toLowerCase()))||f!=="all"&&t.type!==f||N!=="all"&&t.status!==N||v!=="all"&&t.projectId!==v)}).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")),[m,p,f,N,v]),P=()=>{S(null),y(!0)},T=t=>{S(t),y(!0)},Ce=async(t,s)=>{s?await Ne(t):B&&await M(B.id,t)},Se=async()=>{if(I)try{await fe(I)}catch{Y.error("Erro ao remover compromisso.")}finally{O(null)}},ke=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),le=i.useMemo(()=>{const{year:t,month:s}=C,a=new Date(t,s,1),n=new Date(t,s+1,0),r=a.getDay(),l=[],w=c=>`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`;for(let c=r-1;c>=0;c--){const E=new Date(t,s,-c);l.push({date:w(E),day:E.getDate(),isCurrentMonth:!1})}for(let c=1;c<=n.getDate();c++){const E=new Date(t,s,c);l.push({date:w(E),day:c,isCurrentMonth:!0})}for(;l.length<42;){const c=new Date(t,s+1,l.length-r-n.getDate()+1);l.push({date:w(c),day:c.getDate(),isCurrentMonth:!1})}return l},[C]),R=i.useMemo(()=>{const t=new Map;return k.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[k]),h=(()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${n}`})(),ie=i.useMemo(()=>m.filter(t=>t.date>=h).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[m,h]),oe=new Date(C.year,C.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),ce=()=>$(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),de=()=>$(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),[V,_]=i.useState(0),b=i.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()+V*7);const a=[];for(let n=0;n<7;n++){const r=new Date(s);r.setDate(s.getDate()+n),a.push(`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`)}return a},[V]),Te=i.useMemo(()=>{if(b.length===0)return"";const t=new Date(b[0]+"T12:00:00"),s=new Date(b[6]+"T12:00:00");return`${t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})} — ${s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}`},[b]),me=i.useMemo(()=>{const t=new Map;return k.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[k]);return e.jsxs(Le,{title:"Agenda",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ze,{placeholder:"Buscar compromisso ou cliente...",value:p,onChange:t=>te(t.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(W,{value:f,onValueChange:se,children:[e.jsx(K,{className:"w-[130px]",children:e.jsx(q,{placeholder:"Tipo"})}),e.jsxs(G,{children:[e.jsx(j,{value:"all",children:"Todos"}),Object.keys(L).map(t=>e.jsx(j,{value:t,children:L[t]},t))]})]}),e.jsxs(W,{value:N,onValueChange:ae,children:[e.jsx(K,{className:"w-[130px]",children:e.jsx(q,{placeholder:"Status"})}),e.jsxs(G,{children:[e.jsx(j,{value:"all",children:"Todos"}),Object.keys(J).map(t=>e.jsx(j,{value:t,children:J[t]},t))]})]}),e.jsxs(W,{value:v,onValueChange:re,children:[e.jsxs(K,{className:"w-[150px]",children:[e.jsx(Me,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx(q,{placeholder:"Projeto"})]}),e.jsxs(G,{children:[e.jsx(j,{value:"all",children:"Todos"}),ve.map(t=>e.jsx(j,{value:t.id,children:t.name},t.id))]})]}),(f!=="all"||N!=="all"||v!=="all"||p)&&e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{se("all"),ae("all"),re("all"),te("")},className:"text-xs gap-1",children:"✕ Limpar filtros"}),e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(o,{variant:x==="list"?"default":"ghost",size:"sm",onClick:()=>z("list"),className:"rounded-none",children:e.jsx(We,{className:"w-4 h-4"})}),e.jsx(o,{variant:x==="week"?"default":"ghost",size:"sm",onClick:()=>z("week"),className:"rounded-none text-xs px-2",children:"Sem"}),e.jsx(o,{variant:x==="calendar"?"default":"ghost",size:"sm",onClick:()=>z("calendar"),className:"rounded-none",children:e.jsx(Ke,{className:"w-4 h-4"})})]}),e.jsxs(o,{size:"sm",onClick:P,className:"gap-1.5",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]}),e.jsx(_e,{syncing:he,lastSync:ge,onSync:je,error:ue})]})]}),pe?x==="list"?e.jsx(Ye,{}):e.jsx(He,{}):x==="list"?e.jsx("div",{className:"space-y-6",children:me.length===0?e.jsx(u,{children:e.jsxs(g,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(o,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:P,children:[e.jsx(H,{className:"w-4 h-4"})," Criar compromisso"]})]})}):me.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[ke(t),t===h&&e.jsx(A,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(u,{className:"hover:border-primary/30 transition-colors",children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(A,{variant:"secondary",className:`text-[10px] ${D[a.type]}`,children:L[a.type]}),e.jsx(A,{variant:"outline",className:"text-[10px]",children:J[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(qe,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>T(a),children:e.jsx(Ge,{className:"w-3.5 h-3.5"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>O(a.id),children:e.jsx(Je,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):x==="week"?e.jsxs(u,{children:[e.jsx(Q,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>_(t=>t-1),children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(U,{className:"text-base",children:Te}),e.jsxs("div",{className:"flex items-center gap-1",children:[V!==0&&e.jsx(o,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:()=>_(0),children:"Hoje"}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>_(t=>t+1),children:e.jsx(ee,{className:"w-4 h-4"})})]})]})}),e.jsx(g,{children:e.jsx("div",{className:"grid grid-cols-7 gap-2",children:b.map(t=>{const s=new Date(t+"T12:00:00"),a=t===h,n=R.get(t)||[];return e.jsxs("div",{className:d("min-h-[140px] p-2 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",a?"bg-primary/5 border-primary/30":"border-border/50"),onClick:()=>{n.length===0&&(S(null),y(!0))},children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsx("p",{className:"text-[10px] text-muted-foreground capitalize",children:s.toLocaleDateString("pt-BR",{weekday:"short"})}),e.jsx("p",{className:d("text-lg font-bold",a&&"text-primary"),children:s.getDate()})]}),e.jsx("div",{className:"space-y-1",children:n.map(r=>e.jsxs("div",{className:d("text-[10px] px-1.5 py-1 rounded cursor-pointer hover:opacity-80",D[r.type]),onClick:l=>{l.stopPropagation(),T(r)},children:[r.time&&e.jsxs("span",{className:"font-semibold",children:[r.time," "]}),e.jsx("span",{className:"truncate",children:r.title})]},r.id))})]},t)})})})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(u,{children:[e.jsx(Q,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:ce,children:e.jsx(Z,{className:"w-4 h-4"})}),e.jsx(U,{className:"text-base capitalize",children:oe}),e.jsx(o,{variant:"ghost",size:"icon",onClick:de,children:e.jsx(ee,{className:"w-4 h-4"})})]})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t)),le.map((t,s)=>{const a=R.get(t.date)||[],n=t.date===h;return e.jsxs("div",{className:d("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!t.isCurrentMonth&&"opacity-40",n&&"bg-primary/5 border-primary/30",we===t.date&&"bg-primary/10 border-primary/40 ring-1 ring-primary/30"),onDragOver:r=>{r.preventDefault(),F(t.date)},onDragLeave:()=>F(null),onDrop:r=>De(r,t.date),onClick:()=>{a.length===0&&(S(null),y(!0))},children:[e.jsx("p",{className:d("text-xs font-medium mb-0.5",n&&"text-primary font-bold"),children:t.day}),e.jsxs("div",{className:"space-y-0.5",children:[a.slice(0,2).map(r=>e.jsxs("div",{draggable:!0,onDragStart:l=>{l.dataTransfer.setData("eventId",r.id),ne(r.id)},onDragEnd:()=>ne(null),className:d("text-[9px] px-1 py-0.5 rounded truncate cursor-grab active:cursor-grabbing hover:opacity-80",D[r.type],be===r.id&&"opacity-40"),title:`${r.title} — arraste para reagendar`,onClick:l=>{l.stopPropagation(),T(r)},children:[r.time&&e.jsxs("span",{className:"font-medium",children:[r.time," "]}),r.title]},r.id)),a.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",a.length-2," mais"]})]})]},s)})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(u,{className:"h-fit",children:e.jsxs(g,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:ce,children:e.jsx(Z,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-xs font-semibold capitalize",children:oe}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:de,children:e.jsx(ee,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-0.5",children:[["D","S","T","Q","Q","S","S"].map((t,s)=>e.jsx("div",{className:"text-center text-[9px] font-medium text-muted-foreground py-0.5",children:t},s)),le.map((t,s)=>{const a=R.get(t.date)||[],n=t.date===h,r=a.length>0;return e.jsxs("div",{className:d("relative flex items-center justify-center h-7 rounded-sm cursor-pointer transition-colors text-[11px]",!t.isCurrentMonth&&"opacity-30",n&&"bg-primary text-primary-foreground font-bold",!n&&r&&"font-semibold",!n&&"hover:bg-muted/50"),onClick:()=>{$({year:parseInt(t.date.slice(0,4)),month:parseInt(t.date.slice(5,7))-1})},children:[t.day,r&&!n&&e.jsx("span",{className:"absolute bottom-0.5 left-1/2 -translate-x-1/2 flex gap-0.5",children:a.slice(0,3).map((l,w)=>e.jsx("span",{className:d("w-1 h-1 rounded-full",`bg-${D[l.type].split(" ")[0].replace("bg-","")}`),style:{backgroundColor:l.type==="reuniao"?"rgb(59,130,246)":l.type==="audiencia"?"rgb(147,51,234)":l.type==="prazo"?"rgb(239,68,68)":l.type==="consulta"?"rgb(34,197,94)":l.type==="lembrete"?"rgb(234,179,8)":"rgb(156,163,175)"}},w))})]},s)})]})]})}),e.jsxs(u,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(Q,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(U,{className:"text-sm flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-primary"}),"Próximos"]}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:P,children:e.jsx(H,{className:"w-4 h-4"})})]})}),e.jsx(g,{className:"space-y-3",children:ie.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):ie.map(t=>{const s=new Date(t.date+"T12:00:00"),a=new Date;a.setHours(0,0,0,0);const n=new Date(s.getFullYear(),s.getMonth(),s.getDate()),r=Math.round((n.getTime()-a.getTime())/(1e3*60*60*24)),l=r===0?"Hoje":r===1?"Amanhã":`Em ${r} dias`;return e.jsxs("div",{className:"flex gap-3 p-2 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>T(t),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:s.getDate()}),e.jsx("span",{className:"text-[10px] capitalize text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(A,{variant:"outline",className:d("text-[10px] px-1.5 py-0",D[t.type]),children:L[t.type]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:l})]}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx(X,{className:"w-3 h-3 inline mr-1"}),t.time,t.endTime?` – ${t.endTime}`:""]}),t.client&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.jsx(xe,{className:"w-3 h-3 inline mr-1"}),t.client]})]})]},t.id)})})]})]})]}),e.jsx(Qe,{open:ye,onOpenChange:y,event:B,onSave:Ce}),e.jsx($e,{open:!!I,onOpenChange:t=>!t&&O(null),children:e.jsxs(Be,{children:[e.jsxs(Ie,{children:[e.jsx(Oe,{children:"Remover compromisso?"}),e.jsxs(Fe,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Pe,{children:[e.jsx(Re,{children:"Cancelar"}),e.jsx(Ve,{onClick:Se,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Bt as default};
