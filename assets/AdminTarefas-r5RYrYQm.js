import{c as I,ak as ue,r as l,j as s,e as o}from"./index-CXIpuz_-.js";import{A as he}from"./AdminLayout-D1SuZYWo.js";import{C as P,c as R}from"./card-DBAmFPwO.js";import{B as x}from"./badge-DWz80jRg.js";import{B as p}from"./button-DsftJtE4.js";import{I as fe}from"./input--GVCOrrz.js";import{S as ge,C as je}from"./checkbox-B6-KNtQZ.js";import{L as ve}from"./label-BPy4k5e7.js";import{S as w,a as k,b as D,d as L,e as d}from"./select-p3gbrp5J.js";import{P as ye,a as Ne,b as Se}from"./popover-Dr1WJFOI.js";import{d as N,b as A,e as V,T as be}from"./crmTypes-D5hDkvdS.js";import{S as Te,T as Ce,K as we}from"./CrmSkeletons-CxxGKYRq.js";import{S as ke}from"./search-2qiqBA4X.js";import{L as De}from"./list-C_t4Cl6v.js";import{U as Le}from"./users-CilgE17M.js";import{C as Ae}from"./calendar-C3zWe-GW.js";import{P as Ie}from"./pencil-Ce4ZneaA.js";import{T as Oe}from"./trash-2-BMxd3kqF.js";import{C as Ee}from"./chevron-up-D-fx7Pib.js";import{C as Fe}from"./chevron-right-D-gsW5a9.js";import"./index-gWbUSHUY.js";import"./index-BpCwBHQg.js";import"./house-BdN2o6Mm.js";import"./menu-CUUPlfG5.js";import"./file-text-DN8kTDfl.js";import"./index-C7PGZYHI.js";import"./check-DAq3pg4s.js";import"./index-DZvgWwp4.js";import"./skeleton-CFbITS2I.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=I("Columns3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=I("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=I("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Re={client:!0,dueDate:!0,priority:!0,subtasks:!0,tags:!0,description:!1},M={client:"Cliente",dueDate:"Data de entrega",priority:"Prioridade",subtasks:"Subtarefas",tags:"Tags",description:"Descrição"};function hs(){const{tasks:S,setTasks:Ve,loading:z,syncing:K,error:$,lastSync:U,sync:q,updateTaskStatus:O,deleteTask:Y}=ue(),[u,h]=l.useState([]),[m,E]=l.useState("kanban"),[f,G]=l.useState(""),[g,H]=l.useState("all"),[j,J]=l.useState("all"),[v,Q]=l.useState("all"),[W,X]=l.useState(new Set),[c,Z]=l.useState(Re),[F,b]=l.useState(null),[ee,y]=l.useState(null);l.useEffect(()=>{S.length>0&&h(S)},[S]);const se=l.useMemo(()=>[...new Set(u.map(e=>e.client).filter(Boolean))],[u]),T=l.useMemo(()=>u.filter(e=>!(f&&!e.title.toLowerCase().includes(f.toLowerCase())||g!=="all"&&e.status!==g||j!=="all"&&e.priority!==j||v!=="all"&&e.client!==v)),[u,f,g,j,v]),ae=e=>{X(a=>{const t=new Set(a);return t.has(e)?t.delete(e):t.add(e),t})},te=(e,a)=>{h(t=>t.map(r=>r.id===e?{...r,subtasks:r.subtasks.map(n=>n.id===a?{...n,completed:!n.completed}:n)}:r))},re=e=>{Y(e),h(a=>a.filter(t=>t.id!==e))},le=e=>{Z(a=>({...a,[e]:!a[e]}))},ne=l.useCallback((e,a)=>{b(a),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",a),e.currentTarget&&requestAnimationFrame(()=>{e.target.style.opacity="0.5"})},[]),ie=l.useCallback(e=>{e.target.style.opacity="1",b(null),y(null)},[]),ce=l.useCallback((e,a)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",y(a)},[]),oe=l.useCallback(()=>{y(null)},[]),de=l.useCallback((e,a)=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");t&&(h(r=>r.map(n=>n.id===t?{...n,status:a,updatedAt:new Date().toISOString().split("T")[0]}:n)),b(null),y(null),O(t,a))},[O]),me=new Date().toISOString().split("T")[0],xe=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],_=({task:e,draggable:a=!1})=>{const t=W.has(e.id),r=e.subtasks.filter(i=>i.completed).length,n=e.subtasks.length,B=n>0?Math.round(r/n*100):0,C=e.dueDate&&e.dueDate<me&&e.status!=="concluida"&&e.status!=="cancelada",pe=F===e.id;return s.jsx("div",{draggable:a,onDragStart:a?i=>ne(i,e.id):void 0,onDragEnd:a?ie:void 0,className:o("transition-all",a&&"cursor-grab active:cursor-grabbing",pe&&"opacity-50"),children:s.jsx(P,{className:o("hover:border-primary/30 transition-colors",C&&"border-destructive/50"),children:s.jsxs(R,{className:"p-3",children:[s.jsxs("div",{className:"flex items-start gap-2",children:[a&&s.jsx(Be,{className:"w-4 h-4 text-muted-foreground mt-0.5 shrink-0"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[c.priority&&s.jsx(x,{variant:"secondary",className:`text-[10px] ${be[e.priority]}`,children:A[e.priority]}),m==="list"&&s.jsx(x,{variant:"secondary",className:`text-[10px] ${V[e.status]}`,children:N[e.status]}),C&&s.jsx(x,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),s.jsx("p",{className:"font-medium text-sm",children:e.title}),c.description&&e.description&&s.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:e.description}),s.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:[c.client&&e.client&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(Le,{className:"w-3 h-3"}),e.client]}),c.dueDate&&e.dueDate&&s.jsxs("span",{className:o("flex items-center gap-1",C&&"text-destructive font-medium"),children:[s.jsx(Ae,{className:"w-3 h-3"}),new Date(e.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})]})]}),s.jsxs("div",{className:"flex gap-1 shrink-0",children:[s.jsx(p,{variant:"ghost",size:"icon",className:"h-7 w-7",children:s.jsx(Ie,{className:"w-3.5 h-3.5"})}),s.jsx(p,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>re(e.id),children:s.jsx(Oe,{className:"w-3.5 h-3.5"})})]})]}),c.subtasks&&n>0&&s.jsxs("div",{className:"mt-2",children:[s.jsxs("button",{className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors w-full",onClick:()=>ae(e.id),children:[t?s.jsx(Ee,{className:"w-3 h-3"}):s.jsx(Fe,{className:"w-3 h-3"}),s.jsxs("span",{children:[r,"/",n," subtarefas"]}),s.jsx("div",{className:"flex-1 mx-2 bg-muted rounded-full h-1.5",children:s.jsx("div",{className:"bg-primary rounded-full h-1.5 transition-all",style:{width:`${B}%`}})}),s.jsxs("span",{className:"text-[10px]",children:[B,"%"]})]}),t&&s.jsx("div",{className:"mt-2 space-y-1 pl-4",children:e.subtasks.map(i=>s.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer hover:bg-muted/50 rounded p-1 -ml-1",children:[s.jsx(je,{checked:i.completed,onCheckedChange:()=>te(e.id,i.id)}),s.jsx("span",{className:o(i.completed&&"line-through text-muted-foreground"),children:i.title})]},i.id))})]}),c.tags&&e.tags&&e.tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.tags.map(i=>s.jsx(x,{variant:"outline",className:"text-[10px]",children:i},i))})]})})})};return s.jsxs(he,{title:"Tarefas",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[s.jsxs("div",{className:"relative flex-1",children:[s.jsx(ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),s.jsx(fe,{placeholder:"Buscar tarefa...",value:f,onChange:e=>G(e.target.value),className:"pl-9"})]}),s.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[s.jsxs(w,{value:g,onValueChange:H,children:[s.jsx(k,{className:"w-[130px]",children:s.jsx(D,{placeholder:"Status"})}),s.jsxs(L,{children:[s.jsx(d,{value:"all",children:"Todos"}),Object.keys(N).map(e=>s.jsx(d,{value:e,children:N[e]},e))]})]}),s.jsxs(w,{value:j,onValueChange:J,children:[s.jsx(k,{className:"w-[110px]",children:s.jsx(D,{placeholder:"Prioridade"})}),s.jsxs(L,{children:[s.jsx(d,{value:"all",children:"Todas"}),Object.keys(A).map(e=>s.jsx(d,{value:e,children:A[e]},e))]})]}),s.jsxs(w,{value:v,onValueChange:Q,children:[s.jsx(k,{className:"w-[140px]",children:s.jsx(D,{placeholder:"Cliente"})}),s.jsxs(L,{children:[s.jsx(d,{value:"all",children:"Todos"}),se.map(e=>s.jsx(d,{value:e,children:e},e))]})]}),s.jsxs(ye,{children:[s.jsx(Ne,{asChild:!0,children:s.jsxs(p,{variant:"outline",size:"sm",className:"gap-1.5",children:[s.jsx(Pe,{className:"w-4 h-4"}),s.jsx("span",{className:"hidden sm:inline",children:"Campos"})]})}),s.jsx(Se,{className:"w-56",align:"end",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm font-medium mb-2",children:"Mostrar nos cards"}),Object.keys(M).map(e=>s.jsxs("div",{className:"flex items-center justify-between py-1",children:[s.jsx(ve,{htmlFor:`field-${e}`,className:"text-sm cursor-pointer",children:M[e]}),s.jsx(ge,{id:`field-${e}`,checked:c[e],onCheckedChange:()=>le(e)})]},e))]})})]}),s.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[s.jsx(p,{variant:m==="list"?"default":"ghost",size:"sm",onClick:()=>E("list"),className:"rounded-none",children:s.jsx(De,{className:"w-4 h-4"})}),s.jsx(p,{variant:m==="kanban"?"default":"ghost",size:"sm",onClick:()=>E("kanban"),className:"rounded-none",children:s.jsx(_e,{className:"w-4 h-4"})})]}),s.jsx(Te,{syncing:K,lastSync:U,onSync:q,error:$})]})]}),z?m==="list"?s.jsx(Ce,{}):s.jsx(we,{}):m==="list"?s.jsx("div",{className:"space-y-3",children:T.length===0?s.jsx(P,{children:s.jsx(R,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):T.map(e=>s.jsx(_,{task:e},e.id))}):s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:xe.map(e=>{const a=T.filter(r=>r.status===e),t=ee===e&&F!==null;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx(x,{variant:"secondary",className:`${V[e]}`,children:N[e]}),s.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.length,")"]})]}),s.jsx("div",{className:o("space-y-3 min-h-[200px] p-2 rounded-lg transition-colors",t?"bg-primary/10 border-2 border-dashed border-primary/40":"bg-muted/30 border-2 border-transparent"),onDragOver:r=>ce(r,e),onDragLeave:oe,onDrop:r=>de(r,e),children:a.length===0?s.jsx("p",{className:o("text-xs text-center py-8 transition-colors",t?"text-primary":"text-muted-foreground"),children:t?"Soltar aqui":"Vazio"}):a.map(r=>s.jsx(_,{task:r,draggable:!0},r.id))})]},e)})})]})}export{hs as default};
