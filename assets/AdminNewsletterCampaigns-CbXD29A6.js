import{c as z,r as p,n as I,j as e,e as y}from"./index-C0fbWft3.js";import{P as L,S as O,a as _,b as $,c as U,B as R,A as V}from"./AdminLayout-ByDE43MT.js";import{B as f}from"./button-DKkDnD_H.js";import{I as W}from"./input-CwtS6LtH.js";import{L as H}from"./label-BsB-CMgW.js";import{T as X}from"./textarea-Da9_Pq1-.js";import{T as G,a as J,b as M}from"./tabs-BjhIswR8.js";import{D as K,b as Q,a as Y,c as Z,d as ee,e as se,f as ae}from"./dialog-2trSxfIN.js";import{b as q,C as te,T as re,P as le}from"./newsletterTemplate-BtKtRLli.js";import{f as ie,g as ne,h as oe,i as de,j as ce,k as me}from"./useNewsletter-CGnqN9c0.js";import{g as T}from"./supabaseErrors-eYWJjREL.js";import{E as xe,a as ue}from"./eye-DD7vVtEb.js";import{L as A}from"./loader-circle-Bp15b49c.js";import{S as C}from"./skeleton-DLGYyiGB.js";import{C as B}from"./clock-CohXX1Oy.js";import{M as he}from"./menu-7TsGcqDU.js";import{C as pe}from"./circle-check-DKtEbzmU.js";import{T as je}from"./triangle-alert-yRQmegML.js";import{C as ge,c as fe}from"./card-DQuJncvP.js";import{T as be,a as ve,b as E,c as w,d as Ne,e as N}from"./table-CkPTLlce.js";import{A as Ce,a as we,b as ye,c as De,d as Ee,e as Se,f as Te,g as Ae}from"./alert-dialog-DDafD9Ju.js";import"./heart-CVPeks9w.js";import"./sparkles-BO127kSM.js";import"./search-DXqz9zkm.js";import"./calendar-DWFHOdAL.js";import"./house-BIxJB1_q.js";import"./users-BZ2IOsqf.js";import"./file-text-BiE4kwXJ.js";import"./index-B814gKR_.js";import"./index-Bipj6uqk.js";import"./index-Bi9BIILL.js";import"./index-DF38y0gQ.js";import"./dropdown-menu-gyPRmeFo.js";import"./chevron-right-C5--IYVp.js";import"./check-DnSg4QYN.js";import"./circle-JIQm6dKo.js";import"./link-B5D1Mnxe.js";import"./list-B1BdlcZo.js";import"./quote-C63blJYZ.js";import"./trash-2-DSrpR4-L.js";import"./useMutation-C-DaD-fB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=z("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=z("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);function Le(){const[t,j]=p.useState(!1),[n,m]=p.useState(""),[i,g]=p.useState(""),[o,a]=p.useState("visual"),[r,x]=p.useState(!1),d=ie(),{toast:h}=I(),v=async()=>{if(!n.trim()){h({title:"Assunto obrigat√≥rio",description:"Informe o assunto do e-mail.",variant:"destructive"});return}if(!i.trim()){h({title:"Conte√∫do obrigat√≥rio",description:"Escreva o conte√∫do do e-mail.",variant:"destructive"});return}try{const l=q({title:n.trim(),content:i,postUrl:"https://marianalima.adv.br"});await d.mutateAsync({subject:n.trim(),html:l,post_id:""}),h({title:"Campanha criada!",description:"A campanha foi criada com os deliveries na fila."}),m(""),g(""),x(!1),a("visual"),j(!1)}catch(l){h({title:"Erro ao criar campanha",description:T(l,"N√£o foi poss√≠vel criar a campanha."),variant:"destructive"})}},b=()=>{j(!1),m(""),g(""),x(!1),a("visual")},c=q({title:n.trim()||"Assunto do e-mail",content:i||"<p>Conte√∫do do e-mail aparecer√° aqui...</p>",postUrl:"https://marianalima.adv.br"});return e.jsxs(K,{open:t,onOpenChange:l=>l?j(!0):b(),children:[e.jsx(Q,{asChild:!0,children:e.jsxs(f,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Nova campanha"]})}),e.jsxs(Y,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Nova campanha manual"}),e.jsx(se,{children:"Crie uma campanha sem v√≠nculo a um post. O conte√∫do ser√° enviado a todos os inscritos ativos."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-2 pr-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"campaign-subject",children:"Assunto do e-mail *"}),e.jsx(W,{id:"campaign-subject",value:n,onChange:l=>m(l.target.value),placeholder:"Novidades do escrit√≥rio...",maxLength:200})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(H,{children:"Conte√∫do *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!r&&e.jsx(G,{value:o,onValueChange:l=>a(l),children:e.jsxs(J,{className:"h-8",children:[e.jsxs(M,{value:"visual",className:"text-xs px-3",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),"Visual"]}),e.jsxs(M,{value:"html",className:"text-xs px-3",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"HTML"]})]})}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:()=>x(!r),children:r?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 mr-1"}),"Editar"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),"Preview"]})})]})]}),r?e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-muted/30",children:[e.jsx("div",{className:"bg-muted/50 px-4 py-2 border-b border-border",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Preview do e-mail completo (como ser√° recebido pelo inscrito)"})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto",children:e.jsx("iframe",{srcDoc:c,title:"Email Preview",className:"w-full min-h-[350px] border-0 rounded bg-background",sandbox:"allow-same-origin"})})]}):o==="visual"?e.jsx("div",{className:"min-h-[300px]",children:e.jsx(re,{content:i,onChange:g,placeholder:"Escreva o conte√∫do da campanha..."})}):e.jsx(X,{value:i,onChange:l=>g(l.target.value),placeholder:"<p>Conte√∫do do e-mail em HTML...</p>",className:"min-h-[300px] font-mono text-sm"}),!r&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"üí° O conte√∫do ser√° automaticamente envolvido no template de e-mail do escrit√≥rio, com logo, footer e link de descadastro."})]})]}),e.jsxs(ae,{className:"pt-4 border-t border-border",children:[e.jsx(f,{variant:"outline",onClick:b,children:"Cancelar"}),e.jsxs(f,{onClick:v,disabled:d.isPending,children:[d.isPending?e.jsx(A,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(L,{className:"w-4 h-4 mr-2"}),"Criar campanha"]})]})]})]})}const He={draft:{label:"Rascunho",className:"bg-muted text-muted-foreground"},queued:{label:"Na fila",className:"bg-blue-500/10 text-blue-600 border-blue-500/30"},sending:{label:"Enviando",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30 animate-pulse"},sent:{label:"Enviada",className:"bg-green-500/10 text-green-600 border-green-500/30"},partial:{label:"Parcial",className:"bg-orange-500/10 text-orange-600 border-orange-500/30"},failed:{label:"Falhou",className:"bg-destructive/10 text-destructive border-destructive/30"}},F=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî";function Me({campaignId:t,onClose:j,onDelete:n,isDeleting:m}){const{data:i,isLoading:g}=ne(t),{data:o}=oe(),a=(i==null?void 0:i.campaign)??null,r=i==null?void 0:i.deliveryCounts,x=(i==null?void 0:i.total)??0,d=p.useMemo(()=>{if(!r||x===0)return{percent:0,processed:0};const c=r.sent+r.failed+r.skipped;return{percent:Math.round(c/x*100),processed:c}},[r,x]),h=(a==null?void 0:a.status)==="sending"||(a==null?void 0:a.status)==="queued",v=c=>{const l=He[c]||{label:c,className:"bg-muted text-muted-foreground"};return e.jsx(R,{variant:"outline",className:y("text-[11px]",l.className),children:l.label})},b=({label:c,current:l,limit:s})=>{const u=Math.min(100,Math.round(l/s*100)),k=u>=80,P=u>=95;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-muted-foreground",children:c}),e.jsxs("span",{className:y("font-medium",P?"text-destructive":k?"text-yellow-600":"text-foreground"),children:[l,"/",s]})]}),e.jsx("div",{className:"h-1.5 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:y("h-full rounded-full transition-all duration-500",P?"bg-destructive":k?"bg-yellow-500":"bg-primary"),style:{width:`${u}%`}})})]})};return e.jsx(O,{open:!!t,onOpenChange:c=>{c||j()},children:e.jsxs(_,{className:"sm:max-w-lg overflow-y-auto",children:[e.jsx($,{children:e.jsx(U,{className:"text-left",children:"Detalhes da campanha"})}),g?e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(C,{className:"h-6 w-3/4"}),e.jsx(C,{className:"h-20 w-full"}),e.jsx(C,{className:"h-40 w-full"})]}):a?e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Assunto"}),e.jsx("p",{className:"text-sm font-medium",children:a.subject})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Status:"}),v(a.status),h&&e.jsx(A,{className:"w-3 h-3 animate-spin text-muted-foreground"})]})]}),x>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-medium",children:"Progresso do envio"}),e.jsxs("span",{className:"text-lg font-bold tabular-nums",children:[d.percent,"%"]})]}),e.jsx(le,{value:d.percent,className:"h-2.5"}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[d.processed," de ",x," processados"]}),r&&r.queued>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),"Faltam ",r.queued]})]}),h&&e.jsxs("p",{className:"text-[11px] text-muted-foreground flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3 animate-spin"}),"Atualizando automaticamente a cada 3s"]})]}),r&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(D,{icon:e.jsx(he,{className:"w-4 h-4 text-muted-foreground"}),label:"Total",value:x}),e.jsx(D,{icon:e.jsx(pe,{className:"w-4 h-4 text-green-600"}),label:"Enviados",value:r.sent,accent:"green"}),e.jsx(D,{icon:e.jsx(B,{className:"w-4 h-4 text-blue-600"}),label:"Na fila",value:r.queued,accent:"blue"}),e.jsx(D,{icon:e.jsx(ke,{className:"w-4 h-4 text-destructive"}),label:"Falhou",value:r.failed,accent:"red"})]}),o&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Limites de envio (Resend)"})]}),e.jsx(b,{label:"Hoje",current:o.daily,limit:o.dailyLimit}),e.jsx(b,{label:"Este m√™s",current:o.monthly,limit:o.monthlyLimit}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Limites do plano gratuito do Resend. Ajuste se tiver plano pago."})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Post relacionado"}),a.post?e.jsxs("p",{className:"text-sm",children:[a.post.title,e.jsxs("span",{className:"text-muted-foreground ml-1 text-xs",children:["/",a.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Campanha manual"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"Criado em"}),e.jsx("p",{children:F(a.created_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-0.5",children:"Enviado em"}),e.jsx("p",{children:F(a.sent_at)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Preview do e-mail"}),e.jsx("div",{className:"rounded-lg border border-border overflow-hidden bg-white",children:a.html?e.jsx("iframe",{srcDoc:a.html,title:"Preview do e-mail",className:"w-full h-[320px] border-0",sandbox:""}):e.jsx("p",{className:"text-sm text-muted-foreground p-4",children:"Sem conte√∫do HTML."})})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsx(f,{variant:"destructive",size:"sm",onClick:()=>n(a.id),disabled:m,children:m?"Excluindo...":"Excluir campanha"})})]}):e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:"Campanha n√£o encontrada."})]})})}function D({icon:t,label:j,value:n,accent:m}){return e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3 flex items-center gap-3",children:[t,e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:j}),e.jsx("p",{className:"text-lg font-semibold tabular-nums",children:n})]})]})}const qe={draft:{label:"Rascunho",className:"bg-muted text-muted-foreground"},queued:{label:"Na fila",className:"bg-blue-500/10 text-blue-600 border-blue-500/30"},sending:{label:"Enviando",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30"},sent:{label:"Enviada",className:"bg-green-500/10 text-green-600 border-green-500/30"},partial:{label:"Parcial",className:"bg-orange-500/10 text-orange-600 border-orange-500/30"},failed:{label:"Falhou",className:"bg-destructive/10 text-destructive border-destructive/30"}},S=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî",ws=()=>{const{data:t,isLoading:j}=de(),[n,m]=p.useState(null),[i,g]=p.useState(null),[o,a]=p.useState(null),{toast:r}=I(),x=ce(),d=me(),h=p.useMemo(()=>((t==null?void 0:t.length)??0)>0,[t]),v=s=>["draft","queued","partial"].includes(s),b=async s=>{g(s);try{await x.mutateAsync(s),r({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(u){r({title:"Erro ao enviar",description:T(u,"N√£o foi poss√≠vel iniciar o envio."),variant:"destructive"})}finally{g(null)}},c=async()=>{if(o)try{await d.mutateAsync(o),r({title:"Campanha exclu√≠da",description:"A campanha foi removida com sucesso."}),n===o&&m(null)}catch(s){r({title:"Erro ao excluir",description:T(s,"N√£o foi poss√≠vel excluir a campanha."),variant:"destructive"})}finally{a(null)}},l=s=>{const u=qe[s]||{label:s,className:"bg-muted text-muted-foreground"};return e.jsx(R,{variant:"outline",className:y("text-[11px]",u.className),children:u.label})};return e.jsxs(V,{title:"Campanhas de Newsletter",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground hidden sm:block",children:"Gerencie e envie suas campanhas de e-mail."}),e.jsx(Le,{})]}),e.jsx(ge,{children:e.jsx(fe,{className:"p-0",children:j?e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx(C,{className:"h-8 w-full"}),e.jsx(C,{className:"h-8 w-full"}),e.jsx(C,{className:"h-8 w-full"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(be,{children:[e.jsx(ve,{children:e.jsxs(E,{children:[e.jsx(w,{children:"Assunto"}),e.jsx(w,{className:"w-[100px]",children:"Status"}),e.jsx(w,{className:"w-[140px]",children:"Criado em"}),e.jsx(w,{className:"w-[140px]",children:"Enviado em"}),e.jsx(w,{className:"w-[180px] text-right",children:"A√ß√µes"})]})}),e.jsx(Ne,{children:h?t==null?void 0:t.map(s=>e.jsxs(E,{className:y("cursor-pointer transition-colors",n===s.id&&"bg-muted/50"),onClick:()=>m(s.id),children:[e.jsx(N,{className:"font-medium",children:s.subject}),e.jsx(N,{children:l(s.status)}),e.jsx(N,{className:"text-sm text-muted-foreground",children:S(s.created_at)}),e.jsx(N,{className:"text-sm text-muted-foreground",children:S(s.sent_at)}),e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",onClick:u=>u.stopPropagation(),children:[v(s.status)&&e.jsx(f,{variant:"default",size:"sm",className:"h-7 text-xs",onClick:()=>b(s.id),disabled:i===s.id,children:i===s.id?"Enviando...":"Enviar"}),e.jsx(f,{variant:"ghost",size:"sm",className:"h-7 text-xs text-destructive hover:text-destructive",onClick:()=>a(s.id),disabled:d.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(E,{children:e.jsx(N,{colSpan:5,className:"text-center text-muted-foreground py-12",children:'Nenhuma campanha cadastrada. Crie uma manualmente ou publique um post com a op√ß√£o "Enviar newsletter".'})})})]})}),e.jsx("div",{className:"md:hidden p-4 space-y-3",children:h?t==null?void 0:t.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-border space-y-3 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>m(s.id),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:"font-medium text-sm flex-1",children:s.subject}),l(s.status)]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:S(s.created_at)}),e.jsxs("div",{className:"flex gap-2",onClick:u=>u.stopPropagation(),children:[v(s.status)&&e.jsx(f,{size:"sm",className:"h-7 text-xs",onClick:()=>b(s.id),disabled:i===s.id,children:"Enviar"}),e.jsx(f,{variant:"ghost",size:"sm",className:"h-7 text-xs text-destructive",onClick:()=>a(s.id),children:"Excluir"})]})]})]},s.id)):e.jsx("p",{className:"text-center text-sm text-muted-foreground py-8",children:"Nenhuma campanha cadastrada."})})]})})}),e.jsx(Me,{campaignId:n,onClose:()=>m(null),onDelete:s=>a(s),isDeleting:d.isPending}),e.jsx(Ce,{open:!!o,onOpenChange:()=>a(null),children:e.jsxs(we,{children:[e.jsxs(ye,{children:[e.jsx(De,{children:"Excluir campanha?"}),e.jsx(Ee,{children:"Esta a√ß√£o remove a campanha e seu hist√≥rico de envios. N√£o pode ser desfeita."})]}),e.jsxs(Se,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Ae,{onClick:c,disabled:d.isPending,children:d.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{ws as default};
