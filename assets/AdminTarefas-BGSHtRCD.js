const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminCrmDashboard-BvZmYEeB.js","assets/index-DixcKx3f.js","assets/index-CerVpy-o.css","assets/card-CmUM6BfH.js","assets/badge-CmeA_QT4.js","assets/button-UQeTJvbR.js","assets/skeleton-BV0OOwzS.js","assets/select-CLbTsJJp.js","assets/index-D0AoI_jk.js","assets/index-BWrivf-P.js","assets/index-DJsWYCEK.js","assets/chevron-up-DsofAcH6.js","assets/check-BwRU3RkH.js","assets/crmTypes-CiPVSVr_.js","assets/useQuery-DFTDskKo.js","assets/filter-B_FaUucy.js","assets/folder-kanban-CEyoKlWd.js","assets/calendar-Z9o670Zz.js","assets/list-todo-Bu8qy9bp.js","assets/clock-ChVSFK-z.js","assets/triangle-alert-Dvk2RYHp.js","assets/circle-check-DtZLtjOO.js","assets/arrow-right-njhL3ydz.js","assets/users-YOvpsGCv.js"])))=>i.map(i=>d[i]);
import{c as Re,r as a,j as e,e as g,h as ft,m as js,a5 as gt}from"./index-DixcKx3f.js";import{E as jt,A as bt,m as Ss}from"./formatters-uDq9-6EO.js";import{P as vt,T as Nt}from"./TarefaSheet-BjX1o2RX.js";import{u as xs}from"./useCrmFieldOptions-CIW6wzYt.js";import{u as St,F as Ct,a as xe,b as me,c as he,d as De,e as pe,t as wt}from"./form-DJi3DG1h.js";import{D as yt,C as Cs}from"./DatePickerInput-CXgRWxwT.js";import{S as Dt,b as Tt,c as kt,d as _t,e as At,f as Mt}from"./sheet-BjCYXMp8.js";import{I as ms}from"./input-S4SE4ieG.js";import{B as U}from"./button-UQeTJvbR.js";import{S as T,a as k,b as _,c as A,d as u}from"./select-CLbTsJJp.js";import{P as He,a as Ue,b as Ye}from"./popover-BSZ4nNJ6.js";import{S as hs,g as is,h as ws,a as Ot,b as Lt,i as ys,j as Ds,T as Ts,c as Pe}from"./crmTypes-CiPVSVr_.js";import{S as ps}from"./search-DRk7yPhG.js";import{C as Et}from"./check-BwRU3RkH.js";import{U as Pt}from"./user-CwbXQKSa.js";import{T as fs}from"./trash-2-DfpIpLp4.js";import{L as It}from"./loader-circle-DoMssvgx.js";import{o as Ft,s as fe}from"./types-Ba-nZvwf.js";import{T as ks,b as _s,c as Bt,K as Rt}from"./CrmSkeletons-D0-O1d6D.js";import{C as Fe,c as Be}from"./card-CmUM6BfH.js";import{A as As,a as Ms,b as Os,c as Ls,d as Es,e as Ps,f as Is,g as Fs}from"./alert-dialog-BkSlHPy5.js";import{B as F,P as Bs}from"./badge-CmeA_QT4.js";import{S as Ie}from"./switch-Bk2qqYMm.js";import{C as Rs}from"./checkbox-MtKtJYR3.js";import{u as Vs,a as $s,D as Ks,c as zs,b as Hs,d as Us,S as Ys,v as Ws,P as Gs,e as Zs,C as qs}from"./sortable.esm-CuLhkGgB.js";import{C as Te}from"./calendar-Z9o670Zz.js";import{U as Ge}from"./users-YOvpsGCv.js";import{F as Ze}from"./folder-kanban-CEyoKlWd.js";import{L as Js}from"./list-D0VCIBFD.js";import{P as Xs}from"./pencil-D2l7Rrk1.js";import{L as Vt}from"./label-BirSf-vf.js";import{S as os}from"./skeleton-BV0OOwzS.js";import{C as $t,a as Kt}from"./circle-check-DtZLtjOO.js";import{C as zt}from"./clipboard-list-Dx4REkR9.js";import{F as Ht}from"./filter-B_FaUucy.js";import{C as Qs,a as Ut}from"./circle-x-BN38sNNp.js";import{C as Yt}from"./clock-ChVSFK-z.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=Re("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Re("CircleDot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=Re("Columns3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=Re("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=Re("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),Zt=Ft({title:fe().trim().min(1,"Título obrigatório").max(200),parentTaskId:fe().min(1,"Tarefa-mãe obrigatória"),deadline:fe().optional(),status:fe().min(1),assignee:fe().optional(),notes:fe().max(2e3).optional(),numeroProcesso:fe().max(25).optional()});function qt({open:d,onOpenChange:n,subtask:i,tasks:m,onSave:f,onDelete:v}){const j=!i,[b,w]=a.useState(!1),[L,z]=a.useState(""),{getOptions:h}=xs(),y=h("subtarefa_status").map(x=>[x.value,x.label]),Y=Object.entries(hs),W=y.length>0?y:Y,[B,C]=a.useState(!1),H=a.useMemo(()=>{if(!L.trim())return m;const x=L.toLowerCase();return m.filter(p=>p.title.toLowerCase().includes(x))},[m,L]),I=St({resolver:wt(Zt),defaultValues:{title:"",parentTaskId:"",deadline:"",status:"agendado",assignee:"",notes:""}});a.useEffect(()=>{d&&(i?I.reset({title:i.title,parentTaskId:i.parentTaskId,deadline:i.dueDate??"",status:i.status,assignee:i.assignee??"",notes:i.notes??"",numeroProcesso:i.numeroProcesso??""}):I.reset({title:"",parentTaskId:"",deadline:"",status:"agendado",assignee:"",notes:"",numeroProcesso:""}))},[d,i]);const J=async x=>{w(!0);try{await f(x,j,i==null?void 0:i.id),n(!1)}catch(p){ft.error("Erro ao salvar subtarefa: "+p.message),console.error("Erro ao salvar subtarefa:",p)}finally{w(!1)}};return e.jsx(Dt,{open:d,onOpenChange:n,children:e.jsxs(Tt,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(kt,{className:"mb-6",children:[e.jsx(_t,{children:j?"Nova Subtarefa":"Editar Subtarefa"}),e.jsx(At,{children:j?"Preencha os dados e selecione a tarefa-mãe relacionada.":"Altere os campos e salve."})]}),e.jsx(Ct,{...I,children:e.jsxs("form",{onSubmit:I.handleSubmit(J),className:"space-y-5",children:[e.jsx(xe,{control:I.control,name:"title",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Título *"}),e.jsx(De,{children:e.jsx(ms,{placeholder:"Ex: Enviar documento",...x})}),e.jsx(pe,{})]})}),e.jsx(xe,{control:I.control,name:"parentTaskId",render:({field:x})=>{var p;return e.jsxs(me,{className:"flex flex-col",children:[e.jsx(he,{children:"Tarefa-mãe *"}),e.jsxs(He,{open:B,onOpenChange:C,children:[e.jsx(Ue,{asChild:!0,children:e.jsx(De,{children:e.jsxs(U,{variant:"outline",role:"combobox",className:g("w-full justify-between font-normal",!x.value&&"text-muted-foreground"),children:[e.jsx("span",{className:"truncate",children:x.value?((p=m.find(M=>M.id===x.value))==null?void 0:p.title)??"Tarefa não encontrada":"Selecione a tarefa-mãe..."}),e.jsx(Wt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsxs(Ye,{className:"w-[--radix-popover-trigger-width] p-0",align:"start",children:[e.jsxs("div",{className:"flex items-center border-b px-3",children:[e.jsx(ps,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx("input",{className:"flex h-10 w-full bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground",placeholder:"Buscar tarefa...",value:L,onChange:M=>z(M.target.value)})]}),e.jsx("div",{className:"max-h-[200px] overflow-y-auto p-1",children:H.length===0?e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"Nenhuma tarefa encontrada."}):H.map(M=>e.jsxs("button",{type:"button",className:g("relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none hover:bg-accent hover:text-accent-foreground",x.value===M.id&&"bg-accent"),onClick:()=>{x.onChange(M.id),C(!1),z("")},children:[e.jsx(Et,{className:g("mr-2 h-4 w-4",x.value===M.id?"opacity-100":"opacity-0")}),e.jsx("span",{className:"truncate",children:M.title})]},M.id))})]})]}),e.jsx(pe,{})]})}}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(xe,{control:I.control,name:"deadline",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Prazo"}),e.jsx(De,{children:e.jsx(yt,{value:x.value??"",onChange:x.onChange})}),e.jsx(pe,{})]})}),e.jsx(xe,{control:I.control,name:"status",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Status"}),e.jsxs(T,{onValueChange:x.onChange,value:x.value,children:[e.jsx(De,{children:e.jsx(k,{children:e.jsx(_,{})})}),e.jsx(A,{children:W.map(([p,M])=>e.jsx(u,{value:p,children:M},p))})]}),e.jsx(pe,{})]})})]}),e.jsx(xe,{control:I.control,name:"assignee",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Responsável"}),e.jsxs(T,{onValueChange:p=>x.onChange(p==="_none_"?"":p),value:x.value||"_none_",children:[e.jsx(De,{children:e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pt,{className:"w-3.5 h-3.5 text-muted-foreground"}),e.jsx(_,{placeholder:"Responsável..."})]})})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),is.map(p=>e.jsx(u,{value:p,children:p},p))]})]}),e.jsx(pe,{})]})}),e.jsx(xe,{control:I.control,name:"numeroProcesso",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Processo Judicial"}),e.jsx(vt,{value:x.value??"",onValueChange:x.onChange}),e.jsx(pe,{})]})}),e.jsx(xe,{control:I.control,name:"notes",render:({field:x})=>e.jsxs(me,{children:[e.jsx(he,{children:"Observações"}),e.jsx(De,{children:e.jsx(jt,{value:x.value??"",onChange:x.onChange,placeholder:"Observações...",modalTitle:"Editar Observações da Subtarefa"})}),e.jsx(pe,{})]})}),!j&&(i==null?void 0:i.id)&&e.jsx(bt,{folder:`subtarefas/${i.id}`}),e.jsxs(Mt,{className:"gap-2 flex-col sm:flex-row",children:[!j&&i&&v&&e.jsxs(U,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{v(i.id),n(!1)},disabled:b,children:[e.jsx(fs,{className:"w-4 h-4 mr-2"})," Excluir"]}),e.jsxs(U,{type:"submit",disabled:b,className:"flex-1",children:[b&&e.jsx(It,{className:"w-4 h-4 mr-2 animate-spin"}),j?"Criar Subtarefa":"Salvar Alterações"]})]})]})})]})})}const Jt=[{value:"deadline",label:"Prazo (mais distante)"},{value:"title",label:"Título (A → Z)"},{value:"status",label:"Status"}],bs={Pendente:0,Agendado:1,"A fazer":2,"Em andamento":3,Concluído:4},Xt=["Pendente","Agendado","A fazer","Em andamento","Concluído"],Qt={Pendente:"border-t-red-500/60",Agendado:"border-t-blue-500/60","A fazer":"border-t-orange-500/60","Em andamento":"border-t-yellow-500/60",Concluído:"border-t-green-500/60"};function ea(d,n){return[...d].sort((i,m)=>{switch(n){case"deadline":return!i.dueDate&&!m.dueDate?0:i.dueDate?m.dueDate?m.dueDate.localeCompare(i.dueDate):-1:1;case"title":return i.title.localeCompare(m.title,"pt-BR");case"status":return(bs[i.status]??0)-(bs[m.status]??0);default:return 0}})}function sa({id:d,children:n}){const{attributes:i,listeners:m,setNodeRef:f,transform:v,transition:j,isDragging:b}=Zs({id:d}),w={transform:qs.Transform.toString(v),transition:j};return e.jsx("div",{ref:f,style:w,...i,...m,className:g("touch-none",b&&"opacity-30"),children:n})}function ta({status:d,isOver:n,items:i,itemIds:m,today:f,onEdit:v,onDelete:j,showRichNotes:b,borderColor:w,badgeColor:L,statusLabel:z}){const{setNodeRef:h}=Us({id:d});return e.jsxs("div",{className:g("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",w||"border-t-muted/60",n&&"bg-card/80 ring-2 ring-primary/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-border shadow-sm bg-background/50 backdrop-blur-md rounded-t-xl",children:[e.jsx(F,{variant:"secondary",className:L,children:z}),e.jsx(F,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50",children:i.length})]}),e.jsxs("div",{ref:h,"data-column-status":d,className:"flex-1 p-3 space-y-3",children:[e.jsx(Ys,{items:m,strategy:Ws,children:i.map(y=>e.jsx(sa,{id:y.id,children:e.jsx(ds,{sub:y,today:f,onEdit:()=>v(y),onDelete:()=>j(y.id),showRichNotes:b})},y.id))}),i.length===0&&e.jsx("div",{className:"sticky top-[40vh] flex flex-col items-center justify-center border-2 border-dashed border-border/50 rounded-xl p-4 min-h-[80px]"})]})]})}const ds=a.memo(function({sub:n,today:i,showStatus:m,onEdit:f,onDelete:v,showRichNotes:j}){const b=n.dueDate&&n.dueDate<i&&n.status!=="Concluído";return e.jsx(Fe,{className:g("group transition-shadow duration-150 hover:shadow-md cursor-pointer",b&&"border-destructive/50"),onClick:f,children:e.jsx(Be,{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1 flex-wrap",children:[m&&e.jsx(F,{variant:"secondary",className:g("text-[10px]",ws[n.status]),children:hs[n.status]}),b&&e.jsx(F,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),e.jsx("p",{className:g("font-medium text-sm",n.completed&&"line-through text-muted-foreground"),children:n.title}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx("span",{className:"font-medium",children:"Tarefa:"})," ",n.parentTaskTitle]}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1 text-xs text-muted-foreground",children:[n.projectName&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),n.projectName]}),n.assignee&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),n.assignee]}),n.dueDate&&e.jsxs("span",{className:g("flex items-center gap-1",b&&"text-destructive font-medium"),children:[e.jsx(Te,{className:"w-3 h-3"}),new Date(n.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]})]}),n.notes&&j&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Ss(n.notes)||n.notes}}),n.notes&&!j&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 line-clamp-2",children:n.notes.replace(/<[^>]*>/g,"")})]}),e.jsxs("div",{className:"flex gap-0.5 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(U,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:w=>{w.stopPropagation(),f()},children:e.jsx(Xs,{className:"w-3.5 h-3.5"})}),e.jsx(U,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:w=>{w.stopPropagation(),v()},children:e.jsx(fs,{className:"w-3.5 h-3.5"})})]})]})})})});function aa({tasks:d,projects:n,loading:i,onCreateSubtask:m,onUpdateSubtask:f,onDeleteSubtask:v}){const{allOptions:j,getOrderedValues:b,getLabelsMap:w,getColorsMap:L,getBorderColorsMap:z}=xs(),h=a.useMemo(()=>{const t=b("subtarefa_status");return t.length>0?t:Xt},[j]),y=a.useMemo(()=>{const t=w("subtarefa_status");return Object.keys(t).length>0?t:hs},[j]),Y=a.useMemo(()=>{const t=L("subtarefa_status");return Object.keys(t).length>0?t:ws},[j]),W=a.useMemo(()=>{const t=z("subtarefa_status");return Object.keys(t).length>0?t:Qt},[j]),[B,C]=a.useState(!1),[H,I]=a.useState(null),[J,x]=a.useState("kanban"),[p,M]=a.useState(""),[ie,qe]=a.useState("all"),[ge,ke]=a.useState("all"),[_e,Je]=a.useState("all"),[N,X]=a.useState("all"),[Q,je]=a.useState("all"),[Ae,be]=a.useState("deadline"),[ce,ve]=a.useState(()=>localStorage.getItem("crm_hideDone_subtarefas")==="true"),Xe=a.useCallback(t=>{localStorage.setItem("crm_hideDone_subtarefas",String(t)),ve(t)},[]),[ee,Qe]=a.useState(!1),[ae,re]=a.useState(null),[Me,Oe]=a.useState(null),[Ne,Se]=a.useState(null),Ce=Vs($s(Gs,{activationConstraint:{distance:8}})),we=a.useMemo(()=>{const t={};return n.forEach(o=>{t[o.id]=o.name}),t},[n]),R=a.useMemo(()=>d.flatMap(t=>t.subtasks.map(o=>({...o,parentTaskTitle:t.title,projectId:t.projectId,projectName:t.projectId?we[t.projectId]:void 0}))),[d,we]),Z=a.useMemo(()=>{const t=new Date,o=new Date(t.getFullYear(),t.getMonth(),t.getDate()),c=new Date(o);c.setDate(o.getDate()+(7-o.getDay()));const O=new Date(t.getFullYear(),t.getMonth()+1,0),$=R.filter(D=>{if(p&&!D.title.toLowerCase().includes(p.toLowerCase())||ie!=="all"&&D.status!==ie||ge!=="all"&&D.assignee!==ge||_e!=="all"&&D.projectId!==_e||N!=="all"&&D.parentTaskId!==N||ce&&D.status==="Concluído")return!1;if(Q!=="all"){if(!D.dueDate)return Q==="sem_prazo";const G=new Date(D.dueDate+"T23:59:59");switch(Q){case"atrasadas":return G<o&&D.status!=="Concluído";case"hoje":return D.dueDate===V;case"esta_semana":return G>=o&&G<=c;case"este_mes":return G>=o&&G<=O;case"sem_prazo":return!1}}return!0});return ea($,Ae)},[R,p,ie,ge,_e,N,Ae,ce,Q]),V=a.useMemo(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},[]);a.useMemo(()=>{const t={};h.forEach(c=>{t[c]=0});const o=R.filter(c=>c.dueDate&&c.dueDate<V&&c.status!=="Concluído").length;return R.forEach(c=>{t[c.status]!==void 0&&t[c.status]++}),{...t,overdue:o,total:R.length}},[R,V]);const es=a.useCallback(()=>{I(null),C(!0)},[]),se=a.useCallback(t=>{I(t),C(!0)},[]),ss=a.useCallback(async(t,o,c)=>{o?await m(t.parentTaskId,{title:t.title,deadline:t.deadline||void 0,status:t.status,assignee:t.assignee||void 0,notes:t.notes||void 0}):c&&await f(c,{title:t.title,deadline:t.deadline||void 0,status:t.status,assignee:t.assignee||void 0,notes:t.notes||void 0})},[m,f]),de=a.useCallback(async()=>{ae&&(await v(ae),re(null))},[ae,v]),ts=a.useMemo(()=>{const t={};return h.forEach(o=>{t[o]=[]}),Z.forEach(o=>{t[o.status]&&t[o.status].push(o)}),t},[Z,h]),as=a.useCallback(t=>{Oe(String(t.active.id))},[]),rs=a.useCallback(t=>{const{over:o}=t;if(!o){Se(null);return}const c=String(o.id),O=R.find(D=>D.id===c),$=O?O.status:h.includes(c)?c:null;Se($)},[R,h]),ye=a.useCallback(async t=>{const{active:o,over:c}=t;if(Oe(null),Se(null),!c)return;const O=String(o.id),$=String(c.id);if(O===$)return;const D=R.find(q=>q.id===O);if(!D)return;const G=R.find(q=>q.id===$),oe=G?G.status:h.includes($)?$:D.status;D.status!==oe&&await f(O,{status:oe})},[R,f,h]),ns=a.useCallback(()=>{Oe(null),Se(null)},[]),ue=Me?R.find(t=>t.id===Me):null,Ve=a.useMemo(()=>h.filter(t=>!ce||t!=="Concluído"),[ce,h]),ne=a.useMemo(()=>[{key:"title",label:"Título",width:250,minWidth:150,sticky:!0,sortable:!0,sortFn:(t,o)=>t.title.localeCompare(o.title,"pt-BR"),render:t=>e.jsx("span",{className:"font-medium",children:t.title})},{key:"status",label:"Status",width:130,sortable:!0,sortFn:(t,o)=>t.status.localeCompare(o.status),render:t=>e.jsx(F,{variant:"secondary",className:g("text-[10px]",Y[t.status]),children:y[t.status]||t.status}),inlineEdit:(t,o)=>e.jsxs(T,{value:t.status,onValueChange:o,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:h.map(c=>e.jsx(u,{value:c,children:y[c]||c},c))})]})},{key:"parentTaskTitle",label:"Tarefa-mãe",width:200,sortable:!0,sortFn:(t,o)=>t.parentTaskTitle.localeCompare(o.parentTaskTitle,"pt-BR"),render:t=>e.jsx("span",{className:"text-xs",children:t.parentTaskTitle})},{key:"dueDate",label:"Prazo",width:110,sortable:!0,sortFn:(t,o)=>!t.dueDate&&!o.dueDate?0:t.dueDate?o.dueDate?o.dueDate.localeCompare(t.dueDate):-1:1,render:t=>t.dueDate?e.jsxs("span",{className:g("text-xs flex items-center gap-1",t.dueDate<V&&t.status!=="Concluído"&&"text-destructive font-medium"),children:[e.jsx(Te,{className:"w-3 h-3"}),new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(t,o)=>e.jsxs(He,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:g("h-7 text-xs w-full justify-start font-normal",!t.dueDate&&"text-muted-foreground"),children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),t.dueDate?new Date(t.dueDate+"T12:00:00").toLocaleDateString("pt-BR"):"Selecionar"]})}),e.jsx(Ye,{className:"w-auto p-0",align:"start",children:e.jsx(Cs,{mode:"single",selected:t.dueDate?new Date(t.dueDate+"T12:00:00"):void 0,onSelect:c=>{if(c){const O=c.getFullYear(),$=String(c.getMonth()+1).padStart(2,"0"),D=String(c.getDate()).padStart(2,"0");o(`${O}-${$}-${D}`)}else o("")},initialFocus:!0,className:"p-3 pointer-events-auto"})})]})},{key:"assignee",label:"Responsável",width:130,sortable:!0,sortFn:(t,o)=>(t.assignee??"").localeCompare(o.assignee??"","pt-BR"),render:t=>t.assignee?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),t.assignee]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(t,o)=>e.jsxs(T,{value:t.assignee||"_none_",onValueChange:c=>o(c==="_none_"?"":c),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),is.map(c=>e.jsx(u,{value:c,children:c},c))]})]})},{key:"project",label:"Projeto",width:130,render:t=>t.projectName?e.jsxs(F,{variant:"outline",className:"text-[10px] gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),t.projectName]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"relatorioMensal",label:"Rel. Mensal",width:90,render:t=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Rs,{checked:!!t.relatorioMensal,onCheckedChange:o=>f(t.id,{relatorioMensal:!!o})})})}],[V,f]),Le=a.useCallback((t,o,c)=>{o==="status"?f(t,{status:c}):o==="assignee"?f(t,{assignee:c||void 0}):o==="dueDate"?f(t,{deadline:c||void 0}):o==="relatorioMensal"&&f(t,{relatorioMensal:c==="true"})},[f]),le=a.useCallback(t=>{t.forEach(o=>v(o))},[v]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 glass p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(ms,{placeholder:"Buscar subtarefa...",value:p,onChange:t=>M(t.target.value),className:"pl-9 w-full text-sm"})]}),e.jsxs("div",{className:"flex gap-2 items-center ml-auto flex-wrap",children:[e.jsxs(U,{onClick:es,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(Bs,{className:"mr-1.5 h-4 w-4"})," Nova Subtarefa"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsxs("button",{onClick:()=>x("kanban"),className:g("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",J==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(et,{className:"w-4 h-4"})," Kanban"]}),e.jsxs("button",{onClick:()=>x("list"),className:g("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",J==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Js,{className:"w-4 h-4"})," Lista"]}),e.jsxs("button",{onClick:()=>x("table"),className:g("flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium transition-colors",J==="table"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(ks,{className:"w-4 h-4"})," Tabela"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap flex-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),e.jsxs(T,{value:ie,onValueChange:qe,children:[e.jsx(k,{className:"w-[130px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos Status"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Status"}),h.map(t=>e.jsx(u,{value:t,children:y[t]||t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),e.jsxs(T,{value:Q,onValueChange:je,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),e.jsx(u,{value:"atrasadas",children:"Atrasadas"}),e.jsx(u,{value:"hoje",children:"Vence hoje"}),e.jsx(u,{value:"esta_semana",children:"Esta semana"}),e.jsx(u,{value:"este_mes",children:"Este mês"}),e.jsx(u,{value:"sem_prazo",children:"Sem prazo"})]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),e.jsxs(T,{value:ge,onValueChange:ke,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),is.map(t=>e.jsx(u,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Tarefa-mãe"}),e.jsxs(T,{value:N,onValueChange:X,children:[e.jsx(k,{className:"w-[160px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todas"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todas"}),d.map(t=>e.jsx(u,{value:t.id,children:t.title},t.id))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),e.jsxs(T,{value:Ae,onValueChange:t=>be(t),children:[e.jsx(k,{className:"w-[160px] h-8 text-xs",children:e.jsx(_,{})}),e.jsx(A,{children:Jt.map(t=>e.jsx(u,{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 ml-auto shrink-0",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Ocultar concluídas",e.jsx(Ie,{checked:ce,onCheckedChange:Xe,className:"scale-75"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:["Observações formatadas",e.jsx(Ie,{checked:ee,onCheckedChange:Qe,className:"scale-75"})]})]})]})]}),e.jsx(qt,{open:B,onOpenChange:C,subtask:H,tasks:d,onSave:ss,onDelete:t=>re(t)}),e.jsx(As,{open:!!ae,onOpenChange:t=>!t&&re(null),children:e.jsxs(Ms,{children:[e.jsxs(Os,{children:[e.jsx(Ls,{children:"Remover subtarefa?"}),e.jsx(Es,{children:"Esta ação não pode ser desfeita. A subtarefa será removida permanentemente."})]}),e.jsxs(Ps,{children:[e.jsx(Is,{children:"Cancelar"}),e.jsx(Fs,{onClick:de,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),i?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx(Fe,{children:e.jsx(Be,{className:"p-4",children:e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"})})},t))}):J==="table"?e.jsx(_s,{data:Z,columns:ne,onEdit:t=>se(t),onDelete:t=>re(t),onBulkDelete:le,onInlineChange:Le,emptyMessage:"Nenhuma subtarefa encontrada."}):J==="list"?e.jsx("div",{className:"space-y-3",children:Z.length===0?e.jsx(Fe,{children:e.jsx(Be,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma subtarefa encontrada."})}):Z.map(t=>e.jsx(ds,{sub:t,today:V,showStatus:!0,onEdit:()=>se(t),onDelete:()=>re(t.id),showRichNotes:ee},t.id))}):e.jsxs(Ks,{sensors:Ce,collisionDetection:zs,onDragStart:as,onDragOver:rs,onDragEnd:ye,onDragCancel:ns,children:[e.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:e.jsx("div",{className:"flex gap-4",style:{minWidth:`${Ve.length*300}px`},children:Ve.map(t=>{const o=Ne===t,c=ts[t],O=c.map($=>$.id);return e.jsx("div",{className:"flex-1 min-w-[260px]",children:e.jsx(ta,{status:t,isOver:o,items:c,itemIds:O,today:V,onEdit:se,onDelete:re,showRichNotes:ee,borderColor:W[t]||"border-t-muted/60",badgeColor:Y[t]||"",statusLabel:y[t]||t})},t)})})}),e.jsx(Hs,{children:ue&&e.jsx("div",{className:"shadow-xl ring-2 ring-primary/30 rotate-[2deg] scale-105",children:e.jsx(ds,{sub:ue,today:V,showStatus:!0,onEdit:()=>{},onDelete:()=>{},showRichNotes:ee})})})]})]})}const ra=a.lazy(()=>gt(()=>import("./AdminCrmDashboard-BvZmYEeB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]))),na=[{value:"deadline",label:"Prazo (mais distante)"},{value:"priority",label:"Prioridade (Alta → Baixa)"},{value:"title",label:"Título (A → Z)"},{value:"client",label:"Cliente (A → Z)"}],We={alta:0,media:1,baixa:2};function vs(d,n){return[...d].sort((i,m)=>{switch(n){case"deadline":return!i.dueDate&&!m.dueDate?0:i.dueDate?m.dueDate?m.dueDate.localeCompare(i.dueDate):-1:1;case"priority":return(We[i.priority]??1)-(We[m.priority]??1);case"title":return i.title.localeCompare(m.title,"pt-BR");case"client":return(i.client??"").localeCompare(m.client??"","pt-BR");default:return 0}})}const la={client:!0,dueDate:!0,priority:!0,subtasks:!0,tags:!0,description:!1},Ns={client:"Cliente",dueDate:"Data de entrega",priority:"Prioridade",subtasks:"Subtarefas",tags:"Tags",description:"Descrição"},oa=["pendente","agendado","em_andamento","em_tramite","concluida","cancelada"],ia={pendente:"border-t-red-500/60",agendado:"border-t-blue-500/60",em_andamento:"border-t-yellow-500/60",em_tramite:"border-t-orange-500/60",concluida:"border-t-green-500/60",cancelada:"border-t-muted/60"},ca={pendente:Qs,agendado:Yt,em_andamento:cs,em_tramite:cs,concluida:Kt,cancelada:Ut},da=[{value:"all",label:"Todos"},{value:"today",label:"Hoje"},{value:"this_week",label:"Esta semana"},{value:"this_month",label:"Este mês"},{value:"overdue",label:"Atrasadas"},{value:"no_deadline",label:"Sem prazo"}],us=a.memo(function({task:n,cardFields:i,today:m,isExpanded:f,onToggleExpand:v,onToggleSubtask:j,onEdit:b,onDelete:w,showStatus:L,isDragging:z,isOverlay:h,projectName:y}){const Y=n.subtasks.filter(C=>C.status==="Concluído").length,W=n.subtasks.length,B=n.dueDate&&n.dueDate<m&&n.status!=="concluida"&&n.status!=="cancelada";return e.jsx(Fe,{className:g("relative group transition-all duration-200 hover:shadow-md cursor-pointer",z?"opacity-40 scale-95":"",h&&"shadow-2xl ring-2 ring-primary/40 rotate-[2deg] scale-105 cursor-grabbing","border-border/50 bg-card"),onClick:()=>b==null?void 0:b(n),children:e.jsxs(Be,{className:"p-3.5",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[y&&e.jsx("div",{className:"mb-2",children:e.jsxs(F,{variant:"outline",className:"text-[10px] px-1.5 py-0 gap-1 font-normal",children:[e.jsx(Ze,{className:"w-3 h-3"}),y]})}),e.jsx("p",{className:"font-medium text-sm mb-1",children:n.title})]}),!h&&e.jsxs("div",{className:"flex gap-0.5 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(U,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:C=>{C.stopPropagation(),b==null||b(n)},children:e.jsx(Xs,{className:"w-3.5 h-3.5"})}),e.jsx(U,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:C=>{C.stopPropagation(),w(n.id)},children:e.jsx(fs,{className:"w-3.5 h-3.5"})})]})]}),i.description&&n.description&&e.jsx("div",{className:"text-xs text-muted-foreground mb-2 prose prose-xs max-w-none [&>*]:m-0 [&>*]:text-xs line-clamp-4",dangerouslySetInnerHTML:{__html:Ss(n.description)||n.description}}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[i.priority&&e.jsx(F,{variant:"secondary",className:`text-[10px] ${Ts[n.priority]}`,children:Pe[n.priority]}),L&&e.jsx(F,{variant:"secondary",className:`text-[10px] ${Ds[n.status]}`,children:ys[n.status]}),i.dueDate&&n.dueDate&&e.jsxs("span",{className:g("flex items-center gap-1",B&&"text-destructive font-medium"),children:[B?e.jsx(Qs,{className:"w-3 h-3"}):e.jsx(Te,{className:"w-3 h-3"}),new Date(n.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}),B&&e.jsx("span",{className:"text-destructive font-medium",children:"Atrasada"}),n.assignee&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),n.assignee]})]}),i.subtasks&&W>0&&!h&&e.jsx("div",{className:"flex justify-end mt-2",children:e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(st,{className:"w-3 h-3"}),Y,"/",W]})}),i.tags&&n.tags&&n.tags.length>0&&!h&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:n.tags.map(C=>e.jsx(F,{variant:"outline",className:"text-[10px]",children:C},C))})]})})});function ua(d){const{attributes:n,listeners:i,setNodeRef:m,transform:f,transition:v,isDragging:j}=Zs({id:d.task.id}),b={transform:qs.Transform.toString(f),transition:v};return e.jsx("div",{ref:m,style:b,...n,...i,children:e.jsx(us,{...d,isDragging:j})})}function xa({status:d,tasks:n,isOver:i,cardFields:m,today:f,expandedTasks:v,onToggleExpand:j,onToggleSubtask:b,onEdit:w,onDelete:L,projectMap:z,statusLabel:h,borderColor:y,badgeColor:Y}){const W=a.useMemo(()=>n.map(H=>H.id),[n]),{setNodeRef:B}=Us({id:d}),C=ca[d]||cs;return e.jsxs("div",{className:g("flex flex-col rounded-xl border border-border border-t-4 bg-card/40 min-h-[400px] transition-colors",y||"border-t-muted/60",i&&"bg-card/80 ring-2 ring-primary/20"),children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 px-4",children:[e.jsx(C,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(F,{variant:"secondary",className:g("text-xs",Y),children:h}),e.jsx(F,{variant:"secondary",className:"ml-auto text-xs bg-secondary/50 tabular-nums",children:n.length})]}),e.jsxs("div",{ref:B,"data-column-status":d,className:"flex-1 p-3 pt-0 space-y-3",children:[e.jsx(Ys,{items:W,strategy:Ws,children:n.map(H=>e.jsx(ua,{task:H,cardFields:m,today:f,isExpanded:v.has(H.id),onToggleExpand:j,onToggleSubtask:b,onEdit:w,onDelete:L,projectName:z.get(H.projectId||"")},H.id))}),n.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center border-2 border-dashed border-border/50 rounded-xl p-4 min-h-[100px]"})]})]})}function ma({projectId:d,clientNameFilter:n,hideHeader:i,forceTab:m}={}){const{tasks:f,setTasks:v,loading:j,error:b,updateTaskStatus:w,deleteTask:L,createTask:z,updateTask:h,createSubtask:y,updateSubtask:Y,deleteSubtask:W}=Ot(),{projects:B}=Lt(),{allOptions:C,getOrderedValues:H,getLabelsMap:I,getColorsMap:J,getBorderColorsMap:x}=xs(),p=a.useMemo(()=>{const s=H("tarefa_status");return s.length>0?s:oa},[C]),M=a.useMemo(()=>{const s=I("tarefa_status");return Object.keys(s).length>0?s:ys},[C]),ie=a.useMemo(()=>{const s=J("tarefa_status");return Object.keys(s).length>0?s:Ds},[C]),qe=a.useMemo(()=>{const s=x("tarefa_status");return Object.keys(s).length>0?s:ia},[C]),[ge,ke]=a.useState(!1),[_e,Je]=a.useState(null),N=a.useMemo(()=>n||d?f.filter(s=>{var S;const r=n&&((S=s.client)==null?void 0:S.toLowerCase().includes(n.toLowerCase())),l=d&&s.projectId===d;return n&&d?r||l:n?r:l}):f,[f,n,d]),[X,Q]=a.useState("kanban"),[je,Ae]=a.useState(""),[be,ce]=a.useState("all"),[ve,Xe]=a.useState("all"),[ee,Qe]=a.useState("all"),[ae,re]=a.useState(d||"all"),[Me,Oe]=a.useState(new Set),[Ne,Se]=a.useState(la),[Ce,we]=a.useState(null),[R,Z]=a.useState(null),[V,es]=a.useState("deadline"),[se,ss]=a.useState(()=>localStorage.getItem("crm_hideDone_tarefas")==="true"),[de,ts]=a.useState(()=>localStorage.getItem("crm_hideCancelled_tarefas")!=="false"),as=a.useCallback(s=>{localStorage.setItem("crm_hideDone_tarefas",String(s)),ss(s)},[]),rs=a.useCallback(s=>{localStorage.setItem("crm_hideCancelled_tarefas",String(s)),ts(s)},[]),[ye,ns]=a.useState("all"),[ue,Ve]=a.useState("all"),ne=a.useMemo(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`},[]),Le=a.useMemo(()=>[...new Set(N.map(s=>s.assignee).filter(Boolean))],[N]),le=a.useMemo(()=>{const r=!!(d&&n)?"all":d||ae,l=new Date,S=new Date(l);S.setDate(l.getDate()+7);const E=new Date(l.getFullYear(),l.getMonth()+1,0),te=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}-${String(S.getDate()).padStart(2,"0")}`,Ke=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}-${String(E.getDate()).padStart(2,"0")}`,Ee=N.filter(P=>{var ze;if(je&&!P.title.toLowerCase().includes(je.toLowerCase())||be!=="all"&&P.status!==be||ve!=="all"&&P.priority!==ve||ee!=="all"&&P.client!==ee||ue!=="all"&&P.assignee!==ue||r!=="all"&&P.projectId!==r||se&&P.status==="concluida"||de&&P.status==="cancelada")return!1;if(ye!=="all"){const K=(ze=P.dueDate)==null?void 0:ze.split("T")[0];switch(ye){case"today":if(K!==ne)return!1;break;case"this_week":if(!K||K<ne||K>te)return!1;break;case"this_month":if(!K||K<ne||K>Ke)return!1;break;case"overdue":if(!K||K>=ne||P.status==="concluida"||P.status==="cancelada")return!1;break;case"no_deadline":if(K)return!1;break}}return!0});return vs(Ee,V)},[N,je,be,ve,ee,ue,ae,V,ye,ne,se,de]),t=ne,o=a.useMemo(()=>Ce?N.find(s=>s.id===Ce):null,[Ce,N]),c=a.useMemo(()=>[...new Set(N.map(s=>s.client).filter(Boolean))],[N]),O=a.useMemo(()=>{const s=new Map;return B.forEach(r=>s.set(r.id,r.name)),s},[B]),$=a.useMemo(()=>N.reduce((s,r)=>s+r.subtasks.length,0),[N]),D=a.useCallback(s=>{Oe(r=>{const l=new Set(r);return l.has(s)?l.delete(s):l.add(s),l})},[]),G=a.useCallback((s,r)=>{v(l=>l.map(S=>S.id===s?{...S,subtasks:S.subtasks.map(E=>E.id===r?{...E,completed:!E.completed}:E)}:S))},[v]),[oe,q]=a.useState(null),tt=a.useCallback(async()=>{oe&&(v(s=>s.filter(r=>r.id!==oe)),L(oe),q(null))},[oe,L,v]),at=a.useCallback(s=>{Se(r=>({...r,[s]:!r[s]}))},[]),rt=a.useCallback(()=>{Je(null),ke(!0)},[]),ls=a.useCallback(s=>{Je(s),ke(!0)},[]),nt=a.useCallback(async(s,r,l)=>{r?await z({title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description,numeroProcesso:s.numeroProcesso,relatorioMensal:s.relatorioMensal}):l&&await h(l,{title:s.title,deadline:s.deadline,priority:s.priority,status:s.status,clientName:s.clientName,projectId:s.projectId,assignee:s.assignee,description:s.description,numeroProcesso:s.numeroProcesso,relatorioMensal:s.relatorioMensal})},[z,h]),lt=Vs($s(Gs,{activationConstraint:{distance:8}}));a.useCallback(s=>{const r=N.find(l=>l.id===s);return r==null?void 0:r.status},[N]);const ot=a.useCallback(s=>{we(s.active.id)},[]),it=a.useCallback(s=>{const{over:r}=s;if(!r){Z(null);return}const l=r.id,S=N.find(te=>te.id===l),E=S?S.status:p.includes(l)?l:null;Z(E)},[N]),ct=a.useCallback(s=>{const{active:r,over:l}=s;if(we(null),Z(null),!l)return;const S=r.id,E=l.id;if(S===E)return;const te=N.find(P=>P.id===S);if(!te)return;const Ke=N.find(P=>P.id===E),Ee=Ke?Ke.status:p.includes(E)?E:te.status;te.status!==Ee&&(v(P=>{const ze=P.map(K=>K.id===S?{...K,status:Ee}:K);return vs(ze,V)}),w(S,Ee))},[N,w,V]),dt=a.useCallback(()=>{we(null),Z(null)},[]),ut=a.useMemo(()=>{const s={};return p.forEach(r=>{s[r]=[]}),le.forEach(r=>{s[r.status]&&s[r.status].push(r)}),s},[le,p]),gs=a.useMemo(()=>p.filter(s=>!(se&&s==="concluida"||de&&s==="cancelada")),[se,de,p]),xt=a.useMemo(()=>[{key:"title",label:"Título",width:280,minWidth:150,sticky:!0,sortable:!0,sortFn:(s,r)=>s.title.localeCompare(r.title,"pt-BR"),render:s=>e.jsx("span",{className:"font-medium",children:s.title})},{key:"status",label:"Status",width:140,sortable:!0,sortFn:(s,r)=>s.status.localeCompare(r.status),render:s=>e.jsx(F,{variant:"secondary",className:g("text-[10px]",ie[s.status]),children:M[s.status]||s.status}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.status,onValueChange:r,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:p.map(l=>e.jsx(u,{value:l,children:M[l]||l},l))})]})},{key:"priority",label:"Prioridade",width:110,sortable:!0,sortFn:(s,r)=>(We[s.priority]??1)-(We[r.priority]??1),render:s=>e.jsx(F,{variant:"secondary",className:g("text-[10px]",Ts[s.priority]),children:Pe[s.priority]}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.priority,onValueChange:r,children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsx(A,{children:Object.entries(Pe).map(([l,S])=>e.jsx(u,{value:l,children:S},l))})]})},{key:"dueDate",label:"Prazo",width:150,sortable:!0,sortFn:(s,r)=>!s.dueDate&&!r.dueDate?0:s.dueDate?r.dueDate?r.dueDate.localeCompare(s.dueDate):-1:1,render:s=>s.dueDate?e.jsxs("span",{className:g("text-xs flex items-center gap-1",s.dueDate<t&&s.status!=="concluida"&&"text-destructive font-medium"),children:[e.jsx(Te,{className:"w-3 h-3"}),new Date(s.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(He,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(U,{variant:"outline",className:g("h-7 text-xs w-full justify-start font-normal",!s.dueDate&&"text-muted-foreground"),children:[e.jsx(Te,{className:"w-3 h-3 mr-1"}),s.dueDate?new Date(s.dueDate+"T12:00:00").toLocaleDateString("pt-BR"):"Selecionar"]})}),e.jsx(Ye,{className:"w-auto p-0",align:"start",children:e.jsx(Cs,{mode:"single",selected:s.dueDate?new Date(s.dueDate+"T12:00:00"):void 0,onSelect:l=>{if(l){const S=l.getFullYear(),E=String(l.getMonth()+1).padStart(2,"0"),te=String(l.getDate()).padStart(2,"0");r(`${S}-${E}-${te}`)}else r("")},initialFocus:!0,className:"p-3 pointer-events-auto"})})]})},{key:"assignee",label:"Responsável",width:140,sortable:!0,sortFn:(s,r)=>(s.assignee??"").localeCompare(r.assignee??"","pt-BR"),render:s=>s.assignee?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(Ge,{className:"w-3 h-3"}),s.assignee]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.assignee||"_none_",onValueChange:l=>r(l==="_none_"?"":l),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem responsável —"}),Le.map(l=>e.jsx(u,{value:l,children:l},l))]})]})},{key:"client",label:"Cliente",width:140,sortable:!0,sortFn:(s,r)=>(s.client??"").localeCompare(r.client??"","pt-BR"),render:s=>s.client?e.jsx("span",{className:"text-xs",children:s.client}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"}),inlineEdit:(s,r)=>e.jsxs(T,{value:s.client||"_none_",onValueChange:l=>r(l==="_none_"?"":l),children:[e.jsx(k,{className:"h-7 text-xs w-full",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"_none_",children:"— Sem cliente —"}),c.map(l=>e.jsx(u,{value:l,children:l},l))]})]})},{key:"project",label:"Projeto",width:140,render:s=>{const r=O.get(s.projectId||"");return r?e.jsxs(F,{variant:"outline",className:"text-[10px] gap-1",children:[e.jsx(Ze,{className:"w-3 h-3"}),r]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})}},{key:"relatorioMensal",label:"Rel. Mensal",width:90,render:s=>e.jsx("div",{className:"flex justify-center",children:e.jsx(Rs,{checked:!!s.relatorioMensal,onCheckedChange:r=>h(s.id,{relatorioMensal:!!r})})})}],[t,Le,O,c,h]),mt=a.useCallback((s,r,l)=>{r==="status"?w(s,l):r==="assignee"?h(s,{responsavel:l||null}):r==="priority"?h(s,{prioridade:l}):r==="client"?h(s,{cliente:l||null}):r==="dueDate"?h(s,{deadline:l||null}):r==="relatorioMensal"&&h(s,{relatorioMensal:l==="true"})},[w,h]),ht=a.useCallback(s=>{s.forEach(r=>L(r))},[L]),[$e,pt]=a.useState(m||"overview");return e.jsxs(js.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[!m&&e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 mb-5 scrollbar-none",children:e.jsx("div",{className:"flex items-center gap-1 rounded-2xl border border-border bg-muted/40 p-1 w-fit backdrop-blur-sm",children:[{id:"overview",label:"Visão Geral",icon:$t},{id:"tarefas",label:"Tarefas",icon:zt,count:le.length},{id:"subtarefas",label:"Subtarefas",icon:st,count:$}].map(s=>{const r=$e===s.id,l=s.icon;return e.jsxs("button",{onClick:()=>pt(s.id),className:g("relative flex items-center gap-2 rounded-xl px-4 sm:px-5 py-2 sm:py-2.5 text-sm font-medium transition-all duration-200 whitespace-nowrap",r?"text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[r&&e.jsx(js.div,{layoutId:"tarefas-tab-bg",className:"absolute inset-0 rounded-xl gold-gradient shadow-sm",transition:{type:"spring",bounce:.15,duration:.5}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),e.jsx("span",{className:"sm:hidden",children:s.id==="overview"?"Geral":s.label}),"count"in s&&e.jsx("span",{className:g("inline-flex items-center justify-center rounded-full px-2 py-0.5 text-[10px] font-semibold tabular-nums min-w-[22px] transition-colors",r?"bg-primary-foreground/20 text-primary-foreground":"bg-secondary text-muted-foreground"),children:s.count})]})]},s.id)})})}),$e==="overview"&&e.jsx(a.Suspense,{fallback:e.jsxs("div",{className:"space-y-4",children:[e.jsx(os,{className:"h-10 w-full"}),e.jsx(os,{className:"h-40 w-full"}),e.jsx(os,{className:"h-40 w-full"})]}),children:e.jsx(ra,{})}),$e==="tarefas"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-3 glass p-3 sm:p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(ps,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(ms,{placeholder:"Buscar tarefas...",value:je,onChange:s=>Ae(s.target.value),className:"pl-9 w-full text-sm h-9"})]}),e.jsxs("div",{className:"flex gap-2 items-center sm:ml-auto flex-wrap",children:[e.jsxs(U,{onClick:rt,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9 flex-1 sm:flex-none",children:[e.jsx(Bs,{className:"mr-1.5 h-4 w-4"})," Nova Tarefa"]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsxs("button",{onClick:()=>Q("kanban"),className:g("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",X==="kanban"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(et,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Kanban"})]}),e.jsxs("button",{onClick:()=>Q("list"),className:g("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",X==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(Js,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Lista"})]}),e.jsxs("button",{onClick:()=>Q("table"),className:g("flex items-center gap-1 px-2.5 sm:px-3 py-1.5 text-xs sm:text-sm font-medium transition-colors",X==="table"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:[e.jsx(ks,{className:"w-4 h-4"})," ",e.jsx("span",{className:"hidden sm:inline",children:"Tabela"})]})]}),b&&e.jsx("span",{className:"text-xs text-destructive",children:"Erro ao carregar"}),e.jsxs(He,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(U,{variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",children:e.jsx(Gt,{className:"w-4 h-4"})})}),e.jsx(Ye,{className:"w-56",align:"end",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Mostrar nos cards"}),Object.keys(Ns).map(s=>e.jsxs("div",{className:"flex items-center justify-between py-1",children:[e.jsx(Vt,{htmlFor:`field-${s}`,className:"text-sm cursor-pointer",children:Ns[s]}),e.jsx(Ie,{id:`field-${s}`,checked:Ne[s],onCheckedChange:()=>at(s)})]},s))]})})]})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-3 px-3 sm:mx-0 sm:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex gap-2 items-end min-w-max",children:[e.jsx(Ht,{className:"w-4 h-4 text-muted-foreground shrink-0 mb-2"}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Status"}),e.jsxs(T,{value:be,onValueChange:ce,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos Status"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Status"}),p.map(s=>e.jsx(u,{value:s,children:M[s]||s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prioridade"}),e.jsxs(T,{value:ve,onValueChange:Xe,children:[e.jsx(k,{className:"w-[100px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todas"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todas"}),Object.keys(Pe).map(s=>e.jsx(u,{value:s,children:Pe[s]},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Prazo"}),e.jsxs(T,{value:ye,onValueChange:s=>ns(s),children:[e.jsx(k,{className:"w-[100px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsx(A,{children:da.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Responsável"}),e.jsxs(T,{value:ue,onValueChange:Ve,children:[e.jsx(k,{className:"w-[110px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos"}),Le.map(s=>e.jsx(u,{value:s,children:s},s))]})]})]}),!d&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Projeto"}),e.jsxs(T,{value:ae,onValueChange:re,children:[e.jsx(k,{className:"w-[140px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Projetos"}),B.map(s=>e.jsx(u,{value:s.id,children:s.name},s.id))]})]})]}),c.length>0&&e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Cliente"}),e.jsxs(T,{value:ee,onValueChange:Qe,children:[e.jsx(k,{className:"w-[120px] h-8 text-xs",children:e.jsx(_,{placeholder:"Todos"})}),e.jsxs(A,{children:[e.jsx(u,{value:"all",children:"Todos Clientes"}),c.map(s=>e.jsx(u,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mb-0.5",children:"Ordenar por"}),e.jsxs(T,{value:V,onValueChange:s=>es(s),children:[e.jsx(k,{className:"w-[140px] h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(A,{children:[e.jsx(u,{value:"deadline",children:"Sem ordenação"}),na.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1.5 shrink-0",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:[e.jsx("span",{className:"whitespace-nowrap",children:"Ocultar canc."}),e.jsx(Ie,{checked:de,onCheckedChange:rs,className:"scale-75"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-xs text-muted-foreground cursor-pointer select-none justify-end",children:[e.jsx("span",{className:"whitespace-nowrap",children:"Ocultar concl."}),e.jsx(Ie,{checked:se,onCheckedChange:as,className:"scale-75"})]})]})]})})]}),e.jsx(Nt,{open:ge,onOpenChange:ke,task:_e,onSave:nt,onDelete:s=>q(s),onCreateSubtask:y,onUpdateSubtask:Y,onDeleteSubtask:W}),e.jsx(As,{open:!!oe,onOpenChange:s=>!s&&q(null),children:e.jsxs(Ms,{children:[e.jsxs(Os,{children:[e.jsx(Ls,{children:"Remover tarefa?"}),e.jsx(Es,{children:"Esta ação não pode ser desfeita. A tarefa será removida permanentemente."})]}),e.jsxs(Ps,{children:[e.jsx(Is,{children:"Cancelar"}),e.jsx(Fs,{onClick:tt,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})}),j?X==="list"||X==="table"?e.jsx(Bt,{}):e.jsx(Rt,{}):X==="table"?e.jsx(_s,{data:le,columns:xt,onEdit:ls,onDelete:q,onBulkDelete:ht,onInlineChange:mt,emptyMessage:"Nenhuma tarefa encontrada."}):X==="list"?e.jsx("div",{className:"space-y-3",children:le.length===0?e.jsx(Fe,{children:e.jsx(Be,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})}):le.map(s=>e.jsx(us,{task:s,cardFields:Ne,today:t,isExpanded:Me.has(s.id),onToggleExpand:D,onToggleSubtask:G,onEdit:ls,onDelete:q,showStatus:!0,projectName:O.get(s.projectId||"")},s.id))}):e.jsxs(Ks,{sensors:lt,collisionDetection:zs,onDragStart:ot,onDragOver:it,onDragEnd:ct,onDragCancel:dt,children:[e.jsx("div",{className:"overflow-x-auto -mx-2 px-2 pb-4",children:e.jsx("div",{className:"flex gap-4",style:{minWidth:`${gs.length*280}px`},children:gs.map(s=>e.jsx("div",{className:"flex-1 min-w-[260px]",children:e.jsx(xa,{status:s,tasks:ut[s]||[],isOver:R===s&&Ce!==null,cardFields:Ne,today:t,expandedTasks:Me,onToggleExpand:D,onToggleSubtask:G,onEdit:ls,onDelete:q,projectMap:O,statusLabel:M[s]||s,borderColor:qe[s]||"border-t-muted/60",badgeColor:ie[s]||""})},s))})}),e.jsx(Hs,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:o?e.jsx("div",{className:"w-[260px]",children:e.jsx(us,{task:o,cardFields:Ne,today:t,isExpanded:!1,onToggleExpand:()=>{},onToggleSubtask:()=>{},onDelete:()=>{},isOverlay:!0,projectName:O.get(o.projectId||"")})}):null})]})]}),$e==="subtarefas"&&e.jsx(aa,{tasks:d?N.filter(s=>s.projectId===d):N,projects:B,loading:j,onCreateSubtask:y,onUpdateSubtask:Y,onDeleteSubtask:W})]})}const Ja=Object.freeze(Object.defineProperty({__proto__:null,default:ma},Symbol.toStringTag,{value:"Module"}));export{ma as A,st as L,Ja as a};
