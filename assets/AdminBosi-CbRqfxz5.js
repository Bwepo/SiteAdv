import{_ as ce,$ as de,ao as oe,r as u,j as e,e as c}from"./index-CvtXLE2l.js";import{A as me,L as $,F,B as m}from"./AdminLayout-Du5kWuLp.js";import{C as n,c as i,a as H,b as K}from"./card-C43EblsM.js";import{T as xe,a as he,b as S,c as E}from"./tabs-Cw62stbY.js";import{P as L}from"./progress-D5qa8pcg.js";import{T as q,E as J,a as Q,d as W,b as ue,c as pe}from"./crmTypes-C2SECzd8.js";import{S as je}from"./SyncToolbar-CRApxKXR.js";import{B as ge,a as U}from"./CrmSkeletons-aQSE1uIk.js";import{B as fe}from"./building-2-Dc3Fjnce.js";import{C}from"./calendar-DFEfCN2d.js";import{C as P}from"./clock-WFhT799C.js";import{T as V}from"./triangle-alert-D975Jw2M.js";import{C as Y}from"./circle-check-CAcV_faj.js";import{T as Ne}from"./trending-up-CCOtqJBC.js";import{C as be}from"./chart-column-6FodTRlA.js";import{M as ve}from"./map-pin-C9d-7gqR.js";import"./dialog-CbbtArvl.js";import"./index-X-zcB8cG.js";import"./button-D_nQ7M7x.js";import"./heart-DmLVesYO.js";import"./sparkles-DThwhFaW.js";import"./search-BZRF4ofu.js";import"./house-HGg2injS.js";import"./menu-HE_JYmhc.js";import"./users-C1MXXb0z.js";import"./file-text-C_e4ynBF.js";import"./index-yF-Z4Dc8.js";import"./index-DAAyuc6v.js";import"./skeleton-CKZoNmJB.js";const ye=["pendente","agendado","em_andamento","em_tramite"];function Ze(){const a=new Date,r=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,{events:p,loading:j,syncing:v,lastSync:x,sync:A}=ce(),{tasks:M,loading:X,syncing:Z,lastSync:y,sync:ee}=de(),{projects:B,loading:we}=oe(),se=()=>{A(),ee()},te=v||Z,ae=x&&y?x>y?y:x:x||y,re=j||X,h=u.useMemo(()=>p.filter(s=>{var t;return(t=s.client)==null?void 0:t.toLowerCase().includes("bosi")}).sort((s,t)=>s.date.localeCompare(t.date)),[p]),l=u.useMemo(()=>M.filter(s=>{var t;return(t=s.client)==null?void 0:t.toLowerCase().includes("bosi")}),[M]),_=u.useMemo(()=>{const s=new Set;return l.forEach(t=>{t.projectId&&s.add(t.projectId)}),h.forEach(t=>{t.projectId&&s.add(t.projectId)}),s},[l,h]),k=u.useMemo(()=>B.filter(s=>_.has(s.id)),[B,_]),N=u.useMemo(()=>h.filter(s=>s.date>=r&&s.status!=="cancelado"),[h,r]),w=u.useMemo(()=>h.filter(s=>s.date<r||s.status==="cancelado"),[h,r]),T=l.filter(s=>ye.includes(s.status)),d=l.filter(s=>s.dueDate&&s.dueDate<r&&s.status!=="concluida"&&s.status!=="cancelada"),g=l.filter(s=>s.status==="concluida"),D=u.useMemo(()=>l.flatMap(s=>s.subtasks),[l]),le=D.filter(s=>s.completed),I=D.length>0?Math.round(le.length/D.length*100):0,R=u.useMemo(()=>{const s={};return l.forEach(t=>{s[t.status]=(s[t.status]||0)+1}),s},[l]),ne=s=>{const t=new Date(s+"T12:00:00"),o=new Date;return o.setHours(12,0,0,0),Math.round((t.getTime()-o.getTime())/(1e3*60*60*24))};return e.jsxs(me,{title:"",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-xl bg-primary/10 border border-primary/20",children:e.jsx(fe,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold tracking-tight",children:"BOSI Empreendimentos"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Painel exclusivo do cliente"})]})]}),e.jsx(je,{syncing:te,lastSync:ae,onSync:se})]}),re?e.jsxs(e.Fragment,{children:[e.jsx(ge,{}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsx(U,{}),e.jsx(U,{})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6",children:[e.jsx(n,{className:"border-l-4 border-l-blue-500",children:e.jsx(i,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:N.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Compromissos"})]}),e.jsx(C,{className:"w-5 h-5 text-blue-500"})]})})}),e.jsx(n,{className:"border-l-4 border-l-amber-500",children:e.jsx(i,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:T.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Em andamento"})]}),e.jsx(P,{className:"w-5 h-5 text-amber-500"})]})})}),e.jsx(n,{className:c("border-l-4",d.length>0?"border-l-destructive":"border-l-muted"),children:e.jsx(i,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Atrasadas"})]}),e.jsx(V,{className:c("w-5 h-5",d.length>0?"text-destructive":"text-muted-foreground")})]})})}),e.jsx(n,{className:"border-l-4 border-l-green-500",children:e.jsx(i,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.length}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Concluídas"})]}),e.jsx(Y,{className:"w-5 h-5 text-green-500"})]})})}),e.jsx(n,{className:"border-l-4 border-l-primary",children:e.jsxs(i,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[I,"%"]}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"Progresso geral"})]}),e.jsx(Ne,{className:"w-5 h-5 text-primary"})]}),e.jsx(L,{value:I,className:"h-1.5 mt-2"})]})})]}),d.length>0&&e.jsxs("div",{className:"flex items-center gap-2 p-3 mb-6 rounded-lg bg-destructive/10 border border-destructive/20",children:[e.jsx(V,{className:"w-4 h-4 text-destructive shrink-0"}),e.jsxs("p",{className:"text-xs font-medium text-destructive",children:[d.length," tarefa",d.length>1?"s":""," atrasada",d.length>1?"s":"",":"," ",d.slice(0,3).map(s=>s.title).join(", "),d.length>3&&` e mais ${d.length-3}`]})]}),e.jsxs(xe,{defaultValue:"overview",className:"w-full",children:[e.jsxs(he,{className:"mb-4",children:[e.jsxs(S,{value:"overview",className:"gap-1.5",children:[e.jsx(be,{className:"w-3.5 h-3.5"}),"Visão Geral"]}),e.jsxs(S,{value:"tarefas",className:"gap-1.5",children:[e.jsx($,{className:"w-3.5 h-3.5"}),"Tarefas"]}),e.jsxs(S,{value:"agenda",className:"gap-1.5",children:[e.jsx(C,{className:"w-3.5 h-3.5"}),"Agenda"]}),e.jsxs(S,{value:"projetos",className:"gap-1.5",children:[e.jsx(F,{className:"w-3.5 h-3.5"}),"Projetos"]})]}),e.jsx(E,{value:"overview",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(H,{className:"pb-3",children:e.jsx(K,{className:"text-sm",children:"Distribuição de Tarefas"})}),e.jsxs(i,{className:"space-y-2.5",children:[Object.entries(R).map(([s,t])=>{const o=l.length>0?Math.round(t/l.length*100):0;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{variant:"secondary",className:c("text-[10px] w-24 justify-center",W[s]),children:q[s]}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:c("h-2 rounded-full transition-all",s==="concluida"?"bg-green-500":s==="cancelada"?"bg-muted-foreground/30":"bg-primary"),style:{width:`${o}%`}})})}),e.jsxs("span",{className:"text-xs text-muted-foreground w-12 text-right",children:[t," (",o,"%)"]})]},s)}),Object.keys(R).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Sem tarefas"})]})]}),e.jsxs(n,{children:[e.jsx(H,{className:"pb-3",children:e.jsx(K,{className:"text-sm",children:"Próximos Compromissos"})}),e.jsx(i,{children:N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:"Nenhum compromisso futuro"}):e.jsx("div",{className:"space-y-3",children:N.slice(0,6).map(s=>{const t=ne(s.date),o=t===0?"Hoje":t===1?"Amanhã":`Em ${t}d`;return e.jsxs("div",{className:"flex items-center gap-3 p-2.5 rounded-lg border border-border/60 hover:bg-muted/30 transition-colors",children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[40px] rounded bg-muted px-1.5 py-1",children:[e.jsx("span",{className:"text-[9px] uppercase text-muted-foreground leading-none",children:new Date(s.date+"T12:00:00").toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-base font-bold leading-tight",children:new Date(s.date+"T12:00:00").getDate()})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(m,{variant:"outline",className:c("text-[10px] px-1.5 py-0",J[s.type]),children:Q[s.type]}),s.time&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.time})]})]}),e.jsx("span",{className:c("text-[10px] font-medium shrink-0 px-2 py-0.5 rounded-full",t<=1?"bg-destructive/10 text-destructive":t<=3?"bg-amber-100 text-amber-700":"bg-muted text-muted-foreground"),children:o})]},s.id)})})})]})]})}),e.jsx(E,{value:"tarefas",children:e.jsxs("div",{className:"space-y-4",children:[T.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(P,{className:"w-3.5 h-3.5"})," Tarefas ativas (",T.length,")"]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:T.map(s=>e.jsx(z,{task:s,today:r},s.id))})]}),g.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Y,{className:"w-3.5 h-3.5"})," Concluídas (",g.length,")"]}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:g.slice(0,6).map(s=>e.jsx(z,{task:s,today:r},s.id))}),g.length>6&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center mt-3",children:["E mais ",g.length-6," tarefas concluídas"]})]}),l.length===0&&e.jsx(n,{children:e.jsx(i,{className:"p-8 text-center text-muted-foreground",children:"Nenhuma tarefa encontrada."})})]})}),e.jsx(E,{value:"agenda",children:e.jsxs("div",{className:"space-y-6",children:[N.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Próximos"}),e.jsx("div",{className:"space-y-2",children:N.map(s=>e.jsx(G,{event:s,today:r},s.id))})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Histórico"}),e.jsxs("div",{className:"space-y-2",children:[w.slice(0,10).map(s=>e.jsx(G,{event:s,today:r,muted:!0},s.id)),w.length>10&&e.jsxs("p",{className:"text-xs text-muted-foreground text-center py-2",children:["E mais ",w.length-10," eventos anteriores"]})]})]}),h.length===0&&e.jsx(n,{children:e.jsx(i,{className:"p-8 text-center text-muted-foreground",children:"Nenhum compromisso encontrado."})})]})}),e.jsx(E,{value:"projetos",children:k.length===0?e.jsx(n,{children:e.jsx(i,{className:"p-8 text-center text-muted-foreground",children:"Nenhum projeto vinculado."})}):e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:k.map(s=>{const t=l.filter(f=>f.projectId===s.id),o=t.filter(f=>f.status==="concluida").length,b=t.length,O=b>0?Math.round(o/b*100):0,ie=h.filter(f=>f.projectId===s.id&&f.date>=r).length;return e.jsx(n,{className:"hover:border-primary/30 transition-colors",children:e.jsxs(i,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{variant:"outline",className:"text-[10px]",children:s.status}),s.tipo&&e.jsx(m,{variant:"secondary",className:"text-[10px]",children:s.tipo})]})]}),e.jsx(F,{className:"w-4 h-4 text-muted-foreground shrink-0"})]}),b>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground mb-1",children:[e.jsxs("span",{children:[o,"/",b," tarefas"]}),e.jsxs("span",{children:[O,"%"]})]}),e.jsx(L,{value:O,className:"h-1.5"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),b," tarefas"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),ie," eventos"]})]}),s.observacoes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2 italic",children:s.observacoes})]})},s.id)})})})]})]})]})}function z({task:a,today:r}){const p=a.subtasks.filter(A=>A.completed).length,j=a.subtasks.length,v=j>0?Math.round(p/j*100):0,x=a.dueDate&&a.dueDate<r&&a.status!=="concluida"&&a.status!=="cancelada";return e.jsx(n,{className:c("transition-colors",x&&"border-destructive/50"),children:e.jsxs(i,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1.5 flex-wrap",children:[e.jsx(m,{variant:"secondary",className:c("text-[10px]",W[a.status]),children:q[a.status]}),e.jsx(m,{variant:"secondary",className:c("text-[10px]",ue[a.priority]),children:pe[a.priority]}),x&&e.jsx(m,{variant:"destructive",className:"text-[10px]",children:"Atrasada"})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),a.dueDate&&e.jsxs("p",{className:c("text-xs mt-1",x?"text-destructive font-medium":"text-muted-foreground"),children:[e.jsx(C,{className:"w-3 h-3 inline mr-1"}),new Date(a.dueDate+"T12:00:00").toLocaleDateString("pt-BR")]}),j>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] text-muted-foreground mb-1",children:[e.jsxs("span",{children:[p,"/",j," subtarefas"]}),e.jsxs("span",{children:[v,"%"]})]}),e.jsx(L,{value:v,className:"h-1.5"})]})]})})}function G({event:a,today:r,muted:p}){return e.jsxs("div",{className:c("flex items-center gap-3 p-3 rounded-lg border border-border/60 transition-colors",p?"opacity-60":"hover:bg-muted/30"),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[9px] uppercase text-muted-foreground leading-none",children:new Date(a.date+"T12:00:00").toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:new Date(a.date+"T12:00:00").getDate()}),e.jsx("span",{className:"text-[9px] capitalize text-muted-foreground leading-none",children:new Date(a.date+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:a.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(m,{variant:"outline",className:c("text-[10px] px-1.5 py-0",J[a.type]),children:Q[a.type]}),a.time&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx(P,{className:"w-3 h-3 inline mr-0.5"}),a.time]}),a.location&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[e.jsx(ve,{className:"w-3 h-3 inline mr-0.5"}),a.location]})]})]}),a.date===r&&e.jsx(m,{variant:"secondary",className:"text-[10px] shrink-0",children:"Hoje"})]})}export{Ze as default};
