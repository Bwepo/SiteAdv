import{u as a}from"./useQuery-CBRJvJIe.js";import{s,$ as i,r as c}from"./index-Ohf2YKo4.js";import{u}from"./useMutation-DRxeoGez.js";function _(e){return a({queryKey:["post-likes",e],queryFn:async()=>{const{count:t,error:r}=await s.from("mladv_post_likes").select("*",{count:"exact",head:!0}).eq("post_id",e);if(r)throw r;return t??0},enabled:!!e})}function p(e,t){return a({queryKey:["user-liked",e,t],queryFn:async()=>{const{data:r,error:n}=await s.from("mladv_post_likes").select("id").eq("post_id",e).eq("user_fingerprint",t).maybeSingle();if(n)throw n;return!!r},enabled:!!e&&!!t})}function w(){const e=i();return u({mutationFn:async({postId:t,fingerprint:r})=>{const{data:n}=await s.from("mladv_post_likes").select("id").eq("post_id",t).eq("user_fingerprint",r).maybeSingle();if(n){const{error:o}=await s.from("mladv_post_likes").delete().eq("id",n.id);if(o)throw o;return{liked:!1}}else{const{error:o}=await s.from("mladv_post_likes").insert({post_id:t,user_fingerprint:r});if(o)throw o;return{liked:!0}}},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-likes",r.postId]}),e.invalidateQueries({queryKey:["user-liked",r.postId,r.fingerprint]})}})}function v(e){return a({queryKey:["post-comments",e],queryFn:async()=>{const{data:t,error:r}=await s.from("mladv_public_comments").select("*").eq("post_id",e).eq("approved",!0).order("created_at",{ascending:!0});if(r)throw r;return t||[]},enabled:!!e})}function q(){return a({queryKey:["all-comments"],queryFn:async()=>{const{data:e,error:t}=await s.from("mladv_post_comments").select("*, mladv_posts(title, slug)").order("created_at",{ascending:!1});if(t)throw t;return e||[]}})}function g(){const e=i();return u({mutationFn:async t=>{const{data:r,error:n}=await s.from("mladv_post_comments").insert({...t,approved:!0}).select().single();if(n)throw n;return r},onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["post-comments",r.post_id]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function k(){const e=i();return u({mutationFn:async({commentId:t,userId:r})=>{const{error:n}=await s.from("mladv_post_comments").update({approved:!0,reviewed_at:new Date().toISOString(),reviewed_by:r||null}).eq("id",t);if(n)throw n},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function h(){const e=i();return u({mutationFn:async t=>{const{error:r}=await s.from("mladv_post_comments").delete().eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}function l(){const e=localStorage.getItem("mladv_fingerprint");if(e)return e;const t=`${Date.now()}-${Math.random().toString(36).substring(2,15)}`;return localStorage.setItem("mladv_fingerprint",t),t}function K(e){const t=c.useRef(!1);c.useEffect(()=>{if(!e||t.current)return;(async()=>{const n=l(),o=new Date().toISOString().split("T")[0];try{await s.from("mladv_post_views").insert({post_id:e,viewer_fingerprint:n,viewed_date:o,user_agent:navigator.userAgent.substring(0,255),referrer:document.referrer.substring(0,500)||null}),t.current=!0}catch{console.debug("View tracking skipped (likely duplicate)")}})()},[e])}function C(){return a({queryKey:["all-posts-view-counts"],queryFn:async()=>{const{data:e,error:t}=await s.from("mladv_post_views").select("post_id");if(t)throw t;const r={};return(e||[]).forEach(n=>{r[n.post_id]=(r[n.post_id]||0)+1}),r}})}function S(){return a({queryKey:["total-view-count"],queryFn:async()=>{const{count:e,error:t}=await s.from("mladv_post_views").select("*",{count:"exact",head:!0});if(t)throw t;return e??0}})}export{p as a,w as b,v as c,g as d,K as e,q as f,l as g,S as h,C as i,k as j,h as k,_ as u};
