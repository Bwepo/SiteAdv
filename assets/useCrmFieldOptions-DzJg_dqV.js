import{u as b}from"./useQuery-BoVNrBts.js";import{$ as E,s as i,h as a}from"./index-C0jHX-Go.js";import{u as d}from"./useMutation-CYTm8Y7o.js";const c="crm-field-options";function Q(){const l=E(),{data:u=[],isLoading:m}=b({queryKey:[c],queryFn:async()=>{const{data:e,error:r}=await i.from("mladv_crm_field_options").select("*").order("sort_order",{ascending:!0});if(r)throw r;return e},staleTime:1e3*60*5}),s=e=>u.filter(r=>r.field_name===e),f=e=>{const r=s(e);return Object.fromEntries(r.map(o=>[o.value,o.label]))},p=e=>{const r=s(e);return Object.fromEntries(r.map(o=>[o.value,o.color]))},_=e=>{const r=s(e);return Object.fromEntries(r.map(o=>{const t=o.color.match(/bg-(\w+)-\d+/),n=t?t[1]:"muted";return[o.value,`border-t-${n}-500/60`]}))},y=e=>s(e).map(r=>r.value),v=d({mutationFn:async e=>{const r=u.filter(n=>n.field_name===e.field_name),o=r.length>0?Math.max(...r.map(n=>n.sort_order)):0,{error:t}=await i.from("mladv_crm_field_options").insert({field_name:e.field_name,value:e.value,label:e.label,color:e.color,sort_order:o+1});if(t)throw t},onSuccess:()=>{l.invalidateQueries({queryKey:[c]}),a.success("Opção adicionada!")},onError:e=>a.error("Erro ao adicionar: "+e.message)}),O=d({mutationFn:async e=>{const{id:r,...o}=e,{error:t}=await i.from("mladv_crm_field_options").update(o).eq("id",r);if(t)throw t},onSuccess:()=>{l.invalidateQueries({queryKey:[c]}),a.success("Opção atualizada!")},onError:e=>a.error("Erro ao atualizar: "+e.message)}),g=d({mutationFn:async e=>{const{error:r}=await i.from("mladv_crm_field_options").delete().eq("id",e);if(r)throw r},onSuccess:()=>{l.invalidateQueries({queryKey:[c]}),a.success("Opção removida!")},onError:e=>a.error("Erro ao remover: "+e.message)});return{allOptions:u,isLoading:m,getOptions:s,getLabelsMap:f,getColorsMap:p,getBorderColorsMap:_,getOrderedValues:y,addOption:v,updateOption:O,deleteOption:g}}export{Q as u};
