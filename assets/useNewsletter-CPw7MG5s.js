import{u as l,a as o}from"./skeleton-CXGjvzQ4.js";import{ae as m,ad as a}from"./index-GmPaaKoG.js";function f(){return o({mutationFn:async e=>{const{data:t,error:s}=await a.from("mladv_newsletter_subscribers").insert({email:e.email,name:e.name||null,source:e.source||"website"}).select().single();if(s)throw s;return t}})}function y(){return l({queryKey:["newsletter-subscribers"],queryFn:async()=>{const{data:e,error:t}=await a.from("mladv_newsletter_subscribers").select("*").order("subscribed_at",{ascending:!1});if(t)throw t;return e||[]}})}function _(){return l({queryKey:["newsletter-stats"],queryFn:async()=>{const{data:e,error:t,count:s}=await a.from("mladv_newsletter_subscribers").select("*",{count:"exact"}).is("unsubscribed_at",null);if(t)throw t;const r=new Date;r.setDate(r.getDate()-7);const i=(e||[]).filter(u=>new Date(u.subscribed_at)>=r).length;return{total:s||0,active:s||0,newThisWeek:i}}})}function p(){const e=m();return o({mutationFn:async t=>{const{error:s}=await a.from("mladv_newsletter_subscribers").delete().eq("id",t);if(s)throw s},onSuccess:()=>{e.invalidateQueries({queryKey:["newsletter-subscribers"]}),e.invalidateQueries({queryKey:["newsletter-stats"]})}})}function v(){return o({mutationFn:async()=>{const{data:e,error:t}=await a.from("mladv_newsletter_subscribers").select("email, name, subscribed_at").is("unsubscribed_at",null).order("subscribed_at",{ascending:!1});if(t)throw t;const s=["Email","Nome","Data de Inscrição"],r=(e||[]).map(n=>[n.email,n.name||"",new Date(n.subscribed_at).toLocaleDateString("pt-BR")]),i=[s.join(","),...r.map(n=>n.map(b=>`"${b}"`).join(","))].join(`
`),u=new Blob([i],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");return c.href=URL.createObjectURL(u),c.download=`newsletter-subscribers-${new Date().toISOString().split("T")[0]}.csv`,c.click(),i}})}export{y as a,_ as b,p as c,v as d,f as u};
