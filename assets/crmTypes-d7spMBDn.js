import{r as a,s as k}from"./index-RmZ73Lgq.js";const m=i=>k.from(i),v={pendente:"Pendente",agendado:"Agendado",confirmado:"Confirmado",cancelado:"Cancelado",reagendado:"Reagendado",em_andamento:"Em andamento",em_tramite:"Em trâmite",concluida:"Concluído",cancelada:"Cancelado"};function T(i,s,g){const l="https://xlumfscnfnqldlvpbpil.supabase.co",b="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsdW1mc2NuZm5xbGRsdnBicGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MDExMDAsImV4cCI6MjA4NDk3NzEwMH0.eW891SpqT0n-zoFJCmZn2CJqKnIgFHmkXqGyoplm_N0";return fetch(`${l}/functions/v1/airtable-crud?table=${encodeURIComponent(i)}&action=${s}`,{method:"POST",headers:{"Content-Type":"application/json",apikey:b,Authorization:`Bearer ${b}`},body:JSON.stringify(g||{})})}async function A(i){const s="https://xlumfscnfnqldlvpbpil.supabase.co",g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhsdW1mc2NuZm5xbGRsdnBicGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MDExMDAsImV4cCI6MjA4NDk3NzEwMH0.eW891SpqT0n-zoFJCmZn2CJqKnIgFHmkXqGyoplm_N0",l=await fetch(`${s}/functions/v1/airtable-sync`,{method:"POST",headers:{"Content-Type":"application/json",apikey:g,Authorization:`Bearer ${g}`},body:JSON.stringify(i?{tables:i}:{})});if(!l.ok)throw new Error(await l.text());return l.json()}function L(){const[i,s]=a.useState([]),[g,l]=a.useState(!0),[b,p]=a.useState(!1),[E,d]=a.useState(null),[w,_]=a.useState(null),r=a.useCallback(async()=>{try{const{data:e,error:t}=await m("mladv_crm_agenda").select("*").order("data_local",{ascending:!1});if(t)throw t;if(!e||e.length===0){s([]),l(!1);return}const o=e.map(n=>({id:n.airtable_id,title:n.titulo||"",date:n.data_local||"",time:n.hora_local||void 0,type:n.tipo||"reuniao",status:n.status||"pendente",client:n.cliente||void 0,location:n.local_evento||void 0,description:n.descricao||void 0,airtableId:n.airtable_id}));s(o);const{data:u}=await m("mladv_crm_sync_status").select("completed_at").eq("tabela","Agenda").single();u!=null&&u.completed_at&&_(new Date(u.completed_at))}catch(e){console.error("Load agenda error:",e),d(e instanceof Error?e.message:"Erro ao carregar agenda")}finally{l(!1)}},[]),C=a.useCallback(async()=>{p(!0),d(null);try{await A(["Agenda"]),await r(),_(new Date)}catch(e){console.error("Sync agenda error:",e),d(e instanceof Error?e.message:"Erro ao sincronizar agenda")}finally{p(!1)}},[r]),c=a.useCallback(async(e,t)=>{const o=v[t]||t;await T("Agenda","update",{id:e,fields:{Status:o}}),await m("mladv_crm_agenda").update({status:t}).eq("airtable_id",e),s(u=>u.map(n=>n.id===e?{...n,status:t}:n))},[]),S=a.useCallback(async e=>{await T("Agenda","delete",{ids:[e]}),await m("mladv_crm_agenda").delete().eq("airtable_id",e),s(t=>t.filter(o=>o.id!==e))},[]);return a.useEffect(()=>{r()},[r]),{events:i,loading:g,syncing:b,error:E,lastSync:w,sync:C,updateEventStatus:c,deleteEvent:S}}function J(){const[i,s]=a.useState([]),[g,l]=a.useState(!0),[b,p]=a.useState(!1),[E,d]=a.useState(null),[w,_]=a.useState(null),r=a.useCallback(async()=>{try{const[{data:e,error:t},{data:o,error:u}]=await Promise.all([m("mladv_crm_tarefas").select("*"),m("mladv_crm_subtarefas").select("*")]);if(t)throw t;if(u)throw u;if(!e||e.length===0){s([]),l(!1);return}const n=e.map(f=>{const h=(o||[]).filter(y=>y.tarefa_airtable_id===f.airtable_id).map(y=>({id:y.airtable_id,title:y.titulo||"",completed:y.status==="Concluído",dueDate:y.deadline||void 0,assignee:y.responsavel||void 0}));return{id:f.airtable_id,title:f.titulo||"",description:f.descricao||void 0,status:f.status||"pendente",priority:f.prioridade||"media",dueDate:f.deadline||void 0,client:f.cliente||void 0,assignee:f.responsavel||void 0,subtasks:h,createdAt:"",updatedAt:"",airtableId:f.airtable_id}});s(n);const{data:I}=await m("mladv_crm_sync_status").select("completed_at").eq("tabela","Tarefas").single();I!=null&&I.completed_at&&_(new Date(I.completed_at))}catch(e){console.error("Load tarefas error:",e),d(e instanceof Error?e.message:"Erro ao carregar tarefas")}finally{l(!1)}},[]),C=a.useCallback(async()=>{p(!0),d(null);try{await A(["Tarefas","Sub-tarefas"]),await r(),_(new Date)}catch(e){console.error("Sync tarefas error:",e),d(e instanceof Error?e.message:"Erro ao sincronizar tarefas")}finally{p(!1)}},[r]),c=a.useCallback(async(e,t)=>{const o=v[t]||t;await T("Tarefas","update",{id:e,fields:{Status:o}}),await m("mladv_crm_tarefas").update({status:t}).eq("airtable_id",e),s(u=>u.map(n=>n.id===e?{...n,status:t}:n))},[]),S=a.useCallback(async e=>{await T("Tarefas","delete",{ids:[e]}),await m("mladv_crm_tarefas").delete().eq("airtable_id",e),s(t=>t.filter(o=>o.id!==e))},[]);return a.useEffect(()=>{r()},[r]),{tasks:i,setTasks:s,loading:g,syncing:b,error:E,lastSync:w,sync:C,updateTaskStatus:c,deleteTask:S}}function O(){const[i,s]=a.useState([]),[g,l]=a.useState(!0),[b,p]=a.useState(!1),[E,d]=a.useState(null),[w,_]=a.useState(null),r=a.useCallback(async()=>{try{const{data:c,error:S}=await m("mladv_crm_clientes").select("*").order("nome",{ascending:!0});if(S)throw S;const e=(c||[]).map(o=>({id:o.airtable_id,name:o.nome||"",slug:o.slug||""}));s(e);const{data:t}=await m("mladv_crm_sync_status").select("completed_at").eq("tabela","Clientes").single();t!=null&&t.completed_at&&_(new Date(t.completed_at))}catch(c){console.error("Load clientes error:",c),d(c instanceof Error?c.message:"Erro ao carregar clientes")}finally{l(!1)}},[]),C=a.useCallback(async()=>{p(!0),d(null);try{await A(["Clientes"]),await r(),_(new Date)}catch(c){console.error("Sync clientes error:",c),d(c instanceof Error?c.message:"Erro ao sincronizar clientes")}finally{p(!1)}},[r]);return a.useEffect(()=>{r()},[r]),{clients:i,loading:g,syncing:b,error:E,lastSync:w,sync:C}}const z={reuniao:"Reunião",audiencia:"Audiência",prazo:"Prazo",consulta:"Consulta",lembrete:"Lembrete",outro:"Outro"},R={confirmado:"Confirmado",pendente:"Pendente",cancelado:"Cancelado",reagendado:"Reagendado"},N={pendente:"Pendente",agendado:"Agendado",em_andamento:"Em Andamento",em_tramite:"Em Trâmite",concluida:"Concluída",cancelada:"Cancelada"},q={alta:"Alta",media:"Média",baixa:"Baixa"},B={reuniao:"bg-blue-100 text-blue-800",audiencia:"bg-purple-100 text-purple-800",prazo:"bg-red-100 text-red-800",consulta:"bg-green-100 text-green-800",lembrete:"bg-yellow-100 text-yellow-800",outro:"bg-gray-100 text-gray-800"},D={alta:"bg-red-100 text-red-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-green-100 text-green-800"},M={pendente:"bg-red-100 text-red-800",agendado:"bg-slate-100 text-slate-800",em_andamento:"bg-yellow-100 text-yellow-800",em_tramite:"bg-blue-100 text-blue-800",concluida:"bg-green-100 text-green-800",cancelada:"bg-gray-100 text-gray-800"};export{B as E,D as T,J as a,O as b,z as c,q as d,R as e,N as f,M as g,L as u};
