import{r as o,E as H,j as e}from"./index-DSNCnzxG.js";import{A as I}from"./AdminLayout-D_6SQZ1P.js";import{B as j}from"./button-BV8oDHkU.js";import{C as p,a as f,b as N,c as g}from"./card-DYhet0N1.js";import{T as R,a as k,b as c,c as l,d as B,e as d}from"./table-DAXuN_ug.js";import{S as i}from"./skeleton-C7fv5okd.js";import{e as M,f as P,g as _}from"./useNewsletter-BMHOwDWT.js";import"./ThemeToggle-BikNU-gF.js";import"./chevron-left-Ed9zSz1G.js";const v={draft:"Rascunho",queued:"Fila",sending:"Enviando",sent:"Enviada",partial:"Parcial",failed:"Falhou"},q={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},b=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",U=()=>{const{data:t,isLoading:C}=M(),[w,S]=o.useState(null),[x,m]=o.useState(null),{toast:u}=H(),y=P(),{data:r,isLoading:T}=_(w),a=(r==null?void 0:r.campaign)??null,h=r==null?void 0:r.deliveryCounts,E=o.useMemo(()=>((t==null?void 0:t.length)??0)>0,[t]),L=s=>["queued","partial"].includes(s),A=async s=>{m(s);try{await y.mutateAsync(s),u({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(n){u({title:"Erro ao enviar",description:(n==null?void 0:n.message)||"Não foi possível iniciar o envio.",variant:"destructive"})}finally{m(null)}};return e.jsxs(I,{title:"Campanhas de Newsletter",children:[e.jsxs(p,{className:"mb-6",children:[e.jsx(f,{children:e.jsx(N,{children:"Campanhas"})}),e.jsx(g,{children:C?e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"h-8 w-full"}),e.jsx(i,{className:"h-8 w-full"}),e.jsx(i,{className:"h-8 w-full"})]}):e.jsxs(R,{children:[e.jsx(k,{children:e.jsxs(c,{children:[e.jsx(l,{children:"Assunto"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Post"}),e.jsx(l,{children:"Criado em"}),e.jsx(l,{children:"Enviado em"}),e.jsx(l,{className:"text-right",children:"Ações"})]})}),e.jsx(B,{children:E?t==null?void 0:t.map(s=>e.jsxs(c,{children:[e.jsx(d,{className:"font-medium",children:s.subject}),e.jsx(d,{children:v[s.status]??s.status}),e.jsx(d,{children:s.post?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.post.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["/blog/",s.post.slug]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})}),e.jsx(d,{children:b(s.created_at)}),e.jsx(d,{children:b(s.sent_at)}),e.jsx(d,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[L(s.status)&&e.jsx(j,{variant:"default",size:"sm",onClick:()=>A(s.id),disabled:x===s.id,children:x===s.id?"Enviando...":"Enviar agora"}),e.jsx(j,{variant:"outline",size:"sm",onClick:()=>S(s.id),children:"Ver detalhes"})]})})]},s.id)):e.jsx(c,{children:e.jsx(d,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhuma campanha cadastrada."})})})]})})]}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsx(N,{children:"Detalhes da campanha"})}),e.jsx(g,{children:T?e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"h-6 w-1/2"}),e.jsx(i,{className:"h-24 w-full"})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assunto"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:v[a.status]??a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Post relacionado"}),a.post?e.jsxs("div",{className:"text-base font-medium text-foreground",children:[a.post.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["/blog/",a.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resumo de envios"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mt-2",children:Object.entries(q).map(([s,n])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:n}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:h?h[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview HTML"}),e.jsx("div",{className:"mt-2 max-h-[320px] overflow-auto rounded-lg border border-border bg-background p-4",children:a.html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:a.html}}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem conteúdo HTML."})})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma campanha para ver os detalhes."})})]})]})};export{U as default};
