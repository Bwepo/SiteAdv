import{n as y,r,j as e,s as d}from"./index-C5rdV3ki.js";import{B as P}from"./button-V3BEsbEG.js";import{C as A,a as F,b as q,d as z,c as E}from"./card-DeLiqJaA.js";import{I as l}from"./input-B61CGZ39.js";import{L as c}from"./label-CNpBZ07K.js";import{S as I}from"./shield-check-BAfTi4S4.js";import{T}from"./triangle-alert-Bu_CNG_I.js";import{C as L}from"./circle-check-CKqBdMRZ.js";const R=[{label:"Pelo menos 8 caracteres",test:a=>a.length>=8},{label:"Uma letra maiúscula",test:a=>/[A-Z]/.test(a)},{label:"Um número",test:a=>/\d/.test(a)},{label:"Um caractere especial",test:a=>/[^A-Za-z0-9]/.test(a)}],W=()=>{const{toast:a}=y(),[n,m]=r.useState(""),[t,u]=r.useState(""),[i,p]=r.useState(""),[h,o]=r.useState(!1),x=r.useMemo(()=>R.map(s=>({...s,valid:s.test(t)})),[t]),j=x.every(s=>s.valid),f=n.trim().length>0&&t.trim().length>0&&i.trim().length>0&&t===i&&j,C=async s=>{var w,g;if(s.preventDefault(),!f){a({title:"Revise os dados",description:"Preencha todos os campos e atenda aos requisitos da senha.",variant:"destructive"});return}o(!0);const{data:v,error:b}=await d.auth.getSession();if(b||!((g=(w=v.session)==null?void 0:w.user)!=null&&g.email)){a({title:"Sessão inválida",description:"Faça login novamente para alterar sua senha.",variant:"destructive"}),o(!1);return}const{error:N}=await d.auth.signInWithPassword({email:v.session.user.email,password:n});if(N){a({title:"Senha atual incorreta",description:"Confira sua senha atual e tente novamente.",variant:"destructive"}),o(!1);return}const{error:S}=await d.auth.updateUser({password:t});S?a({title:"Não foi possível atualizar",description:"Tente novamente em instantes.",variant:"destructive"}):(a({title:"Senha atualizada",description:"Sua senha foi alterada com sucesso."}),m(""),u(""),p("")),o(!1)};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"max-w-2xl",children:e.jsxs(A,{children:[e.jsxs(F,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-primary"}),"Alterar senha"]}),e.jsx(z,{children:"Atualize sua senha seguindo as regras de segurança abaixo."})]}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"current-password",children:"Senha atual"}),e.jsx(l,{id:"current-password",type:"password",autoComplete:"current-password",value:n,onChange:s=>m(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"new-password",children:"Nova senha"}),e.jsx(l,{id:"new-password",type:"password",autoComplete:"new-password",value:t,onChange:s=>u(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"confirm-password",children:"Confirmar nova senha"}),e.jsx(l,{id:"confirm-password",type:"password",autoComplete:"new-password",value:i,onChange:s=>p(s.target.value),required:!0})]}),e.jsx(P,{type:"submit",disabled:!f||h,children:h?"Salvando...":"Atualizar senha"})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-muted/40 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-foreground",children:[e.jsx(T,{className:"w-4 h-4 text-muted-foreground"}),"Requisitos da senha"]}),e.jsx("ul",{className:"mt-3 space-y-2 text-sm text-muted-foreground",children:x.map(s=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(L,{className:`h-4 w-4 ${s.valid?"text-emerald-500":"text-muted-foreground/60"}`}),e.jsx("span",{className:s.valid?"text-foreground":void 0,children:s.label})]},s.label))})]})]})]})})})};export{W as default};
