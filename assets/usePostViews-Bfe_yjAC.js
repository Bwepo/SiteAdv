import{a}from"./useMutation-COuFGjyM.js";import{r as o,E as n}from"./index-BdXZqJOp.js";import{g as u}from"./usePostInteractions-D7DQP-UE.js";function w(r){const e=o.useRef(!1);o.useEffect(()=>{if(!r||e.current)return;(async()=>{const s=u(),i=new Date().toISOString().split("T")[0];try{await n.from("mladv_post_views").insert({post_id:r,viewer_fingerprint:s,viewed_date:i,user_agent:navigator.userAgent.substring(0,255),referrer:document.referrer.substring(0,500)||null}),e.current=!0}catch{console.debug("View tracking skipped (likely duplicate)")}})()},[r])}function d(){return a({queryKey:["all-posts-view-counts"],queryFn:async()=>{const{data:r,error:e}=await n.from("mladv_post_views").select("post_id");if(e)throw e;const t={};return(r||[]).forEach(s=>{t[s.post_id]=(t[s.post_id]||0)+1}),t}})}function g(){return a({queryKey:["total-view-count"],queryFn:async()=>{const{count:r,error:e}=await n.from("mladv_post_views").select("*",{count:"exact",head:!0});if(e)throw e;return r??0}})}export{g as a,d as b,w as u};
