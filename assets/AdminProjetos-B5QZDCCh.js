import{c as X,r as n,s as _,j as e,m as E,e as m,at as Ge,a7 as $e,a6 as Ve,Y as qe,l as P,X as Ke}from"./index-C5rdV3ki.js";import{B as U}from"./badge-BMLAq-mz.js";import{P as J}from"./progress--NvF4Yt5.js";import{S as Je}from"./skeleton-v7DQooK3.js";import{B as L}from"./button-V3BEsbEG.js";import{S as de,g as me,h as ue,i as pe,j as F}from"./form-DG7uB_oU.js";import{D as Xe,a as Ye,c as We,d as Qe,f as Ze}from"./dialog-CjGIzY2y.js";import{A as es,a as ss,b as as,c as ts,d as rs,e as os,f as ns,g as is}from"./alert-dialog-fZtWGPG7.js";import{I as ke}from"./input-B61CGZ39.js";import{L as B}from"./label-CNpBZ07K.js";import{C as z,c as H,a as $,b as V}from"./card-DeLiqJaA.js";import{d as ls,b as cs}from"./crmTypes-CSOUCF6B.js";import{T as ds}from"./trending-up-D0vbEAIP.js";import{C as ms}from"./clock-DLn3XL0K.js";import{T as us}from"./triangle-alert-Bu_CNG_I.js";import{L as he}from"./list-todo-DkkhuRZV.js";import{L as Pe,A as Se,C as ps}from"./AdminTarefas-BdOB7K6U.js";import{S as xs}from"./SyncToolbar-BYT4VdAg.js";import gs from"./AdminAgenda-B52c30Py.js";import{P as hs}from"./plus-B1CoPVXr.js";import{F as Te}from"./folder-kanban-BnnlfNqM.js";import{L as fs}from"./list-C853bYST.js";import{C as bs}from"./chevron-left-DDrp74a_.js";import{U as De}from"./upload-BiTAQqMQ.js";import{L as xe}from"./loader-circle-DjI6FToJ.js";import{C as fe}from"./calendar-C3sKBTp-.js";import{C as js}from"./chart-column-CVX6aBTV.js";import"./index-FK3-Dmxm.js";import"./index-YIY_kSu2.js";import"./index-BT9qmzog.js";import"./chevron-up-CgXdGGql.js";import"./check-CsZJdN-T.js";import"./index-DhX7exH0.js";import"./TarefaSheet-BCZRfnm0.js";import"./sheet-Bq_BPsEQ.js";import"./textarea-M7ib3y3c.js";import"./separator-BjXnq03W.js";import"./chevron-right-B3DLkH4w.js";import"./circle-check-CKqBdMRZ.js";import"./circle-IV1wPkpR.js";import"./trash-2-H5_0A3gc.js";import"./types-C9wiu8_K.js";import"./SubtarefasTab-ChMbAwZR.js";import"./popover-ocv8R353.js";import"./search-Ca7hmoNW.js";import"./checkbox-6SnAOQFb.js";import"./users-CkoqQKX3.js";import"./CrmSkeletons-BUdVWqbk.js";import"./refresh-cw-BjslH46I.js";import"./AgendaEventSheet-CCiNOAbT.js";import"./map-pin-BHx3vCaD.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=X("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=X("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=X("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=X("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),ge="mladv-project-covers",Ae=800,_e=600,Ns=.8,ws=5*1024*1024;async function Cs(c){return new Promise((C,D)=>{const i=new Image,y=URL.createObjectURL(c);i.onload=()=>{URL.revokeObjectURL(y);let{width:h,height:o}=i;if(h>Ae||o>_e){const u=Math.min(Ae/h,_e/o);h=Math.round(h*u),o=Math.round(o*u)}const p=document.createElement("canvas");p.width=h,p.height=o;const S=p.getContext("2d");if(!S){D(new Error("Canvas não suportado"));return}S.drawImage(i,0,0,h,o),p.toBlob(u=>{if(!u){D(new Error("Falha ao comprimir imagem"));return}C(u)},"image/jpeg",Ns)},i.onerror=()=>{URL.revokeObjectURL(y),D(new Error("Falha ao carregar imagem para compressão"))},i.src=y})}async function ks(c){try{return{blob:await Cs(c),contentType:"image/jpeg"}}catch(C){return console.warn("[CoverUpload] Compressão falhou, enviando original:",C),{blob:c,contentType:c.type}}}function Ss(){const[c,C]=n.useState(!1),[D,i]=n.useState(0);return{uploadCover:async(o,p)=>{C(!0),i(0);try{if(!["image/jpeg","image/png","image/webp","image/gif"].includes(p.type))throw new Error("Tipo não permitido. Use JPEG, PNG, WebP ou GIF.");if(p.size>ws)throw new Error("Arquivo muito grande. Máximo de 5MB.");i(10);const{blob:u,contentType:a}=await ks(p);i(40);const r=a==="image/jpeg"?"jpg":p.name.split(".").pop()||"jpg",j=`covers/${`${o}-${Date.now()}.${r}`}`,{error:N}=await _.storage.from(ge).upload(j,u,{contentType:a,cacheControl:"3600",upsert:!1});if(N)throw new Error(N.message);i(70);const{data:k}=_.storage.from(ge).getPublicUrl(j),{data:d}=await _.from("mladv_crm_projetos").select("raw_fields").eq("airtable_id",o).single(),I=(d==null?void 0:d.raw_fields)||{},{error:T}=await _.from("mladv_crm_projetos").update({raw_fields:{...I,cover_url:k.publicUrl}}).eq("airtable_id",o);if(T)throw new Error(T.message);return i(100),{url:k.publicUrl,path:j}}finally{C(!1)}},removeCover:async(o,p)=>{try{const a=p.match(/\/object\/public\/mladv-project-covers\/(.+)$/);a&&await _.storage.from(ge).remove([a[1]])}catch{}const{data:S}=await _.from("mladv_crm_projetos").select("raw_fields").eq("airtable_id",o).single(),u=(S==null?void 0:S.raw_fields)||{};delete u.cover_url,await _.from("mladv_crm_projetos").update({raw_fields:u}).eq("airtable_id",o)},isUploading:c,progress:D}}const Ts={pendente:"bg-yellow-500/20 text-yellow-400",agendado:"bg-slate-500/20 text-slate-400",em_andamento:"bg-blue-500/20 text-blue-400",em_tramite:"bg-blue-500/20 text-blue-400",concluida:"bg-green-500/20 text-green-400",cancelada:"bg-red-500/20 text-red-400","A fazer":"bg-yellow-500/20 text-yellow-400","Em andamento":"bg-blue-500/20 text-blue-400",Concluído:"bg-green-500/20 text-green-400"};function Ds({projectId:c,tasks:C,events:D}){const i=n.useMemo(()=>C.filter(a=>a.projectId===c),[C,c]),y=n.useMemo(()=>i.flatMap(a=>a.subtasks),[i]),h=n.useMemo(()=>D.filter(a=>a.projectId===c),[D,c]),o=n.useMemo(()=>{const a=i.length,r=i.filter(f=>f.status==="concluida").length,x=i.filter(f=>f.status==="em_andamento").length,j=i.filter(f=>f.status==="pendente").length,N=i.filter(f=>!f.dueDate||f.status==="concluida"||f.status==="cancelada"?!1:new Date(f.dueDate)<new Date).length,k=a>0?Math.round(r/a*100):0,d=y.length,I=y.filter(f=>f.status==="Concluído").length,T=d>0?Math.round(I/d*100):0;return{totalTarefas:a,concluidas:r,emAndamento:x,pendentes:j,atrasadas:N,progress:k,totalSub:d,subConcluidas:I,subProgress:T}},[i,y]),p=n.useMemo(()=>{const a=[];return i.forEach(r=>a.push({id:r.id,type:"tarefa",title:r.title,status:r.status,date:r.updatedAt||r.createdAt,priority:r.priority})),y.forEach(r=>a.push({id:r.id,type:"subtarefa",title:r.title,status:r.status,date:r.dueDate||""})),h.forEach(r=>a.push({id:r.id,type:"evento",title:r.title,status:r.status,date:r.date})),a.sort((r,x)=>new Date(x.date).getTime()-new Date(r.date).getTime()).slice(0,10)},[i,y,h]),S=n.useMemo(()=>{const a=new Date;a.setHours(0,0,0,0);const r=[];for(let x=0;x<14;x++){const j=new Date(a);j.setDate(j.getDate()+x);const N=j.toISOString().split("T")[0],k=[];h.forEach(d=>{d.date===N&&k.push({title:d.title,type:"evento"})}),i.forEach(d=>{d.dueDate===N&&k.push({title:d.title,type:"tarefa"})}),y.forEach(d=>{d.dueDate===N&&k.push({title:d.title,type:"subtarefa"})}),r.push({date:j,label:j.toLocaleDateString("pt-BR",{weekday:"short",day:"numeric"}),isToday:x===0,events:k})}return r},[h,i,y]),u=[{title:"PROGRESSO GERAL",value:`${o.progress}%`,subtitle:`${o.concluidas}/${o.totalTarefas} tarefas`,icon:ds,color:"text-green-400",bgColor:"bg-green-500/10"},{title:"EM ANDAMENTO",value:o.emAndamento,subtitle:"tarefas ativas",icon:Ee,color:"text-blue-400",bgColor:"bg-blue-500/10"},{title:"PENDENTES",value:o.pendentes,subtitle:"aguardando início",icon:ms,color:"text-yellow-400",bgColor:"bg-yellow-500/10"},{title:"ATRASADAS",value:o.atrasadas,subtitle:"precisam de atenção",icon:us,color:o.atrasadas>0?"text-red-400":"text-muted-foreground",bgColor:o.atrasadas>0?"bg-red-500/10":"bg-muted/30"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:u.map((a,r)=>{const x=a.icon;return e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:r*.05},children:e.jsx(z,{className:"border-border/50 bg-card/80 backdrop-blur-sm",children:e.jsx(H,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-[11px] font-medium text-muted-foreground uppercase tracking-wider",children:a.title}),e.jsx("p",{className:m("text-2xl font-bold",a.color),children:a.value}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:a.subtitle})]}),e.jsx("div",{className:m("rounded-lg p-2",a.bgColor),children:e.jsx(x,{className:m("h-4 w-4",a.color)})})]})})})},a.title)})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},children:e.jsxs(z,{className:"border-border/50 bg-card/80 backdrop-blur-sm",children:[e.jsx($,{className:"pb-3 pt-4 px-4",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4 text-primary"}),"Tarefas"]})}),e.jsxs(H,{className:"px-4 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[o.concluidas," concluídas"]}),e.jsxs("span",{className:"font-semibold text-foreground",children:[o.progress,"%"]})]}),e.jsx(J,{value:o.progress,className:"h-2"}),e.jsxs("div",{className:"flex gap-3 text-[10px] text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-green-400"}),o.concluidas," concluídas"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"}),o.emAndamento," andamento"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"h-1.5 w-1.5 rounded-full bg-yellow-400"}),o.pendentes," pendentes"]})]})]})]})}),e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.25},children:e.jsxs(z,{className:"border-border/50 bg-card/80 backdrop-blur-sm",children:[e.jsx($,{className:"pb-3 pt-4 px-4",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-primary"}),"Subtarefas"]})}),e.jsxs(H,{className:"px-4 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:[o.subConcluidas," concluídas"]}),e.jsxs("span",{className:"font-semibold text-foreground",children:[o.subProgress,"%"]})]}),e.jsx(J,{value:o.subProgress,className:"h-2"}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:[o.subConcluidas,"/",o.totalSub," subtarefas finalizadas"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-3",children:[e.jsx(E.div,{className:"lg:col-span-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},children:e.jsxs(z,{className:"border-border/50 bg-card/80 backdrop-blur-sm h-full",children:[e.jsx($,{className:"pb-3 pt-4 px-4",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),"Atividades Recentes"]})}),e.jsx(H,{className:"px-4 pb-4",children:p.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:"Nenhuma atividade ainda."}):e.jsx("div",{className:"space-y-0",children:p.map((a,r)=>e.jsxs("div",{className:"flex items-start gap-3 py-2.5 border-b border-border/30 last:border-0",children:[e.jsxs("div",{className:"mt-1.5 flex flex-col items-center",children:[e.jsx("div",{className:m("h-2 w-2 rounded-full shrink-0",a.type==="evento"?"bg-purple-400":a.type==="subtarefa"?"bg-cyan-400":"bg-primary")}),r<p.length-1&&e.jsx("div",{className:"w-px h-full bg-border/40 mt-1"})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-foreground truncate",children:a.title}),e.jsx(U,{variant:"outline",className:m("text-[8px] px-1 py-0 shrink-0",Ts[a.status]||"bg-secondary text-secondary-foreground"),children:a.status})]}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-muted-foreground",children:[e.jsx("span",{className:"capitalize",children:a.type==="tarefa"?"Tarefa":a.type==="subtarefa"?"Subtarefa":"Evento"}),a.priority&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{className:ls[a.priority]||"",children:cs[a.priority]||a.priority})]}),a.date&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(a.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})})]})]})]})]},a.id))})})]})}),e.jsx(E.div,{className:"lg:col-span-2",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.35},children:e.jsxs(z,{className:"border-border/50 bg-card/80 backdrop-blur-sm h-full",children:[e.jsx($,{className:"pb-3 pt-4 px-4",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(vs,{className:"h-4 w-4 text-primary"}),"Próximos 14 dias"]})}),e.jsx(H,{className:"px-4 pb-4",children:e.jsx("div",{className:"space-y-0.5",children:S.map(a=>{const r=a.events.length>0;return e.jsxs("div",{className:m("flex items-start gap-3 py-1.5 px-2 rounded-md transition-colors",a.isToday&&"bg-primary/5 border border-primary/20",r&&!a.isToday&&"bg-muted/20"),children:[e.jsx("span",{className:m("text-[11px] w-16 shrink-0 capitalize",a.isToday?"font-bold text-primary":r?"font-medium text-foreground":"text-muted-foreground"),children:a.isToday?"Hoje":a.label}),e.jsx("div",{className:"flex-1 min-w-0",children:r?e.jsx("div",{className:"space-y-0.5",children:a.events.map((x,j)=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:m("h-1.5 w-1.5 rounded-full shrink-0",x.type==="evento"?"bg-purple-400":x.type==="subtarefa"?"bg-cyan-400":"bg-primary")}),e.jsx("span",{className:"text-[11px] text-foreground truncate",children:x.title})]},j))}):e.jsx("span",{className:"text-[10px] text-muted-foreground/50",children:"—"})})]},a.date.toISOString())})})})]})})]})]})}const K={Ativo:"bg-green-600/90 text-white border-green-600/50","Em Espera":"bg-yellow-600/90 text-white border-yellow-600/50",Concluído:"bg-blue-600/90 text-white border-blue-600/50",Cancelado:"bg-red-600/90 text-white border-red-600/50"},Es=[{id:"visao_geral",label:"Visão Geral",icon:js},{id:"agenda",label:"Agenda",icon:fe},{id:"tarefas",label:"Tarefas",icon:ps},{id:"subtarefas",label:"Subtarefas",icon:Pe}],As=["Ativo","Em Espera","Concluído","Cancelado"],_s=["Extra","CLT","Pessoal"];function Ea(){const{projects:c,loading:C,syncing:D,error:i,lastSync:y,sync:h,createProject:o,updateProject:p,deleteProject:S}=Ge(),{tasks:u,loading:a}=$e(),{events:r}=Ve(),{uploadCover:x,removeCover:j,isUploading:N}=Ss(),k=n.useRef(null),[d,I]=n.useState(null),[T,f]=n.useState(null),[w,G]=n.useState(null),[M,Ie]=n.useState("visao_geral"),{prefs:Me,updatePref:Le}=qe(),Y=Me.project_view_mode,be=s=>Le("project_view_mode",s),[Ue,O]=n.useState(!1),[g,je]=n.useState(null),[R,W]=n.useState(""),[Q,Z]=n.useState("Ativo"),[ee,se]=n.useState(""),[ae,te]=n.useState(""),[ve,ye]=n.useState(!1),[re,Ne]=n.useState(null),oe=async(s,l)=>{try{await x(s,l),P.success("Capa atualizada!"),h()}catch(t){P.error("Erro ao enviar capa: "+t.message)}},Oe=async(s,l)=>{try{await j(s,l),P.success("Capa removida"),h()}catch(t){P.error("Erro ao remover capa: "+t.message)}},ne=(s,l)=>{var t;l.stopPropagation(),I(s),(t=k.current)==null||t.click()},Re=s=>{var t;const l=(t=s.target.files)==null?void 0:t[0];l&&d&&oe(d,l),s.target.value=""},ie=n.useCallback((s,l)=>{s.preventDefault(),s.stopPropagation(),f(l)},[]),le=n.useCallback(s=>{s.preventDefault(),s.stopPropagation(),f(null)},[]),ce=n.useCallback((s,l)=>{var b;s.preventDefault(),s.stopPropagation(),f(null);const t=(b=s.dataTransfer.files)==null?void 0:b[0];t&&t.type.startsWith("image/")?oe(l,t):t&&P.error("Apenas imagens são permitidas.")},[oe]),A=n.useMemo(()=>c.find(s=>s.id===w)||null,[c,w]),we=n.useMemo(()=>{if(!c.length||!u.length)return new Map;const s=new Map;return c.forEach(l=>{const t=u.filter(v=>v.projectId===l.id),b=t.filter(v=>v.status==="concluida").length;s.set(l.id,{total:t.length,concluidas:b})}),s},[c,u]),Fe=n.useMemo(()=>{if(!w)return{visao_geral:0,agenda:0,tarefas:0,subtarefas:0};const s=u.filter(b=>b.projectId===w),l=s.flatMap(b=>b.subtasks);return{visao_geral:0,agenda:r.filter(b=>b.projectId===w).length,tarefas:s.length,subtarefas:l.length}},[w,u,r]),Be=()=>{je(null),W(""),Z("Ativo"),se(""),te(""),O(!0)},ze=s=>{je(s),W(s.name),Z(s.status||"Ativo"),se(s.tipo||""),te(s.observacoes||""),O(!0)},Ce=async()=>{if(R.trim()){ye(!0);try{g?await p(g.id,{name:R.trim(),status:Q,tipo:ee||void 0,observacoes:ae||void 0}):await o({name:R.trim(),status:Q,tipo:ee||void 0,observacoes:ae||void 0}),O(!1)}catch(s){P.error("Erro ao salvar projeto: "+s.message)}finally{ye(!1)}}},He=async()=>{if(re)try{await S(re)}catch(s){P.error("Erro ao remover projeto: "+s.message)}finally{Ne(null)}};return C||a?e.jsxs("div",{className:"space-y-6 pb-20 md:pb-0",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Projetos"}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[1,2,3,4].map(s=>e.jsx(Je,{className:"h-40 w-full rounded-xl"},s))})]}):e.jsxs(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-6 pb-20 md:pb-0",children:[e.jsx("input",{ref:k,type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",onChange:Re,className:"hidden"}),w?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(L,{variant:"ghost",size:"sm",className:"gap-1.5 text-muted-foreground hover:text-foreground",onClick:()=>G(null),children:[e.jsx(bs,{className:"h-4 w-4"}),"Voltar"]}),e.jsx("span",{className:"text-lg font-semibold text-foreground",children:A==null?void 0:A.name}),A&&e.jsx(U,{variant:"outline",className:m("text-[10px] px-1.5 py-0",K[A.status]||"bg-secondary text-secondary-foreground"),children:A.status}),e.jsx(L,{variant:"outline",size:"sm",className:"text-xs h-8 ml-auto",onClick:()=>A&&ze(A),children:"Editar projeto"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Projetos"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(U,{variant:"secondary",className:"text-xs",children:[c.length," projetos"]}),e.jsx(xs,{syncing:D,lastSync:y,onSync:h,error:i}),e.jsxs(L,{onClick:Be,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity",children:[e.jsx(hs,{className:"mr-2 h-4 w-4"})," Novo Projeto"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 max-w-md",children:[e.jsx(Te,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsxs(de,{value:"none",onValueChange:s=>s!=="none"&&G(s),children:[e.jsx(me,{className:"bg-background/50",children:e.jsx(ue,{placeholder:"Selecionar projeto..."})}),e.jsxs(pe,{children:[e.jsx(F,{value:"none",children:"Selecionar projeto..."}),c.map(s=>e.jsx(F,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),e.jsx(U,{variant:"outline",className:m("text-[9px] px-1 py-0 ml-1",K[s.status]||"bg-secondary text-secondary-foreground"),children:s.status})]})},s.id))]})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5 rounded-lg border border-border bg-muted/40 p-0.5",children:[e.jsx("button",{onClick:()=>be("list"),className:m("rounded-md p-1.5 transition-colors",Y==="list"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:e.jsx(fs,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>be("cards"),className:m("rounded-md p-1.5 transition-colors",Y==="cards"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:e.jsx(ys,{className:"h-4 w-4"})})]})]})]}),w?e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"flex items-center gap-1 rounded-2xl border border-border bg-muted/40 p-1 w-fit backdrop-blur-sm",children:Es.map(s=>{const l=M===s.id,t=s.icon;return e.jsxs("button",{onClick:()=>Ie(s.id),className:m("relative flex items-center gap-2 rounded-xl px-5 py-2.5 text-sm font-medium transition-all duration-200",l?"text-primary-foreground":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[l&&e.jsx(E.div,{layoutId:"project-tab-bg",className:"absolute inset-0 rounded-xl gold-gradient shadow-sm",transition:{type:"spring",bounce:.15,duration:.5}}),e.jsxs("span",{className:"relative z-10 flex items-center gap-2",children:[e.jsx(t,{className:"h-4 w-4"}),s.label,s.id!=="visao_geral"&&e.jsx("span",{className:m("inline-flex items-center justify-center rounded-full px-2 py-0.5 text-[10px] font-semibold tabular-nums min-w-[22px] transition-colors",l?"bg-primary-foreground/20 text-primary-foreground":"bg-secondary text-muted-foreground"),children:Fe[s.id]})]})]},s.id)})}),e.jsxs(E.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.2},children:[M==="visao_geral"&&e.jsx(Ds,{projectId:w,tasks:u,events:r}),M==="agenda"&&e.jsx(gs,{projectId:w,hideHeader:!0}),M==="tarefas"&&e.jsx(Se,{projectId:w,hideHeader:!0,forceTab:"tarefas"}),M==="subtarefas"&&e.jsx(Se,{projectId:w,hideHeader:!0,forceTab:"subtarefas"})]},`${w}-${M}`)]}):Y==="list"?e.jsx("div",{className:"space-y-2",children:c.map((s,l)=>{const t=we.get(s.id),b=t&&t.total>0?Math.round(t.concluidas/t.total*100):0;return e.jsxs(E.div,{initial:{opacity:0,x:-8},animate:{opacity:1,x:0},transition:{delay:l*.03},onClick:()=>G(s.id),className:"group flex items-center gap-4 rounded-lg border border-border bg-card p-3 cursor-pointer hover:border-primary/40 hover:bg-card/90 transition-all duration-200",children:[e.jsxs("div",{className:m("shrink-0 w-24 aspect-[4/3] rounded-md overflow-hidden border-2 bg-muted/20 flex items-center justify-center relative group/thumb transition-all",T===s.id?"border-primary border-dashed ring-2 ring-primary/30":"border-border/50"),onDragOver:v=>ie(v,s.id),onDragLeave:le,onDrop:v=>ce(v,s.id),children:[s.coverUrl?e.jsx("img",{src:s.coverUrl,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-accent/10 via-muted/30 to-muted/10 flex items-center justify-center",children:T===s.id?e.jsx(De,{className:"h-5 w-5 text-primary animate-pulse"}):e.jsx(Te,{className:"h-5 w-5 text-accent/40"})}),e.jsx("button",{onClick:v=>ne(s.id,v),className:"absolute inset-0 bg-black/50 opacity-0 group-hover/thumb:opacity-100 transition-opacity flex items-center justify-center",children:N&&d===s.id?e.jsx(xe,{className:"h-4 w-4 text-white animate-spin"}):e.jsx(q,{className:"h-4 w-4 text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground truncate",children:s.name}),e.jsx(U,{variant:"outline",className:m("text-[9px] px-1.5 py-0 shrink-0",K[s.status]||"bg-secondary text-secondary-foreground"),children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-3 text-[11px] text-muted-foreground",children:[s.tipo&&e.jsx("span",{children:s.tipo}),s.observacoes&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"•"}),e.jsx("span",{className:"truncate",children:s.observacoes})]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-5 shrink-0",children:[e.jsxs("div",{className:"w-32 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),(t==null?void 0:t.concluidas)||0,"/",(t==null?void 0:t.total)||0]}),e.jsxs("span",{className:"font-medium",children:[b,"%"]})]}),e.jsx(J,{value:b,className:"h-1.5"})]}),s.dataInicio&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground whitespace-nowrap",children:[e.jsx(fe,{className:"h-3 w-3"}),new Date(s.dataInicio+"T12:00:00").toLocaleDateString("pt-BR")]})]})]},s.id)})}):e.jsx("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3",children:c.map((s,l)=>{const t=we.get(s.id),b=t&&t.total>0?Math.round(t.concluidas/t.total*100):0;return e.jsxs(E.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:l*.03},onClick:()=>G(s.id),className:m("group relative rounded-lg border-2 overflow-hidden cursor-pointer hover:border-primary/40 transition-all duration-200 aspect-[4/3] flex flex-col justify-end",T===s.id?"border-primary border-dashed ring-2 ring-primary/30":"border-border"),onDragOver:v=>ie(v,s.id),onDragLeave:le,onDrop:v=>ce(v,s.id),children:[s.coverUrl?e.jsx("img",{src:s.coverUrl,alt:s.name,className:"absolute inset-0 w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent/8 via-card to-card"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-card via-card/60 to-transparent"}),e.jsx("button",{onClick:v=>ne(s.id,v),className:"absolute top-2.5 left-2.5 z-20 rounded-full bg-black/50 p-1.5 opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/70",children:N&&d===s.id?e.jsx(xe,{className:"h-3.5 w-3.5 text-white animate-spin"}):e.jsx(q,{className:"h-3.5 w-3.5 text-white"})}),e.jsx(U,{variant:"outline",className:m("absolute top-2.5 right-2.5 text-[11px] px-2 py-0.5 font-semibold backdrop-blur-sm shadow-sm",K[s.status]||"bg-secondary text-secondary-foreground"),children:s.status}),e.jsxs("div",{className:"relative z-10 p-3.5 space-y-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground truncate",children:s.name}),s.tipo&&e.jsx("span",{className:"text-[11px] text-muted-foreground",children:s.tipo})]}),s.observacoes&&e.jsx("p",{className:"text-[11px] text-muted-foreground line-clamp-1",children:s.observacoes}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-[11px] text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),(t==null?void 0:t.concluidas)||0,"/",(t==null?void 0:t.total)||0," tarefas"]}),e.jsxs("span",{className:"font-medium",children:[b,"%"]})]}),e.jsx(J,{value:b,className:"h-1.5"})]}),s.dataInicio&&e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(fe,{className:"h-2.5 w-2.5"}),"Início: ",new Date(s.dataInicio+"T12:00:00").toLocaleDateString("pt-BR")]})]})]},s.id)})}),e.jsx(Xe,{open:Ue,onOpenChange:O,children:e.jsxs(Ye,{className:"sm:max-w-md",children:[e.jsx(We,{children:e.jsx(Qe,{children:g?"Editar Projeto":"Novo Projeto"})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{children:[e.jsx(B,{htmlFor:"project-name",children:"Nome do projeto"}),e.jsx(ke,{id:"project-name",value:R,onChange:s=>W(s.target.value),placeholder:"Ex: EasyBR",onKeyDown:s=>s.key==="Enter"&&Ce(),autoFocus:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(B,{children:"Status"}),e.jsxs(de,{value:Q,onValueChange:Z,children:[e.jsx(me,{children:e.jsx(ue,{})}),e.jsx(pe,{children:As.map(s=>e.jsx(F,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(B,{children:"Tipo"}),e.jsxs(de,{value:ee||"__none__",onValueChange:s=>se(s==="__none__"?"":s),children:[e.jsx(me,{children:e.jsx(ue,{placeholder:"Nenhum"})}),e.jsxs(pe,{children:[e.jsx(F,{value:"__none__",children:"Nenhum"}),_s.map(s=>e.jsx(F,{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"project-obs",children:"Observações"}),e.jsx(ke,{id:"project-obs",value:ae,onChange:s=>te(s.target.value),placeholder:"Notas sobre o projeto"})]}),g&&e.jsxs("div",{children:[e.jsx(B,{children:"Capa do projeto"}),e.jsxs("div",{className:m("mt-1.5 flex items-center gap-3 p-3 rounded-lg border-2 border-dashed transition-all",T===g.id?"border-primary bg-primary/5":"border-transparent"),onDragOver:s=>ie(s,g.id),onDragLeave:le,onDrop:s=>ce(s,g.id),children:[g.coverUrl?e.jsxs("div",{className:"relative w-24 aspect-[4/3] rounded-md overflow-hidden border border-border",children:[e.jsx("img",{src:g.coverUrl,alt:"Capa",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>Oe(g.id,g.coverUrl),className:"absolute top-0.5 right-0.5 rounded-full bg-destructive p-0.5",children:e.jsx(Ke,{className:"h-3 w-3 text-destructive-foreground"})})]}):e.jsxs("div",{className:m("w-24 aspect-[4/3] rounded-md border-2 border-dashed flex flex-col items-center justify-center bg-muted/20 gap-1 transition-colors",T===g.id?"border-primary":"border-border"),children:[T===g.id?e.jsx(De,{className:"h-5 w-5 text-primary animate-pulse"}):e.jsx(q,{className:"h-5 w-5 text-muted-foreground/40"}),e.jsx("span",{className:"text-[9px] text-muted-foreground",children:"Arraste aqui"})]}),e.jsx(L,{type:"button",variant:"outline",size:"sm",onClick:s=>ne(g.id,s),disabled:N,children:N&&d===g.id?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-3.5 w-3.5 mr-1.5 animate-spin"})," Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-3.5 w-3.5 mr-1.5"})," ",g.coverUrl?"Trocar":"Adicionar"]})})]})]})]}),e.jsxs(Ze,{children:[e.jsx(L,{variant:"outline",onClick:()=>O(!1),children:"Cancelar"}),e.jsx(L,{onClick:Ce,disabled:ve||!R.trim(),className:"gold-gradient text-primary-foreground hover:opacity-90",children:ve?"Salvando...":g?"Salvar":"Criar"})]})]})}),e.jsx(es,{open:!!re,onOpenChange:s=>!s&&Ne(null),children:e.jsxs(ss,{children:[e.jsxs(as,{children:[e.jsx(ts,{children:"Remover projeto?"}),e.jsx(rs,{children:"Esta ação não pode ser desfeita. O projeto será removido permanentemente."})]}),e.jsxs(os,{children:[e.jsx(ns,{children:"Cancelar"}),e.jsx(is,{onClick:He,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remover"})]})]})})]})}export{Ea as default};
