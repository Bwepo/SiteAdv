import{$ as H,r as t,j as e,h as i,s as J}from"./index-BQQTb6fi.js";import{u as L}from"./useQuery-CnOz2Hdf.js";import{B as d}from"./button-BYLOxE-2.js";import{I as p}from"./input-CE2c-gnk.js";import{L as c}from"./label-ULu1cug-.js";import{B as k,P as U}from"./badge-AZvcS7pt.js";import{c as Y,E as X}from"./formatters-Bj0D2YiU.js";import{S as $,a as G,b as M,c as W,d as Z}from"./select-DQAAOv5a.js";import{A as ee,a as se,b as ae,c as te,d as re,e as oe,f as ce,g as ie}from"./alert-dialog-ChmPdjXe.js";import{D as le,a as ne,c as de,d as me,f as ue}from"./dialog-BFbvaQ4H.js";import{P as xe}from"./crmTypes-CAMEoS1a.js";import{S as he}from"./scale-IyStsT_j.js";import{L as q}from"./loader-circle-xgMqgjFX.js";import{P as pe}from"./pencil-CSW1l7Ok.js";import{T as ve}from"./trash-2-BJDwYsZn.js";const m=a=>J.from(a),F="crm-processos";function I(a){return{id:a.id,clienteAirtableId:a.cliente_airtable_id,numero:a.numero||"",titulo:a.titulo||void 0,vara:a.vara||void 0,comarca:a.comarca||void 0,status:a.status||"Ativo",observacoes:a.observacoes||void 0,createdAt:a.created_at||"",updatedAt:a.updated_at||""}}function Te({clienteAirtableId:a}){const u=H(),l=[F,a],{data:o=[],isLoading:R}=L({queryKey:l,queryFn:async()=>{const{data:s,error:r}=await m("mladv_crm_processos").select("*").eq("cliente_airtable_id",a).order("created_at",{ascending:!1});if(r)throw r;return(s||[]).map(I)},enabled:!!a}),S=t.useCallback(()=>{u.invalidateQueries({queryKey:l})},[u,l]),[z,n]=t.useState(!1),[x,w]=t.useState(null),[_,P]=t.useState(!1),[v,g]=t.useState(null),[h,j]=t.useState(""),[D,f]=t.useState(""),[A,N]=t.useState(""),[E,y]=t.useState(""),[O,b]=t.useState("Ativo"),[T,C]=t.useState(""),V=()=>{w(null),j(""),f(""),N(""),y(""),b("Ativo"),C(""),n(!0)},B=s=>{w(s),j(s.numero),f(s.titulo||""),N(s.vara||""),y(s.comarca||""),b(s.status),C(s.observacoes||""),n(!0)},Q=async()=>{if(!h.trim()){i.error("Número do processo é obrigatório");return}P(!0);try{const s={numero:h.trim(),titulo:D.trim()||null,vara:A.trim()||null,comarca:E.trim()||null,status:O,observacoes:T.trim()||null};if(x){const{error:r}=await m("mladv_crm_processos").update(s).eq("id",x.id);if(r)throw r;i.success("Processo atualizado!")}else{const{error:r}=await m("mladv_crm_processos").insert({...s,cliente_airtable_id:a});if(r)throw r;i.success("Processo adicionado!")}S(),n(!1)}catch(s){i.error("Erro: "+s.message)}finally{P(!1)}},K=async()=>{if(v)try{const{error:s}=await m("mladv_crm_processos").delete().eq("id",v);if(s)throw s;i.success("Processo removido"),S()}catch(s){i.error("Erro: "+s.message)}finally{g(null)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(c,{className:"text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(he,{className:"h-3.5 w-3.5"}),"Processos Judiciais",o.length>0&&e.jsx(k,{variant:"secondary",className:"text-[10px]",children:o.length})]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",className:"gap-1 h-7",onClick:V,children:[e.jsx(U,{className:"h-3 w-3"})," Novo"]})]}),R?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground py-2",children:[e.jsx(q,{className:"h-3 w-3 animate-spin"})," Carregando..."]}):o.length===0?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-3",children:"Nenhum processo vinculado."}):e.jsx("div",{className:"space-y-1.5",children:o.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 rounded-md border border-border bg-muted/30 hover:bg-muted/60 transition-colors group",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-mono font-medium truncate",children:s.numero}),s.titulo&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.titulo}),e.jsxs("div",{className:"flex gap-2 mt-0.5 flex-wrap",children:[e.jsx(k,{variant:"outline",className:"text-[10px]",children:s.status}),s.vara&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.vara}),s.comarca&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["• ",s.comarca]})]})]}),e.jsxs("div",{className:"flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>B(s),children:e.jsx(pe,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>g(s.id),children:e.jsx(ve,{className:"h-3 w-3"})})]})]},s.id))}),e.jsx(le,{open:z,onOpenChange:n,children:e.jsxs(ne,{className:"sm:max-w-md",children:[e.jsx(de,{children:e.jsx(me,{children:x?"Editar Processo":"Novo Processo"})}),e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Número do Processo *"}),e.jsx(p,{value:h,onChange:s=>j(Y(s.target.value)),placeholder:"NNNNNNN-DD.AAAA.J.TR.OOOO",maxLength:25,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Título / Descrição breve"}),e.jsx(p,{value:D,onChange:s=>f(s.target.value),placeholder:"Ex: Ação de Indenização"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Vara"}),e.jsx(p,{value:A,onChange:s=>N(s.target.value),placeholder:"Ex: 3ª Vara Cível"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Comarca"}),e.jsx(p,{value:E,onChange:s=>y(s.target.value),placeholder:"Ex: São Paulo/SP"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Status"}),e.jsxs($,{value:O,onValueChange:b,children:[e.jsx(G,{children:e.jsx(M,{})}),e.jsx(W,{children:xe.map(s=>e.jsx(Z,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(c,{children:"Observações"}),e.jsx(X,{value:T,onChange:C,placeholder:"Notas sobre o processo...",modalTitle:"Editar Observações do Processo"})]})]}),e.jsxs(ue,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsxs(d,{onClick:Q,disabled:!h.trim()||_,children:[_&&e.jsx(q,{className:"h-4 w-4 animate-spin mr-2"}),x?"Salvar":"Adicionar"]})]})]})}),e.jsx(ee,{open:!!v,onOpenChange:s=>!s&&g(null),children:e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Excluir processo?"}),e.jsx(re,{children:"Esta ação não pode ser desfeita."})]}),e.jsxs(oe,{children:[e.jsx(ce,{children:"Cancelar"}),e.jsx(ie,{onClick:K,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function ke(){const{data:a=[],isLoading:u}=L({queryKey:[F,"all"],queryFn:async()=>{const{data:l,error:o}=await m("mladv_crm_processos").select("*").order("numero",{ascending:!0});if(o)throw o;return(l||[]).map(I)}});return{processos:a,loading:u}}export{Te as P,ke as u};
