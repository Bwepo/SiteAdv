import{r as i,aj as De,ak as ue,j as e,ah as Te,e as U,l as Ae}from"./index-BTPYu9Yo.js";import{S as Ee,b as Le,c as ke,d as Me,g as Fe,h as Ie,A as ze,P as re}from"./AdminLayout-CVZ3aQcY.js";import{C as Q,c as G,a as xe,b as he}from"./card-DNe0sRVJ.js";import{B as K}from"./badge-DW72TID6.js";import{B as x}from"./button-ityc9YDm.js";import{I as F}from"./input-CsY588i_.js";import{S as b,a as D,b as T,d as A,e as h}from"./select-BXIgJkyJ.js";import{A as Pe,a as Ve,b as Be,c as Oe,d as $e,e as Re,f as _e,g as He}from"./alert-dialog-BFmi_TnA.js";import{a as V,c as q,E as ne}from"./crmTypes-CSTEvmy3.js";import{S as Ye,A as Ue,C as Qe}from"./CrmSkeletons-UHSYdfdj.js";import{u as Ge,F as Ke,a as v,b as g,c as f,d as C,e as w,t as qe}from"./form-C3uh-jDA.js";import{T as Je}from"./textarea-DsyjojRE.js";import{L as We}from"./loader-circle-9GLeBr-m.js";import{o as Xe,s as N,e as pe}from"./types-C9wiu8_K.js";import{S as Ze}from"./search-Po7BR4lg.js";import{F as es}from"./folder-kanban-CW3ZSf4q.js";import{L as ss}from"./list-BJVcjPxX.js";import{C as ts}from"./calendar-CItZDCDV.js";import{C as le}from"./clock-DDVxU7vS.js";import{U as je}from"./users-D6c7JY70.js";import{M as as}from"./map-pin-D7RSymzR.js";import{P as rs}from"./pencil-BBW9dlQ9.js";import{T as ns}from"./trash-2-StV8G2fU.js";import{C as ls}from"./dialog-BUN5YjuJ.js";import{C as os}from"./chevron-right-Bnr3GFMm.js";import"./heart-Cc17w6w0.js";import"./sparkles-BBbVRxFI.js";import"./house-DzCPO-14.js";import"./menu-1KtLnSzP.js";import"./file-text-DGOW7wuu.js";import"./index-BB19Mu0F.js";import"./index-27RjLLL3.js";import"./index-jCx5hd2J.js";import"./chevron-up-YRNoJyD4.js";import"./check-BCv74W8S.js";import"./skeleton-mG-FlQEv.js";import"./label-Cp_0jkOO.js";const is=Xe({title:N().trim().min(1,"Título obrigatório").max(200),date:N().min(1,"Data obrigatória"),time:N().optional(),endTime:N().optional(),type:pe(["reuniao","audiencia","prazo","consulta","lembrete","outro"]),status:pe(["confirmado","pendente","cancelado","reagendado"]),clientId:N().optional(),clientName:N().optional(),projectId:N().optional(),location:N().max(300).optional(),description:N().max(2e3).optional()}),cs=Object.entries(V),ds=Object.entries(q);function ms({open:y,onOpenChange:I,event:o,onSave:J}){const E=!o,[z,B]=i.useState(!1),{clients:L}=De(),{projects:k}=ue(),l=Ge({resolver:qe(is),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""}});i.useEffect(()=>{if(y)if(o){const t=L.find(d=>{var p;return d.name.toLowerCase()===((p=o.client)==null?void 0:p.toLowerCase())}),n=k.find(d=>{var p;return d.name.toLowerCase()===((p=o.client)==null?void 0:p.toLowerCase())});l.reset({title:o.title,date:o.date,time:o.time??"",endTime:o.endTime??"",type:o.type,status:o.status,clientId:(t==null?void 0:t.id)??"",clientName:o.client??"",projectId:(n==null?void 0:n.id)??"",location:o.location??"",description:o.description??""})}else l.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:"",clientName:"",projectId:"",location:"",description:""})},[y,o,L,k]);const M=t=>{const n=L.find(d=>d.id===t);l.setValue("clientId",t),l.setValue("clientName",(n==null?void 0:n.name)??"")},O=t=>{if(l.setValue("projectId",t),!l.getValues("clientName")&&t!=="none"){const n=k.find(d=>d.id===t);n&&l.setValue("clientName",n.name)}},S=async t=>{B(!0);try{const n=t.projectId&&t.projectId!=="none"?t.projectId:void 0;await J({...t,projectAirtableId:n},E),I(!1)}finally{B(!1)}};return e.jsx(Ee,{open:y,onOpenChange:I,children:e.jsxs(Le,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(ke,{className:"mb-6",children:[e.jsx(Me,{children:E?"Novo Compromisso":"Editar Compromisso"}),e.jsx(Fe,{children:E?"Preencha os dados e salve para criar o compromisso no banco e sincronizar com o Airtable.":"Altere os campos e salve. A atualização será sincronizada com o Airtable automaticamente."})]}),e.jsx(Ke,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(S),className:"space-y-5",children:[e.jsx(v,{control:l.control,name:"title",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Título *"}),e.jsx(C,{children:e.jsx(F,{placeholder:"Ex: Reunião de alinhamento",...t})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(v,{control:l.control,name:"date",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Data *"}),e.jsx(C,{children:e.jsx(F,{type:"date",...t})}),e.jsx(w,{})]})}),e.jsx(v,{control:l.control,name:"time",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Hora início"}),e.jsx(C,{children:e.jsx(F,{type:"time",...t})}),e.jsx(w,{})]})})]}),e.jsx(v,{control:l.control,name:"endTime",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Hora término"}),e.jsx(C,{children:e.jsx(F,{type:"time",...t})}),e.jsx(w,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(v,{control:l.control,name:"type",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Tipo *"}),e.jsxs(b,{onValueChange:t.onChange,value:t.value,children:[e.jsx(C,{children:e.jsx(D,{children:e.jsx(T,{})})}),e.jsx(A,{children:cs.map(([n,d])=>e.jsx(h,{value:n,children:d},n))})]}),e.jsx(w,{})]})}),e.jsx(v,{control:l.control,name:"status",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Status *"}),e.jsxs(b,{onValueChange:t.onChange,value:t.value,children:[e.jsx(C,{children:e.jsx(D,{children:e.jsx(T,{})})}),e.jsx(A,{children:ds.map(([n,d])=>e.jsx(h,{value:n,children:d},n))})]}),e.jsx(w,{})]})})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Projeto (Airtable)"}),e.jsxs(b,{onValueChange:O,value:l.watch("projectId")||"",children:[e.jsx(D,{children:e.jsx(T,{placeholder:"Selecione um projeto..."})}),e.jsxs(A,{children:[e.jsx(h,{value:"none",children:"— Sem projeto —"}),k.map(t=>e.jsx(h,{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Cliente"}),e.jsxs(b,{onValueChange:M,value:l.watch("clientId")||"",children:[e.jsx(D,{children:e.jsx(T,{placeholder:"Selecione um cliente..."})}),e.jsxs(A,{children:[e.jsx(h,{value:"none",children:"— Sem cliente —"}),L.map(t=>e.jsx(h,{value:t.id,children:t.name},t.id))]})]})]}),e.jsx(v,{control:l.control,name:"location",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Local / Link"}),e.jsx(C,{children:e.jsx(F,{placeholder:"Ex: Sala de reunião / Google Meet",...t})}),e.jsx(w,{})]})}),e.jsx(v,{control:l.control,name:"description",render:({field:t})=>e.jsxs(g,{children:[e.jsx(f,{children:"Descrição / Observações"}),e.jsx(C,{children:e.jsx(Je,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...t})}),e.jsx(w,{})]})}),e.jsxs(Ie,{className:"pt-2 gap-2",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>I(!1),disabled:z,children:"Cancelar"}),e.jsxs(x,{type:"submit",disabled:z,children:[z&&e.jsx(We,{className:"w-4 h-4 mr-2 animate-spin"}),E?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}function qs(){const{events:y,loading:I,syncing:o,error:J,lastSync:E,sync:z,deleteEvent:B,createEvent:L,updateEvent:k}=Te(),{projects:l}=ue(),[M,O]=i.useState("calendar"),[S,t]=i.useState(""),[n,d]=i.useState("all"),[p,oe]=i.useState("all"),[P,ie]=i.useState("all"),[$,ce]=i.useState(()=>{const s=new Date;return{year:s.getFullYear(),month:s.getMonth()}}),[ge,R]=i.useState(!1),[W,X]=i.useState(null),[Z,ee]=i.useState(null),_=i.useMemo(()=>y.filter(s=>{var a;if(S&&!s.title.toLowerCase().includes(S.toLowerCase())&&!((a=s.client)!=null&&a.toLowerCase().includes(S.toLowerCase()))||n!=="all"&&s.type!==n||p!=="all"&&s.status!==p)return!1;if(P!=="all"){const r=l.find(j=>j.id===P);if(r&&s.client!==r.name)return!1}return!0}).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||"")),[y,S,n,p,P,l]),se=()=>{X(null),R(!0)},te=s=>{X(s),R(!0)},fe=async(s,a)=>{a?await L(s):W&&await k(W.id,s)},Ne=async()=>{if(Z)try{await B(Z)}catch{Ae.error("Erro ao remover compromisso.")}finally{ee(null)}},ye=s=>new Date(s+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),Se=i.useMemo(()=>{const{year:s,month:a}=$,r=new Date(s,a,1),j=new Date(s,a+1,0),m=r.getDay(),u=[],ae=c=>`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`;for(let c=m-1;c>=0;c--){const Y=new Date(s,a,-c);u.push({date:ae(Y),day:Y.getDate(),isCurrentMonth:!1})}for(let c=1;c<=j.getDate();c++){const Y=new Date(s,a,c);u.push({date:ae(Y),day:c,isCurrentMonth:!0})}for(;u.length<42;){const c=new Date(s,a+1,u.length-m-j.getDate()+1);u.push({date:ae(c),day:c.getDate(),isCurrentMonth:!1})}return u},[$]),ve=i.useMemo(()=>{const s=new Map;return _.forEach(a=>{s.has(a.date)||s.set(a.date,[]),s.get(a.date).push(a)}),s},[_]),H=(()=>{const s=new Date,a=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),j=String(s.getDate()).padStart(2,"0");return`${a}-${r}-${j}`})(),de=i.useMemo(()=>y.filter(s=>s.date>=H).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||"")).slice(0,8),[y,H]),Ce=new Date($.year,$.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),we=()=>ce(s=>s.month===0?{year:s.year-1,month:11}:{...s,month:s.month-1}),be=()=>ce(s=>s.month===11?{year:s.year+1,month:0}:{...s,month:s.month+1}),me=i.useMemo(()=>{const s=new Map;return _.forEach(a=>{s.has(a.date)||s.set(a.date,[]),s.get(a.date).push(a)}),Array.from(s.entries())},[_]);return e.jsxs(ze,{title:"Agenda",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Buscar compromisso ou cliente...",value:S,onChange:s=>t(s.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(b,{value:n,onValueChange:d,children:[e.jsx(D,{className:"w-[130px]",children:e.jsx(T,{placeholder:"Tipo"})}),e.jsxs(A,{children:[e.jsx(h,{value:"all",children:"Todos"}),Object.keys(V).map(s=>e.jsx(h,{value:s,children:V[s]},s))]})]}),e.jsxs(b,{value:p,onValueChange:oe,children:[e.jsx(D,{className:"w-[130px]",children:e.jsx(T,{placeholder:"Status"})}),e.jsxs(A,{children:[e.jsx(h,{value:"all",children:"Todos"}),Object.keys(q).map(s=>e.jsx(h,{value:s,children:q[s]},s))]})]}),e.jsxs(b,{value:P,onValueChange:ie,children:[e.jsxs(D,{className:"w-[150px]",children:[e.jsx(es,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx(T,{placeholder:"Projeto"})]}),e.jsxs(A,{children:[e.jsx(h,{value:"all",children:"Todos"}),l.map(s=>e.jsx(h,{value:s.id,children:s.name},s.id))]})]}),(n!=="all"||p!=="all"||P!=="all"||S)&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{d("all"),oe("all"),ie("all"),t("")},className:"text-xs gap-1",children:"✕ Limpar filtros"}),e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(x,{variant:M==="list"?"default":"ghost",size:"sm",onClick:()=>O("list"),className:"rounded-none",children:e.jsx(ss,{className:"w-4 h-4"})}),e.jsx(x,{variant:M==="calendar"?"default":"ghost",size:"sm",onClick:()=>O("calendar"),className:"rounded-none",children:e.jsx(ts,{className:"w-4 h-4"})})]}),e.jsxs(x,{size:"sm",onClick:se,className:"gap-1.5",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]}),e.jsx(Ye,{syncing:o,lastSync:E,onSync:z,error:J})]})]}),I?M==="list"?e.jsx(Ue,{}):e.jsx(Qe,{}):M==="list"?e.jsx("div",{className:"space-y-6",children:me.length===0?e.jsx(Q,{children:e.jsxs(G,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(x,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:se,children:[e.jsx(re,{className:"w-4 h-4"})," Criar compromisso"]})]})}):me.map(([s,a])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[ye(s),s===H&&e.jsx(K,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:a.map(r=>e.jsx(Q,{className:"hover:border-primary/30 transition-colors",children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(K,{variant:"secondary",className:`text-[10px] ${ne[r.type]}`,children:V[r.type]}),e.jsx(K,{variant:"outline",className:"text-[10px]",children:q[r.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:r.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[r.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3"}),r.time,r.endTime&&` — ${r.endTime}`]}),r.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-3 h-3"}),r.client]}),r.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-3 h-3"}),r.location]})]}),r.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>te(r),children:e.jsx(rs,{className:"w-3.5 h-3.5"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>ee(r.id),children:e.jsx(ns,{className:"w-3.5 h-3.5"})})]})]})})},r.id))})]},s))}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(Q,{children:[e.jsx(xe,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:we,children:e.jsx(ls,{className:"w-4 h-4"})}),e.jsx(he,{className:"text-base capitalize",children:Ce}),e.jsx(x,{variant:"ghost",size:"icon",onClick:be,children:e.jsx(os,{className:"w-4 h-4"})})]})}),e.jsx(G,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(s=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:s},s)),Se.map((s,a)=>{const r=ve.get(s.date)||[],j=s.date===H;return e.jsxs("div",{className:U("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!s.isCurrentMonth&&"opacity-40",j&&"bg-primary/5 border-primary/30"),onClick:()=>{r.length===0&&(X(null),R(!0))},children:[e.jsx("p",{className:U("text-xs font-medium mb-0.5",j&&"text-primary font-bold"),children:s.day}),e.jsxs("div",{className:"space-y-0.5",children:[r.slice(0,2).map(m=>e.jsxs("div",{className:U("text-[9px] px-1 py-0.5 rounded truncate cursor-pointer hover:opacity-80",ne[m.type]),title:m.title,onClick:u=>{u.stopPropagation(),te(m)},children:[m.time&&e.jsxs("span",{className:"font-medium",children:[m.time," "]}),m.title]},m.id)),r.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",r.length-2," mais"]})]})]},a)})]})})]}),e.jsxs(Q,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(xe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"text-sm flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-primary"}),"Próximos Compromissos"]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:se,children:e.jsx(re,{className:"w-4 h-4"})})]})}),e.jsx(G,{className:"space-y-3",children:de.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):de.map(s=>{const a=new Date(s.date+"T12:00:00"),r=new Date;r.setHours(0,0,0,0);const j=new Date(a.getFullYear(),a.getMonth(),a.getDate()),m=Math.round((j.getTime()-r.getTime())/(1e3*60*60*24)),u=m===0?"Hoje":m===1?"Amanhã":`Em ${m} dias`;return e.jsxs("div",{className:"flex gap-3 p-2 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>te(s),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground leading-none",children:a.toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:a.getDate()}),e.jsx("span",{className:"text-[10px] capitalize text-muted-foreground leading-none",children:a.toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(K,{variant:"outline",className:U("text-[10px] px-1.5 py-0",ne[s.type]),children:V[s.type]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:u})]}),s.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx(le,{className:"w-3 h-3 inline mr-1"}),s.time,s.endTime?` – ${s.endTime}`:""]}),s.client&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.jsx(je,{className:"w-3 h-3 inline mr-1"}),s.client]})]})]},s.id)})})]})]}),e.jsx(ms,{open:ge,onOpenChange:R,event:W,onSave:fe}),e.jsx(Pe,{open:!!Z,onOpenChange:s=>!s&&ee(null),children:e.jsxs(Ve,{children:[e.jsxs(Be,{children:[e.jsx(Oe,{children:"Remover compromisso?"}),e.jsxs($e,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Re,{children:[e.jsx(_e,{children:"Cancelar"}),e.jsx(He,{onClick:Ne,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{qs as default};
