import{c as z,r as j,s as b,j as s,X as L,h as $,e as M}from"./index-DuYpUTKK.js";import{B as w}from"./button-BaZbB3CL.js";import{L as C}from"./label-kqbA6Am2.js";import{A as F,a as O,b as I,c as _,d as B,e as P,f as V,g as q}from"./alert-dialog-7rqofho9.js";import{L as W}from"./loader-circle-C8D_-Cfk.js";import{D as S}from"./download-BqQtGVlk.js";import{F as H}from"./file-text-C6j8P8EC.js";import{E as G}from"./tabs-Bcv08EIN.js";import{U as X,T as J}from"./TipTapEditor-BCTPZSMM.js";import{T as Y}from"./textarea-BgwPv-7s.js";import{D as K,a as Q,c as Z,d as ee,f as se}from"./dialog-DvQ-4ZEs.js";import{p as T}from"./purify.es-D9RiKzGB.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=z("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=z("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),re=/\.(jpg|jpeg|png|webp|gif)$/i;function ve({folder:t,readOnly:e=!1,label:i="Anexos"}){const[a,d]=j.useState([]),[c,o]=j.useState(!1),[p,n]=j.useState(!0),[m,x]=j.useState(null),f=j.useCallback(async()=>{n(!0);try{const{data:r,error:l}=await b.storage.from("crm-anexos").list(t);if(l)throw l;const u=(r||[]).filter(v=>v.name!==".emptyFolderPlaceholder");if(u.length>0){const v=await Promise.all(u.map(async h=>{const k=re.test(h.name);let A;if(k){const{data:E}=await b.storage.from("crm-anexos").createSignedUrl(`${t}/${h.name}`,3600);A=(E==null?void 0:E.signedUrl)??void 0}return{name:h.name,signedUrl:A,isImage:k}}));d(v)}else d([])}catch{d([])}finally{n(!1)}},[t]);j.useEffect(()=>{f()},[f]);const N=async r=>{const l=r.target.files;if(!(!l||l.length===0)){o(!0);try{for(const u of Array.from(l)){const v=`${t}/${u.name}`,{error:h}=await b.storage.from("crm-anexos").upload(v,u,{upsert:!0});if(h)throw h}await f(),$.success("Arquivo(s) enviado(s)!")}catch(u){$.error("Erro no upload: "+u.message)}finally{o(!1),r.target.value=""}}},y=async()=>{if(m)try{const{error:r}=await b.storage.from("crm-anexos").remove([`${t}/${m}`]);if(r)throw r;d(l=>l.filter(u=>u.name!==m)),$.success("Arquivo removido.")}catch(r){$.error("Erro ao remover: "+r.message)}finally{x(null)}},g=async r=>{const{data:l,error:u}=await b.storage.from("crm-anexos").download(`${t}/${r}`);if(u){$.error("Erro ao baixar arquivo.");return}const v=URL.createObjectURL(l),h=document.createElement("a");h.href=v,h.download=r,h.click(),URL.revokeObjectURL(v)},D=async r=>{const{data:l,error:u}=await b.storage.from("crm-anexos").createSignedUrl(`${t}/${r}`,3600);if(u||!(l!=null&&l.signedUrl)){$.error("Erro ao gerar link de visualização.");return}window.open(l.signedUrl,"_blank")};return p?s.jsxs("div",{className:"space-y-2",children:[s.jsxs(C,{className:"flex items-center gap-1.5",children:[s.jsx(R,{className:"h-3.5 w-3.5"})," ",i]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[s.jsx(W,{className:"h-3 w-3 animate-spin"})," Carregando..."]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(C,{className:"flex items-center gap-1.5",children:[s.jsx(R,{className:"h-3.5 w-3.5"})," ",i,a.length>0&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",a.length,")"]})]}),a.length>0&&s.jsxs("div",{className:"space-y-1.5",children:[a.some(r=>r.isImage)&&s.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:a.filter(r=>r.isImage&&r.signedUrl).map(r=>s.jsxs("div",{className:"relative group rounded-md overflow-hidden border border-border",children:[s.jsx("img",{src:r.signedUrl,alt:r.name,className:"h-16 w-16 object-cover cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>D(r.name)}),s.jsxs("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center gap-1 opacity-0 group-hover:opacity-100",children:[s.jsx("button",{onClick:()=>g(r.name),className:"p-1 bg-background/80 rounded",title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx("button",{onClick:()=>x(r.name),className:"p-1 bg-background/80 rounded text-destructive",title:"Excluir",children:s.jsx(L,{className:"h-3 w-3"})})]}),s.jsx("span",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-1 truncate",children:r.name})]},r.name))}),a.filter(r=>!r.isImage).map(r=>s.jsxs("div",{className:"flex items-center gap-2 bg-muted/50 rounded-md px-2.5 py-1.5 text-xs group",children:[s.jsx(H,{className:"h-3.5 w-3.5 shrink-0 text-muted-foreground"}),s.jsx("span",{className:"truncate flex-1 max-w-[180px]",children:r.name}),s.jsxs("div",{className:"flex items-center gap-0.5 shrink-0",children:[s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>D(r.name),title:"Visualizar",children:s.jsx(G,{className:"h-3 w-3"})}),s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>g(r.name),title:"Baixar",children:s.jsx(S,{className:"h-3 w-3"})}),!e&&s.jsx(w,{variant:"ghost",size:"icon",className:"h-6 w-6 text-destructive hover:text-destructive",onClick:()=>x(r.name),title:"Excluir",children:s.jsx(L,{className:"h-3 w-3"})})]})]},r.name))]}),a.length===0&&s.jsx("p",{className:"text-xs text-muted-foreground",children:"Nenhum anexo."}),!e&&s.jsxs("label",{className:"inline-flex items-center gap-2 cursor-pointer text-sm text-primary hover:underline mt-1",children:[s.jsx(X,{className:"h-4 w-4"}),c?"Enviando...":"Adicionar arquivo",s.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:N,disabled:c})]})]}),s.jsx(F,{open:!!m,onOpenChange:r=>!r&&x(null),children:s.jsxs(O,{children:[s.jsxs(I,{children:[s.jsx(_,{children:"Excluir anexo?"}),s.jsxs(B,{children:['O arquivo "',m,'" será removido permanentemente. Esta ação não pode ser desfeita.']})]}),s.jsxs(P,{children:[s.jsx(V,{children:"Cancelar"}),s.jsx(q,{onClick:y,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function ae({open:t,onOpenChange:e,title:i="Editar Observações",value:a,onChange:d}){const[c,o]=j.useState(a),p=j.useCallback(m=>{m&&o(a),e(m)},[a,e]),n=()=>{d(c),e(!1)};return s.jsx(K,{open:t,onOpenChange:p,children:s.jsxs(Q,{className:"max-w-4xl w-[95vw] max-h-[90vh] flex flex-col p-0",children:[s.jsx(Z,{className:"px-6 pt-6 pb-0",children:s.jsx(ee,{children:i})}),s.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 min-h-0",children:s.jsx("div",{className:"[&_.border]:overflow-visible [&_.border]:flex [&_.border]:flex-col [&_.border]:max-h-full",children:s.jsx(J,{content:c,onChange:o,placeholder:"Escreva suas observações aqui..."})})}),s.jsxs(se,{className:"px-6 pb-6 pt-2 gap-2 border-t border-border",children:[s.jsx(w,{variant:"outline",onClick:()=>e(!1),children:"Cancelar"}),s.jsx(w,{onClick:n,children:"Salvar"})]})]})})}const U={ALLOWED_TAGS:["p","h1","h2","h3","h4","h5","h6","strong","em","ul","ol","li","br","hr"],ALLOWED_ATTR:[],ALLOW_DATA_ATTR:!1};function ne(t){if(!t)return"";const e=String(t).trim();if(!e)return"";if(/<[a-z][\s\S]*>/i.test(e))return T.sanitize(e,U);const i=e.split(/\r?\n/),a=[];let d=!1;const c=p=>{let n=p.replace(/\\-/g,"-");return n=n.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),n},o=()=>{d&&(a.push("</ul>"),d=!1)};for(const p of i){const n=p.trim();if(!n){o();continue}const m=n.match(/^(#{1,6})\s+(.+)$/);if(m){o();const g=Math.min(m[1].length,6);a.push(`<h${g}>${c(m[2])}</h${g}>`);continue}const x=n.match(/^\*\*(.+?)\*\*:?$/);if(x){o();const g=x[1];g.match(/^(\d+)\)\s+(.+)$/)?a.push(`<h3>${c(g)}</h3>`):a.push(`<p><strong>${c(g)}${n.endsWith(":")?":":""}</strong></p>`);continue}const f=n.match(/^(\d+)\)\s+(.+)$/);if(f){o(),a.push(`<h3>${f[1]}) ${c(f[2])}</h3>`);continue}const N=n.replace(/^\\-/,"-"),y=N.match(/^(-|•|\*)\s+(.+)$/);if(y&&!N.startsWith("**")){d||(a.push("<ul>"),d=!0),a.push(`<li>${c(y[2])}</li>`);continue}o(),a.push(`<p>${c(n)}</p>`)}return o(),T.sanitize(a.join(""),U)}function ie(t){return t?/<[a-z][\s\S]*>/i.test(t)?new DOMParser().parseFromString(t,"text/html").body.textContent||"":t:""}function be({value:t,onChange:e,placeholder:i="Observações...",className:a,modalTitle:d="Editar Observações"}){const[c,o]=j.useState(!1),p=ne(t)||t,n=/<[a-z][\s\S]*>/i.test(t),m=n?ie(t):t,x=n;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative group",children:[s.jsx(Y,{placeholder:i,className:M("resize-none min-h-[80px] pr-10",a),value:m,onChange:f=>e(f.target.value)}),s.jsx(w,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1.5 right-1.5 h-7 w-7 opacity-50 group-hover:opacity-100 transition-opacity",onClick:()=>o(!0),title:"Expandir editor",children:s.jsx(te,{className:"w-3.5 h-3.5"})}),x&&s.jsx("span",{className:"absolute bottom-1.5 right-1.5 text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:"Texto formatado"})]}),s.jsx(ae,{open:c,onOpenChange:o,title:d,value:p,onChange:e})]})}function $e(t){const e=t.replace(/\D/g,"").slice(0,20);let i="";for(let a=0;a<e.length;a++)a===7&&(i+="-"),a===9&&(i+="."),a===13&&(i+="."),a===14&&(i+="."),a===16&&(i+="."),i+=e[a];return i}function we(t){const e=t.replace(/\D/g,"").slice(0,11);return e.length<=3?e:e.length<=6?`${e.slice(0,3)}.${e.slice(3)}`:e.length<=9?`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6)}`:`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6,9)}-${e.slice(9)}`}function Ne(t){const e=t.replace(/\D/g,"").slice(0,14);return e.length<=2?e:e.length<=5?`${e.slice(0,2)}.${e.slice(2)}`:e.length<=8?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5)}`:e.length<=12?`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8)}`:`${e.slice(0,2)}.${e.slice(2,5)}.${e.slice(5,8)}/${e.slice(8,12)}-${e.slice(12)}`}function ye(t){const e=t.replace(/\D/g,"").slice(0,11);return e.length<=2?`(${e}`:e.length<=7?`(${e.slice(0,2)}) ${e.slice(2)}`:`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7)}`}function De(t){const e=t.replace(/\D/g,"");return e?(parseInt(e,10)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""}function Ee(t){const e=t.replace(/\D/g,"");return e?parseInt(e,10)/100:null}function ke(t){return t==null?"":t.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}export{ve as A,be as E,we as a,Ne as b,$e as c,De as d,ye as f,ne as m,ke as n,Ee as p};
