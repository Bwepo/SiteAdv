import{V as je,al as fe,r as l,j as e,e as w,l as Ne}from"./index-CtsJZjVD.js";import{A as ye,P as F}from"./AdminLayout-B1EAX9Ih.js";import{C,c as S,a as W,b as X}from"./card-Bl6Lsyvc.js";import{B as D}from"./badge-BEU10yW7.js";import{B as c}from"./button-iJbIC8yL.js";import{I as ve}from"./input-1DORRgsD.js";import{S as P,a as $,b as V,d as O,e as d}from"./select-DeV3-_tz.js";import{A as we,a as Ce,b as Se,c as De,d as be,e as Ee,f as Ae,g as Te}from"./alert-dialog-CYETQbU4.js";import{a as b,e as R,E as _}from"./crmTypes-DP3iBdIv.js";import{S as ke,A as Me,C as Le}from"./CrmSkeletons-t1hYzYPa.js";import{A as ze}from"./AgendaEventSheet-BzEyBkdv.js";import{S as Be}from"./search-DyRZdP3k.js";import{F as Fe}from"./folder-kanban-BvChiypQ.js";import{L as Pe}from"./list-B_NzJ4q6.js";import{C as $e}from"./calendar-DIfnZnNz.js";import{C as Y}from"./clock-mCxINhRW.js";import{U as Z}from"./users-CzHNTk2b.js";import{M as Ve}from"./map-pin-BW2wvvGK.js";import{P as Oe}from"./pencil-DXBtrWFH.js";import{T as Re}from"./trash-2-C6vcGgbx.js";import{C as _e}from"./dialog-C7w8Hxjs.js";import{C as Ye}from"./chevron-right-B-YTG414.js";import"./heart-BwxRwLUs.js";import"./sparkles-XNSsiAiX.js";import"./house-CqEmnknK.js";import"./menu-BjDrXSAf.js";import"./file-text-BKmNecAx.js";import"./index-S2y_AUBt.js";import"./index-C-8BFZJY.js";import"./index-Dpqfu98b.js";import"./chevron-up-BAdjDZxD.js";import"./check-Dtu3uIvr.js";import"./skeleton-CQRb4J3S.js";import"./form-DQWI7eI5.js";import"./label-DL7jfP8Y.js";import"./textarea-cK4BphRx.js";import"./loader-circle-CsxACxy4.js";import"./types-C9wiu8_K.js";function Et(){const{events:u,loading:ee,syncing:te,error:se,lastSync:ae,sync:re,deleteEvent:ne,createEvent:le,updateEvent:oe}=je(),{projects:E}=fe(),[g,H]=l.useState("calendar"),[m,I]=l.useState(""),[x,U]=l.useState("all"),[h,Q]=l.useState("all"),[p,K]=l.useState("all"),[j,q]=l.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[ie,f]=l.useState(!1),[A,T]=l.useState(null),[k,M]=l.useState(null),N=l.useMemo(()=>u.filter(t=>{var s;if(m&&!t.title.toLowerCase().includes(m.toLowerCase())&&!((s=t.client)!=null&&s.toLowerCase().includes(m.toLowerCase()))||x!=="all"&&t.type!==x||h!=="all"&&t.status!==h)return!1;if(p!=="all"){const a=E.find(o=>o.id===p);if(a&&t.client!==a.name)return!1}return!0}).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")),[u,m,x,h,p,E]),L=()=>{T(null),f(!0)},z=t=>{T(t),f(!0)},ce=async(t,s)=>{s?await le(t):A&&await oe(A.id,t)},me=async()=>{if(k)try{await ne(k)}catch{Ne.error("Erro ao remover compromisso.")}finally{M(null)}},de=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),xe=l.useMemo(()=>{const{year:t,month:s}=j,a=new Date(t,s,1),o=new Date(t,s+1,0),n=a.getDay(),i=[],B=r=>`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`;for(let r=n-1;r>=0;r--){const v=new Date(t,s,-r);i.push({date:B(v),day:v.getDate(),isCurrentMonth:!1})}for(let r=1;r<=o.getDate();r++){const v=new Date(t,s,r);i.push({date:B(v),day:r,isCurrentMonth:!0})}for(;i.length<42;){const r=new Date(t,s+1,i.length-n-o.getDate()+1);i.push({date:B(r),day:r.getDate(),isCurrentMonth:!1})}return i},[j]),he=l.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[N]),y=(()=>{const t=new Date,s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${o}`})(),G=l.useMemo(()=>u.filter(t=>t.date>=y).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[u,y]),pe=new Date(j.year,j.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),ue=()=>q(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),ge=()=>q(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),J=l.useMemo(()=>{const t=new Map;return N.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[N]);return e.jsxs(ye,{title:"Agenda",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(ve,{placeholder:"Buscar compromisso ou cliente...",value:m,onChange:t=>I(t.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[e.jsxs(P,{value:x,onValueChange:U,children:[e.jsx($,{className:"w-[130px]",children:e.jsx(V,{placeholder:"Tipo"})}),e.jsxs(O,{children:[e.jsx(d,{value:"all",children:"Todos"}),Object.keys(b).map(t=>e.jsx(d,{value:t,children:b[t]},t))]})]}),e.jsxs(P,{value:h,onValueChange:Q,children:[e.jsx($,{className:"w-[130px]",children:e.jsx(V,{placeholder:"Status"})}),e.jsxs(O,{children:[e.jsx(d,{value:"all",children:"Todos"}),Object.keys(R).map(t=>e.jsx(d,{value:t,children:R[t]},t))]})]}),e.jsxs(P,{value:p,onValueChange:K,children:[e.jsxs($,{className:"w-[150px]",children:[e.jsx(Fe,{className:"w-3.5 h-3.5 mr-1 text-muted-foreground"}),e.jsx(V,{placeholder:"Projeto"})]}),e.jsxs(O,{children:[e.jsx(d,{value:"all",children:"Todos"}),E.map(t=>e.jsx(d,{value:t.id,children:t.name},t.id))]})]}),(x!=="all"||h!=="all"||p!=="all"||m)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{U("all"),Q("all"),K("all"),I("")},className:"text-xs gap-1",children:"✕ Limpar filtros"}),e.jsxs("div",{className:"flex border border-border rounded-md overflow-hidden",children:[e.jsx(c,{variant:g==="list"?"default":"ghost",size:"sm",onClick:()=>H("list"),className:"rounded-none",children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx(c,{variant:g==="calendar"?"default":"ghost",size:"sm",onClick:()=>H("calendar"),className:"rounded-none",children:e.jsx($e,{className:"w-4 h-4"})})]}),e.jsxs(c,{size:"sm",onClick:L,className:"gap-1.5",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo"})]}),e.jsx(ke,{syncing:te,lastSync:ae,onSync:re,error:se})]})]}),ee?g==="list"?e.jsx(Me,{}):e.jsx(Le,{}):g==="list"?e.jsx("div",{className:"space-y-6",children:J.length===0?e.jsx(C,{children:e.jsxs(S,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(c,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:L,children:[e.jsx(F,{className:"w-4 h-4"})," Criar compromisso"]})]})}):J.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[de(t),t===y&&e.jsx(D,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(C,{className:"hover:border-primary/30 transition-colors",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(D,{variant:"secondary",className:`text-[10px] ${_[a.type]}`,children:b[a.type]}),e.jsx(D,{variant:"outline",className:"text-[10px]",children:R[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ve,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>z(a),children:e.jsx(Oe,{className:"w-3.5 h-3.5"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>M(a.id),children:e.jsx(Re,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-6",children:[e.jsxs(C,{children:[e.jsx(W,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:ue,children:e.jsx(_e,{className:"w-4 h-4"})}),e.jsx(X,{className:"text-base capitalize",children:pe}),e.jsx(c,{variant:"ghost",size:"icon",onClick:ge,children:e.jsx(Ye,{className:"w-4 h-4"})})]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-7 gap-px",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"text-center text-xs font-medium text-muted-foreground py-2",children:t},t)),xe.map((t,s)=>{const a=he.get(t.date)||[],o=t.date===y;return e.jsxs("div",{className:w("min-h-[80px] p-1 border border-border/50 rounded-sm cursor-pointer hover:bg-muted/30 transition-colors",!t.isCurrentMonth&&"opacity-40",o&&"bg-primary/5 border-primary/30"),onClick:()=>{a.length===0&&(T(null),f(!0))},children:[e.jsx("p",{className:w("text-xs font-medium mb-0.5",o&&"text-primary font-bold"),children:t.day}),e.jsxs("div",{className:"space-y-0.5",children:[a.slice(0,2).map(n=>e.jsxs("div",{className:w("text-[9px] px-1 py-0.5 rounded truncate cursor-pointer hover:opacity-80",_[n.type]),title:n.title,onClick:i=>{i.stopPropagation(),z(n)},children:[n.time&&e.jsxs("span",{className:"font-medium",children:[n.time," "]}),n.title]},n.id)),a.length>2&&e.jsxs("p",{className:"text-[9px] text-muted-foreground pl-1",children:["+",a.length-2," mais"]})]})]},s)})]})})]}),e.jsxs(C,{className:"h-fit lg:sticky lg:top-4",children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"text-sm flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-primary"}),"Próximos Compromissos"]}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:L,children:e.jsx(F,{className:"w-4 h-4"})})]})}),e.jsx(S,{className:"space-y-3",children:G.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum compromisso futuro"}):G.map(t=>{const s=new Date(t.date+"T12:00:00"),a=new Date;a.setHours(0,0,0,0);const o=new Date(s.getFullYear(),s.getMonth(),s.getDate()),n=Math.round((o.getTime()-a.getTime())/(1e3*60*60*24)),i=n===0?"Hoje":n===1?"Amanhã":`Em ${n} dias`;return e.jsxs("div",{className:"flex gap-3 p-2 rounded-md border border-border/60 hover:bg-muted/50 transition-colors cursor-pointer",onClick:()=>z(t),children:[e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[44px] rounded bg-muted px-1 py-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{month:"short"})}),e.jsx("span",{className:"text-lg font-bold leading-tight",children:s.getDate()}),e.jsx("span",{className:"text-[10px] capitalize text-muted-foreground leading-none",children:s.toLocaleDateString("pt-BR",{weekday:"short"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5 flex-wrap",children:[e.jsx(D,{variant:"outline",className:w("text-[10px] px-1.5 py-0",_[t.type]),children:b[t.type]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:i})]}),t.time&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:[e.jsx(Y,{className:"w-3 h-3 inline mr-1"}),t.time,t.endTime?` – ${t.endTime}`:""]}),t.client&&e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[e.jsx(Z,{className:"w-3 h-3 inline mr-1"}),t.client]})]})]},t.id)})})]})]}),e.jsx(ze,{open:ie,onOpenChange:f,event:A,onSave:ce}),e.jsx(we,{open:!!k,onOpenChange:t=>!t&&M(null),children:e.jsxs(Ce,{children:[e.jsxs(Se,{children:[e.jsx(De,{children:"Remover compromisso?"}),e.jsxs(be,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(Ee,{children:[e.jsx(Ae,{children:"Cancelar"}),e.jsx(Te,{onClick:me,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Et as default};
