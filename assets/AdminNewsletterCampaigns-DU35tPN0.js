import{c as B,r as x,y as F,j as e,e as k}from"./index-CRbxGvyX.js";import{P,A as z,S as q,b as R,c as _,d as U}from"./AdminLayout-DVyBoKkl.js";import{B as u}from"./button-BhzpMakZ.js";import{I as V}from"./input-B9d6DtNu.js";import{L}from"./label-CcQWtkmJ.js";import{T as G}from"./textarea-C4akluy1.js";import{T as W,a as J,b as H}from"./tabs-DSgndPYl.js";import{D as K,b as Q,a as X,c as Y,d as Z,e as $,f as ee}from"./dialog-D6uN70U_.js";import{b as I,C as se,T as ae}from"./newsletterTemplate-jT6CMczo.js";import{g as te,b as re,h as ie,i as le,j as oe}from"./useNewsletter-aHmBisZ5.js";import{g as D}from"./supabaseErrors-eYWJjREL.js";import{E as ne,a as de}from"./eye-C_Iy9Pxr.js";import{L as ce}from"./loader-circle-CJZD0c8D.js";import{C as me,c as xe}from"./card-3kacQ-b0.js";import{T as ue,a as he,b as E,c as N,d as pe,e as g,A as je,f as ge,g as ve,h as fe,i as be,j as Ne,k as Ce,l as we}from"./alert-dialog-CMQ4h_e4.js";import{S as v}from"./skeleton-DSMFxKyy.js";import{B as ye}from"./badge-DTHINpQd.js";import"./index-COYZmbZ5.js";import"./index-CNru88L7.js";import"./house-P1ESO-SK.js";import"./menu-Ceh_55VR.js";import"./file-text-d3xM3Sek.js";import"./index-i5nyuRCd.js";import"./index-CyFKvgBJ.js";import"./index-oCKtZWHP.js";import"./dropdown-menu-Dm4ei0Qp.js";import"./chevron-right-nvwxV0gW.js";import"./check-DT6rteUS.js";import"./link-CKrZEgIt.js";import"./list-DuQI9AK_.js";import"./quote-MfKXaG0y.js";import"./trash-2-C3uNbEaZ.js";import"./useMutation-S1XUc4T2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=B("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);function Se(){const[a,f]=x.useState(!1),[o,h]=x.useState(""),[d,p]=x.useState(""),[j,c]=x.useState("visual"),[n,b]=x.useState(!1),m=te(),{toast:l}=F(),w=async()=>{if(!o.trim()){l({title:"Assunto obrigat√≥rio",description:"Informe o assunto do e-mail.",variant:"destructive"});return}if(!d.trim()){l({title:"Conte√∫do obrigat√≥rio",description:"Escreva o conte√∫do do e-mail.",variant:"destructive"});return}try{const t=I({title:o.trim(),content:d,postUrl:"https://marianalima.adv.br"});await m.mutateAsync({subject:o.trim(),html:t,post_id:""}),l({title:"Campanha criada!",description:"A campanha foi criada com os deliveries na fila."}),h(""),p(""),b(!1),c("visual"),f(!1)}catch(t){l({title:"Erro ao criar campanha",description:D(t,"N√£o foi poss√≠vel criar a campanha."),variant:"destructive"})}},r=()=>{f(!1),h(""),p(""),b(!1),c("visual")},C=I({title:o.trim()||"Assunto do e-mail",content:d||"<p>Conte√∫do do e-mail aparecer√° aqui...</p>",postUrl:"https://marianalima.adv.br"});return e.jsxs(K,{open:a,onOpenChange:t=>t?f(!0):r(),children:[e.jsx(Q,{asChild:!0,children:e.jsxs(u,{children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Nova campanha"]})}),e.jsxs(X,{className:"max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Nova campanha manual"}),e.jsx($,{children:"Crie uma campanha sem v√≠nculo a um post. O conte√∫do ser√° enviado a todos os inscritos ativos."})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-2 pr-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"campaign-subject",children:"Assunto do e-mail *"}),e.jsx(V,{id:"campaign-subject",value:o,onChange:t=>h(t.target.value),placeholder:"Novidades do escrit√≥rio...",maxLength:200})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{children:"Conte√∫do *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[!n&&e.jsx(W,{value:j,onValueChange:t=>c(t),children:e.jsxs(J,{className:"h-8",children:[e.jsxs(H,{value:"visual",className:"text-xs px-3",children:[e.jsx(Ee,{className:"w-3 h-3 mr-1"}),"Visual"]}),e.jsxs(H,{value:"html",className:"text-xs px-3",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"HTML"]})]})}),e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>b(!n),children:n?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-1"}),"Editar"]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),"Preview"]})})]})]}),n?e.jsxs("div",{className:"border border-border rounded-lg overflow-hidden bg-muted/30",children:[e.jsx("div",{className:"bg-muted/50 px-4 py-2 border-b border-border",children:e.jsx("p",{className:"text-xs text-muted-foreground",children:"Preview do e-mail completo (como ser√° recebido pelo inscrito)"})}),e.jsx("div",{className:"p-4 max-h-[400px] overflow-y-auto",children:e.jsx("iframe",{srcDoc:C,title:"Email Preview",className:"w-full min-h-[350px] border-0 rounded bg-background",sandbox:"allow-same-origin"})})]}):j==="visual"?e.jsx("div",{className:"min-h-[300px]",children:e.jsx(ae,{content:d,onChange:p,placeholder:"Escreva o conte√∫do da campanha..."})}):e.jsx(G,{value:d,onChange:t=>p(t.target.value),placeholder:"<p>Conte√∫do do e-mail em HTML...</p>",className:"min-h-[300px] font-mono text-sm"}),!n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"üí° O conte√∫do ser√° automaticamente envolvido no template de e-mail do escrit√≥rio, com logo, footer e link de descadastro."})]})]}),e.jsxs(ee,{className:"pt-4 border-t border-border",children:[e.jsx(u,{variant:"outline",onClick:r,children:"Cancelar"}),e.jsxs(u,{onClick:w,disabled:m.isPending,children:[m.isPending?e.jsx(ce,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(P,{className:"w-4 h-4 mr-2"}),"Criar campanha"]})]})]})]})}const De={draft:{label:"Rascunho",className:"bg-muted text-muted-foreground"},queued:{label:"Na fila",className:"bg-blue-500/10 text-blue-600 border-blue-500/30"},sending:{label:"Enviando",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30"},sent:{label:"Enviada",className:"bg-green-500/10 text-green-600 border-green-500/30"},partial:{label:"Parcial",className:"bg-orange-500/10 text-orange-600 border-orange-500/30"},failed:{label:"Falhou",className:"bg-destructive/10 text-destructive border-destructive/30"}},Te={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},S=a=>a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"‚Äî",ns=()=>{const{data:a,isLoading:f}=re(),[o,h]=x.useState(null),[d,p]=x.useState(null),[j,c]=x.useState(null),{toast:n}=F(),b=ie(),m=le(),{data:l,isLoading:w}=oe(o),r=(l==null?void 0:l.campaign)??null,C=l==null?void 0:l.deliveryCounts,t=x.useMemo(()=>((a==null?void 0:a.length)??0)>0,[a]),T=s=>["draft","queued","partial"].includes(s),A=async s=>{p(s);try{await b.mutateAsync(s),n({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(i){const O=D(i,"N√£o foi poss√≠vel iniciar o envio.");n({title:"Erro ao enviar",description:O,variant:"destructive"})}finally{p(null)}},M=async()=>{if(j)try{await m.mutateAsync(j),n({title:"Campanha exclu√≠da",description:"A campanha foi removida com sucesso."}),o===j&&h(null)}catch(s){const i=D(s,"N√£o foi poss√≠vel excluir a campanha.");n({title:"Erro ao excluir",description:i,variant:"destructive"})}finally{c(null)}},y=s=>{const i=De[s]||{label:s,className:"bg-muted text-muted-foreground"};return e.jsx(ye,{variant:"outline",className:k("text-[11px]",i.className),children:i.label})};return e.jsxs(z,{title:"Campanhas de Newsletter",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("p",{className:"text-sm text-muted-foreground hidden sm:block",children:"Gerencie e envie suas campanhas de e-mail."}),e.jsx(Se,{})]}),e.jsx(me,{children:e.jsx(xe,{className:"p-0",children:f?e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsx(v,{className:"h-8 w-full"}),e.jsx(v,{className:"h-8 w-full"}),e.jsx(v,{className:"h-8 w-full"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block",children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs(E,{children:[e.jsx(N,{children:"Assunto"}),e.jsx(N,{className:"w-[100px]",children:"Status"}),e.jsx(N,{className:"w-[140px]",children:"Criado em"}),e.jsx(N,{className:"w-[140px]",children:"Enviado em"}),e.jsx(N,{className:"w-[180px] text-right",children:"A√ß√µes"})]})}),e.jsx(pe,{children:t?a==null?void 0:a.map(s=>e.jsxs(E,{className:k("cursor-pointer transition-colors",o===s.id&&"bg-muted/50"),onClick:()=>h(s.id),children:[e.jsx(g,{className:"font-medium",children:s.subject}),e.jsx(g,{children:y(s.status)}),e.jsx(g,{className:"text-sm text-muted-foreground",children:S(s.created_at)}),e.jsx(g,{className:"text-sm text-muted-foreground",children:S(s.sent_at)}),e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",onClick:i=>i.stopPropagation(),children:[T(s.status)&&e.jsx(u,{variant:"default",size:"sm",className:"h-7 text-xs",onClick:()=>A(s.id),disabled:d===s.id,children:d===s.id?"Enviando...":"Enviar"}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-7 text-xs text-destructive hover:text-destructive",onClick:()=>c(s.id),disabled:m.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(E,{children:e.jsx(g,{colSpan:5,className:"text-center text-muted-foreground py-12",children:'Nenhuma campanha cadastrada. Crie uma manualmente ou publique um post com a op√ß√£o "Enviar newsletter".'})})})]})}),e.jsx("div",{className:"md:hidden p-4 space-y-3",children:t?a==null?void 0:a.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-border space-y-3 cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>h(s.id),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:"font-medium text-sm flex-1",children:s.subject}),y(s.status)]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("span",{children:S(s.created_at)}),e.jsxs("div",{className:"flex gap-2",onClick:i=>i.stopPropagation(),children:[T(s.status)&&e.jsx(u,{size:"sm",className:"h-7 text-xs",onClick:()=>A(s.id),disabled:d===s.id,children:"Enviar"}),e.jsx(u,{variant:"ghost",size:"sm",className:"h-7 text-xs text-destructive",onClick:()=>c(s.id),children:"Excluir"})]})]})]},s.id)):e.jsx("p",{className:"text-center text-sm text-muted-foreground py-8",children:"Nenhuma campanha cadastrada."})})]})})}),e.jsx(q,{open:!!o,onOpenChange:s=>{s||h(null)},children:e.jsxs(R,{className:"sm:max-w-lg overflow-y-auto",children:[e.jsx(_,{children:e.jsx(U,{className:"text-left",children:"Detalhes da campanha"})}),w?e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(v,{className:"h-6 w-3/4"}),e.jsx(v,{className:"h-20 w-full"}),e.jsx(v,{className:"h-40 w-full"})]}):r?e.jsxs("div",{className:"space-y-6 mt-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Assunto"}),e.jsx("p",{className:"text-sm font-medium",children:r.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Status"}),y(r.status)]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Post relacionado"}),r.post?e.jsxs("p",{className:"text-sm",children:[r.post.title,e.jsxs("span",{className:"text-muted-foreground ml-1 text-xs",children:["/",r.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Campanha manual"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Resumo de envios"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(Te).map(([s,i])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-[11px] text-muted-foreground",children:i}),e.jsx("p",{className:"text-lg font-semibold",children:C?C[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Preview do e-mail"}),e.jsx("div",{className:"rounded-lg border border-border overflow-hidden bg-white",children:r.html?e.jsx("iframe",{srcDoc:r.html,title:"Preview do e-mail",className:"w-full h-[320px] border-0",sandbox:""}):e.jsx("p",{className:"text-sm text-muted-foreground p-4",children:"Sem conte√∫do HTML."})})]}),e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsx(u,{variant:"destructive",size:"sm",onClick:()=>c(r.id),disabled:m.isPending,children:"Excluir campanha"})})]}):e.jsx("p",{className:"text-sm text-muted-foreground mt-6",children:"Campanha n√£o encontrada."})]})}),e.jsx(je,{open:!!j,onOpenChange:()=>c(null),children:e.jsxs(ge,{children:[e.jsxs(ve,{children:[e.jsx(fe,{children:"Excluir campanha?"}),e.jsx(be,{children:"Esta a√ß√£o remove a campanha e seu hist√≥rico de envios. N√£o pode ser desfeita."})]}),e.jsxs(Ne,{children:[e.jsx(Ce,{children:"Cancelar"}),e.jsx(we,{onClick:M,disabled:m.isPending,children:m.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{ns as default};
