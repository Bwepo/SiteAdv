import{$ as Y,r,j as e,h as c,s as $}from"./index-CVUt1wCy.js";import{u as F}from"./useQuery-BsapWAU7.js";import{B as d}from"./button-M3QFLZwx.js";import{I as u}from"./input-CJB1I6Dy.js";import{L as o}from"./label-DwIqh7px.js";import{B as k,P as X}from"./badge-wPxsNUIw.js";import{n as q,c as G,d as M,E as W,p as Z}from"./formatters-HsXnrXg-.js";import{S as ee,a as se,b as ae,c as re,d as te}from"./select-DSs-hNby.js";import{A as oe,a as le,b as ce,c as ie,d as ne,e as de,f as ue,g as me}from"./alert-dialog-DqzMIbyM.js";import{D as xe,a as he,c as ve,d as pe,f as ge}from"./dialog-D_Z-9rs9.js";import{P as je}from"./crmTypes-Ubwxf8W1.js";import{S as fe}from"./scale-D0XmvpDL.js";import{L as B}from"./loader-circle-BFmEUsru.js";import{P as Ne}from"./pencil-Cry4KBnS.js";import{T as Ce}from"./trash-2-BzndVWAh.js";const m=a=>$.from(a),V="crm-processos";function I(a){return{id:a.id,clienteAirtableId:a.cliente_airtable_id,numero:a.numero||"",titulo:a.titulo||void 0,vara:a.vara||void 0,comarca:a.comarca||void 0,status:a.status||"Ativo",observacoes:a.observacoes||void 0,valorCausa:a.valor_causa!=null?Number(a.valor_causa):null,createdAt:a.created_at||"",updatedAt:a.updated_at||""}}function Be({clienteAirtableId:a}){const x=Y(),i=[V,a],{data:l=[],isLoading:z}=F({queryKey:i,queryFn:async()=>{const{data:s,error:t}=await m("mladv_crm_processos").select("*").eq("cliente_airtable_id",a).order("created_at",{ascending:!1});if(t)throw t;return(s||[]).map(I)},enabled:!!a}),_=r.useCallback(()=>{x.invalidateQueries({queryKey:i})},[x,i]),[Q,n]=r.useState(!1),[h,w]=r.useState(null),[P,D]=r.useState(!1),[p,g]=r.useState(null),[v,j]=r.useState(""),[A,f]=r.useState(""),[E,N]=r.useState(""),[O,C]=r.useState(""),[T,y]=r.useState("Ativo"),[L,b]=r.useState(""),[R,S]=r.useState(""),K=()=>{w(null),j(""),f(""),N(""),C(""),y("Ativo"),b(""),S(""),n(!0)},H=s=>{w(s),j(s.numero),f(s.titulo||""),N(s.vara||""),C(s.comarca||""),y(s.status),b(s.observacoes||""),S(s.valorCausa!=null?q(s.valorCausa):""),n(!0)},J=async()=>{if(!v.trim()){c.error("Número do processo é obrigatório");return}D(!0);try{const s={numero:v.trim(),titulo:A.trim()||null,vara:E.trim()||null,comarca:O.trim()||null,status:T,observacoes:L.trim()||null,valor_causa:Z(R)};if(h){const{error:t}=await m("mladv_crm_processos").update(s).eq("id",h.id);if(t)throw t;c.success("Processo atualizado!")}else{const{error:t}=await m("mladv_crm_processos").insert({...s,cliente_airtable_id:a});if(t)throw t;c.success("Processo adicionado!")}_(),n(!1)}catch(s){c.error("Erro: "+s.message)}finally{D(!1)}},U=async()=>{if(p)try{const{error:s}=await m("mladv_crm_processos").delete().eq("id",p);if(s)throw s;c.success("Processo removido"),_()}catch(s){c.error("Erro: "+s.message)}finally{g(null)}};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"text-sm font-semibold flex items-center gap-1.5",children:[e.jsx(fe,{className:"h-3.5 w-3.5"}),"Processos Judiciais",l.length>0&&e.jsx(k,{variant:"secondary",className:"text-[10px]",children:l.length})]}),e.jsxs(d,{type:"button",variant:"outline",size:"sm",className:"gap-1 h-7",onClick:K,children:[e.jsx(X,{className:"h-3 w-3"})," Novo"]})]}),z?e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground py-2",children:[e.jsx(B,{className:"h-3 w-3 animate-spin"})," Carregando..."]}):l.length===0?e.jsx("p",{className:"text-xs text-muted-foreground text-center py-3",children:"Nenhum processo vinculado."}):e.jsx("div",{className:"space-y-1.5",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between gap-2 p-2 rounded-md border border-border bg-muted/30 hover:bg-muted/60 transition-colors group",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-mono font-medium truncate",children:s.numero}),s.titulo&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.titulo}),e.jsxs("div",{className:"flex gap-2 mt-0.5 flex-wrap",children:[e.jsx(k,{variant:"outline",className:"text-[10px]",children:s.status}),s.vara&&e.jsx("span",{className:"text-[10px] text-muted-foreground",children:s.vara}),s.comarca&&e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:["• ",s.comarca]}),s.valorCausa!=null&&e.jsxs("span",{className:"text-[10px] font-medium text-foreground",children:["• ",q(s.valorCausa)]})]})]}),e.jsxs("div",{className:"flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>H(s),children:e.jsx(Ne,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>g(s.id),children:e.jsx(Ce,{className:"h-3 w-3"})})]})]},s.id))}),e.jsx(xe,{open:Q,onOpenChange:n,children:e.jsxs(he,{className:"sm:max-w-md",children:[e.jsx(ve,{children:e.jsx(pe,{children:h?"Editar Processo":"Novo Processo"})}),e.jsxs("div",{className:"space-y-3 py-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Número do Processo *"}),e.jsx(u,{value:v,onChange:s=>j(G(s.target.value)),placeholder:"NNNNNNN-DD.AAAA.J.TR.OOOO",maxLength:25,autoFocus:!0})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Título / Descrição breve"}),e.jsx(u,{value:A,onChange:s=>f(s.target.value),placeholder:"Ex: Ação de Indenização"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Vara"}),e.jsx(u,{value:E,onChange:s=>N(s.target.value),placeholder:"Ex: 3ª Vara Cível"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Comarca"}),e.jsx(u,{value:O,onChange:s=>C(s.target.value),placeholder:"Ex: São Paulo/SP"})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Status"}),e.jsxs(ee,{value:T,onValueChange:y,children:[e.jsx(se,{children:e.jsx(ae,{})}),e.jsx(re,{children:je.map(s=>e.jsx(te,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Valor da Causa"}),e.jsx(u,{value:R,onChange:s=>S(M(s.target.value)),placeholder:"R$ 0,00"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(o,{children:"Observações"}),e.jsx(W,{value:L,onChange:b,placeholder:"Notas sobre o processo...",modalTitle:"Editar Observações do Processo"})]})]}),e.jsxs(ge,{children:[e.jsx(d,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsxs(d,{onClick:J,disabled:!v.trim()||P,children:[P&&e.jsx(B,{className:"h-4 w-4 animate-spin mr-2"}),h?"Salvar":"Adicionar"]})]})]})}),e.jsx(oe,{open:!!p,onOpenChange:s=>!s&&g(null),children:e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsx(ie,{children:"Excluir processo?"}),e.jsx(ne,{children:"Esta ação não pode ser desfeita."})]}),e.jsxs(de,{children:[e.jsx(ue,{children:"Cancelar"}),e.jsx(me,{onClick:U,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Excluir"})]})]})})]})}function Fe(){const{data:a=[],isLoading:x}=F({queryKey:[V,"all"],queryFn:async()=>{const{data:i,error:l}=await m("mladv_crm_processos").select("*").order("numero",{ascending:!0});if(l)throw l;return(i||[]).map(I)}});return{processos:a,loading:x}}export{Be as P,Fe as u};
