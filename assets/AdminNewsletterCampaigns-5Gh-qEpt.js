import{r as u,E as I,j as e}from"./index-ziHXrAGQ.js";import{A as R}from"./AdminLayout-LadXLwtk.js";import{B as h}from"./button-HQ8thvGE.js";import{C,a as b,b as w,c as y}from"./card-UfYWDfDC.js";import{T as z,a as B,b as j,c as r,d as F,e as l,A as M,f as _,g as q,h as O,i as V,j as G,k as J,l as K}from"./alert-dialog-Bo7GML3q.js";import{S as o}from"./skeleton-OrSh3OT_.js";import{b as Q,g as U,h as W,i as X}from"./useNewsletter-f9FMHZOJ.js";import"./chevron-left-Bg7HGbl4.js";import"./mail-CM3OdGkC.js";import"./index-CGCAsMoH.js";import"./Combination-CLvWnlGC.js";import"./useMutation-DncFD02b.js";const A={draft:"Rascunho",queued:"Fila",sending:"Enviando",sent:"Enviada",partial:"Parcial",failed:"Falhou"},Y={queued:"Na fila",sent:"Enviados",failed:"Falhou",skipped:"Ignorados"},E=t=>t?new Date(t).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—",ce=()=>{const{data:t,isLoading:S}=Q(),[p,f]=u.useState(null),[g,v]=u.useState(null),[c,m]=u.useState(null),{toast:x}=I(),D=U(),d=W(),{data:n,isLoading:T}=X(p),a=(n==null?void 0:n.campaign)??null,N=n==null?void 0:n.deliveryCounts,L=u.useMemo(()=>((t==null?void 0:t.length)??0)>0,[t]),k=s=>["queued","partial"].includes(s),P=async s=>{v(s);try{await D.mutateAsync(s),x({title:"Envio iniciado",description:"A campanha foi enviada para a fila de envios."})}catch(i){x({title:"Erro ao enviar",description:(i==null?void 0:i.message)||"Não foi possível iniciar o envio.",variant:"destructive"})}finally{v(null)}},H=async()=>{if(c)try{await d.mutateAsync(c),x({title:"Campanha excluída",description:"A campanha foi removida com sucesso."}),p===c&&f(null)}catch(s){const i=s instanceof Error?s.message:"Não foi possível excluir a campanha.";x({title:"Erro ao excluir",description:i,variant:"destructive"})}finally{m(null)}};return e.jsxs(R,{title:"Campanhas de Newsletter",children:[e.jsxs(C,{className:"mb-6",children:[e.jsx(b,{children:e.jsx(w,{children:"Campanhas"})}),e.jsx(y,{children:S?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"}),e.jsx(o,{className:"h-8 w-full"})]}):e.jsxs(z,{children:[e.jsx(B,{children:e.jsxs(j,{children:[e.jsx(r,{children:"Assunto"}),e.jsx(r,{children:"Status"}),e.jsx(r,{children:"Post"}),e.jsx(r,{children:"Criado em"}),e.jsx(r,{children:"Enviado em"}),e.jsx(r,{className:"text-right",children:"Ações"})]})}),e.jsx(F,{children:L?t==null?void 0:t.map(s=>e.jsxs(j,{children:[e.jsx(l,{className:"font-medium",children:s.subject}),e.jsx(l,{children:A[s.status]??s.status}),e.jsx(l,{children:s.post?e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.post.title}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["/blog/",s.post.slug]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})}),e.jsx(l,{children:E(s.created_at)}),e.jsx(l,{children:E(s.sent_at)}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex flex-wrap justify-end gap-2",children:[k(s.status)&&e.jsx(h,{variant:"default",size:"sm",onClick:()=>P(s.id),disabled:g===s.id,children:g===s.id?"Enviando...":"Enviar agora"}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>f(s.id),children:"Ver detalhes"}),e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(s.id),disabled:d.isPending,children:"Excluir"})]})})]},s.id)):e.jsx(j,{children:e.jsx(l,{colSpan:6,className:"text-center text-muted-foreground",children:"Nenhuma campanha cadastrada."})})})]})})]}),e.jsxs(C,{children:[e.jsx(b,{children:e.jsx(w,{children:"Detalhes da campanha"})}),e.jsx(y,{children:T?e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"h-6 w-1/2"}),e.jsx(o,{className:"h-24 w-full"})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-end gap-3",children:e.jsx(h,{variant:"destructive",size:"sm",onClick:()=>m(a.id),disabled:d.isPending,children:"Excluir campanha"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assunto"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:a.subject})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx("p",{className:"text-base font-medium text-foreground",children:A[a.status]??a.status})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Post relacionado"}),a.post?e.jsxs("div",{className:"text-base font-medium text-foreground",children:[a.post.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["/blog/",a.post.slug]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"—"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Resumo de envios"}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mt-2",children:Object.entries(Y).map(([s,i])=>e.jsxs("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:i}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:N?N[s]:0})]},s))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Preview HTML"}),e.jsx("div",{className:"mt-2 max-h-[320px] overflow-auto rounded-lg border border-border bg-background p-4",children:a.html?e.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:a.html}}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem conteúdo HTML."})})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Selecione uma campanha para ver os detalhes."})})]}),e.jsx(M,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(_,{children:[e.jsxs(q,{children:[e.jsx(O,{children:"Excluir campanha?"}),e.jsx(V,{children:"Esta ação remove a campanha e seu histórico de envios. Essa ação não pode ser desfeita."})]}),e.jsxs(G,{children:[e.jsx(J,{children:"Cancelar"}),e.jsx(K,{onClick:H,disabled:d.isPending,children:d.isPending?"Excluindo...":"Excluir"})]})]})})]})};export{ce as default};
