import{r as l,h as ee,j as e,e as d,m as Oe,a1 as Re,W as Fe,Y as Ie,Z as Ve}from"./index-DyFY_geq.js";import{A as Ye,C as He,b as _e,T as We}from"./CrmSkeletons-DrgaUb26.js";import{C as te,c as se,a as Ue,b as Ge}from"./card-DKgjZrhA.js";import{B as f,P as ae}from"./badge-cv0ZjFJD.js";import{B as c}from"./button-DDKUy5aI.js";import{I as Qe}from"./input-Dh2VVhU3.js";import{S as Ze}from"./scroll-area-_a18GtPO.js";import{S as A,a as M,b as B,c as $,d as j}from"./select-74VM9eyW.js";import{A as qe,a as Je,b as Ke,c as Xe,d as et,e as tt,f as st,g as at}from"./alert-dialog-vXHv_RDa.js";import{u as rt,b as nt,E as P,d as v,e as D}from"./crmTypes-_rdtG3m5.js";import{A as ot}from"./AgendaEventSheet-Cg1jVq4i.js";import{C as he}from"./calendar-Cg5ojNWU.js";import{C as re}from"./clock-BpFhyml3.js";import{U as ue}from"./users-CAoi54g9.js";import{M as ge}from"./map-pin-BG5UyL3W.js";import{P as lt}from"./pencil-Cg4rNZO6.js";import{T as fe}from"./trash-2-CQAi9VgV.js";import{C as je}from"./chevron-left-DPhFdzgf.js";import{C as Ne}from"./chevron-right-DbAQMpk3.js";import{S as it}from"./search-BKO_jJe_.js";import"./checkbox-BknldCj9.js";import"./index-Duj2ZiZw.js";import"./check-CKVpSA4r.js";import"./arrow-up-down-CDc9giCF.js";import"./skeleton-DvD88n1b.js";import"./index-C--ltkpL.js";import"./index-m5olh0Pl.js";import"./chevron-up-VLQ2nNh1.js";import"./index-DCxkZEM0.js";import"./useQuery-BAUPoymC.js";import"./form-B4HVdY-W.js";import"./label-CXBGdOI9.js";import"./DatePickerInput-BrWA8vgt.js";import"./pt-BR-ZY5I46FX.js";import"./popover-RWDgTVEa.js";import"./sheet-BZGT4qV7.js";import"./textarea-C-ypUF8t.js";import"./useCrmFieldOptions-_aWsi9AX.js";import"./useMutation-N6yCiwHQ.js";import"./ClientSelect-WCIm_Vzv.js";import"./loader-circle-49uHq0JK.js";import"./types-Ba-nZvwf.js";function ct(x){const N=x.split("T")[0],[Y,p,H]=N.split("-");return`${H}/${p}/${Y}`}function Xt({projectId:x,clientFilter:N,hideHeader:Y}={}){const{events:p,loading:H,error:ye,deleteEvent:_,createEvent:be,updateEvent:C}=rt(),{projects:we}=nt(),[h,W]=l.useState("calendar"),[y,ne]=l.useState(""),[S,oe]=l.useState("all"),[k,le]=l.useState("all"),[z,ie]=l.useState(x||"all"),[b,U]=l.useState(()=>{const t=new Date;return{year:t.getFullYear(),month:t.getMonth()}}),[ve,O]=l.useState(!1),[G,Q]=l.useState(null),[Z,w]=l.useState(null),[dt,R]=l.useState(null),[ce,T]=l.useState(null),[u,de]=l.useState(null),F=l.useRef(null),me=l.useCallback((t,s)=>{F.current&&F.current.remove();const a=document.createElement("div");a.style.position="fixed",a.style.top="-1000px",a.style.left="-1000px",a.style.zIndex="99999",a.style.pointerEvents="none",a.innerHTML=`<div style="padding:6px 12px;background:#1a1a2e;color:#fff;border-radius:8px;font-size:12px;box-shadow:0 4px 12px rgba(0,0,0,.3);white-space:nowrap;display:flex;align-items:center;gap:6px;">
      <span style="font-weight:600;">${s.title}</span>
      ${s.time?`<span style="opacity:.7;font-size:11px;">⏰ ${s.time}</span>`:""}
    </div>`,document.body.appendChild(a),F.current=a,t.dataTransfer.setDragImage(a,0,0),setTimeout(()=>{a.remove(),F.current=null},2e3)},[]),xe=l.useCallback(async(t,s)=>{t.preventDefault(),T(null);const a=t.dataTransfer.getData("eventId");if(!a)return;const r=p.find(n=>n.id===a);if(!(!r||r.date===s))try{await C(a,{title:r.title,date:s,time:r.time,endTime:r.endTime,type:r.type,status:r.status,clientName:r.client,location:r.location,description:r.description,projectAirtableId:r.projectId}),ee.success(`"${r.title}" reagendado para ${new Date(s+"T12:00:00").toLocaleDateString("pt-BR")}`)}catch{ee.error("Erro ao reagendar")}},[p,C]),g=l.useMemo(()=>{const t=x||z;return p.filter(s=>{var a,r,n;if(N&&x){const o=(a=s.client)==null?void 0:a.toLowerCase().includes(N.toLowerCase()),m=s.projectId===x;if(!o&&!m)return!1}else if(N){if(!((r=s.client)!=null&&r.toLowerCase().includes(N.toLowerCase())))return!1}else if(t!=="all"&&s.projectId!==t)return!1;return!(y&&!s.title.toLowerCase().includes(y.toLowerCase())&&!((n=s.client)!=null&&n.toLowerCase().includes(y.toLowerCase()))||S!=="all"&&s.type!==S||k!=="all"&&s.status!==k)}).sort((s,a)=>s.date.localeCompare(a.date)||(s.time||"").localeCompare(a.time||""))},[p,y,S,k,z,x,N]),q=()=>{Q(null),O(!0)},I=t=>{Q(t),O(!0)},De=async(t,s)=>{s?await be(t):G&&await C(G.id,t)},Ce=async()=>{if(Z)try{await _(Z)}catch{ee.error("Erro ao remover compromisso.")}finally{w(null)}},Se=t=>new Date(t+"T12:00:00").toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"long"}),ke=l.useMemo(()=>{const{year:t,month:s}=b,a=new Date(t,s,1),r=new Date(t,s+1,0),n=a.getDay(),o=[],m=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`;for(let i=n-1;i>=0;i--){const V=new Date(t,s,-i);o.push({date:m(V),day:V.getDate(),isCurrentMonth:!1})}for(let i=1;i<=r.getDate();i++){const V=new Date(t,s,i);o.push({date:m(V),day:i,isCurrentMonth:!0})}for(;o.length<42;){const i=new Date(t,s+1,o.length-n-r.getDate()+1);o.push({date:m(i),day:i.getDate(),isCurrentMonth:!1})}return o},[b]),J=l.useMemo(()=>{const t=new Map;return g.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),t},[g]),E=(()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`})(),Te=l.useMemo(()=>g.filter(t=>t.date>=E).sort((t,s)=>t.date.localeCompare(s.date)||(t.time||"").localeCompare(s.time||"")).slice(0,8),[g,E]),Ee=new Date(b.year,b.month).toLocaleDateString("pt-BR",{month:"long",year:"numeric"}),Le=()=>U(t=>t.month===0?{year:t.year-1,month:11}:{...t,month:t.month-1}),Ae=()=>U(t=>t.month===11?{year:t.year+1,month:0}:{...t,month:t.month+1}),[K,X]=l.useState(0),L=l.useMemo(()=>{const t=new Date,s=new Date(t);s.setDate(t.getDate()-t.getDay()+K*7);const a=[];for(let r=0;r<7;r++){const n=new Date(s);n.setDate(s.getDate()+r),a.push(`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`)}return a},[K]),Me=l.useMemo(()=>{if(L.length===0)return"";const t=new Date(L[0]+"T12:00:00"),s=new Date(L[6]+"T12:00:00");return`${t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})} — ${s.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}`},[L]),pe=l.useMemo(()=>{const t=new Map;return g.forEach(s=>{t.has(s.date)||t.set(s.date,[]),t.get(s.date).push(s)}),Array.from(t.entries())},[g]),Be=l.useMemo(()=>[{key:"title",label:"Título",width:250,minWidth:150,sticky:!0,sortable:!0,sortFn:(t,s)=>t.title.localeCompare(s.title,"pt-BR"),render:t=>e.jsx("span",{className:"font-medium",children:t.title})},{key:"type",label:"Tipo",width:120,sortable:!0,sortFn:(t,s)=>t.type.localeCompare(s.type),render:t=>e.jsx(f,{variant:"secondary",className:d("text-[10px]",P[t.type]),children:v[t.type]}),inlineEdit:(t,s)=>e.jsxs(A,{value:t.type,onValueChange:s,children:[e.jsx(M,{className:"h-7 text-xs w-full",children:e.jsx(B,{})}),e.jsx($,{children:Object.entries(v).map(([a,r])=>e.jsx(j,{value:a,children:r},a))})]})},{key:"status",label:"Status",width:120,sortable:!0,sortFn:(t,s)=>t.status.localeCompare(s.status),render:t=>e.jsx(f,{variant:"outline",className:"text-[10px]",children:D[t.status]}),inlineEdit:(t,s)=>e.jsxs(A,{value:t.status,onValueChange:s,children:[e.jsx(M,{className:"h-7 text-xs w-full",children:e.jsx(B,{})}),e.jsx($,{children:Object.entries(D).map(([a,r])=>e.jsx(j,{value:a,children:r},a))})]})},{key:"date",label:"Data",width:120,sortable:!0,sortFn:(t,s)=>t.date.localeCompare(s.date),render:t=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),new Date(t.date+"T12:00:00").toLocaleDateString("pt-BR")]})},{key:"time",label:"Hora",width:100,sortable:!0,sortFn:(t,s)=>(t.time||"").localeCompare(s.time||""),render:t=>t.time?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),t.time,t.endTime?` — ${t.endTime}`:""]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"client",label:"Cliente",width:140,sortable:!0,sortFn:(t,s)=>(t.client??"").localeCompare(s.client??"","pt-BR"),render:t=>t.client?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),t.client]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})},{key:"location",label:"Local",width:160,sortable:!0,sortFn:(t,s)=>(t.location??"").localeCompare(s.location??"","pt-BR"),render:t=>t.location?e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),t.location]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})}],[]),$e=l.useCallback((t,s,a)=>{const r=p.find(o=>o.id===t);if(!r)return;const n={};s==="type"?n.type=a:s==="status"&&(n.status=a),C(t,{title:r.title,date:r.date,time:r.time,endTime:r.endTime,type:n.type||r.type,status:n.status||r.status,clientName:r.client,location:r.location,description:r.description,projectAirtableId:r.projectId})},[p,C]),Pe=l.useCallback(t=>{t.forEach(s=>_(s))},[_]),ze=()=>Y?e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(f,{variant:"secondary",className:"text-xs",children:[g.length," eventos"]}),e.jsxs(c,{onClick:q,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9",children:[e.jsx(ae,{className:"mr-1.5 h-4 w-4"})," Novo Compromisso"]})]}):e.jsxs("div",{className:"flex flex-col gap-3 glass p-3 sm:p-4 rounded-xl border border-border shadow-sm mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative w-full sm:min-w-[220px] sm:max-w-xs",children:[e.jsx(it,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"}),e.jsx(Qe,{placeholder:"Buscar compromisso...",value:y,onChange:t=>ne(t.target.value),className:"pl-9 w-full text-sm h-9"})]}),e.jsxs("div",{className:"flex gap-2 items-center sm:ml-auto flex-wrap",children:[e.jsxs(c,{onClick:q,className:"gold-gradient text-primary-foreground shadow-md hover:opacity-90 transition-opacity h-9 flex-1 sm:flex-none",children:[e.jsx(ae,{className:"mr-1.5 h-4 w-4"})," ",e.jsx("span",{className:"sm:inline",children:"Novo"})]}),e.jsxs("div",{className:"flex border border-border rounded-lg overflow-hidden bg-muted/40",children:[e.jsx("button",{onClick:()=>W("calendar"),className:d("px-3 sm:px-4 py-1.5 text-xs sm:text-sm font-medium transition-colors",h==="calendar"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Mês"}),e.jsx("button",{onClick:()=>W("week"),className:d("px-3 sm:px-4 py-1.5 text-xs sm:text-sm font-medium transition-colors",h==="week"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:"Semana"}),e.jsx("button",{onClick:()=>W("table"),className:d("px-3 sm:px-4 py-1.5 text-xs sm:text-sm font-medium transition-colors",h==="table"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground"),children:e.jsx(We,{className:"w-4 h-4"})})]}),ye&&e.jsx("span",{className:"text-xs text-destructive",children:"Erro"})]})]}),e.jsx("div",{className:"overflow-x-auto -mx-3 px-3 sm:mx-0 sm:px-0 scrollbar-none",children:e.jsxs("div",{className:"flex gap-2 items-center text-xs text-muted-foreground min-w-max",children:[e.jsxs(A,{value:S,onValueChange:oe,children:[e.jsx(M,{className:"w-[120px] h-8 text-xs",children:e.jsx(B,{placeholder:"Tipo"})}),e.jsxs($,{children:[e.jsx(j,{value:"all",children:"Todos Tipos"}),Object.keys(v).map(t=>e.jsx(j,{value:t,children:v[t]},t))]})]}),e.jsxs(A,{value:k,onValueChange:le,children:[e.jsx(M,{className:"w-[130px] h-8 text-xs",children:e.jsx(B,{placeholder:"Status"})}),e.jsxs($,{children:[e.jsx(j,{value:"all",children:"Todos Status"}),Object.keys(D).map(t=>e.jsx(j,{value:t,children:D[t]},t))]})]}),!x&&e.jsxs(A,{value:z,onValueChange:ie,children:[e.jsx(M,{className:"w-[140px] h-8 text-xs",children:e.jsx(B,{placeholder:"Projeto"})}),e.jsxs($,{children:[e.jsx(j,{value:"all",children:"Todos Projetos"}),we.map(t=>e.jsx(j,{value:t.id,children:t.name},t.id))]})]}),(S!=="all"||k!=="all"||z!=="all"||y)&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{oe("all"),le("all"),ie("all"),ne("")},className:"text-xs gap-1 h-8 shrink-0",children:"✕ Limpar"})]})})]});return e.jsxs(Oe.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[ze(),H?h==="list"||h==="table"?e.jsx(Ye,{}):e.jsx(He,{}):h==="table"?e.jsx(_e,{data:g,columns:Be,onEdit:I,onDelete:t=>w(t),onBulkDelete:Pe,onInlineChange:$e,emptyMessage:"Nenhum compromisso encontrado."}):h==="list"?e.jsx("div",{className:"space-y-6",children:pe.length===0?e.jsx(te,{children:e.jsxs(se,{className:"p-8 text-center text-muted-foreground",children:["Nenhum compromisso encontrado.",e.jsx("br",{}),e.jsxs(c,{variant:"outline",size:"sm",className:"mt-3 gap-1.5",onClick:q,children:[e.jsx(ae,{className:"w-4 h-4"})," Criar compromisso"]})]})}):pe.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-2 capitalize",children:[Se(t),t===E&&e.jsx(f,{variant:"secondary",className:"ml-2 text-[10px]",children:"Hoje"})]}),e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsx(te,{className:"hover:border-primary/30 transition-colors",children:e.jsx(se,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(f,{variant:"secondary",className:`text-[10px] ${P[a.type]}`,children:v[a.type]}),e.jsx(f,{variant:"outline",className:"text-[10px]",children:D[a.status]})]}),e.jsx("p",{className:"font-medium text-sm",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-1.5 text-xs text-muted-foreground",children:[a.time&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"w-3 h-3"}),a.time,a.endTime&&` — ${a.endTime}`]}),a.client&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),a.client]}),a.location&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),a.location]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>I(a),children:e.jsx(lt,{className:"w-3.5 h-3.5"})}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive",onClick:()=>w(a.id),children:e.jsx(fe,{className:"w-3.5 h-3.5"})})]})]})})},a.id))})]},t))}):h==="week"?e.jsxs(te,{children:[e.jsx(Ue,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>X(t=>t-1),children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(Ge,{className:"text-base",children:Me}),e.jsxs("div",{className:"flex items-center gap-1",children:[K!==0&&e.jsx(c,{variant:"ghost",size:"sm",className:"text-xs h-7",onClick:()=>X(0),children:"Hoje"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:()=>X(t=>t+1),children:e.jsx(Ne,{className:"w-4 h-4"})})]})]})}),e.jsx(se,{children:e.jsx("div",{className:"overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:e.jsx("div",{className:"grid grid-cols-7 gap-1 sm:gap-2",style:{minWidth:"560px"},children:L.map(t=>{const s=new Date(t+"T12:00:00"),a=t===E,r=J.get(t)||[];return e.jsxs("div",{className:d("min-h-[120px] sm:min-h-[140px] p-1.5 sm:p-2 rounded-lg border transition-colors cursor-pointer hover:bg-muted/30",a?"bg-primary/5 border-primary/30":"border-border/50",ce===t&&"bg-primary/10 ring-1 ring-primary/30"),onClick:()=>{r.length===0&&(Q(null),O(!0))},onDragOver:n=>{n.preventDefault(),T(t)},onDragLeave:()=>T(null),onDrop:n=>xe(n,t),children:[e.jsxs("div",{className:"text-center mb-1 sm:mb-2",children:[e.jsx("p",{className:"text-[9px] sm:text-[10px] text-muted-foreground capitalize",children:s.toLocaleDateString("pt-BR",{weekday:"short"})}),e.jsx("p",{className:d("text-base sm:text-lg font-bold",a&&"text-primary"),children:s.getDate()})]}),e.jsx("div",{className:"space-y-1",children:r.map(n=>e.jsxs("div",{draggable:!0,onDragStart:o=>{o.stopPropagation(),o.dataTransfer.setData("eventId",n.id),R(n.id),me(o,n)},onDragEnd:()=>R(null),className:d("text-[9px] sm:text-[10px] px-1 sm:px-1.5 py-0.5 sm:py-1 rounded cursor-grab active:cursor-grabbing hover:opacity-80 truncate",P[n.type]),onClick:o=>{o.stopPropagation(),I(n)},children:[n.time&&e.jsxs("span",{className:"font-semibold",children:[n.time," "]}),e.jsx("span",{className:"truncate",children:n.title})]},n.id))})]},t)})})})})]}):e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 rounded-xl border border-border bg-card p-4",children:[e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between w-full sm:w-auto gap-4",children:[e.jsx(c,{variant:"ghost",size:"icon",onClick:Le,children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-lg font-semibold text-foreground capitalize font-sans text-center min-w-[140px]",children:Ee}),e.jsx(c,{variant:"ghost",size:"icon",onClick:Ae,children:e.jsx(Ne,{className:"h-4 w-4"})})]}),(b.month!==new Date().getMonth()||b.year!==new Date().getFullYear())&&e.jsx(c,{variant:"outline",size:"sm",className:"text-xs h-7 gap-1",onClick:()=>U({year:new Date().getFullYear(),month:new Date().getMonth()}),children:"Hoje"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"py-1 text-center text-xs font-medium text-muted-foreground",children:t},t))}),e.jsx(Re,{delayDuration:300,children:e.jsx("div",{className:"grid grid-cols-7 gap-1",children:ke.map((t,s)=>{const a=J.get(t.date)||[],r=t.date===E,n=e.jsxs("button",{onClick:()=>{u===t.date?de(null):de(t.date)},onDragOver:o=>{o.preventDefault(),T(t.date)},onDragLeave:()=>T(null),onDrop:o=>xe(o,t.date),className:d("relative flex flex-col items-center rounded-lg p-1.5 text-sm transition-colors min-h-[48px]",!t.isCurrentMonth&&"opacity-30",r&&"ring-1 ring-accent",u===t.date&&"bg-accent/10 ring-1 ring-accent",ce===t.date&&"bg-primary/10 ring-1 ring-primary/30","hover:bg-secondary/50"),children:[e.jsx("span",{className:d("text-xs font-sans",r?"font-bold text-accent":"text-foreground"),children:t.day}),a.length>0&&e.jsx("div",{className:"mt-0.5 flex gap-0.5",children:a.slice(0,3).map(o=>e.jsx("div",{draggable:!0,onDragStart:m=>{m.stopPropagation(),m.dataTransfer.setData("eventId",o.id),R(o.id),me(m,o)},onDragEnd:()=>R(null),className:"h-1.5 w-1.5 rounded-full bg-accent cursor-grab active:cursor-grabbing"},o.id))})]},s);return a.length===0?n:e.jsxs(Fe,{children:[e.jsx(Ie,{asChild:!0,children:n}),e.jsxs(Ve,{side:"top",className:"max-w-[220px] p-2 space-y-1.5",children:[a.slice(0,5).map(o=>e.jsxs("div",{className:"flex items-start gap-1.5 text-xs",children:[e.jsx(f,{variant:"secondary",className:d("text-[8px] px-1 py-0 shrink-0",P[o.type]),children:v[o.type]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:o.title}),o.time&&e.jsxs("p",{className:"text-muted-foreground text-[10px]",children:[o.time,o.endTime?` — ${o.endTime}`:""]})]})]},o.id)),a.length>5&&e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["+",a.length-5," mais"]})]})]},s)})})})]}),e.jsxs("div",{className:"rounded-xl border border-border bg-card p-4 flex flex-col max-h-[500px] lg:max-h-[calc(100vh-220px)]",children:[e.jsx("h3",{className:"mb-3 text-sm font-medium text-foreground font-sans shrink-0",children:u?`${new Date(u+"T12:00:00").toLocaleDateString("pt-BR",{day:"numeric",month:"long"})}`:"Próximos compromissos"}),e.jsx(Ze,{className:"flex-1 -mr-2 pr-2",children:e.jsx("div",{className:"space-y-3",children:(()=>{const t=u?J.get(u)||[]:Te;return t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:u?"Nenhum compromisso neste dia.":"Nenhum compromisso futuro."}):t.map(s=>e.jsxs("div",{onClick:()=>I(s),className:"group/ev rounded-lg border border-border bg-card/80 p-3 space-y-1.5 cursor-pointer hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground font-sans flex-1 min-w-0",children:s.title}),e.jsx(c,{variant:"ghost",size:"icon",className:"h-6 w-6 shrink-0 text-destructive opacity-0 group-hover/ev:opacity-100 transition-opacity",onClick:a=>{a.stopPropagation(),w(s.id)},children:e.jsx(fe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(f,{variant:"outline",className:d("text-[10px] px-1.5 py-0 capitalize",P[s.type]),children:D[s.status]||s.status}),!u&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(he,{className:"h-3 w-3"}),ct(s.date)]}),s.time&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] text-muted-foreground",children:[e.jsx(re,{className:"h-3 w-3"}),s.time]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:s.description})]},s.id))})()})})]})]}),e.jsx(ot,{open:ve,onOpenChange:O,event:G,onSave:De,onDelete:t=>w(t)}),e.jsx(qe,{open:!!Z,onOpenChange:t=>!t&&w(null),children:e.jsxs(Je,{children:[e.jsxs(Ke,{children:[e.jsx(Xe,{children:"Remover compromisso?"}),e.jsxs(et,{children:["Esta ação remove o compromisso do banco de dados ",e.jsx("strong",{children:"e do Airtable"})," permanentemente."]})]}),e.jsxs(tt,{children:[e.jsx(st,{children:"Cancelar"}),e.jsx(at,{onClick:Ce,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, remover"})]})]})})]})}export{Xt as default};
