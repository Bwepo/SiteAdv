import{r as L,j as e}from"./index-DixcKx3f.js";import{u as H,F as B,a as l,b as i,c as n,d as c,e as d,t as M}from"./form-DJi3DG1h.js";import{D as O}from"./DatePickerInput-CXgRWxwT.js";import{S as R,b as _,c as z,d as G,e as q,f as J}from"./sheet-BjCYXMp8.js";import{I as f}from"./input-S4SE4ieG.js";import{B as C}from"./button-UQeTJvbR.js";import{T as K}from"./textarea-D2FpDeDK.js";import{S as N,a as y,b as I,c as T,d as g}from"./select-CLbTsJJp.js";import{f as Q,b as U}from"./crmTypes-CiPVSVr_.js";import{u as W}from"./useCrmFieldOptions-CIW6wzYt.js";import{C as X}from"./ClientSelect-DNdvzJbO.js";import{T as Y}from"./trash-2-DfpIpLp4.js";import{L as Z}from"./loader-circle-DoMssvgx.js";import{o as $,s as r}from"./types-Ba-nZvwf.js";const ee=$({title:r().trim().min(1,"Título obrigatório").max(200),date:r().min(1,"Data obrigatória"),time:r().optional(),endTime:r().optional(),type:r().min(1),status:r().min(1),clientId:r().optional(),clientName:r().optional(),projectId:r().optional(),location:r().max(300).optional(),description:r().max(2e3).optional()});function he({open:S,onOpenChange:p,event:a,defaultClientName:V,onSave:E,onDelete:w}){const j=!a,[h,v]=L.useState(!1),{clients:b}=Q(),{projects:u}=U(),{getOptions:F}=W(),A=F("agenda_tipo"),k=F("agenda_status"),o=H({resolver:M(ee),defaultValues:{title:"",date:"",time:"",endTime:"",type:"reuniao",status:"confirmado",clientId:"",clientName:"",projectId:"",location:"",description:""}});L.useEffect(()=>{if(S)if(a){const s=b.find(m=>{var x;return m.name.toLowerCase()===((x=a.client)==null?void 0:x.toLowerCase())}),t=u.find(m=>{var x;return m.name.toLowerCase()===((x=a.client)==null?void 0:x.toLowerCase())});o.reset({title:a.title,date:a.date,time:a.time??"",endTime:a.endTime??"",type:a.type,status:a.status,clientId:(s==null?void 0:s.id)??"",clientName:a.client??"",projectId:(t==null?void 0:t.id)??"",location:a.location??"",description:a.description??""})}else{const s=V??"",t=b.find(m=>m.name.toLowerCase()===s.toLowerCase());o.reset({title:"",date:"",time:"",endTime:"",type:"reuniao",status:"pendente",clientId:(t==null?void 0:t.id)??"",clientName:s,projectId:"",location:"",description:""})}},[S,a,b,u]);const D=s=>{if(o.setValue("projectId",s),!o.getValues("clientName")&&s!=="none"){const t=u.find(m=>m.id===s);t&&o.setValue("clientName",t.name)}},P=async s=>{v(!0);try{const t=s.projectId&&s.projectId!=="none"?s.projectId:void 0;await E({...s,projectAirtableId:t},j),p(!1)}finally{v(!1)}};return e.jsx(R,{open:S,onOpenChange:p,children:e.jsxs(_,{side:"right",className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs(z,{className:"mb-6",children:[e.jsx(G,{children:j?"Novo Compromisso":"Editar Compromisso"}),e.jsx(q,{children:j?"Preencha os dados e salve para criar o compromisso.":"Altere os campos e salve."})]}),e.jsx(B,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(P),className:"space-y-5",children:[e.jsx(l,{control:o.control,name:"title",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Título *"}),e.jsx(c,{children:e.jsx(f,{placeholder:"Ex: Reunião de alinhamento",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"date",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Data *"}),e.jsx(c,{children:e.jsx(O,{value:s.value,onChange:s.onChange})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"time",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Hora início"}),e.jsx(c,{children:e.jsx(f,{type:"time",...s})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:o.control,name:"endTime",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Hora término"}),e.jsx(c,{children:e.jsx(f,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(l,{control:o.control,name:"type",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Tipo *"}),e.jsxs(N,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(y,{children:e.jsx(I,{})})}),e.jsx(T,{children:A.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"status",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Status *"}),e.jsxs(N,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(y,{children:e.jsx(I,{})})}),e.jsx(T,{children:k.map(t=>e.jsx(g,{value:t.value,children:t.label},t.value))})]}),e.jsx(d,{})]})})]}),e.jsxs(i,{children:[e.jsx(n,{children:"Projeto"}),e.jsxs(N,{onValueChange:D,value:o.watch("projectId")||"",children:[e.jsx(y,{children:e.jsx(I,{placeholder:"Selecione um projeto..."})}),e.jsxs(T,{children:[e.jsx(g,{value:"none",children:"— Sem projeto —"}),u.map(s=>e.jsx(g,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs(i,{children:[e.jsx(n,{children:"Cliente"}),e.jsx(X,{value:o.watch("clientName")||"",onValueChange:(s,t)=>{o.setValue("clientName",s),o.setValue("clientId",t)}})]}),e.jsx(l,{control:o.control,name:"location",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Local / Link"}),e.jsx(c,{children:e.jsx(f,{placeholder:"Ex: Sala de reunião / Google Meet",...s})}),e.jsx(d,{})]})}),e.jsx(l,{control:o.control,name:"description",render:({field:s})=>e.jsxs(i,{children:[e.jsx(n,{children:"Descrição / Observações"}),e.jsx(c,{children:e.jsx(K,{placeholder:"Anotações sobre o compromisso...",className:"resize-none min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsxs(J,{className:"pt-2 gap-2 flex-col sm:flex-row",children:[!j&&a&&w&&e.jsxs(C,{type:"button",variant:"destructive",className:"sm:mr-auto",onClick:()=>{w(a.id),p(!1)},disabled:h,children:[e.jsx(Y,{className:"w-4 h-4 mr-2"})," Excluir"]}),e.jsx(C,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:h,children:"Cancelar"}),e.jsxs(C,{type:"submit",disabled:h,children:[h&&e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),j?"Criar compromisso":"Salvar alterações"]})]})]})})]})})}export{he as A};
