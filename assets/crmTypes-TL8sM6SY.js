import{$ as P,r as d,h as v,s as x}from"./index-D6dUEwVM.js";import{u as q}from"./useQuery-BgQ3VoAB.js";const u=o=>x.from(o),C={agenda:["crm","agenda"],tarefas:["crm","tarefas"],clientes:["crm","clientes"],projetos:["crm","projetos"],all:["crm"]};function j(){return`local_${crypto.randomUUID().slice(0,12)}`}async function L(){const{data:o,error:c}=await u("mladv_crm_agenda").select("airtable_id,titulo,data_local,hora_local,tipo,status,cliente,local_evento,descricao,projeto_airtable_id").order("data_local",{ascending:!1});if(c)throw c;return{events:(o||[]).map(a=>({id:a.airtable_id,title:a.titulo||"",date:a.data_local||"",time:a.hora_local||void 0,type:a.tipo||"reuniao",status:a.status||"pendente",client:a.cliente||void 0,location:a.local_evento||void 0,description:a.descricao||void 0,projectId:a.projeto_airtable_id||void 0,airtableId:a.airtable_id}))}}async function I(){const[{data:o,error:c},{data:b,error:a}]=await Promise.all([u("mladv_crm_tarefas").select("airtable_id,titulo,descricao,status,prioridade,deadline,cliente,responsavel,projeto_airtable_id,numero_processo").order("deadline",{ascending:!0,nullsFirst:!1}),u("mladv_crm_subtarefas").select("airtable_id,titulo,status,deadline,responsavel,tarefa_airtable_id,numero_processo,raw_fields")]);if(c)throw c;if(a)throw a;return{tasks:(o||[]).map(l=>{const r=(b||[]).filter(_=>_.tarefa_airtable_id===l.airtable_id).map(_=>{const E=_.raw_fields||{},k=_.status||"A fazer";return{id:_.airtable_id,title:_.titulo||"",completed:k==="Concluído",status:k,dueDate:_.deadline||void 0,assignee:_.responsavel||void 0,notes:E.Observações||void 0,numeroProcesso:_.numero_processo||void 0,parentTaskId:l.airtable_id}});return{id:l.airtable_id,title:l.titulo||"",description:l.descricao||void 0,status:l.status||"pendente",priority:l.prioridade||"media",dueDate:l.deadline||void 0,client:l.cliente||void 0,assignee:l.responsavel||void 0,projectId:l.projeto_airtable_id||void 0,numeroProcesso:l.numero_processo||void 0,subtasks:r,createdAt:"",updatedAt:"",airtableId:l.airtable_id}})}}async function h(){const{data:o,error:c}=await u("mladv_crm_clientes").select("airtable_id,nome,slug,email,telefone,endereco,documento,tipo_documento,numero_processo,data_nascimento").order("nome",{ascending:!0});if(c)throw c;return{clients:(o||[]).map(a=>({id:a.airtable_id,name:a.nome||"",slug:a.slug||"",email:a.email||void 0,telefone:a.telefone||void 0,endereco:a.endereco||void 0,documento:a.documento||void 0,tipoDocumento:a.tipo_documento||"cpf",numeroProcesso:a.numero_processo||void 0,dataNascimento:a.data_nascimento||void 0}))}}async function f(){const{data:o,error:c}=await u("mladv_crm_projetos").select("airtable_id,nome,slug,status,tipo,data_inicio,observacoes,cover_url,raw_fields,cliente").order("nome",{ascending:!0});if(c)throw c;return{projects:(o||[]).map(a=>{var S;return{id:a.airtable_id,name:a.nome||"",slug:a.slug||"",status:a.status||"Ativo",tipo:a.tipo||void 0,dataInicio:a.data_inicio||void 0,observacoes:a.observacoes||void 0,coverUrl:((S=a.raw_fields)==null?void 0:S.cover_url)||a.cover_url||void 0,cliente:a.cliente||void 0}})}}function R(){const o=P(),{data:c,isLoading:b,error:a}=q({queryKey:C.agenda,queryFn:L}),S=(c==null?void 0:c.events)??[],l=a?a.message:null,r=d.useCallback(()=>{o.invalidateQueries({queryKey:C.agenda})},[o]),_=d.useCallback(async(n,t)=>{o.setQueryData(C.agenda,m=>m&&{...m,events:m.events.map(T=>T.id===n?{...T,status:t}:T)});try{await u("mladv_crm_agenda").update({status:t}).eq("airtable_id",n)}catch{r()}},[r,o]),E=d.useCallback(async n=>{await u("mladv_crm_agenda").delete().eq("airtable_id",n),r(),v.success("Compromisso removido com sucesso.")},[r]),k=d.useCallback(async n=>{const t=j();await u("mladv_crm_agenda").insert({airtable_id:t,titulo:n.title,data_local:n.date,hora_local:n.time||null,tipo:n.type,status:n.status,cliente:n.clientName||null,local_evento:n.location||null,descricao:n.description||null,projeto_airtable_id:n.projectAirtableId||null}),r(),v.success("Compromisso criado.")},[r]),p=d.useCallback(async(n,t)=>{const m={};t.title!==void 0&&(m.titulo=t.title),t.date!==void 0&&(m.data_local=t.date),t.time!==void 0&&(m.hora_local=t.time||null),t.type!==void 0&&(m.tipo=t.type),t.status!==void 0&&(m.status=t.status),t.clientName!==void 0&&(m.cliente=t.clientName||null),t.location!==void 0&&(m.local_evento=t.location||null),t.description!==void 0&&(m.descricao=t.description||null),await u("mladv_crm_agenda").update(m).eq("airtable_id",n),r(),v.success("Compromisso atualizado.")},[r]);return{events:S,loading:b,error:l,updateEventStatus:_,updateEvent:p,createEvent:k,deleteEvent:E}}function U(){const o=P(),{data:c,isLoading:b,error:a}=q({queryKey:C.tarefas,queryFn:I}),S=(c==null?void 0:c.tasks)??[],l=a?a.message:null,r=d.useCallback(()=>{o.invalidateQueries({queryKey:C.tarefas})},[o]),_=d.useCallback(s=>{o.setQueryData(C.tarefas,e=>{if(!e)return e;const i=typeof s=="function"?s(e.tasks):s;return{...e,tasks:i}})},[o]),E=d.useCallback(async(s,e)=>{o.setQueryData(C.tarefas,i=>i&&{...i,tasks:i.tasks.map(g=>g.id===s?{...g,status:e}:g)});try{await u("mladv_crm_tarefas").update({status:e}).eq("airtable_id",s)}catch{r()}},[r,o]),k=d.useCallback(async s=>{await u("mladv_crm_tarefas").delete().eq("airtable_id",s),r(),v.success("Tarefa removida.")},[r]),p=d.useCallback(async s=>{const e=j();await u("mladv_crm_tarefas").insert({airtable_id:e,titulo:s.title,deadline:s.deadline||null,prioridade:s.priority,status:s.status,cliente:s.clientName||null,responsavel:s.assignee||null,descricao:s.description||null,projeto_airtable_id:s.projectId||null,numero_processo:s.numeroProcesso||null}),r(),v.success("Tarefa criada.")},[r]),n=d.useCallback(async(s,e)=>{o.setQueryData(C.tarefas,g=>g&&{...g,tasks:g.tasks.map(w=>{if(w.id!==s)return w;const y={...w};return e.title!==void 0&&(y.title=e.title),e.deadline!==void 0&&(y.dueDate=e.deadline||void 0),e.priority!==void 0&&(y.priority=e.priority),e.status!==void 0&&(y.status=e.status),e.clientName!==void 0&&(y.client=e.clientName||void 0),e.assignee!==void 0&&(y.assignee=e.assignee||void 0),e.description!==void 0&&(y.description=e.description||void 0),y})});const i={};e.title!==void 0&&(i.titulo=e.title),e.deadline!==void 0&&(i.deadline=e.deadline||null),e.priority!==void 0&&(i.prioridade=e.priority),e.status!==void 0&&(i.status=e.status),e.clientName!==void 0&&(i.cliente=e.clientName||null),e.assignee!==void 0&&(i.responsavel=e.assignee||null),e.description!==void 0&&(i.descricao=e.description||null),e.projectId!==void 0&&(i.projeto_airtable_id=e.projectId||null),e.numeroProcesso!==void 0&&(i.numero_processo=e.numeroProcesso||null);try{await u("mladv_crm_tarefas").update(i).eq("airtable_id",s)}catch{r(),v.error("Erro ao atualizar tarefa.");return}v.success("Tarefa atualizada.")},[r,o]),t=d.useCallback(async(s,e)=>{const i=j();return await u("mladv_crm_subtarefas").insert({airtable_id:i,titulo:e.title,tarefa_airtable_id:s,status:e.status??"A fazer",deadline:e.deadline||null,responsavel:e.assignee||null,raw_fields:e.notes?{Observações:e.notes}:{},numero_processo:e.numeroProcesso||null}),r(),v.success("Sub-tarefa criada."),i},[r]),m=d.useCallback(async(s,e)=>{o.setQueryData(C.tarefas,g=>g&&{...g,tasks:g.tasks.map(w=>({...w,subtasks:w.subtasks.map(y=>{if(y.id!==s)return y;const A={...y};return e.title!==void 0&&(A.title=e.title),e.status!==void 0&&(A.status=e.status,A.completed=e.status==="Concluído"),e.deadline!==void 0&&(A.dueDate=e.deadline||void 0),e.assignee!==void 0&&(A.assignee=e.assignee||void 0),A})}))});const i={};e.title!==void 0&&(i.titulo=e.title),e.status!==void 0&&(i.status=e.status),e.deadline!==void 0&&(i.deadline=e.deadline||null),e.assignee!==void 0&&(i.responsavel=e.assignee||null),e.numeroProcesso!==void 0&&(i.numero_processo=e.numeroProcesso||null);try{await u("mladv_crm_subtarefas").update(i).eq("airtable_id",s)}catch{r(),v.error("Erro ao atualizar sub-tarefa.");return}v.success("Sub-tarefa atualizada.")},[r,o]),T=d.useCallback(async s=>{await u("mladv_crm_subtarefas").delete().eq("airtable_id",s),r(),v.success("Sub-tarefa removida.")},[r]);return{tasks:S,setTasks:_,loading:b,error:l,updateTaskStatus:E,deleteTask:k,createTask:p,updateTask:n,createSubtask:t,updateSubtask:m,deleteSubtask:T}}function K(){const{data:o,isLoading:c,error:b}=q({queryKey:C.clientes,queryFn:h}),a=(o==null?void 0:o.clients)??[],S=b?b.message:null;return{clients:a,loading:c,error:S}}function N(){const o=P(),{data:c,isLoading:b,error:a}=q({queryKey:C.projetos,queryFn:f}),S=(c==null?void 0:c.projects)??[],l=a?a.message:null,r=d.useCallback(()=>{o.invalidateQueries({queryKey:C.projetos})},[o]),_=d.useCallback(async p=>{const n=j(),t=p.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");await u("mladv_crm_projetos").insert({airtable_id:n,nome:p.name,slug:t,status:p.status||"Ativo",tipo:p.tipo||null,observacoes:p.observacoes||null,cliente:p.cliente||null}),r(),v.success("Projeto criado.")},[r]),E=d.useCallback(async(p,n)=>{const t={};n.name!==void 0&&(t.nome=n.name,t.slug=n.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),n.status!==void 0&&(t.status=n.status),n.tipo!==void 0&&(t.tipo=n.tipo||null),n.observacoes!==void 0&&(t.observacoes=n.observacoes||null),n.cliente!==void 0&&(t.cliente=n.cliente||null),await u("mladv_crm_projetos").update(t).eq("airtable_id",p),r(),v.success("Projeto atualizado.")},[r]),k=d.useCallback(async p=>{await u("mladv_crm_projetos").delete().eq("airtable_id",p),r(),v.success("Projeto removido.")},[r]);return{projects:S,loading:b,error:l,createProject:_,updateProject:E,deleteProject:k}}const D={"A fazer":"A fazer","Em andamento":"Em andamento",Concluído:"Concluído"},Q={"A fazer":"bg-red-100 text-red-800","Em andamento":"bg-yellow-100 text-yellow-800",Concluído:"bg-green-100 text-green-800"},B=["Ativo","Arquivado","Encerrado","Suspenso"],F={reuniao:"Reunião",audiencia:"Audiência",prazo:"Prazo",consulta:"Consulta",lembrete:"Lembrete",outro:"Outro"},M={confirmado:"Confirmado",pendente:"Pendente",cancelado:"Cancelado",reagendado:"Reagendado"},Y={pendente:"Pendente",agendado:"Agendado",em_andamento:"Em Andamento",em_tramite:"Em Trâmite",concluida:"Concluída",cancelada:"Cancelada"},V={alta:"Alta",media:"Média",baixa:"Baixa"},$={reuniao:"bg-blue-100 text-blue-800",audiencia:"bg-purple-100 text-purple-800",prazo:"bg-red-100 text-red-800",consulta:"bg-green-100 text-green-800",lembrete:"bg-yellow-100 text-yellow-800",outro:"bg-gray-100 text-gray-800"},G={alta:"bg-red-100 text-red-800",media:"bg-yellow-100 text-yellow-800",baixa:"bg-green-100 text-green-800"},H={pendente:"bg-red-100 text-red-800",agendado:"bg-slate-100 text-slate-800",em_andamento:"bg-yellow-100 text-yellow-800",em_tramite:"bg-blue-100 text-blue-800",concluida:"bg-green-100 text-green-800",cancelada:"bg-gray-100 text-gray-800"},J=["Mariana Lima","Equipe ML"];export{$ as E,B as P,D as S,G as T,U as a,N as b,V as c,F as d,M as e,K as f,J as g,Q as h,H as i,Y as j,R as u};
