var W=e=>{throw TypeError(e)};var Q=(e,t,s)=>t.has(e)||W("Cannot "+s);var i=(e,t,s)=>(Q(e,t,"read from private field"),s?s.call(e):t.get(e)),q=(e,t,s)=>t.has(e)?W("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),S=(e,t,s,r)=>(Q(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),K=(e,t,s)=>(Q(e,t,"access private method"),s);import{ab as T,ac as V,ad as D,ae as G,af as L,V as E,r as M,ag as H,ah as J,a5 as O,s as u}from"./index-BYSmSza6.js";var y,g,d,m,f,C,x,I,N=(I=class extends T{constructor(t,s){super();q(this,f);q(this,y);q(this,g);q(this,d);q(this,m);S(this,y,t),this.setOptions(s),this.bindMethods(),K(this,f,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const s=this.options;this.options=i(this,y).defaultMutationOptions(t),V(this.options,s)||i(this,y).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,d),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&D(s.mutationKey)!==D(this.options.mutationKey)?this.reset():((r=i(this,d))==null?void 0:r.state.status)==="pending"&&i(this,d).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,d))==null||t.removeObserver(this)}onMutationUpdate(t){K(this,f,C).call(this),K(this,f,x).call(this,t)}getCurrentResult(){return i(this,g)}reset(){var t;(t=i(this,d))==null||t.removeObserver(this),S(this,d,void 0),K(this,f,C).call(this),K(this,f,x).call(this)}mutate(t,s){var r;return S(this,m,s),(r=i(this,d))==null||r.removeObserver(this),S(this,d,i(this,y).getMutationCache().build(i(this,y),this.options)),i(this,d).addObserver(this),i(this,d).execute(t)}},y=new WeakMap,g=new WeakMap,d=new WeakMap,m=new WeakMap,f=new WeakSet,C=function(){var s;const t=((s=i(this,d))==null?void 0:s.state)??G();S(this,g,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},x=function(t){L.batch(()=>{var s,r,a,l,n,o,p,_;if(i(this,m)&&this.hasListeners()){const c=i(this,g).variables,v=i(this,g).context;(t==null?void 0:t.type)==="success"?((r=(s=i(this,m)).onSuccess)==null||r.call(s,t.data,c,v),(l=(a=i(this,m)).onSettled)==null||l.call(a,t.data,null,c,v)):(t==null?void 0:t.type)==="error"&&((o=(n=i(this,m)).onError)==null||o.call(n,t.error,c,v),(_=(p=i(this,m)).onSettled)==null||_.call(p,void 0,t.error,c,v))}this.listeners.forEach(c=>{c(i(this,g))})})},I);function F(e,t){const s=E(),[r]=M.useState(()=>new N(s,e));M.useEffect(()=>{r.setOptions(e)},[r,e]);const a=M.useSyncExternalStore(M.useCallback(n=>r.subscribe(L.batchCalls(n)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),l=M.useCallback((n,o)=>{r.mutate(n,o).catch(H)},[r]);if(a.error&&J(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}async function A(e){if(e.length===0)return new Map;const{data:t,error:s}=await u.from("mladv_post_categories").select("post_id, category_id").in("post_id",e);if(s||!t)return new Map;const r=[...new Set(t.map(p=>p.category_id))];if(r.length===0)return new Map;const{data:a,error:l}=await u.from("mladv_categories").select("*").in("id",r);if(l||!a)return new Map;const n=new Map(a.map(p=>[p.id,p])),o=new Map;return e.forEach(p=>{const _=t.filter(c=>c.post_id===p).map(c=>n.get(c.category_id)).filter(c=>c!==void 0);o.set(p,_)}),o}function et(e={}){const{published:t,page:s=1,pageSize:r=10,search:a,categorySlug:l,tag:n}=e;return O({queryKey:["posts",{published:t,page:s,pageSize:r,search:a,categorySlug:l,tag:n}],queryFn:async()=>{if(l){const{data:b}=await u.from("mladv_categories").select("id").eq("slug",l).maybeSingle();if(!b)return{posts:[],total:0,totalPages:0};const{data:P}=await u.from("mladv_post_categories").select("post_id").eq("category_id",b.id),k=(P==null?void 0:P.map(w=>w.post_id))||[];if(k.length===0)return{posts:[],total:0,totalPages:0};let h=u.from("mladv_posts").select("*",{count:"exact"}).in("id",k);t!==void 0&&(h=h.eq("published",t)),a&&(h=h.or(`title.ilike.%${a}%,content_html.ilike.%${a}%`)),n&&(h=h.contains("tags",[n])),h=h.order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).range((s-1)*r,s*r-1);const{data:z,error:R,count:$}=await h;if(R)throw R;const U=z||[],B=await A(U.map(w=>w.id));return{posts:U.map(w=>({...w,categories:B.get(w.id)||[]})),total:$??0,totalPages:Math.ceil(($??0)/r)}}let o=u.from("mladv_posts").select("*",{count:"exact"});t!==void 0&&(o=o.eq("published",t)),a&&(o=o.or(`title.ilike.%${a}%,content_html.ilike.%${a}%`)),n&&(o=o.contains("tags",[n])),o=o.order("published_at",{ascending:!1,nullsFirst:!1}).order("created_at",{ascending:!1}).range((s-1)*r,s*r-1);const{data:p,error:_,count:c}=await o;if(_)throw _;const v=p||[],j=await A(v.map(b=>b.id));return{posts:v.map(b=>({...b,categories:j.get(b.id)||[]})),total:c??0,totalPages:Math.ceil((c??0)/r)}}})}function st(e){return O({queryKey:["post",e],queryFn:async()=>{const{data:t,error:s}=await u.from("mladv_posts").select("*").eq("slug",e).eq("published",!0).maybeSingle();if(s)throw s;return t},enabled:!!e})}function rt(e){return O({queryKey:["post-by-id",e],queryFn:async()=>{const{data:t,error:s}=await u.from("mladv_posts").select("*").eq("id",e).maybeSingle();if(s)throw s;return t},enabled:!!e})}function at(){return O({queryKey:["all-posts"],queryFn:async()=>{const{data:e,error:t}=await u.from("mladv_posts").select("*").order("created_at",{ascending:!1});if(t)throw t;return e||[]}})}function it(){const e=E();return F({mutationFn:async t=>{const{data:s,error:r}=await u.from("mladv_posts").insert(t).select().single();if(r)throw r;return s},onSuccess:()=>{e.invalidateQueries({queryKey:["posts"]}),e.invalidateQueries({queryKey:["all-posts"]})}})}function ot(){const e=E();return F({mutationFn:async({id:t,...s})=>{const{data:r,error:a}=await u.from("mladv_posts").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(a)throw a;return r},onSuccess:t=>{e.invalidateQueries({queryKey:["posts"]}),e.invalidateQueries({queryKey:["all-posts"]}),e.invalidateQueries({queryKey:["post",t.slug]}),e.invalidateQueries({queryKey:["post-by-id",t.id]})}})}function nt(){const e=E();return F({mutationFn:async t=>{(await Promise.all([{table:"mladv_post_categories",result:u.from("mladv_post_categories").delete().eq("post_id",t)},{table:"mladv_newsletter_campaigns",result:u.from("mladv_newsletter_campaigns").update({post_id:null}).eq("post_id",t)},{table:"mladv_post_views",result:u.from("mladv_post_views").delete().eq("post_id",t)},{table:"mladv_post_likes",result:u.from("mladv_post_likes").delete().eq("post_id",t)},{table:"mladv_post_comments",result:u.from("mladv_post_comments").delete().eq("post_id",t)}])).forEach(({table:a,result:l})=>{var n;if(l.error){const o=typeof((n=l.error)==null?void 0:n.message)=="string"?l.error.message:String(l.error);throw new Error(`Erro ao limpar ${a}: ${o}`)}});const{error:r}=await u.from("mladv_posts").delete().eq("id",t);if(r){const a=typeof(r==null?void 0:r.message)=="string"?r.message:String(r);throw new Error(`Erro ao excluir post: ${a}`)}},onSuccess:()=>{e.invalidateQueries({queryKey:["posts"]}),e.invalidateQueries({queryKey:["all-posts"]}),e.invalidateQueries({queryKey:["post-views"]}),e.invalidateQueries({queryKey:["post-likes"]}),e.invalidateQueries({queryKey:["post-comments"]}),e.invalidateQueries({queryKey:["all-comments"]})}})}export{st as a,at as b,ot as c,nt as d,F as e,it as f,rt as g,et as u};
